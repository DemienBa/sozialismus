<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Das Wesen des linken Denkens</title>
  
  <!-- Open Graph / Social Media -->
  <meta property="og:title" content="Das Wesen des linken Denkens">
  <meta property="og:description" content="Interaktive Kartografie linker Ideen, Positionen und Debatten. Erkunde das lebendige Netzwerk politischer Theorie.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://example.com/wesen-preview.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Das Wesen des linken Denkens">
  <meta name="twitter:description" content="Interaktive Kartografie linker Ideen, Positionen und Debatten.">
  
  <!-- Theme Color -->
  <meta name="theme-color" content="#E53935">
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       THEME-SYSTEM: CSS-Variablen
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #222;
      --bg-tertiary: #2a2a2a;
      --text-primary: #f5f5f5;
      --text-secondary: #aaa;
      --text-muted: #666;
      --accent: #E53935;
      --accent-secondary: #4CAF50;
      --accent-tertiary: #2196F3;
      --border: #333;
      --border-light: #444;
      --glow: rgba(229, 57, 53, 0.3);
      --font-main: 'Helvetica Neue', Arial, sans-serif;
      --font-display: 'Helvetica Neue', Arial, sans-serif;
      --font-mono: 'Courier New', monospace;
      --radius: 0px;
      --transition: 0.3s;
    }
    
    /* ğŸŒ¿ MYZEL - Organisch, wachsend, pilzartig */
    body.theme-myzel {
      --bg-primary: #0a1208;
      --bg-secondary: #0f1a0d;
      --bg-tertiary: #152211;
      --text-primary: #c8d4c0;
      --text-secondary: #8a9a7a;
      --text-muted: #566046;
      --accent: #7cb342;
      --accent-secondary: #ab47bc;
      --accent-tertiary: #5d99c6;
      --border: #2a3a22;
      --border-light: #3a4a32;
      --glow: rgba(124, 179, 66, 0.4);
      --font-main: 'Georgia', 'Times New Roman', serif;
      --font-display: 'Georgia', serif;
      --radius: 20px;
    }
    
    body.theme-myzel::before {
      content: '';
      position: fixed;
      inset: 0;
      background: 
        radial-gradient(ellipse at 20% 80%, rgba(124, 179, 66, 0.05) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, rgba(171, 71, 188, 0.05) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(93, 153, 198, 0.03) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }
    
    /* ğŸ”¥ BARRIKADE - Agitprop, revolutionÃ¤r, plakatartig */
    body.theme-barrikade {
      --bg-primary: #1a0a0a;
      --bg-secondary: #220808;
      --bg-tertiary: #2a0c0c;
      --text-primary: #fff;
      --text-secondary: #ffcccc;
      --text-muted: #aa6666;
      --accent: #ff1744;
      --accent-secondary: #ffd600;
      --accent-tertiary: #000;
      --border: #440000;
      --border-light: #660000;
      --glow: rgba(255, 23, 68, 0.5);
      --font-main: 'Impact', 'Arial Black', sans-serif;
      --font-display: 'Impact', 'Arial Black', sans-serif;
      --radius: 0px;
    }
    
    body.theme-barrikade h1,
    body.theme-barrikade h2,
    body.theme-barrikade h3 {
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    
    /* ğŸ’» TERMINAL - Hacker, CLI, Retro-Computer */
    body.theme-terminal {
      --bg-primary: #0a0a0a;
      --bg-secondary: #0f0f0f;
      --bg-tertiary: #141414;
      --text-primary: #00ff00;
      --text-secondary: #00cc00;
      --text-muted: #006600;
      --accent: #00ff00;
      --accent-secondary: #ffff00;
      --accent-tertiary: #00ffff;
      --border: #003300;
      --border-light: #004400;
      --glow: rgba(0, 255, 0, 0.3);
      --font-main: 'Courier New', 'Monaco', monospace;
      --font-display: 'Courier New', monospace;
      --radius: 0px;
    }
    
    body.theme-terminal * {
      text-shadow: 0 0 5px var(--glow);
    }
    
    body.theme-terminal::before {
      content: '';
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.1) 0px,
        rgba(0, 0, 0, 0.1) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      z-index: 9999;
    }
    
    /* ğŸŒŒ KOSMOS - Kosmisch, Sterne, unendlich */
    body.theme-kosmos {
      --bg-primary: #050510;
      --bg-secondary: #0a0a1a;
      --bg-tertiary: #101025;
      --text-primary: #e0e0ff;
      --text-secondary: #a0a0cc;
      --text-muted: #606088;
      --accent: #7c4dff;
      --accent-secondary: #00e5ff;
      --accent-tertiary: #ff4081;
      --border: #1a1a3a;
      --border-light: #2a2a4a;
      --glow: rgba(124, 77, 255, 0.4);
      --font-main: 'Segoe UI', 'Roboto', sans-serif;
      --font-display: 'Segoe UI', sans-serif;
      --radius: 8px;
    }
    
    body.theme-kosmos::before {
      content: '';
      position: fixed;
      inset: 0;
      background: 
        radial-gradient(2px 2px at 20% 30%, white, transparent),
        radial-gradient(2px 2px at 40% 70%, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 90% 40%, white, transparent),
        radial-gradient(2px 2px at 60% 80%, rgba(255,255,255,0.6), transparent),
        radial-gradient(1px 1px at 30% 50%, white, transparent),
        radial-gradient(1px 1px at 70% 20%, rgba(255,255,255,0.7), transparent),
        radial-gradient(2px 2px at 80% 90%, white, transparent),
        radial-gradient(1px 1px at 10% 60%, rgba(255,255,255,0.5), transparent);
      pointer-events: none;
      z-index: 0;
    }
    
    /* ğŸšï¸ RUINE - Verfallen, archÃ¤ologisch, fragmentiert */
    body.theme-ruine {
      --bg-primary: #1a1815;
      --bg-secondary: #22201a;
      --bg-tertiary: #2a2820;
      --text-primary: #d4cfc0;
      --text-secondary: #a09080;
      --text-muted: #706050;
      --accent: #c49a6c;
      --accent-secondary: #8b7355;
      --accent-tertiary: #6b8e23;
      --border: #3a3530;
      --border-light: #4a4540;
      --glow: rgba(196, 154, 108, 0.3);
      --font-main: 'Palatino', 'Book Antiqua', serif;
      --font-display: 'Palatino', serif;
      --radius: 2px;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: var(--font-main);
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      transition: background var(--transition), color var(--transition);
    }
    
    header {
      padding: 0.75rem 1.5rem;
      border-bottom: 1px solid var(--border);
      background: var(--bg-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      position: relative;
      z-index: 200;
      margin-left: 56px;
      height: 50px;
      transition: margin-left 0.3s;
    }
    
    body.palette-expanded header {
      margin-left: 180px;
    }
    
    /* Mobile: Header ohne margin */
    @media (max-width: 600px) {
      header {
        margin-left: 0 !important;
        height: auto;
        min-height: 50px;
      }
    }
    
    h1 {
      font-family: var(--font-display);
      font-size: 1.1rem;
      font-weight: 400;
      letter-spacing: 0.05em;
      color: var(--text-primary);
    }
    
    .stats {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    
    .linsen {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
      align-items: center;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LINSEN-PALETTE: Spielerisches Interface
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    /* Palette am linken Rand */
    .linsen-palette {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 56px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      padding: 0.5rem;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      overflow-y: auto;
      transition: width 0.3s ease;
    }
    
    .linsen-palette.expanded {
      width: 180px;
      padding: 0.75rem;
    }
    
    .palette-toggle {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      transition: all 0.2s;
    }
    
    .palette-toggle:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
    
    .palette-section {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border);
    }
    
    .palette-section:last-child {
      border-bottom: none;
    }
    
    .palette-section-label {
      font-size: 0.6rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 0 0.25rem;
      display: none;
    }
    
    .linsen-palette.expanded .palette-section-label {
      display: block;
    }
    
    /* Einzelne Linse */
    .linse {
      width: 40px;
      height: 40px;
      border-radius: 20px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      flex-shrink: 0;
      overflow: hidden;
    }
    
    .linse:hover {
      transform: scale(1.05);
      border-color: var(--accent);
      box-shadow: 0 0 15px var(--glow);
    }
    
    .linse.active {
      background: var(--accent);
      border-color: var(--accent);
      box-shadow: 0 0 20px var(--glow);
    }
    
    .linse.ansicht { border-color: #E53935; }
    .linse.ansicht:hover, .linse.ansicht.active { background: rgba(229, 57, 53, 0.3); }
    
    .linse.filter { border-color: #FF9800; border-style: dashed; }
    .linse.filter:hover, .linse.filter.active { background: rgba(255, 152, 0, 0.3); }
    
    .linse.werkzeug { border-color: #9C27B0; }
    .linse.werkzeug:hover, .linse.werkzeug.active { background: rgba(156, 39, 176, 0.3); }
    
    /* Label versteckt im collapsed state */
    .linse-label {
      display: none;
    }
    
    /* Wrapper */
    .linse-wrapper {
      display: flex;
      align-items: center;
    }
    
    /* EXPANDED STATE */
    .linsen-palette.expanded .linse {
      width: auto;
      min-width: 40px;
      padding-right: 12px;
      gap: 8px;
    }
    
    .linsen-palette.expanded .linse-label {
      display: inline;
      font-size: 0.75rem;
      color: var(--text-primary);
      white-space: nowrap;
    }
    
    /* Linse-Gruppen (aufklappbar) */
    .linse-gruppe {
      margin: 0.15rem 0;
    }
    .linse.gruppe-header {
      position: relative;
      border-color: #444;
      background: rgba(255,255,255,0.02);
    }
    .linse.gruppe-header:hover {
      border-color: #666;
      background: rgba(255,255,255,0.05);
    }
    .gruppe-pfeil {
      position: absolute;
      right: 4px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.6rem;
      color: #666;
      transition: transform 0.2s;
    }
    .linsen-palette.expanded .gruppe-pfeil {
      right: 8px;
    }
    .linse-gruppe.open .gruppe-pfeil {
      transform: translateY(-50%) rotate(90deg);
    }
    
    .gruppe-inhalt {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .linse-gruppe.open .gruppe-inhalt {
      max-height: 200px;
    }
    
    .linse-wrapper.sub {
      padding-left: 0.5rem;
    }
    .linse.sub {
      font-size: 0.9rem;
      opacity: 0.85;
      border-left: 2px solid transparent;
    }
    .linse.sub:hover {
      opacity: 1;
    }
    .linse.sub.active {
      border-left-color: var(--accent);
    }
    
    /* Disabled Extra-Button */
    .extra-btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .extra-btn.disabled:hover {
      background: transparent;
      transform: none;
    }
    
    /* Schwebende Linse (folgt Cursor) */
    .floating-linse {
      display: none !important;
      position: fixed;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--bg-secondary);
      border: 3px solid var(--accent);
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 0 30px var(--glow), 0 5px 20px rgba(0,0,0,0.5);
      animation: float-pulse 1.5s ease-in-out infinite;
    }
    
    .floating-linse.visible {
      display: flex;
    }
    
    .floating-linse.filter {
      border-color: #FF9800;
      box-shadow: 0 0 30px rgba(255, 152, 0, 0.5), 0 5px 20px rgba(0,0,0,0.5);
    }
    
    .floating-linse.werkzeug {
      border-color: #9C27B0;
      box-shadow: 0 0 30px rgba(156, 39, 176, 0.5), 0 5px 20px rgba(0,0,0,0.5);
    }
    
    @keyframes float-pulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.05); }
    }
    
    /* Aktive Linsen-Anzeige (unten) - deaktiviert */
    .active-linsen {
      display: none !important;
    }
    
    body.palette-expanded .active-linsen {
      display: none !important;
    }
    
    .active-linsen:empty {
      display: none;
    }
    
    .active-chip {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      background: var(--bg-tertiary);
      border-radius: 20px;
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
    }
    
    .active-chip.ansicht { border-left: 3px solid #E53935; }
    .active-chip.filter { border-left: 3px solid #FF9800; }
    
    .active-chip .remove {
      cursor: pointer;
      opacity: 0.6;
      font-size: 0.9rem;
    }
    
    .active-chip .remove:hover {
      opacity: 1;
    }
    
    .active-linsen .separator {
      color: var(--text-muted);
      font-size: 1.2rem;
    }
    
    /* Hinweis-Box beim Aufnehmen */
    .linse-hint {
      display: none !important;
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-secondary);
      border: 1px solid var(--accent);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 0.85rem;
      color: var(--text-primary);
      z-index: 1001;
      display: none;
      animation: hint-appear 0.3s ease;
    }
    
    .linse-hint.visible {
      display: block;
    }
    
    @keyframes hint-appear {
      from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    
    /* Anwende-Animation */
    .viewport-glow {
      display: none !important;
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 98;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .viewport-glow.active {
      opacity: 1;
      animation: glow-ripple 0.6s ease-out;
    }
    
    @keyframes glow-ripple {
      0% { 
        box-shadow: inset 0 0 0 0 var(--glow);
        opacity: 1;
      }
      100% { 
        box-shadow: inset 0 0 100px 50px transparent;
        opacity: 0;
      }
    }
    
    /* Epoche-Slider in der Palette */
    .epoche-slider-vertical {
      display: none;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem 0;
    }
    
    .epoche-slider-vertical.visible {
      display: flex;
    }
    
    .epoche-slider-vertical input[type="range"] {
      writing-mode: vertical-lr;
      direction: rtl;
      height: 100px;
      width: 20px;
      accent-color: #FF9800;
    }
    
    .epoche-slider-vertical .epoche-value {
      font-size: 0.7rem;
      color: #FF9800;
      margin-top: 0.3rem;
    }
    
    /* Extras (Theme, Share) am unteren Rand der Palette */
    .palette-extras {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      margin-top: auto;
      padding-top: 0.5rem;
      border-top: 1px solid var(--border);
    }
    
    .extra-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .extra-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    
    /* Alte Navigation verstecken */
    .linsen-nav {
      display: none !important;
    }
    
    .filter-bar {
      display: none !important;
    }
    
    /* Theme-Modal */
    .theme-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .theme-modal.open {
      display: flex;
    }
    
    .theme-modal-content {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .theme-modal h2 {
      margin-bottom: 1.5rem;
      color: var(--text-primary);
    }
    
    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
    }
    
    .theme-option {
      background: var(--bg-tertiary);
      border: 2px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }
    
    .theme-option:hover {
      border-color: var(--accent);
    }
    
    .theme-option.active {
      border-color: var(--accent);
      background: rgba(229, 57, 53, 0.1);
    }
    
    .theme-option .icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    
    .theme-option .name {
      font-weight: bold;
      color: var(--text-primary);
    }
    
    .theme-option .desc {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.3rem;
    }
    
    /* Social Media Buttons */
    .social-btn {
      padding: 0.5rem 1rem;
      border: none;
      color: #fff;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.8rem;
      transition: opacity 0.2s;
    }
    
    .social-btn:hover {
      opacity: 0.8;
    }
    
    .share-section {
      padding: 1rem;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    
    /* Filter-Bar (zeigt aktive Filter) */
    .filter-bar {
      display: none;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 2rem;
      background: rgba(255, 152, 0, 0.05);
      border-bottom: 1px solid #333;
    }
    
    .filter-bar.visible {
      display: flex;
    }
    
    .filter-bar-label {
      font-size: 0.7rem;
      color: #888;
    }
    
    .filter-chips {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .filter-chip {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(255, 152, 0, 0.2);
      border: 1px solid #FF9800;
      color: #FF9800;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      font-size: 0.7rem;
    }
    
    .filter-chip .remove {
      cursor: pointer;
      opacity: 0.7;
      font-size: 0.8rem;
    }
    
    .filter-chip .remove:hover {
      opacity: 1;
    }
    
    .epoche-control {
      display: none;
      align-items: center;
      gap: 0.5rem;
      margin-left: auto;
    }
    
    .epoche-control.visible {
      display: flex;
    }
    
    .epoche-control input[type="range"] {
      width: 150px;
      accent-color: #FF9800;
    }
    
    #epoche-wert {
      font-size: 0.75rem;
      color: #FF9800;
      min-width: 60px;
    }
    
    /* Linsen-Trenner entfernen (nicht mehr nÃ¶tig) */
    .linsen-trenner {
      display: none;
    }
    
    /* Alte Linsen-Buttons verstecken falls noch vorhanden */
    .linse-btn {
      display: none;
    }
    
    /* Wesen-Container (Startbildschirm) */
    #wesen-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      display: block;
    }
    
    #wesen-container.hidden {
      display: none;
    }
    
    #wesen-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .wesen-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      text-align: center;
      pointer-events: none;
      opacity: 0.6;
      transition: opacity 0.3s;
    }
    
    .wesen-overlay h2 {
      font-weight: 300;
      font-size: 1.5rem;
      color: rgba(255,255,255,0.5);
      margin-bottom: 0.5rem;
    }
    
    .wesen-overlay p {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.3);
    }
    
    #wesen-container.drag-active .wesen-overlay {
      opacity: 1;
    }
    
    #wesen-container.drag-active .wesen-overlay h2 {
      color: #E53935;
    }
    
    /* Linsen als draggable */
    .linse-btn {
      cursor: grab;
    }
    
    .linse-btn:active {
      cursor: grabbing;
    }
    
    .linse-btn.dragging {
      opacity: 0.5;
    }

    main {
      display: flex;
      height: calc(100vh - 50px);
      margin-left: 56px; /* Platz fÃ¼r Palette */
      transition: margin-left 0.3s;
    }
    
    body.palette-expanded main {
      margin-left: 180px;
    }
    
    #netzwerk-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      min-height: 500px;
      height: calc(100vh - 50px);
      display: none;
      background: var(--bg-primary);
    }
    
    #netzwerk-container.hidden {
      display: none;
    }
    
    #netzwerk3d {
      width: 100%;
      height: 100%;
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }
    
    /* Touch-Hinweis fÃ¼r Mobile */
    .touch-hint {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.85);
      color: #fff;
      padding: 0.6rem 1.2rem;
      border-radius: 25px;
      font-size: 0.8rem;
      z-index: 500;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .touch-hint.visible {
      opacity: 1;
    }
    
    #detail-panel {
      width: 420px;
      background: #222;
      border-left: 1px solid #333;
      overflow-y: auto;
      padding: 1.5rem;
      display: none;
      position: relative;
    }
    
    #detail-panel.open {
      display: block;
    }
    
    #detail-panel h2 {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #E53935;
    }
    
    .achse-tag {
      display: inline-block;
      background: #333;
      padding: 0.2rem 0.5rem;
      font-size: 0.7rem;
      border-radius: 3px;
      margin-bottom: 1rem;
    }
    
    .beschreibung {
      font-size: 0.95rem;
      line-height: 1.6;
      color: #ccc;
      margin-bottom: 1.5rem;
    }
    
    #detail-panel h3 {
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      color: #888;
      margin: 1.5rem 0 0.75rem;
      text-transform: uppercase;
    }
    
    .zitat {
      background: #2a2a2a;
      padding: 1rem;
      border-left: 3px solid #E53935;
      margin-bottom: 0.75rem;
      font-style: italic;
      font-size: 0.95rem;
      line-height: 1.5;
    }
    
    .zitat-autor {
      font-size: 0.8rem;
      color: #888;
      margin-top: 0.5rem;
      font-style: normal;
    }
    
    .bewohner {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .bewohner span {
      background: #333;
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
      border-radius: 3px;
    }
    
    .person-link {
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .person-link:hover {
      color: var(--accent);
      text-decoration: underline;
    }
    
    .bewohner .person-link {
      display: inline-block;
      background: #333;
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
      border-radius: 3px;
    }
    
    .bewohner .person-link:hover {
      background: #444;
    }
    
    .literatur-item {
      background: #2a2a2a;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border-radius: 4px;
    }
    
    .literatur-item .titel {
      font-weight: 600;
      color: #fff;
    }
    
    .literatur-item .autor {
      font-size: 0.85rem;
      color: #888;
    }
    
    .frei-tag {
      display: inline-block;
      background: #4CAF50;
      color: #fff;
      font-size: 0.65rem;
      padding: 0.1rem 0.4rem;
      border-radius: 2px;
      margin-left: 0.5rem;
    }
    
    .literatur-item a {
      color: #E53935;
      font-size: 0.8rem;
      text-decoration: none;
    }
    
    .literatur-item a:hover {
      text-decoration: underline;
    }
    
    .verbindungen {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .verbindung {
      background: #333;
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .verbindung:hover {
      background: #E53935;
    }
    
    .verbindung.stark {
      border: 1px solid #4CAF50;
    }
    
    .verbindung.debatte {
      border: 1px solid #FF9800;
    }
    
    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: #888;
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    .close-btn:hover {
      color: #fff;
    }
    
    .atmosphaere {
      background: #1a1a1a;
      padding: 1rem;
      border-radius: 4px;
      font-size: 0.85rem;
      color: #888;
      line-height: 1.6;
    }
    
    #debatten-container {
      flex: 1;
      display: none;
      padding: 2rem;
      overflow-y: auto;
    }
    
    #debatten-container.active {
      display: block;
    }
    
    .debatte-card {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .debatte-card h2 {
      font-size: 1.2rem;
      color: #FF9800;
      margin-bottom: 0.5rem;
    }
    
    .debatte-card .frage {
      font-style: italic;
      color: #aaa;
      margin-bottom: 1.5rem;
    }
    
    .debatte-seiten {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    
    @media (max-width: 600px) {
      .debatte-seiten {
        grid-template-columns: 1fr;
      }
      #detail-panel {
        width: 100%;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 100;
        padding-top: 4.5rem; /* Platz fÃ¼r Header */
      }
      
      #detail-panel.open {
        display: flex;
        flex-direction: column;
      }
      
      #detail-panel .close-btn {
        position: fixed;
        top: auto;
        bottom: 5rem; /* Ãœber der unteren Navigation */
        right: 1rem;
        width: 44px;
        height: 44px;
        background: #E53935;
        border: none;
        border-radius: 50%;
        color: #fff;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 250; /* HÃ¶her als linsen-palette (200) */
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      }
      
      #detail-panel #detail-content {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 4rem; /* Platz fÃ¼r Close-Button */
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Zufall-Container - mehr Padding oben fÃ¼r Header
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      #zufall-container {
        padding-top: 5rem;
        align-items: flex-start;
      }
      .zufall-card {
        margin: 0 0.5rem;
        padding: 1.5rem 1rem;
      }
      .zufall-card h2 {
        font-size: 1.2rem;
        padding-right: 2rem;
      }
      .zufall-close {
        top: 0.75rem;
        right: 0.75rem;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Header - kompakt, Suchfeld und Button untereinander
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      header {
        padding: 0.4rem 0.5rem;
        flex-direction: column;
        align-items: stretch;
        gap: 0.4rem;
        position: relative;
        z-index: 300;
      }
      header > div:first-child {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      header h1 {
        font-size: 0.75rem;
      }
      #stats {
        display: none;
      }
      /* Suchfeld und Button nebeneinander in einer Zeile */
      header > div:last-child {
        display: flex;
        gap: 0.4rem;
        align-items: center;
        width: 100%;
      }
      .suche-wrapper {
        flex: 1;
      }
      .suche-input,
      #suche-input {
        width: 100% !important;
        font-size: 0.75rem !important;
        padding: 0.3rem 0.6rem !important;
      }
      .suche-ergebnisse {
        width: calc(100vw - 1rem);
        left: 0;
        right: auto;
        top: 100%;
      }
      .info-toggle {
        white-space: nowrap;
        font-size: 0.7rem !important;
        padding: 0.3rem 0.5rem !important;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Linsen-Palette UNTEN als horizontale Leiste
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      .linsen-palette {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        top: auto;
        transform: none;
        width: 100%;
        height: 48px;
        max-height: none;
        flex-direction: row;
        overflow-x: auto;
        overflow-y: hidden;
        padding: 0.3rem 0.5rem;
        border-left: none;
        border-top: 1px solid var(--border);
        border-radius: 0;
        gap: 0.2rem;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        z-index: 200;
        background: var(--bg-secondary);
      }
      .linsen-palette::-webkit-scrollbar {
        display: none;
      }
      .linsen-palette.expanded {
        width: 100%;
        height: 48px;
        padding: 0.3rem 0.5rem;
      }
      
      /* Toggle verstecken auf Mobile */
      .palette-toggle {
        display: none !important;
      }
      
      /* Sections horizontal */
      .palette-section {
        flex-direction: row;
        gap: 0.15rem;
        padding: 0;
        border-bottom: none;
        border-right: 1px solid var(--border);
        padding-right: 0.3rem;
        margin-right: 0.15rem;
        flex-shrink: 0;
        align-items: center;
      }
      .palette-section:last-child {
        border-right: none;
      }
      .palette-section-label {
        display: none !important;
      }
      
      /* Linsen kompakt */
      .linse {
        width: 34px;
        height: 34px;
        min-width: 34px;
        min-height: 34px;
        padding: 0;
        font-size: 1rem;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .linse-label {
        display: none !important;
      }
      .linse-wrapper {
        flex-direction: row;
      }
      .linsen-palette.expanded .linse {
        width: 34px;
        padding: 0;
      }
      .linsen-palette.expanded .linse-label {
        display: none !important;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Gruppen INLINE expandieren (horizontal nach rechts)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      .linse-gruppe {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 0.15rem;
        flex-shrink: 0;
      }
      .linse.gruppe-header {
        width: 34px;
        height: 34px;
      }
      .gruppe-pfeil {
        display: none !important;
      }
      
      /* Gruppe-Inhalt: horizontal inline */
      .gruppe-inhalt {
        display: flex;
        flex-direction: row;
        gap: 0.15rem;
        max-width: 0;
        overflow: hidden;
        opacity: 0;
        transition: all 0.25s ease;
      }
      
      /* Wenn Gruppe offen: Items erscheinen rechts */
      .linse-gruppe.open .gruppe-inhalt {
        max-width: 200px;
        opacity: 1;
      }
      
      /* Gruppe-Header bekommt Indikator wenn offen */
      .linse-gruppe.open .linse.gruppe-header {
        background: rgba(229, 57, 53, 0.3);
        border-color: var(--accent);
      }
      
      .linse-wrapper.sub {
        padding-left: 0;
      }
      .linse.sub {
        width: 30px;
        height: 30px;
        min-width: 30px;
        font-size: 0.9rem;
        border-style: dashed;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Filter-Section komplett verstecken
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      .filter-section {
        display: none !important;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Ã„sthetik-Icon (info-toggle) zentriert in Reihe
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      .info-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        font-size: 0.7rem !important;
        padding: 0.3rem 0.5rem !important;
        height: 32px;
        flex-shrink: 0;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Main Content - Platz fÃ¼r untere Palette
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      main {
        margin-left: 0 !important;
        margin-top: 0 !important;
        padding-top: 0;
        padding-right: 0;
        padding-bottom: 52px; /* Platz fÃ¼r untere Palette */
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Konzept-Box (Was ist das?) - Fullscreen Overlay
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      #konzept-box,
      .konzept-box {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        transform: none !important;
        width: 100% !important;
        max-width: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
        padding: 1rem !important;
        padding-bottom: 60px !important; /* Platz fÃ¼r untere Leiste */
        margin: 0 !important;
      }
      .konzept-box.open {
        transform: none !important;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Dein Platz - Fullscreen Overlay
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      .dein-platz {
        position: relative;
        margin: 0 0 1rem 0;
        border-radius: 12px;
        padding: 1rem;
      }
      .dein-platz-header {
        flex-direction: column;
        text-align: center;
        gap: 0.4rem;
      }
      .dein-platz-icon {
        font-size: 1.5rem;
      }
      .dein-platz-header h2 {
        font-size: 1rem;
      }
      .dein-platz-header p {
        font-size: 0.75rem;
      }
      
      /* 3 Zimmer: vertikal auf Mobile */
      .drei-zimmer-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }
      
      .empfohlenes-zimmer {
        padding: 0.75rem;
      }
      .empf-zimmer-header {
        gap: 0.4rem;
        margin-bottom: 0.4rem;
      }
      .empf-zimmer-icon {
        font-size: 1.25rem;
      }
      .empf-zimmer-name {
        font-size: 0.9rem;
      }
      .empf-zimmer-frage {
        font-size: 0.75rem;
        margin-bottom: 0.5rem;
      }
      .empf-zimmer-position {
        padding: 0.4rem;
        margin-bottom: 0.5rem;
      }
      .empf-pos-nummer {
        width: 22px;
        height: 22px;
        font-size: 0.75rem;
      }
      .empf-pos-name {
        font-size: 0.8rem;
      }
      .empf-zimmer-teaser {
        padding: 0.4rem;
      }
      .teaser-text {
        font-size: 0.7rem;
      }
      .empf-zimmer-action span {
        font-size: 0.7rem;
      }
      
      /* Popup Mobile */
      .empfohlenes-popup {
        max-height: 90vh;
      }
      .empf-popup-position {
        flex-direction: column;
        gap: 0.75rem;
        text-align: center;
      }
      .empf-popup-position .position-nummer {
        width: 36px;
        height: 36px;
        font-size: 1rem;
      }
      .empf-popup-aufgaben {
        padding: 0.75rem;
      }
      .aufgabe-item {
        gap: 0.5rem;
      }
      .aufgabe-nummer {
        width: 20px;
        height: 20px;
        font-size: 0.7rem;
      }
      .aufgabe-content strong {
        font-size: 0.8rem;
      }
      .aufgabe-content p {
        font-size: 0.75rem;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Mein Sozialismus
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      .mein-sozialismus-container {
        padding: 0.5rem;
      }
      .ms-intro h3 {
        font-size: 1.1rem;
      }
      .ms-intro p {
        font-size: 0.8rem;
      }
      .ms-kategorie-header {
        padding: 0.5rem 0.75rem;
      }
      .ms-kategorie-icon {
        font-size: 1rem;
      }
      .ms-kategorie-header h4 {
        font-size: 0.85rem;
      }
      .ms-item {
        padding: 0.5rem;
      }
      .ms-item-label {
        font-size: 0.8rem;
      }
      .ms-hinzufuegen {
        flex-direction: column;
      }
      .ms-vorschau {
        padding: 1rem;
      }
      .ms-vorschau-header {
        flex-direction: column;
        gap: 0.5rem;
        align-items: flex-start;
      }
      .ms-aktionen {
        flex-direction: column;
      }
      .ms-btn-primary, .ms-btn-secondary, .ms-btn-danger {
        width: 100%;
      }
      .ms-auswahl-popup {
        max-height: 90vh;
        padding: 1rem;
      }
      .ms-auswahl-zimmer {
        flex-wrap: wrap;
      }
      .ms-auswahl-positionen {
        width: 100%;
        margin-top: 0.3rem;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Haus-Ansicht
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      #wg-container {
        padding: 0.4rem;
      }
      .haus-header {
        flex-direction: column;
        gap: 0.4rem;
        padding: 0.5rem;
        margin-bottom: 0.4rem;
      }
      .haus-header h2 {
        font-size: 0.9rem;
      }
      .haus-tabs {
        width: 100%;
      }
      .haus-tab {
        flex: 1;
        padding: 0.35rem 0.4rem;
        font-size: 0.7rem;
      }
      .haus-banner {
        margin: 0 0 0.4rem 0;
        padding: 0.5rem;
        flex-direction: column;
        text-align: center;
        gap: 0.3rem;
      }
      .banner-icon {
        font-size: 1.1rem;
      }
      .banner-text strong {
        font-size: 0.75rem;
      }
      .banner-text span {
        font-size: 0.65rem;
      }
      .haus-gebaeude {
        padding: 0;
        gap: 0.4rem;
      }
      .haus-etage {
        padding: 0.4rem;
        border-radius: 6px;
      }
      .etage-header {
        flex-direction: column;
        text-align: center;
        gap: 0.2rem;
        margin-bottom: 0.4rem;
      }
      .etage-icon {
        font-size: 1.1rem;
      }
      .etage-info h3 {
        font-size: 0.8rem;
      }
      .etage-untertitel {
        font-size: 0.65rem;
      }
      .etage-zimmer {
        grid-template-columns: 1fr;
        gap: 0.3rem;
      }
      .haus-zimmer {
        padding: 0.4rem;
      }
      .zimmer-kopf {
        margin-bottom: 0.3rem;
      }
      .zimmer-achse {
        font-size: 0.55rem;
      }
      .zimmer-name {
        font-size: 0.7rem;
      }
      .zimmer-spektrum {
        gap: 0.15rem;
      }
      .spektrum-pos {
        width: 22px;
        height: 22px;
      }
      .pos-zahl {
        font-size: 0.55rem;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Netzwerk - Touch-optimiert
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      #netzwerk-container {
        height: calc(100vh - 48px - 50px);
        touch-action: none;
      }
      .legende {
        display: none;
      }
      
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE: Talkshow
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      .talkshow-popup {
        width: 95%;
        padding: 0.6rem;
        max-height: 85vh;
      }
      .talkshow-popup h2 {
        font-size: 0.9rem;
      }
      .talkshow-gaeste {
        grid-template-columns: repeat(3, 1fr);
        gap: 0.25rem;
      }
      .talkshow-gast {
        padding: 0.25rem;
      }
      .gast-icon {
        font-size: 0.9rem;
      }
      .gast-name {
        font-size: 0.55rem;
      }
    }
    
    .debatte-seite {
      background: #2a2a2a;
      padding: 1rem;
      border-radius: 4px;
    }
    
    .debatte-seite.a {
      border-left: 3px solid #E53935;
    }
    
    .debatte-seite.b {
      border-left: 3px solid #2196F3;
    }
    
    .debatte-seite h4 {
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
      color: #fff;
    }
    
    .debatte-seite ul {
      list-style: none;
      font-size: 0.85rem;
      color: #bbb;
    }
    
    .debatte-seite li {
      margin-bottom: 0.5rem;
      padding-left: 1rem;
      position: relative;
    }
    
    .debatte-seite li::before {
      content: "â†’";
      position: absolute;
      left: 0;
      color: #666;
    }
    
    .debatte-historisch {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #333;
      font-size: 0.85rem;
      color: #888;
    }
    
    .debatte-texte {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #333;
    }
    
    .debatte-texte a {
      display: inline-block;
      color: #E53935;
      font-size: 0.85rem;
      margin-right: 1rem;
      text-decoration: none;
    }
    
    .debatte-texte a:hover {
      text-decoration: underline;
    }
    
    .legende {
      position: absolute;
      bottom: 1rem;
      left: 1rem;
      background: rgba(30, 30, 30, 0.95);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 0.75rem;
      color: #888;
      z-index: 50;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.1);
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .legende-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.3rem;
    }
    
    .legende-item:last-child {
      margin-bottom: 0;
    }
    
    .legende-linie {
      width: 20px;
      height: 3px;
    }
    
    .legende-linie.gruen { background: #4CAF50; }
    .legende-linie.orange { background: #FF9800; }
    .legende-linie.grau { background: #555; }
    
    /* Filter-Legenden (dynamisch) */
    .legende-filter {
      display: none;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #444;
    }
    
    .legende-filter.visible {
      display: block;
    }
    
    .legende-filter-titel {
      font-weight: bold;
      color: #ccc;
      margin-bottom: 0.5rem;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Fieber-Gradient */
    .legende-fieber-gradient {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.4rem;
    }
    
    .fieber-gradient-bar {
      width: 80px;
      height: 12px;
      border-radius: 6px;
      background: linear-gradient(to right, #2196F3, #4CAF50, #FFEB3B, #FF9800, #E53935);
    }
    
    .fieber-labels {
      display: flex;
      justify-content: space-between;
      width: 80px;
      font-size: 0.6rem;
      color: #666;
    }
    
    /* Konflikte-Legende */
    .legende-konflikt-linie {
      width: 24px;
      height: 3px;
      background: #FF9800;
      border-style: dashed;
    }
    
    .legende-kugel {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
    }
    
    .legende-kugel.klein { transform: scale(0.7); }
    .legende-kugel.gross { transform: scale(1.3); }
    
    .legende-section {
      margin-bottom: 0.6rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #333;
    }
    .legende-section:last-of-type {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .legende-section-titel {
      font-size: 0.7rem;
      color: #888;
      margin-bottom: 0.4rem;
      font-weight: 500;
    }
    
    /* Globale Filter-Info (unten rechts, immer sichtbar) */
    .filter-info-global {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: rgba(30, 30, 30, 0.95);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-size: 0.75rem;
      color: #aaa;
      z-index: 90;
      display: none;
      max-width: 200px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .filter-info-global.visible {
      display: block;
    }
    
    .filter-info-global .filter-info-item {
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #444;
    }
    
    .filter-info-global .filter-info-item:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    /* Liste */
    #liste-container {
      flex: 1;
      display: none;
      padding: 2rem;
      overflow-y: auto;
      background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1a1a 100%);
    }
    
    #liste-container.active {
      display: block;
    }
    
    .liste-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .liste-header h2 {
      font-size: 1.5rem;
      font-weight: 300;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }
    
    .liste-header p {
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    
    .liste-filter-bar {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    
    .liste-filter-btn {
      padding: 0.4rem 0.8rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .liste-filter-btn:hover, .liste-filter-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    
    .liste-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .liste-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-left: 4px solid var(--accent);
      padding: 1rem 1.25rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .liste-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      border-color: var(--accent);
    }
    
    .liste-item .item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }
    
    .liste-item .name {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 1rem;
      line-height: 1.3;
    }
    
    .liste-item .achse-badge {
      font-size: 0.65rem;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      background: rgba(229, 57, 53, 0.2);
      color: #E53935;
      white-space: nowrap;
      flex-shrink: 0;
      margin-left: 0.5rem;
    }
    
    .liste-item .beschreibung {
      font-size: 0.8rem;
      color: var(--text-muted);
      line-height: 1.5;
      margin: 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .liste-item .item-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.75rem;
      padding-top: 0.5rem;
      border-top: 1px solid var(--border);
      font-size: 0.7rem;
      color: var(--text-muted);
    }
    
    .liste-item .verbindungen {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    /* Achsen-Farben fÃ¼r Border */
    .liste-item[data-achse^="A"] { border-left-color: #E53935; }
    .liste-item[data-achse^="A"] .achse-badge { background: rgba(229, 57, 53, 0.2); color: #E53935; }
    .liste-item[data-achse^="B"] { border-left-color: #4CAF50; }
    .liste-item[data-achse^="B"] .achse-badge { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }
    .liste-item[data-achse^="C"] { border-left-color: #2196F3; }
    .liste-item[data-achse^="C"] .achse-badge { background: rgba(33, 150, 243, 0.2); color: #2196F3; }
    .liste-item[data-achse^="D"] { border-left-color: #9C27B0; }
    .liste-item[data-achse^="D"] .achse-badge { background: rgba(156, 39, 176, 0.2); color: #9C27B0; }
    .liste-item[data-achse^="E"] { border-left-color: #FF9800; }
    .liste-item[data-achse^="E"] .achse-badge { background: rgba(255, 152, 0, 0.2); color: #FF9800; }
    .liste-item[data-achse^="F"] { border-left-color: #00BCD4; }
    .liste-item[data-achse^="F"] .achse-badge { background: rgba(0, 188, 212, 0.2); color: #00BCD4; }

    /* Karte */
    #karte-container {
      flex: 1;
      display: none;
      padding: 2rem;
      overflow: auto;
      background: linear-gradient(135deg, var(--bg-primary) 0%, #0d1117 100%);
    }
    #karte-container.active { display: block; }
    
    .karte-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .karte-header h2 {
      font-size: 1.8rem;
      font-weight: 300;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }
    
    .karte-header p {
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    
    .karte-legende {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    
    .karte-legende span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .karte-wrapper {
      max-width: 1100px;
      margin: 0 auto;
    }
    
    .karte-achse-group {
      margin-bottom: 1.5rem;
      background: var(--bg-secondary);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border);
    }
    
    .karte-achse-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border);
    }
    
    .karte-achse-code {
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      color: #fff;
    }
    
    .karte-achse-name {
      font-size: 0.9rem;
      color: var(--text-primary);
      font-weight: 500;
    }
    
    .karte-skala {
      display: flex;
      justify-content: space-between;
      padding: 0 1rem;
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 0.3rem;
    }
    
    .karte-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 3px;
      padding: 0.5rem;
    }
    
    .karte-cell {
      background: var(--bg-primary);
      padding: 0.6rem 0.4rem;
      min-height: 55px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      border-radius: 6px;
      border: 1px solid transparent;
    }
    
    .karte-cell:hover {
      transform: scale(1.05);
      z-index: 10;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    
    .karte-cell.filled {
      border-color: var(--border);
    }
    
    .karte-cell.filled:hover {
      border-color: var(--accent);
    }
    
    .karte-cell .name {
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--text-primary);
      line-height: 1.2;
    }
    
    .karte-cell .position {
      font-size: 0.6rem;
      color: var(--text-muted);
      margin-top: 0.2rem;
    }
    
    .karte-cell.empty {
      opacity: 0.3;
      cursor: default;
    }
    
    /* Achsen-Farben */
    .karte-achse-group[data-achse^="A"] .karte-achse-code { background: #E53935; }
    .karte-achse-group[data-achse^="A"] .karte-cell.filled:hover { border-color: #E53935; }
    .karte-achse-group[data-achse^="B"] .karte-achse-code { background: #4CAF50; }
    .karte-achse-group[data-achse^="B"] .karte-cell.filled:hover { border-color: #4CAF50; }
    .karte-achse-group[data-achse^="C"] .karte-achse-code { background: #2196F3; }
    .karte-achse-group[data-achse^="C"] .karte-cell.filled:hover { border-color: #2196F3; }
    .karte-achse-group[data-achse^="D"] .karte-achse-code { background: #9C27B0; }
    .karte-achse-group[data-achse^="D"] .karte-cell.filled:hover { border-color: #9C27B0; }
    .karte-achse-group[data-achse^="E"] .karte-achse-code { background: #FF9800; }
    .karte-achse-group[data-achse^="E"] .karte-cell.filled:hover { border-color: #FF9800; }
    .karte-achse-group[data-achse^="F"] .karte-achse-code { background: #00BCD4; }
    .karte-achse-group[data-achse^="F"] .karte-cell.filled:hover { border-color: #00BCD4; }

    /* Zeitleiste */
    #zeitleiste-container {
      flex: 1;
      display: none;
      padding: 2rem;
      overflow-y: auto;
      background: linear-gradient(180deg, var(--bg-primary) 0%, #12121a 100%);
    }
    #zeitleiste-container.active { display: block; }
    
    .zeitleiste-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .zeitleiste-header h2 {
      font-size: 1.8rem;
      font-weight: 300;
      color: #E53935;
      margin-bottom: 0.5rem;
    }
    
    .zeitleiste-header p {
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    
    .zeitleiste-filter {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    
    .zeitleiste-filter-btn {
      padding: 0.4rem 0.8rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .zeitleiste-filter-btn:hover, .zeitleiste-filter-btn.active {
      background: #E53935;
      border-color: #E53935;
      color: #fff;
    }
    
    .zeitleiste-wrapper {
      max-width: 900px;
      margin: 0 auto;
      position: relative;
      padding-left: 100px;
    }
    
    /* Vertikale Timeline-Linie */
    .zeitleiste-wrapper::before {
      content: '';
      position: absolute;
      left: 85px;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(to bottom, #E53935, #9C27B0, #2196F3);
      border-radius: 3px;
    }
    
    .zeitleiste-item {
      position: relative;
      margin-bottom: 1.5rem;
      padding-left: 2rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .zeitleiste-item:hover {
      transform: translateX(5px);
    }
    
    .zeitleiste-item:hover .zeitleiste-card {
      border-color: #E53935;
      box-shadow: 0 4px 20px rgba(229, 57, 53, 0.2);
    }
    
    /* Punkt auf der Timeline */
    .zeitleiste-item::before {
      content: '';
      position: absolute;
      left: -22px;
      top: 12px;
      width: 12px;
      height: 12px;
      background: var(--bg-primary);
      border: 3px solid #E53935;
      border-radius: 50%;
      z-index: 1;
    }
    
    .zeitleiste-item[data-typ="praxis"]::before { border-color: #4CAF50; }
    .zeitleiste-item[data-typ="text"]::before { border-color: #2196F3; }
    .zeitleiste-item[data-typ="geburt"]::before { border-color: #FF9800; }
    
    .zeitleiste-jahr {
      position: absolute;
      left: -95px;
      top: 8px;
      font-size: 0.85rem;
      font-weight: 700;
      color: #E53935;
      width: 60px;
      text-align: right;
    }
    
    .zeitleiste-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      transition: all 0.2s;
    }
    
    .zeitleiste-card-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .zeitleiste-icon {
      font-size: 1.2rem;
    }
    
    .zeitleiste-card h3 {
      font-size: 0.95rem;
      color: var(--text-primary);
      font-weight: 600;
      margin: 0;
    }
    
    .zeitleiste-card p {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin: 0;
      line-height: 1.4;
    }
    
    .zeitleiste-card .ort {
      font-size: 0.75rem;
      color: #666;
      margin-top: 0.3rem;
    }
    
    .zeitleiste-card .tag {
      display: inline-block;
      font-size: 0.65rem;
      padding: 0.15rem 0.4rem;
      border-radius: 8px;
      margin-top: 0.5rem;
    }
    
    .zeitleiste-card .tag.praxis { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }
    .zeitleiste-card .tag.text { background: rgba(33, 150, 243, 0.2); color: #2196F3; }
    .zeitleiste-card .tag.geburt { background: rgba(255, 152, 0, 0.2); color: #FF9800; }
    
    /* Epochen-Marker */
    .zeitleiste-epoche {
      position: relative;
      margin: 2rem 0;
      padding-left: 2rem;
    }
    
    .zeitleiste-epoche-label {
      background: rgba(229, 57, 53, 0.2);
      color: #E53935;
      padding: 0.3rem 0.8rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Stammbaum */
    #stammbaum-container {
      flex: 1;
      display: none;
      padding: 1rem;
      overflow: auto;
      background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%);
    }
    #stammbaum-container.active { display: block; }
    
    .stammbaum-wrapper {
      min-width: 1200px;
      padding: 1rem;
      overflow-x: auto;
    }
    
    .stammbaum-svg {
      width: 100%;
      height: auto;
      min-height: 700px;
    }
    
    .stammbaum-epoche {
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .stammbaum-epoche:hover {
      filter: brightness(1.2);
    }
    
    .stammbaum-epoche rect {
      rx: 8;
      ry: 8;
    }
    
    .stammbaum-person {
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .stammbaum-person:hover {
      filter: brightness(1.3);
    }
    
    .stammbaum-person:hover .stammbaum-label {
      fill: #fff;
      font-weight: bold;
    }
    
    .stammbaum-person circle {
      stroke-width: 1;
      stroke: rgba(255,255,255,0.3);
    }
    
    .stammbaum-linie {
      stroke: #555;
      stroke-width: 1;
      fill: none;
      opacity: 0.4;
    }
    
    .stammbaum-linie.einfluss {
      stroke: #4CAF50;
      stroke-dasharray: 4,3;
    }
    
    .stammbaum-linie.konflikt {
      stroke: #f44336;
      stroke-dasharray: 2,2;
    }
    
    .stammbaum-label {
      fill: #ccc;
      font-size: 9px;
      text-anchor: middle;
      pointer-events: none;
    }
    
    .stammbaum-epoche-label {
      fill: #fff;
      font-size: 12px;
      font-weight: 600;
      text-anchor: start;
    }
    
    .stammbaum-zeit-label {
      fill: #888;
      font-size: 9px;
      text-anchor: start;
    }
    
    .stammbaum-legende {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: rgba(0,0,0,0.8);
      padding: 1rem;
      border-radius: 8px;
      font-size: 0.8rem;
      z-index: 100;
    }
    
    .stammbaum-legende-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .stammbaum-legende-linie {
      width: 30px;
      height: 3px;
    }
    
    /* Bibliothek */
    #bibliothek-container {
      flex: 1;
      display: none;
      padding: 2rem;
      overflow-y: auto;
    }
    #bibliothek-container.active { display: block; }
    
    .bibliothek-wrapper {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .bibliothek-section {
      margin-bottom: 2rem;
    }
    
    .bibliothek-section h2 {
      font-size: 1rem;
      color: #E53935;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #333;
    }
    
    .buch-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 0.75rem;
      background: #222;
      margin-bottom: 0.5rem;
      border-radius: 4px;
    }
    
    .buch-item:hover {
      background: #2a2a2a;
    }
    
    .buch-info .titel {
      font-weight: 600;
      color: #fff;
    }
    
    .buch-info .autor {
      font-size: 0.85rem;
      color: #888;
    }
    
    .buch-info .kontext {
      font-size: 0.75rem;
      color: #666;
      margin-top: 0.25rem;
    }
    
    .buch-meta {
      text-align: right;
      font-size: 0.75rem;
    }
    
    .buch-meta a {
      color: #E53935;
      text-decoration: none;
    }

    /* Praxis */
    #praxis-container {
      flex: 1;
      display: none;
      padding: 2rem;
      overflow-y: auto;
    }
    #praxis-container.active { display: block; }
    
    .praxis-wrapper {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .praxis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    
    .praxis-card {
      background: #222;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 1rem;
    }
    
    .praxis-card h3 {
      font-size: 1rem;
      color: #4CAF50;
      margin-bottom: 0.25rem;
    }
    
    .praxis-card .meta {
      font-size: 0.8rem;
      color: #888;
      margin-bottom: 0.5rem;
    }
    
    .praxis-card .beschreibung {
      font-size: 0.85rem;
      color: #aaa;
      margin-bottom: 0.5rem;
    }
    
    .praxis-card .kontext {
      font-size: 0.7rem;
      color: #666;
    }

    /* Fragen */
    #fragen-container {
      flex: 1;
      display: none;
      padding: 2rem;
      overflow-y: auto;
    }
    #fragen-container.active { display: block; }
    
    .fragen-wrapper {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .frage-item {
      background: #222;
      padding: 1rem;
      margin-bottom: 0.75rem;
      border-radius: 4px;
      border-left: 3px solid #FF9800;
      cursor: pointer;
    }
    
    .frage-item:hover {
      background: #2a2a2a;
    }
    
    .frage-item .frage {
      color: #fff;
      font-size: 0.95rem;
      margin-bottom: 0.3rem;
    }
    
    .frage-item .kontext {
      font-size: 0.75rem;
      color: #666;
    }

    /* Zufall */
    #zufall-container {
      flex: 1;
      display: none;
      padding: 2rem;
      justify-content: center;
      align-items: center;
    }
    #zufall-container.active { display: flex; }
    
    .zufall-card {
      max-width: 500px;
      background: #222;
      border: 2px solid #E53935;
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      position: relative;
    }
    
    .zufall-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      width: 32px;
      height: 32px;
      background: rgba(255,255,255,0.1);
      border: 1px solid #444;
      border-radius: 50%;
      color: #888;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .zufall-close:hover {
      background: #E53935;
      color: #fff;
      border-color: #E53935;
    }
    
    .zufall-card h2 {
      font-size: 1.5rem;
      color: #E53935;
      margin-bottom: 0.5rem;
    }
    
    .zufall-card .achse {
      font-size: 0.8rem;
      color: #888;
      margin-bottom: 1rem;
    }
    
    .zufall-card .beschreibung {
      font-size: 1rem;
      color: #ccc;
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }
    
    .zufall-card .zitat {
      background: #1a1a1a;
      padding: 1rem;
      border-left: 3px solid #E53935;
      font-style: italic;
      margin-bottom: 1.5rem;
      text-align: left;
    }
    
    .zufall-btn {
      background: #E53935;
      border: none;
      color: #fff;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 4px;
      margin-right: 0.5rem;
    }
    
    .zufall-btn:hover {
      background: #c62828;
    }
    
    .zufall-btn.secondary {
      background: #333;
    }
    
    .zufall-btn.secondary:hover {
      background: #444;
    }

    /* Mein Kosmos */
    #kosmos-container {
      flex: 1;
      display: none;
      padding: 2rem;
      overflow-y: auto;
    }
    #kosmos-container.active { display: block; }
    
    .kosmos-wrapper {
      max-width: 700px;
      margin: 0 auto;
    }
    
    .kosmos-intro {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .kosmos-intro h2 {
      color: #E53935;
      margin-bottom: 0.5rem;
    }
    
    .kosmos-intro p {
      color: #888;
      font-size: 0.9rem;
    }
    
    .kosmos-slider-group {
      background: #222;
      padding: 1rem;
      margin-bottom: 0.75rem;
      border-radius: 4px;
    }
    
    .kosmos-slider-group label {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: #fff;
      margin-bottom: 0.5rem;
    }
    
    .kosmos-slider-group .achse-name {
      color: #888;
      font-size: 0.75rem;
    }
    
    .kosmos-slider-group input[type="range"] {
      width: 100%;
      margin-bottom: 0.25rem;
    }
    
    .kosmos-slider-group .labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.65rem;
      color: #666;
    }
    
    .kosmos-result {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #222;
      border-radius: 8px;
      border: 1px solid #E53935;
    }
    
    .kosmos-result h3 {
      color: #E53935;
      margin-bottom: 1rem;
    }
    
    .kosmos-nachbarn {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .kosmos-nachbar {
      background: #333;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      font-size: 0.85rem;
      cursor: pointer;
    }
    
    .kosmos-nachbar:hover {
      background: #E53935;
    }
    
    .kosmos-nachbar .distanz {
      font-size: 0.7rem;
      color: #888;
      margin-left: 0.3rem;
    }

    /* Reaktor */
    #reaktor-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #1a1a1a;
      border-top: 2px solid #E53935;
      padding: 1.5rem 2rem;
      display: none;
      z-index: 200;
      max-height: 50vh;
      overflow-y: auto;
    }
    
    #reaktor-panel.open {
      display: block;
    }
    
    .reaktor-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }
    
    .reaktor-titel {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .reaktor-titel h2 {
      font-size: 1.1rem;
      color: #fff;
      font-weight: 400;
    }
    
    .reaktor-titel .vs {
      color: #E53935;
      font-size: 1.5rem;
    }
    
    .reaktor-close {
      background: none;
      border: none;
      color: #888;
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    .reaktor-body {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1.5rem;
    }
    
    @media (max-width: 800px) {
      .reaktor-body {
        grid-template-columns: 1fr;
      }
    }
    
    .reaktor-section h3 {
      font-size: 0.75rem;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
    }
    
    .reaktor-verbindung {
      background: #222;
      padding: 1rem;
      border-radius: 4px;
    }
    
    .reaktor-verbindung.direkt {
      border-left: 3px solid #4CAF50;
    }
    
    .reaktor-verbindung.debatte {
      border-left: 3px solid #FF9800;
    }
    
    .reaktor-verbindung.keine {
      border-left: 3px solid #666;
    }
    
    .reaktor-distanz {
      font-size: 2rem;
      font-weight: 600;
      color: #E53935;
    }
    
    .reaktor-distanz-label {
      font-size: 0.8rem;
      color: #888;
    }
    
    .reaktor-nachbarn {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .reaktor-nachbar {
      background: #333;
      padding: 0.3rem 0.6rem;
      font-size: 0.75rem;
      border-radius: 3px;
      cursor: pointer;
    }
    
    .reaktor-nachbar:hover {
      background: #E53935;
    }
    
    .reaktor-synthese {
      background: #222;
      padding: 1rem;
      border-radius: 4px;
      font-size: 0.9rem;
      line-height: 1.5;
      color: #ccc;
    }
    
    .reaktor-frage {
      background: #2a2a2a;
      padding: 0.75rem;
      border-left: 3px solid #FF9800;
      font-style: italic;
      color: #aaa;
      margin-top: 0.75rem;
    }
    
    /* Such-System */
    .suche-wrapper {
      position: relative;
    }
    
    .suche-ergebnisse {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      width: 350px;
      max-height: 400px;
      overflow-y: auto;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-top: 0.5rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
      z-index: 1000;
    }
    
    .suche-kategorie {
      padding: 0.5rem;
      border-bottom: 1px solid var(--border);
    }
    
    .suche-kategorie:last-child {
      border-bottom: none;
    }
    
    .suche-kategorie-titel {
      font-size: 0.75rem;
      color: var(--text-secondary);
      padding: 0.3rem 0.5rem;
      font-weight: 600;
    }
    
    .suche-item {
      padding: 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .suche-item:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .suche-item-name {
      display: block;
      color: var(--text-primary);
      font-size: 0.9rem;
    }
    
    .suche-item-meta {
      display: block;
      color: var(--text-secondary);
      font-size: 0.75rem;
      margin-top: 0.2rem;
    }
    
    .suche-item-zitat {
      display: block;
      color: var(--text-primary);
      font-size: 0.85rem;
      font-style: italic;
    }
    
    .suche-leer {
      padding: 1rem;
      text-align: center;
      color: var(--text-secondary);
    }
    
    /* Konzept-Box */
    .info-toggle {
      background: transparent;
      border: 1px solid #555;
      color: #aaa;
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      cursor: pointer;
      border-radius: 3px;
    }
    .info-toggle:hover { background: #333; color: #fff; }
    
    .konzept-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: #222;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 2rem;
      max-width: 700px;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .konzept-box.open {
      opacity: 1;
      visibility: visible;
      transform: translate(-50%, -50%) scale(1);
    }
    .konzept-box h2 { color: #E53935; margin-bottom: 1rem; }
    .konzept-box h3 { color: #aaa; margin: 1.5rem 0 0.5rem; font-size: 1rem; }
    .konzept-box p { line-height: 1.6; margin-bottom: 0.75rem; color: #ccc; }
    .konzept-box ul { margin-left: 1.5rem; margin-bottom: 1rem; }
    .konzept-box li { margin-bottom: 0.5rem; color: #aaa; }
    .konzept-box li strong { color: #fff; }
    .konzept-box em { color: #FF9800; font-style: normal; }
    
    /* WG-Container */
    #wg-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 1.5rem;
      overflow-y: auto;
    }
    
    /* Haus Header */
    .haus-header {
      text-align: center;
      margin-bottom: 1rem;
    }
    .haus-header h2 {
      color: #E53935;
      font-size: 1.4rem;
      margin-bottom: 0.2rem;
    }
    .haus-header p {
      color: #666;
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
    }
    .haus-tabs {
      display: flex;
      gap: 0.35rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    .haus-tab {
      padding: 0.4rem 0.8rem;
      background: #252525;
      border: 1px solid #333;
      border-radius: 16px;
      color: #888;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .haus-tab:hover { border-color: #555; color: #fff; }
    .haus-tab.active { background: #C62828; border-color: #C62828; color: #fff; }
    
    /* Banner */
    .haus-banner {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      animation: fadeIn 0.3s ease;
    }
    .haus-banner.funktional { background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.1); }
    .haus-banner.harmonie { background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(76,175,80,0.03)); border: 1px solid rgba(76,175,80,0.2); }
    .haus-banner.konflikt { background: linear-gradient(135deg, rgba(229,57,53,0.1), rgba(229,57,53,0.03)); border: 1px solid rgba(229,57,53,0.2); }
    .haus-banner.epochen { background: linear-gradient(135deg, rgba(255,152,0,0.1), rgba(255,152,0,0.03)); border: 1px solid rgba(255,152,0,0.2); }
    .haus-banner.chaos { background: linear-gradient(135deg, rgba(156,39,176,0.1), rgba(156,39,176,0.03)); border: 1px solid rgba(156,39,176,0.2); }
    .banner-icon { font-size: 1.5rem; }
    .banner-text strong { display: block; color: #fff; font-size: 0.95rem; margin-bottom: 0.1rem; }
    .banner-text span { color: #888; font-size: 0.8rem; }
    .chaos-neu-btn {
      margin-left: auto;
      padding: 0.35rem 0.75rem;
      background: linear-gradient(135deg, #9C27B0, #673AB7);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .chaos-neu-btn:hover { transform: scale(1.05); }
    
    /* Haus GebÃ¤ude */
    .haus-gebaeude {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
    
    /* Etagen */
    .haus-etage {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-left: 4px solid #444;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      transition: all 0.2s;
    }
    .haus-etage:hover { border-color: #555; }
    .haus-etage.aktiv { border-left-color: #C62828; background: rgba(198,40,40,0.03); }
    
    .etage-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.6rem;
    }
    .etage-icon { font-size: 1.25rem; }
    .etage-info h3 { color: #ddd; font-size: 0.9rem; margin: 0; }
    .etage-untertitel { font-size: 0.75rem; color: #666; }
    
    /* Zimmer Grid */
    .etage-zimmer {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 0.5rem;
    }
    
    /* Einzelnes Zimmer */
    .haus-zimmer {
      background: #222;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 0.5rem 0.6rem;
      cursor: pointer;
      transition: all 0.15s;
    }
    .haus-zimmer:hover { border-color: #555; background: #282828; }
    
    /* Zimmer Hervorhebungen - subtiler, nur als Vorschlag */
    .haus-zimmer.meine-position { 
      border-left: 3px solid rgba(198,40,40,0.6); 
      background: rgba(198,40,40,0.05); 
    }
    .haus-zimmer.wg-position { border-color: #4CAF50; background: rgba(76,175,80,0.05); }
    .haus-zimmer.konflikt-achse { border-color: #E53935; }
    .haus-zimmer.epochen-position { border-color: #FF9800; background: rgba(255,152,0,0.05); }
    .haus-zimmer.chaos-position { border-color: #9C27B0; background: rgba(156,39,176,0.05); }
    
    .zimmer-kopf {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.4rem;
    }
    .zimmer-achse {
      background: #333;
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
      font-size: 0.6rem;
      font-weight: 600;
      color: #888;
    }
    /* Meine Position Zimmer-Achse: dezenter */
    .haus-zimmer.meine-position .zimmer-achse { 
      background: rgba(198,40,40,0.4); 
      color: #ccc; 
    }
    .zimmer-name { font-size: 0.75rem; color: #bbb; }
    
    /* Spektrum */
    .zimmer-spektrum {
      display: flex;
      gap: 2px;
    }
    .spektrum-pos {
      flex: 1;
      background: #2a2a2a;
      border: 1px solid #333;
      border-radius: 3px;
      padding: 0.25rem 0;
      text-align: center;
      cursor: pointer;
      transition: all 0.1s;
      position: relative;
    }
    .spektrum-pos:hover { border-color: #666; background: #333; }
    /* Meine Position: NUR roter Punkt, keine ausgefÃ¼llte FlÃ¤che */
    .spektrum-pos.meine { 
      background: #2a2a2a; /* Gleich wie andere */
      border-color: #333;
    }
    .spektrum-pos.meine::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 8px;
      height: 8px;
      background: #E53935;
      border-radius: 50%;
      box-shadow: 0 0 6px rgba(229, 57, 53, 0.6);
    }
    .spektrum-pos.wg-match { border-color: #4CAF50; }
    .spektrum-pos.epochen-match { border-color: #FF9800; }
    .spektrum-pos.chaos-match { border-color: #9C27B0; background: rgba(156,39,176,0.2); }
    .pos-zahl { font-size: 0.7rem; color: #666; }
    .spektrum-pos.meine .pos-zahl { color: #888; font-weight: 400; } /* Nicht mehr weiÃŸ/bold */
    .pos-du { position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); font-size: 0.5rem; color: #C62828; }
    
    .zimmer-pole {
      display: flex;
      justify-content: space-between;
      margin-top: 0.25rem;
      font-size: 0.55rem;
      color: #555;
    }
    .zimmer-zusatz {
      margin-top: 0.3rem;
      padding-top: 0.3rem;
      border-top: 1px solid #333;
      font-size: 0.65rem;
      color: #888;
    }
    
    /* Zimmer Detail Popup */
    .zimmer-detail-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.2s ease;
      padding: 1rem;
      overflow-y: auto;
    }
    .zimmer-detail-popup {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 500px;
      width: 100%;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    .zimmer-detail-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      color: #666;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .zimmer-detail-close:hover { color: #fff; }
    .zimmer-detail-popup h3 {
      color: #E53935;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }
    .zimmer-frage {
      color: #888;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    
    /* Spektrum im Detail */
    .zimmer-spektrum-detail {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: #222;
      border-radius: 8px;
    }
    .spektrum-label-links,
    .spektrum-label-rechts {
      font-size: 0.65rem;
      color: #666;
      max-width: 60px;
      text-align: center;
    }
    .spektrum-positionen {
      flex: 1;
      display: flex;
      gap: 3px;
    }
    .spektrum-pos-detail {
      flex: 1;
      background: #2a2a2a;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 0.4rem 0.2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .spektrum-pos-detail:hover {
      border-color: #555;
      background: #333;
    }
    .spektrum-pos-detail.meine {
      border-color: #C62828;
      background: rgba(198,40,40,0.15);
    }
    .spektrum-pos-detail .pos-num {
      display: block;
      font-size: 0.75rem;
      font-weight: 600;
      color: #888;
    }
    .spektrum-pos-detail.meine .pos-num {
      color: #E53935;
    }
    .spektrum-pos-detail .pos-title {
      display: block;
      font-size: 0.55rem;
      color: #666;
      margin-top: 2px;
      line-height: 1.2;
    }
    .spektrum-pos-detail .pos-marker {
      position: absolute;
      top: -4px;
      right: -4px;
      color: #E53935;
      font-size: 0.6rem;
    }
    
    /* Meine Position Box */
    .zimmer-meine-pos {
      background: rgba(198,40,40,0.1);
      border-left: 3px solid #C62828;
      padding: 0.75rem;
      margin-bottom: 1rem;
      border-radius: 0 8px 8px 0;
    }
    .zimmer-meine-pos .pos-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .zimmer-meine-pos .pos-label {
      font-size: 0.75rem;
      color: #888;
    }
    .zimmer-meine-pos .pos-nummer {
      background: #C62828;
      color: #fff;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.85rem;
    }
    .zimmer-meine-pos .pos-name {
      font-size: 0.9rem;
      color: #ddd;
      font-weight: 500;
    }
    
    /* Position Details */
    .position-details {
      background: #222;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .position-beschreibung {
      color: #bbb;
      font-size: 0.85rem;
      line-height: 1.5;
      margin-bottom: 0.75rem;
    }
    .position-zitat {
      background: rgba(255,255,255,0.03);
      border-radius: 6px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .position-zitat .zitat-icon {
      font-size: 1rem;
      margin-bottom: 0.3rem;
      display: block;
    }
    .position-zitat blockquote {
      font-style: italic;
      color: #aaa;
      font-size: 0.85rem;
      margin: 0 0 0.3rem 0;
      padding: 0;
      border: none;
    }
    .position-zitat cite {
      font-size: 0.75rem;
      color: #666;
      font-style: normal;
    }
    .position-bewohner {
      font-size: 0.8rem;
      color: #888;
      margin-bottom: 0.75rem;
    }
    .position-bewohner .bewohner-label {
      color: #666;
    }
    .position-bewohner .bewohner-namen {
      color: #aaa;
    }
    .position-mehr-btn {
      background: rgba(229,57,53,0.2);
      border: 1px solid rgba(229,57,53,0.4);
      color: #E53935;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
    }
    .position-mehr-btn:hover {
      background: rgba(229,57,53,0.3);
      border-color: #E53935;
    }
    
    .zimmer-einbringen {
      background: #222;
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .zimmer-einbringen h4 {
      color: #4CAF50;
      font-size: 0.85rem;
      margin-bottom: 0.4rem;
    }
    .zimmer-einbringen p {
      color: #aaa;
      font-size: 0.85rem;
    }
    .zimmer-future {
      background: rgba(156,39,176,0.1);
      border: 1px dashed rgba(156,39,176,0.3);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
    }
    .zimmer-future span {
      color: #9C27B0;
      font-size: 0.8rem;
    }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WG-MODUS: Social(ist) Media
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .haus-banner.wg {
      background: linear-gradient(135deg, rgba(156,39,176,0.1), rgba(103,58,183,0.05));
      border: 1px solid rgba(156,39,176,0.2);
    }
    
    .wg-intro {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.75rem 1rem;
      background: #1a1a1a;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .wg-intro p {
      color: #888;
      font-size: 0.85rem;
      margin: 0;
    }
    .wg-neu-btn {
      padding: 0.5rem 1rem;
      background: linear-gradient(135deg, #9C27B0, #673AB7);
      border: none;
      border-radius: 20px;
      color: #fff;
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }
    .wg-neu-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(156,39,176,0.4);
    }
    
    .wg-liste {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
    }
    
    .wg-karte {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.2s;
      cursor: pointer;
    }
    .wg-karte:hover {
      border-color: #555;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .wg-karte.meine-wg {
      border: 2px solid #9C27B0;
      background: rgba(156,39,176,0.05);
      box-shadow: 0 0 20px rgba(156,39,176,0.15);
    }
    
    .wg-karte-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.75rem;
      padding-bottom: 0.6rem;
      border-bottom: 1px solid #333;
    }
    .wg-icon {
      font-size: 1.5rem;
    }
    .wg-karte-header h3 {
      color: #fff;
      font-size: 1rem;
      margin: 0;
      flex: 1;
    }
    .wg-badge {
      background: #9C27B0;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-size: 0.7rem;
      color: #fff;
      font-weight: 600;
    }
    
    .wg-bewohner {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .wg-person {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.5rem 0.6rem;
      background: #222;
      border: 1px solid #333;
      border-left: 3px solid var(--accent, #666);
      border-radius: 6px;
      transition: all 0.15s;
    }
    .wg-person:hover {
      background: #282828;
      border-color: #444;
    }
    .wg-person.ich {
      background: rgba(156,39,176,0.1);
      border-color: #9C27B0;
    }
    
    .person-icon {
      font-size: 1.25rem;
    }
    .person-info {
      flex: 1;
      min-width: 0;
    }
    .person-name {
      display: block;
      color: #ddd;
      font-size: 0.8rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .person-slogan {
      display: block;
      color: #666;
      font-size: 0.7rem;
      font-style: italic;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .ich-badge {
      background: #C62828;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      font-size: 0.65rem;
      color: #fff;
      font-weight: 600;
    }
    
    .wg-footer {
      margin-top: 0.75rem;
      padding-top: 0.6rem;
      border-top: 1px solid #333;
    }
    .wg-potential {
      color: #666;
      font-size: 0.75rem;
    }
    
    .wg-zukunft {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      margin-top: 1.5rem;
      padding: 1rem;
      background: rgba(156,39,176,0.08);
      border: 1px dashed rgba(156,39,176,0.3);
      border-radius: 10px;
    }
    .wg-zukunft span:first-child {
      font-size: 1.5rem;
    }
    .wg-zukunft strong {
      display: block;
      color: #9C27B0;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }
    .wg-zukunft p {
      color: #888;
      font-size: 0.8rem;
      margin: 0;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TALKSHOW-GENERATOR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .talkshow-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: linear-gradient(135deg, rgba(156,39,176,0.15), rgba(103,58,183,0.08));
      border: 1px solid rgba(156,39,176,0.2);
      border-radius: 12px;
      margin-bottom: 1rem;
    }
    .talkshow-logo {
      font-size: 2.5rem;
    }
    .talkshow-titel {
      flex: 1;
    }
    .talkshow-titel h2 {
      color: #fff;
      font-size: 1.3rem;
      margin: 0 0 0.2rem 0;
    }
    .talkshow-titel p {
      color: #888;
      font-size: 0.85rem;
      margin: 0;
    }
    .talkshow-neu-btn {
      padding: 0.6rem 1rem;
      background: linear-gradient(135deg, #9C27B0, #673AB7);
      border: none;
      border-radius: 20px;
      color: #fff;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .talkshow-neu-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(156,39,176,0.4);
    }
    
    .talkshow-gaeste {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .gaeste-label {
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 0.75rem;
    }
    .gaeste-reihe {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 0.75rem;
    }
    .gast-karte {
      background: #222;
      border: 1px solid #333;
      border-left: 3px solid var(--accent, #666);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
      transition: all 0.2s;
    }
    .gast-karte:hover {
      background: #282828;
      border-color: #444;
    }
    .gast-icon {
      font-size: 1.75rem;
      margin-bottom: 0.4rem;
    }
    .gast-name {
      color: #ddd;
      font-size: 0.75rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
      line-height: 1.3;
    }
    .gast-slogan {
      color: #666;
      font-size: 0.65rem;
      font-style: italic;
    }
    
    .talkshow-user {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.75rem 1rem;
      background: rgba(76,175,80,0.1);
      border: 1px solid rgba(76,175,80,0.2);
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    .talkshow-user.kein-archetyp {
      justify-content: flex-start;
      background: rgba(255,255,255,0.03);
      border-color: #333;
    }
    .talkshow-user.kein-archetyp span {
      font-size: 1.5rem;
    }
    .talkshow-user.kein-archetyp p {
      color: #888;
      font-size: 0.85rem;
      margin: 0;
    }
    .user-badge {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.4rem 0.75rem;
      background: #222;
      border: 1px solid var(--accent, #4CAF50);
      border-radius: 20px;
    }
    .user-icon {
      font-size: 1.25rem;
    }
    .user-info {
      display: flex;
      flex-direction: column;
    }
    .user-label {
      color: #888;
      font-size: 0.65rem;
    }
    .user-name {
      color: #ddd;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .user-einschalten {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .einschalten-teaser {
      color: #888;
      font-size: 0.8rem;
    }
    .einschalten-btn {
      padding: 0.4rem 0.75rem;
      background: #4CAF50;
      border-radius: 15px;
      color: #fff;
      font-size: 0.75rem;
      text-decoration: none;
      transition: all 0.2s;
    }
    .einschalten-btn:hover {
      background: #66BB6A;
      transform: scale(1.05);
    }
    
    .talkshow-start {
      text-align: center;
      margin-bottom: 1rem;
    }
    .debatte-starten-btn {
      padding: 0.75rem 2rem;
      background: linear-gradient(135deg, #E53935, #C62828);
      border: none;
      border-radius: 25px;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .debatte-starten-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 20px rgba(229,57,53,0.4);
    }
    
    .talkshow-zukunft {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 1rem;
      background: rgba(156,39,176,0.08);
      border: 1px dashed rgba(156,39,176,0.3);
      border-radius: 10px;
    }
    .talkshow-zukunft span:first-child {
      font-size: 1.5rem;
    }
    .talkshow-zukunft strong {
      display: block;
      color: #9C27B0;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }
    .talkshow-zukunft p {
      color: #888;
      font-size: 0.8rem;
      margin: 0;
    }
    
    /* TALKSHOW POPUP */
    .talkshow-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.2s ease;
      padding: 1rem;
      overflow-y: auto;
    }
    .talkshow-popup {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .talkshow-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      color: #666;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 1;
    }
    .talkshow-close:hover { color: #fff; }
    
    .talkshow-popup-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1.25rem;
      background: linear-gradient(135deg, rgba(156,39,176,0.15), transparent);
      border-bottom: 1px solid #333;
    }
    .talkshow-popup-logo {
      font-size: 2rem;
    }
    .talkshow-popup-header h3 {
      color: #fff;
      font-size: 1.1rem;
      margin: 0 0 0.2rem 0;
    }
    .talkshow-popup-header p {
      color: #888;
      font-size: 0.8rem;
      margin: 0;
    }
    
    .talkshow-popup-gaeste {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #333;
      flex-wrap: wrap;
    }
    .popup-gast {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.6rem;
      background: #222;
      border: 1px solid var(--accent, #666);
      border-radius: 20px;
      font-size: 0.75rem;
      color: #ccc;
    }
    .popup-gast span:first-child {
      font-size: 1rem;
    }
    
    .talkshow-thema {
      padding: 1rem;
      border-bottom: 1px solid #333;
    }
    .thema-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }
    .thema-nummer {
      padding: 0.2rem 0.5rem;
      background: #E53935;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
      color: #fff;
    }
    .thema-name {
      color: #E53935;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .thema-frage {
      background: rgba(229,57,53,0.08);
      border-radius: 8px;
      padding: 0.6rem 0.75rem;
      color: #ddd;
      font-size: 0.9rem;
      font-style: italic;
      margin-bottom: 0.75rem;
    }
    
    .thema-statements {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .statement {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.5rem 0.6rem;
      background: #222;
      border-left: 3px solid var(--accent, #666);
      border-radius: 6px;
    }
    .statement-icon {
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    .statement-text {
      flex: 1;
    }
    .statement-name {
      color: #aaa;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .statement-text {
      color: #ccc;
      font-size: 0.8rem;
      line-height: 1.4;
    }
    
    .talkshow-harmonie {
      padding: 2rem;
      text-align: center;
      color: #888;
    }
    
    .talkshow-abschluss {
      padding: 1rem;
      background: rgba(76,175,80,0.05);
      border-bottom: 1px solid #333;
    }
    .abschluss-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }
    .abschluss-header span {
      font-size: 1.25rem;
    }
    .abschluss-header h4 {
      color: #4CAF50;
      font-size: 0.9rem;
      margin: 0;
    }
    .abschluss-gemeinsamkeiten {
      margin-bottom: 0.75rem;
    }
    .gem-intro {
      color: #4CAF50;
      font-size: 0.8rem;
      margin-bottom: 0.4rem;
    }
    .gem-tag {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      background: rgba(76,175,80,0.15);
      border-radius: 12px;
      font-size: 0.75rem;
      color: #aaa;
      margin: 0.15rem;
    }
    .abschluss-frage {
      background: rgba(76,175,80,0.1);
      border-radius: 8px;
      padding: 0.6rem 0.75rem;
      color: #ccc;
      font-size: 0.85rem;
      font-style: italic;
      margin-bottom: 0.6rem;
    }
    .abschluss-note {
      color: #888;
      font-size: 0.8rem;
    }
    
    .talkshow-einschalten {
      padding: 1rem;
      background: rgba(76,175,80,0.08);
      border-bottom: 1px solid #333;
    }
    .einschalten-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.6rem;
    }
    .einschalten-header span {
      font-size: 1.5rem;
    }
    .einschalten-header strong {
      display: block;
      color: #fff;
      font-size: 0.9rem;
    }
    .einschalten-header p {
      color: #888;
      font-size: 0.75rem;
      margin: 0;
    }
    .einschalten-mail-btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      background: #4CAF50;
      border-radius: 20px;
      color: #fff;
      font-size: 0.85rem;
      text-decoration: none;
      transition: all 0.2s;
    }
    .einschalten-mail-btn:hover {
      background: #66BB6A;
      transform: scale(1.03);
    }
    
    .talkshow-popup-footer {
      padding: 0.75rem 1rem;
      background: rgba(156,39,176,0.1);
      text-align: center;
    }
    .talkshow-popup-footer span {
      color: #9C27B0;
      font-size: 0.8rem;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DEIN PLATZ IM LINKEN WESEN
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .dein-platz {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid #E53935;
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      animation: fadeIn 0.4s ease;
    }
    
    .dein-platz-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.25rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(229,57,53,0.3);
    }
    .dein-platz-icon {
      font-size: 2rem;
    }
    .dein-platz-header h2 {
      color: #fff;
      font-size: 1.2rem;
      margin: 0 0 0.25rem 0;
    }
    .dein-platz-header p {
      color: #888;
      font-size: 0.85rem;
      margin: 0;
    }
    
    /* 3 Zimmer Grid */
    .drei-zimmer-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }
    
    .empfohlenes-zimmer {
      background: rgba(255,255,255,0.03);
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      flex-direction: column;
    }
    .empfohlenes-zimmer:hover {
      background: rgba(229,57,53,0.1);
      border-color: rgba(229,57,53,0.5);
      transform: translateY(-3px);
    }
    
    .empf-zimmer-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .empf-zimmer-icon {
      font-size: 1.5rem;
    }
    .empf-zimmer-achse {
      background: #333;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-size: 0.7rem;
      color: #888;
    }
    
    .empf-zimmer-name {
      color: #fff;
      font-size: 1rem;
      margin: 0 0 0.4rem 0;
    }
    
    .empf-zimmer-frage {
      color: #888;
      font-size: 0.8rem;
      margin: 0 0 0.75rem 0;
      line-height: 1.4;
    }
    
    .empf-zimmer-position {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      background: rgba(229,57,53,0.15);
      border-radius: 8px;
      margin-bottom: 0.75rem;
    }
    .empf-pos-nummer {
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #E53935;
      border-radius: 50%;
      color: #fff;
      font-weight: 700;
      font-size: 0.85rem;
    }
    .empf-pos-name {
      color: #ddd;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .empf-zimmer-teaser {
      display: flex;
      align-items: flex-start;
      gap: 0.4rem;
      padding: 0.5rem;
      background: rgba(76,175,80,0.08);
      border-radius: 6px;
      flex: 1;
    }
    .teaser-icon {
      font-size: 0.9rem;
    }
    .teaser-text {
      color: #aaa;
      font-size: 0.75rem;
      line-height: 1.4;
    }
    
    .empf-zimmer-action {
      margin-top: 0.75rem;
      padding-top: 0.5rem;
      border-top: 1px solid #333;
      text-align: center;
    }
    .empf-zimmer-action span {
      color: #E53935;
      font-size: 0.75rem;
    }
    
    /* Empfohlenes Zimmer Popup */
    .empfohlenes-popup {
      max-width: 550px;
    }
    
    .empf-popup-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .empf-popup-achse {
      background: #E53935;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      color: #fff;
    }
    .empf-popup-header h3 {
      color: #fff;
      font-size: 1.15rem;
      margin: 0;
    }
    
    .empf-popup-frage {
      color: #888;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    
    .empf-popup-position {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: rgba(229,57,53,0.1);
      border: 1px solid rgba(229,57,53,0.3);
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    .empf-popup-position .position-marker {
      flex-shrink: 0;
    }
    .empf-popup-position .position-nummer {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #E53935;
      border-radius: 50%;
      color: #fff;
      font-weight: 700;
      font-size: 1.2rem;
    }
    .empf-popup-position .position-info {
      flex: 1;
    }
    .empf-popup-position .position-name {
      display: block;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
    }
    .empf-popup-position .position-beschreibung {
      color: #bbb;
      font-size: 0.85rem;
      line-height: 1.5;
      margin: 0;
    }
    
    .empf-popup-zitat {
      background: rgba(255,255,255,0.03);
      border-left: 3px solid #666;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      border-radius: 0 8px 8px 0;
    }
    .empf-popup-zitat .zitat-zeichen {
      font-size: 1.5rem;
      color: #555;
      line-height: 1;
    }
    .empf-popup-zitat blockquote {
      margin: 0;
      padding: 0;
      border: none;
      font-style: italic;
      color: #aaa;
      font-size: 0.9rem;
      line-height: 1.5;
    }
    .empf-popup-zitat cite {
      display: block;
      margin-top: 0.4rem;
      font-size: 0.8rem;
      color: #666;
      font-style: normal;
    }
    
    .empf-popup-aufgaben {
      background: #222;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .empf-popup-aufgaben h4 {
      color: #4CAF50;
      font-size: 0.95rem;
      margin: 0 0 0.75rem 0;
    }
    
    .aufgaben-liste {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .aufgabe-item {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
    }
    .aufgabe-nummer {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(76,175,80,0.2);
      border-radius: 50%;
      color: #4CAF50;
      font-size: 0.75rem;
      font-weight: 600;
      flex-shrink: 0;
    }
    .aufgabe-content {
      flex: 1;
    }
    .aufgabe-content strong {
      display: block;
      color: #ddd;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }
    .aufgabe-content p {
      color: #888;
      font-size: 0.8rem;
      line-height: 1.4;
      margin: 0;
    }
    
    .empf-popup-mehr {
      width: 100%;
      padding: 0.75rem;
      background: rgba(229,57,53,0.2);
      border: 1px solid rgba(229,57,53,0.4);
      border-radius: 8px;
      color: #E53935;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .empf-popup-mehr:hover {
      background: rgba(229,57,53,0.3);
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE/TABLET: Hier wirst du gebraucht - Cards untereinander
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 900px) {
      .dein-platz {
        padding: 1rem;
        margin: 0 0 1rem 0;
        overflow: hidden;
      }
      
      .dein-platz-header {
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
      }
      
      .dein-platz-header h2 {
        font-size: 1.1rem;
      }
      
      .dein-platz-header p {
        font-size: 0.8rem;
      }
      
      .drei-zimmer-grid {
        grid-template-columns: 1fr !important;
        gap: 0.75rem;
      }
      
      .empfohlenes-zimmer {
        padding: 0.85rem;
      }
      
      .empf-zimmer-name {
        font-size: 0.95rem;
      }
      
      .empf-zimmer-frage {
        font-size: 0.75rem;
      }
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MEIN PROFIL - Kombinierte Ansicht
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .mein-profil-container {
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    
    .profil-header-card {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid #E53935;
      border-radius: 16px;
      padding: 1.25rem;
    }
    
    .profil-header-card.leer {
      border-color: #444;
      text-align: center;
    }
    
    .profil-header-top {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .profil-icon {
      font-size: 2rem;
    }
    
    .profil-info {
      flex: 1;
    }
    
    .profil-info h3 {
      color: #fff;
      font-size: 1.1rem;
      margin: 0;
    }
    
    .profil-archetyp {
      color: #E53935;
      font-size: 0.85rem;
    }
    
    .profil-edit-btn {
      background: rgba(255,255,255,0.1);
      border: 1px solid #444;
      color: #aaa;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
    }
    
    .profil-edit-btn:hover {
      background: rgba(229,57,53,0.2);
      border-color: #E53935;
      color: #fff;
    }
    
    .profil-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .profil-chip {
      background: rgba(229,57,53,0.15);
      border: 1px solid rgba(229,57,53,0.3);
      color: #ddd;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      font-size: 0.75rem;
      cursor: pointer;
    }
    
    .profil-chip:hover {
      background: rgba(229,57,53,0.3);
    }
    
    .profil-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    .profil-action-btn {
      flex: 1;
      padding: 0.6rem;
      border-radius: 8px;
      border: 1px solid #444;
      background: rgba(255,255,255,0.05);
      color: #ccc;
      cursor: pointer;
      font-size: 0.85rem;
    }
    
    .profil-action-btn:hover {
      background: rgba(229,57,53,0.2);
      border-color: #E53935;
    }
    
    .profil-action-btn.secondary {
      background: transparent;
    }
    
    /* Profil Editor */
    .profil-editor-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .profil-achse-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.3rem;
      background: rgba(0,0,0,0.2);
      border-radius: 4px;
    }
    
    .profil-achse-label {
      font-size: 0.7rem;
      color: #888;
      width: 24px;
    }
    
    .profil-achse-slider {
      display: flex;
      gap: 2px;
      flex: 1;
    }
    
    .profil-pos {
      flex: 1;
      padding: 0.25rem;
      background: #333;
      border: 1px solid #444;
      color: #888;
      font-size: 0.7rem;
      cursor: pointer;
      border-radius: 2px;
    }
    
    .profil-pos:hover {
      background: #444;
    }
    
    .profil-pos.selected {
      background: #E53935;
      border-color: #E53935;
      color: #fff;
    }
    
    .profil-editor-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .profil-save-btn, .profil-cancel-btn {
      flex: 1;
      padding: 0.5rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
    }
    
    .profil-save-btn {
      background: #E53935;
      color: #fff;
    }
    
    .profil-cancel-btn {
      background: #333;
      color: #aaa;
    }
    
    /* Leerer Profil-Zustand */
    .profil-leer-content {
      padding: 1rem;
    }
    
    .profil-leer-icon {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }
    
    .profil-leer-content h3 {
      color: #fff;
      margin: 0 0 0.5rem 0;
    }
    
    .profil-leer-content p {
      color: #888;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    
    .profil-start-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .profil-start-btn {
      display: block;
      padding: 0.75rem;
      border-radius: 8px;
      text-align: center;
      text-decoration: none;
      font-size: 0.9rem;
      cursor: pointer;
      border: none;
    }
    
    .profil-start-btn.primary {
      background: #E53935;
      color: #fff;
    }
    
    .profil-start-btn.secondary {
      background: #333;
      color: #ccc;
      border: 1px solid #444;
    }
    
    /* Mein Sozialismus Section */
    .ms-section {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1rem;
    }
    
    .ms-section-header {
      text-align: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #333;
    }
    
    .ms-section-header h3 {
      color: #E53935;
      font-size: 1.1rem;
      margin: 0 0 0.25rem 0;
    }
    
    .ms-section-header p {
      color: #888;
      font-size: 0.8rem;
      margin: 0;
    }
    
    .hidden {
      display: none !important;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MEIN SOZIALISMUS - Definition Editor
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .mein-sozialismus-container {
      padding: 1rem;
    }
    
    .ms-intro {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #333;
    }
    .ms-intro h3 {
      color: #E53935;
      font-size: 1.3rem;
      margin: 0 0 0.5rem 0;
    }
    .ms-intro p {
      color: #888;
      font-size: 0.9rem;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.5;
    }
    
    .ms-editor {
      margin-bottom: 1.5rem;
    }
    
    .ms-kategorien {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .ms-kategorie {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .ms-kategorie-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: #222;
      border-bottom: 1px solid #333;
    }
    .ms-kategorie-icon {
      font-size: 1.25rem;
    }
    .ms-kategorie-header h4 {
      color: #fff;
      font-size: 0.95rem;
      margin: 0;
    }
    .ms-kategorie-info {
      color: #666;
      font-size: 0.75rem;
    }
    
    .ms-dropzone {
      min-height: 60px;
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      position: relative;
    }
    .ms-dropzone.dragover {
      background: rgba(229,57,53,0.1);
    }
    .ms-dropzone-hint {
      color: #444;
      font-size: 0.8rem;
      text-align: center;
      padding: 1rem;
      border: 2px dashed #333;
      border-radius: 8px;
      display: none;
    }
    .ms-dropzone:empty .ms-dropzone-hint,
    .ms-dropzone:not(:has(.ms-item)) .ms-dropzone-hint {
      display: block;
    }
    
    .ms-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 0.75rem;
      background: #252525;
      border: 1px solid #333;
      border-radius: 8px;
      cursor: grab;
      transition: all 0.2s;
    }
    .ms-item:hover {
      border-color: #555;
      background: #2a2a2a;
    }
    .ms-item.dragging {
      opacity: 0.5;
      border-color: #E53935;
    }
    
    .ms-item-drag {
      color: #444;
      font-size: 0.9rem;
      cursor: grab;
    }
    .ms-item-content {
      flex: 1;
    }
    .ms-item-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .ms-item-achse {
      background: #333;
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-size: 0.65rem;
      color: #888;
    }
    .ms-item-label {
      color: #ddd;
      font-size: 0.85rem;
      font-weight: 500;
    }
    .ms-item-custom {
      font-size: 0.7rem;
    }
    .ms-item-zimmer {
      color: #666;
      font-size: 0.7rem;
      margin-top: 0.2rem;
    }
    .ms-item-eigentext {
      color: #aaa;
      font-size: 0.75rem;
      font-style: italic;
      margin-top: 0.2rem;
    }
    
    .ms-item-actions {
      display: flex;
      gap: 0.25rem;
    }
    .ms-item-actions button {
      background: none;
      border: none;
      color: #555;
      cursor: pointer;
      padding: 0.25rem;
      font-size: 0.85rem;
      transition: color 0.2s;
    }
    .ms-item-actions button:hover {
      color: #fff;
    }
    .ms-item-remove:hover {
      color: #E53935 !important;
    }
    
    .ms-hinzufuegen {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }
    .ms-add-btn, .ms-add-custom-btn {
      flex: 1;
      padding: 0.75rem;
      background: #222;
      border: 1px dashed #444;
      border-radius: 8px;
      color: #888;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .ms-add-btn:hover, .ms-add-custom-btn:hover {
      border-color: #E53935;
      color: #E53935;
    }
    
    /* Vorschau */
    .ms-vorschau {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid #E53935;
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1rem;
    }
    .ms-vorschau-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    .ms-vorschau-header h4 {
      color: #fff;
      font-size: 1rem;
      margin: 0;
    }
    .ms-edit-text-btn {
      background: none;
      border: 1px solid #444;
      color: #888;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .ms-edit-text-btn:hover {
      border-color: #888;
      color: #fff;
    }
    
    .ms-vorschau-text {
      color: #ccc;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .ms-vorschau-text strong {
      color: #E53935;
    }
    .ms-vorschau-leer {
      color: #555;
      font-style: italic;
    }
    
    .ms-freitext-editor textarea {
      width: 100%;
      min-height: 100px;
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      color: #ccc;
      padding: 0.75rem;
      font-size: 0.9rem;
      line-height: 1.5;
      resize: vertical;
      margin-bottom: 0.5rem;
    }
    .ms-save-freitext {
      background: #E53935;
      border: none;
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
    }
    
    /* Aktionen */
    .ms-aktionen {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    .ms-btn-primary {
      flex: 1;
      min-width: 120px;
      padding: 0.75rem 1rem;
      background: linear-gradient(135deg, #E53935, #C62828);
      border: none;
      border-radius: 25px;
      color: #fff;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .ms-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(229,57,53,0.4);
    }
    .ms-btn-secondary {
      padding: 0.75rem 1rem;
      background: #222;
      border: 1px solid #444;
      border-radius: 25px;
      color: #ccc;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .ms-btn-secondary:hover {
      border-color: #888;
      color: #fff;
    }
    .ms-btn-danger {
      padding: 0.75rem 1rem;
      background: transparent;
      border: 1px solid #444;
      border-radius: 25px;
      color: #888;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .ms-btn-danger:hover {
      border-color: #E53935;
      color: #E53935;
    }
    
    /* Edit Overlay */
    .ms-edit-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 1rem;
    }
    .ms-edit-popup {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 400px;
      width: 100%;
    }
    .ms-edit-popup h4 {
      color: #fff;
      font-size: 1.1rem;
      margin: 0 0 0.5rem 0;
    }
    .ms-edit-popup p {
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 1rem;
    }
    .ms-edit-popup input,
    .ms-edit-popup textarea {
      width: 100%;
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      color: #ccc;
      padding: 0.75rem;
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
    }
    .ms-edit-popup textarea {
      min-height: 80px;
      resize: vertical;
    }
    .ms-edit-buttons {
      display: flex;
      gap: 0.5rem;
    }
    .ms-edit-buttons button {
      flex: 1;
      padding: 0.6rem;
      border-radius: 6px;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .ms-edit-buttons button:first-child {
      background: #E53935;
      border: none;
      color: #fff;
    }
    .ms-edit-buttons button.secondary {
      background: #333;
      border: 1px solid #444;
      color: #ccc;
    }
    
    /* Auswahl Overlay */
    .ms-auswahl-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 1rem;
    }
    .ms-auswahl-popup {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    .ms-auswahl-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      color: #666;
      font-size: 1.5rem;
      cursor: pointer;
    }
    .ms-auswahl-popup h4 {
      color: #fff;
      margin: 0 0 0.25rem 0;
    }
    .ms-auswahl-popup > p {
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 1rem;
    }
    .ms-auswahl-liste {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .ms-auswahl-etage h5 {
      color: #888;
      font-size: 0.8rem;
      margin: 0 0 0.5rem 0;
    }
    .ms-auswahl-zimmer {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      background: #222;
      border-radius: 6px;
      margin-bottom: 0.4rem;
    }
    .ms-auswahl-achse {
      background: #333;
      padding: 0.15rem 0.35rem;
      border-radius: 4px;
      font-size: 0.65rem;
      color: #888;
    }
    .ms-auswahl-name {
      flex: 1;
      color: #ccc;
      font-size: 0.8rem;
    }
    .ms-auswahl-positionen {
      display: flex;
      gap: 0.25rem;
    }
    .ms-auswahl-pos {
      width: 28px;
      height: 28px;
      background: #333;
      border: 1px solid #444;
      border-radius: 4px;
      color: #888;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .ms-auswahl-pos:hover:not(:disabled) {
      background: #E53935;
      border-color: #E53935;
      color: #fff;
    }
    .ms-auswahl-pos.vorhanden {
      background: #1a3a1a;
      border-color: #2a5a2a;
      color: #4a8a4a;
      cursor: not-allowed;
    }
    }
    .dein-platz-btn:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 15px rgba(229,57,53,0.4);
    }
    .dein-platz-btn.secondary {
      background: transparent;
      border: 1px solid #555;
      color: #aaa;
    }
    .dein-platz-btn.secondary:hover {
      border-color: #888;
      color: #ddd;
      box-shadow: none;
    }
    
    /* Highlight-Pulse Animation fÃ¼r Zimmer */
    @keyframes highlightPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(229,57,53,0); }
      50% { box-shadow: 0 0 20px 5px rgba(229,57,53,0.4); }
    }
    .highlight-pulse {
      animation: highlightPulse 0.5s ease 3;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ZIMMER-FINDER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .zimmer-finder-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 20000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      animation: fadeIn 0.3s ease;
    }
    
    .zimmer-finder-modal {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid #E53935;
      border-radius: 16px;
      max-width: 550px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem;
      box-shadow: 0 20px 60px rgba(229,57,53,0.3);
    }
    
    .zimmer-finder-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(229,57,53,0.3);
    }
    .zimmer-finder-header.ergebnis {
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }
    
    .zimmer-finder-archetyp {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .archetyp-icon {
      font-size: 1.75rem;
    }
    .archetyp-name {
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
    }
    
    .zimmer-finder-progress {
      color: #888;
      font-size: 0.85rem;
    }
    .zimmer-finder-titel {
      color: #E53935;
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    .zimmer-finder-frage h2 {
      color: #fff;
      font-size: 1.3rem;
      margin: 0 0 0.5rem 0;
    }
    .frage-text {
      color: #aaa;
      font-size: 0.9rem;
      margin: 0 0 1.25rem 0;
    }
    
    .zimmer-finder-optionen {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .zf-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.03);
      border: 1px solid #333;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .zf-option:hover {
      background: rgba(255,255,255,0.06);
      border-color: #555;
    }
    .zf-option.selected {
      background: rgba(229,57,53,0.1);
      border-color: #E53935;
    }
    
    .zf-radio {
      width: 18px;
      height: 18px;
      border: 2px solid #555;
      border-radius: 50%;
      flex-shrink: 0;
      position: relative;
    }
    .zf-radio.checked {
      border-color: #E53935;
    }
    .zf-radio.checked::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 8px;
      height: 8px;
      background: #E53935;
      border-radius: 50%;
    }
    
    .zf-option-text {
      flex: 1;
      color: #ccc;
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .zf-option.selected .zf-option-text {
      color: #fff;
    }
    
    .zf-option-wert {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #333;
      border-radius: 50%;
      color: #888;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .zf-option.selected .zf-option-wert {
      background: #E53935;
      color: #fff;
    }
    
    .zimmer-finder-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    .zimmer-finder-actions.ergebnis {
      justify-content: center;
    }
    
    .zf-btn {
      padding: 0.75rem 1.25rem;
      border-radius: 25px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .zf-btn.primary {
      flex: 1;
      background: linear-gradient(135deg, #E53935, #C62828);
      border: none;
      color: #fff;
    }
    .zf-btn.primary:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 15px rgba(229,57,53,0.4);
    }
    .zf-btn.primary.gross {
      padding: 1rem 2rem;
      font-size: 1rem;
    }
    .zf-btn.secondary {
      background: transparent;
      border: 1px solid #555;
      color: #aaa;
    }
    .zf-btn.secondary:hover {
      border-color: #888;
      color: #ddd;
    }
    
    /* Zimmer-Finder Ergebnis */
    .zimmer-finder-ergebnis {
      padding: 0.5rem 0;
    }
    
    .zf-hauptzimmer {
      background: rgba(229,57,53,0.1);
      border: 1px solid rgba(229,57,53,0.3);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .zf-badge {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      background: #E53935;
      border-radius: 12px;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 600;
      margin-bottom: 0.6rem;
    }
    .zf-zimmer-header {
      display: flex;
      align-items: flex-start;
      gap: 0.6rem;
      margin-bottom: 0.75rem;
    }
    .zf-etage-icon {
      font-size: 1.5rem;
    }
    .zf-zimmer-header h3 {
      color: #fff;
      font-size: 1rem;
      margin: 0 0 0.2rem 0;
    }
    .zf-achse {
      color: #888;
      font-size: 0.75rem;
    }
    
    .zf-position {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.75rem;
      padding: 0.4rem 0.6rem;
      background: rgba(255,255,255,0.05);
      border-radius: 6px;
    }
    .zf-pos-label {
      color: #888;
      font-size: 0.75rem;
    }
    .zf-pos-wert {
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #E53935;
      border-radius: 50%;
      color: #fff;
      font-weight: 700;
      font-size: 0.8rem;
    }
    .zf-pos-name {
      color: #ddd;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .zf-aufgabe {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.6rem;
      background: rgba(76,175,80,0.1);
      border: 1px solid rgba(76,175,80,0.2);
      border-radius: 6px;
    }
    .zf-aufgabe-icon {
      font-size: 1rem;
    }
    .zf-aufgabe p {
      color: #bbb;
      font-size: 0.8rem;
      line-height: 1.4;
      margin: 0;
    }
    
    .zf-weitere-titel {
      color: #888;
      font-size: 0.8rem;
      margin-bottom: 0.4rem;
    }
    .zf-weitere-liste {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      margin-bottom: 1rem;
    }
    .zf-weiteres-zimmer {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.6rem;
      background: rgba(255,255,255,0.03);
      border: 1px solid #333;
      border-radius: 6px;
    }
    .zf-weiteres-icon {
      font-size: 1.1rem;
    }
    .zf-weiteres-name {
      color: #ddd;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .zf-weiteres-pos {
      color: #888;
      font-size: 0.7rem;
      display: block;
    }
    
    .zf-wg-empfehlung {
      padding: 0.75rem;
      background: rgba(156,39,176,0.08);
      border: 1px solid rgba(156,39,176,0.2);
      border-radius: 8px;
    }
    .zf-wg-label {
      color: #9C27B0;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
    }
    .zf-wg-liste {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }
    .zf-wg-item {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.25rem 0.5rem;
      background: #222;
      border: 1px solid var(--accent, #666);
      border-radius: 15px;
      font-size: 0.75rem;
      color: #ccc;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       WG-DEBATTE POPUP
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .wg-debatte-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.2s ease;
      padding: 1rem;
    }
    .wg-debatte-popup {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 16px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .wg-debatte-close {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      color: #666;
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 1;
    }
    .wg-debatte-close:hover { color: #fff; }
    
    .wg-debatte-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1.25rem;
      background: linear-gradient(135deg, rgba(156,39,176,0.15), rgba(103,58,183,0.05));
      border-bottom: 1px solid #333;
    }
    .wg-debatte-icon {
      font-size: 2rem;
    }
    .wg-debatte-header h3 {
      color: #fff;
      font-size: 1.1rem;
      margin: 0 0 0.2rem 0;
    }
    .wg-debatte-header p {
      color: #888;
      font-size: 0.8rem;
      margin: 0;
    }
    
    .wg-debatte-bewohner {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      padding: 1rem;
      border-bottom: 1px solid #333;
      flex-wrap: wrap;
    }
    .debatte-person {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.6rem;
      background: #222;
      border: 1px solid var(--accent, #666);
      border-radius: 20px;
      font-size: 0.75rem;
      color: #ccc;
    }
    .debatte-person span:first-child {
      font-size: 1rem;
    }
    
    .wg-debatte-spannungen {
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .spannung-karte {
      background: #222;
      border: 1px solid #333;
      border-left: 3px solid #E53935;
      border-radius: 8px;
      padding: 0.75rem;
    }
    .spannung-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .spannung-nummer {
      width: 22px;
      height: 22px;
      background: #E53935;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: #fff;
    }
    .spannung-name {
      color: #E53935;
      font-weight: 600;
      font-size: 0.85rem;
    }
    
    .spannung-kontrahenten {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
      flex-wrap: wrap;
    }
    .spannung-kontrahenten .kontrahent {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.25rem 0.5rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--accent, #666);
      border-radius: 12px;
      font-size: 0.7rem;
      color: #ccc;
    }
    .spannung-kontrahenten .vs {
      color: #666;
      font-size: 0.8rem;
    }
    
    .spannung-frage {
      background: rgba(229,57,53,0.08);
      border-radius: 6px;
      padding: 0.6rem 0.75rem;
      color: #ddd;
      font-size: 0.85rem;
      font-style: italic;
      line-height: 1.4;
    }
    
    .keine-spannungen {
      text-align: center;
      padding: 1.5rem;
      color: #888;
    }
    .keine-spannungen p:first-child {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }
    
    .wg-debatte-footer {
      padding: 0.75rem 1rem;
      background: rgba(156,39,176,0.1);
      border-top: 1px solid #333;
      text-align: center;
    }
    .wg-debatte-footer span {
      color: #9C27B0;
      font-size: 0.8rem;
    }
    
    /* Sections im Debatte-Popup */
    .wg-debatte-section {
      border-bottom: 1px solid #333;
    }
    .wg-debatte-section:last-of-type {
      border-bottom: none;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.03);
    }
    .section-header.debatte {
      background: linear-gradient(135deg, rgba(229,57,53,0.1), transparent);
    }
    .section-header.gemeinsam {
      background: linear-gradient(135deg, rgba(76,175,80,0.1), transparent);
    }
    .section-icon {
      font-size: 1.25rem;
    }
    .section-header h4 {
      color: #fff;
      font-size: 0.9rem;
      margin: 0;
    }
    .section-header p {
      color: #888;
      font-size: 0.75rem;
      margin: 0;
    }
    
    .wg-debatte-spannungen {
      padding: 0.75rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
    
    /* Gemeinsamer Raum */
    .gemeinsamer-raum {
      padding: 0.75rem 1rem;
    }
    
    .gemeinsamkeiten {
      margin-bottom: 0.75rem;
    }
    .gemeinsamkeiten-intro {
      color: #4CAF50;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
    }
    .gemeinsamkeit {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.3rem 0;
      color: #aaa;
      font-size: 0.8rem;
    }
    .gem-icon {
      color: #4CAF50;
      font-size: 0.7rem;
    }
    
    .dialog-fragen {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }
    .dialog-frage {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.6rem 0.75rem;
      background: rgba(76,175,80,0.08);
      border: 1px solid rgba(76,175,80,0.2);
      border-radius: 8px;
    }
    .dialog-icon {
      font-size: 1rem;
      flex-shrink: 0;
    }
    .dialog-frage span:last-child {
      color: #ccc;
      font-size: 0.85rem;
      font-style: italic;
      line-height: 1.4;
    }
    
    .solidaritaet-note {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.6rem 0.75rem;
      background: linear-gradient(135deg, rgba(76,175,80,0.15), rgba(76,175,80,0.05));
      border-radius: 8px;
      border-left: 3px solid #4CAF50;
    }
    .solidaritaet-note span {
      font-size: 1rem;
    }
    .solidaritaet-note p {
      color: #aaa;
      font-size: 0.8rem;
      margin: 0;
      line-height: 1.4;
    }
    
    /* Ã–kosystem-Container */
    #oekosystem-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 2rem;
      overflow-y: auto;
    }
    .oeko-zone {
      margin-bottom: 2rem;
    }
    .oeko-zone h3 {
      color: #4CAF50;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #333;
    }
    .oeko-arten {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    .oeko-art {
      background: #252525;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .oeko-art:hover { border-color: #4CAF50; }
    .oeko-art.dominant { border-color: #4CAF50; background: #2a3a2a; }
    .oeko-art.pioneer { border-color: #FF9800; background: #3a3020; }
    .oeko-art.symbiont { border-color: #2196F3; background: #202a3a; }
    .oeko-art.endangered { border-color: #f44336; background: #3a2020; opacity: 0.7; }
    
    /* Chemie-Container */
    #chemie-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 2rem;
      overflow-y: auto;
    }
    .periodensystem {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 0.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .element {
      background: #252525;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 0.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .element:hover { transform: scale(1.1); z-index: 10; }
    .element .symbol { font-size: 1.2rem; font-weight: bold; }
    .element .name { font-size: 0.6rem; color: #888; margin-top: 0.25rem; }
    .element.edelgas { border-color: #9C27B0; background: #2a202a; }
    .element.alkali { border-color: #f44336; background: #3a2020; }
    .element.katalysator { border-color: #FF9800; background: #3a3020; }
    .element.stabil { border-color: #4CAF50; background: #2a3a2a; }
    
    .reaktionsgleichung {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 1.5rem;
      margin-top: 2rem;
      font-family: monospace;
    }
    .reaktionsgleichung h3 { color: #FF9800; margin-bottom: 1rem; }
    .reaktion { margin-bottom: 1rem; color: #aaa; }
    .reaktion .formel { font-size: 1.1rem; color: #fff; }
    .reaktion .ergebnis { color: #666; font-size: 0.85rem; }
    
    /* Epochen-Container */
    #zeit-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 2rem;
      overflow-y: auto;
    }
    .epochen-nav {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }
    .epoche-btn {
      background: #252525;
      border: 1px solid #444;
      color: #aaa;
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.85rem;
    }
    .epoche-btn:hover { border-color: #666; }
    .epoche-btn.active { border-color: #E53935; color: #fff; background: #2a2020; }
    .epochen-inhalt {
      background: #222;
      border-radius: 8px;
      padding: 2rem;
    }
    .epochen-inhalt h3 { color: #E53935; margin-bottom: 1rem; }
    .epochen-inhalt p { color: #aaa; line-height: 1.6; margin-bottom: 1rem; }
    .epochen-knoten {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .epochen-knoten span {
      background: #333;
      padding: 0.3rem 0.6rem;
      border-radius: 3px;
      font-size: 0.8rem;
      cursor: pointer;
    }
    .epochen-knoten span:hover { background: #444; }
    .epochen-knoten span.geboren { border-left: 3px solid #4CAF50; }
    .epochen-knoten span.aktiv { border-left: 3px solid #FF9800; }
    .epochen-knoten span.tot { border-left: 3px solid #666; opacity: 0.5; }
    
    /* Stammbaum-Container */
    #stammbaum-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 2rem;
      overflow-y: auto;
      background: linear-gradient(180deg, var(--bg-primary) 0%, #0d1117 100%);
    }
    
    .stammbaum-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .stammbaum-header h2 {
      font-size: 1.8rem;
      font-weight: 300;
      color: #4CAF50;
      margin-bottom: 0.5rem;
    }
    
    .stammbaum-header p {
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    
    .stammbaum-timeline {
      position: relative;
      max-width: 900px;
      margin: 0 auto;
      padding-left: 60px;
    }
    
    /* Vertikale Linie */
    .stammbaum-timeline::before {
      content: '';
      position: absolute;
      left: 25px;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(to bottom, #4CAF50, #2196F3, #9C27B0, #E53935);
      border-radius: 3px;
    }
    
    .stammbaum-epoche {
      position: relative;
      margin-bottom: 2.5rem;
    }
    
    /* Zeitmarker */
    .stammbaum-epoche::before {
      content: '';
      position: absolute;
      left: -47px;
      top: 8px;
      width: 16px;
      height: 16px;
      background: var(--bg-primary);
      border: 3px solid #4CAF50;
      border-radius: 50%;
      z-index: 1;
    }
    
    .stammbaum-epoche:nth-child(2)::before { border-color: #66BB6A; }
    .stammbaum-epoche:nth-child(3)::before { border-color: #42A5F5; }
    .stammbaum-epoche:nth-child(4)::before { border-color: #7E57C2; }
    .stammbaum-epoche:nth-child(5)::before { border-color: #FF7043; }
    .stammbaum-epoche:nth-child(6)::before { border-color: #EC407A; }
    
    .stammbaum-zeit {
      font-size: 0.8rem;
      color: #4CAF50;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.75rem;
    }
    
    .stammbaum-epoche:nth-child(2) .stammbaum-zeit { color: #66BB6A; }
    .stammbaum-epoche:nth-child(3) .stammbaum-zeit { color: #42A5F5; }
    .stammbaum-epoche:nth-child(4) .stammbaum-zeit { color: #7E57C2; }
    .stammbaum-epoche:nth-child(5) .stammbaum-zeit { color: #FF7043; }
    .stammbaum-epoche:nth-child(6) .stammbaum-zeit { color: #EC407A; }
    
    .stammbaum-generation {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    
    .stammbaum-knoten {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      text-align: center;
      cursor: pointer;
      min-width: 110px;
      transition: all 0.2s;
      position: relative;
    }
    
    .stammbaum-knoten:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      border-color: #4CAF50;
    }
    
    .stammbaum-knoten.clickable {
      border-left: 3px solid #4CAF50;
    }
    
    .stammbaum-knoten.clickable::after {
      content: 'â†’';
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      color: #4CAF50;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .stammbaum-knoten.clickable:hover::after {
      opacity: 1;
    }
    
    .stammbaum-knoten .name {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }
    
    .stammbaum-knoten .zeit {
      font-size: 0.7rem;
      color: var(--text-muted);
    }
    
    .stammbaum-knoten .einfluss-tags {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 0.5rem;
    }
    
    .stammbaum-knoten .einfluss-tag {
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      background: rgba(76, 175, 80, 0.15);
      color: #4CAF50;
      border-radius: 8px;
    }
    
    .stammbaum-footer {
      margin-top: 2rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      color: var(--text-muted);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
      font-size: 0.85rem;
    }
    
    .stammbaum-footer strong {
      color: #4CAF50;
    }
    
    /* Dialoge-Container */
    #dialoge-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 2rem;
      overflow-y: auto;
    }
    .dialog-box {
      max-width: 800px;
      margin: 0 auto 2rem;
      background: #222;
      border-radius: 8px;
      padding: 1.5rem;
    }
    .dialog-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #333;
    }
    .dialog-sprecher {
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .dialog-sprecher.links { background: #E53935; color: #fff; }
    .dialog-sprecher.rechts { background: #2196F3; color: #fff; }
    .dialog-zeile {
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 8px;
    }
    .dialog-zeile.links { background: #2a2020; border-left: 3px solid #E53935; margin-right: 20%; }
    .dialog-zeile.rechts { background: #202a30; border-left: 3px solid #2196F3; margin-left: 20%; }
    .dialog-zeile .autor { font-weight: 500; color: #aaa; margin-bottom: 0.5rem; }
    .dialog-zeile .text { line-height: 1.6; }
    
    /* Zitate-Container */
    #zitate-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 2rem;
      overflow-y: auto;
    }
    .zitat-card {
      background: #222;
      border-left: 3px solid #E53935;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    .zitat-text {
      font-size: 1.1rem;
      line-height: 1.6;
      font-style: italic;
      color: #ddd;
      margin-bottom: 1rem;
    }
    .zitat-quelle {
      display: flex;
      justify-content: space-between;
      color: #888;
      font-size: 0.85rem;
    }
    .zitat-autor { cursor: pointer; }
    .zitat-autor:hover { color: #E53935; }
    
    /* Konfigurator-Container */
    #konfigurator-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 1.5rem;
      overflow-y: auto;
      background: linear-gradient(180deg, var(--bg-primary) 0%, #0d0d12 100%);
    }
    
    /* Generator-Header - kompakt */
    .konfig-generator-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: linear-gradient(135deg, rgba(198,40,40,0.15) 0%, rgba(156,39,176,0.1) 100%);
      border: 1px solid rgba(198,40,40,0.3);
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    .konfig-generator-icon {
      font-size: 2rem;
    }
    .konfig-generator-header h2 {
      color: #fff;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.15rem;
    }
    .konfig-generator-header .archetyp-name {
      color: #C62828;
      font-size: 1rem;
      font-weight: 600;
    }
    .konfig-generator-header .konfig-subtitle {
      color: var(--text-muted);
      font-size: 0.8rem;
    }
    
    /* Normaler Header - kompakt */
    .konfig-header {
      margin-bottom: 1rem;
      text-align: center;
    }
    .konfig-header h2 {
      color: #9C27B0;
      font-size: 1.4rem;
      margin-bottom: 0.25rem;
    }
    .konfig-header p {
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    .konfig-hint {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background: rgba(156,39,176,0.1);
      border-radius: 6px;
      font-size: 0.8rem;
      display: inline-block;
    }
    
    /* Haupt-Layout: Zwei Spalten */
    .konfig-main {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 1.5rem;
      align-items: start;
    }
    
    @media (max-width: 1000px) {
      .konfig-main {
        grid-template-columns: 1fr;
      }
    }
    
    /* Linke Spalte: Achsen-Grid */
    .konfig-achsen {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.5rem;
    }
    .konfig-achsen-header {
      grid-column: 1 / -1;
      color: var(--text-muted);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0.25rem;
    }
    
    /* Einzelne Achsen-Box */
    .konfig-achse {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.5rem;
      transition: all 0.2s;
    }
    .konfig-achse.has-value {
      border-left: 3px solid #C62828;
    }
    .konfig-achse-header {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.4rem;
    }
    .konfig-achse-id {
      background: var(--bg-tertiary);
      padding: 0.1rem 0.3rem;
      border-radius: 3px;
      font-size: 0.65rem;
      font-weight: 600;
      color: var(--text-muted);
    }
    .konfig-achse-name {
      font-size: 0.75rem;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Slider kompakt */
    .konfig-slider {
      display: flex;
      gap: 2px;
    }
    .konfig-option {
      flex: 1;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      padding: 0.3rem 0.15rem;
      text-align: center;
      cursor: pointer;
      font-size: 0.7rem;
      color: var(--text-muted);
      border-radius: 3px;
      transition: all 0.15s;
    }
    .konfig-option:hover { 
      border-color: #666;
      color: var(--text-primary);
    }
    .konfig-option.selected { 
      background: #C62828; 
      border-color: #C62828; 
      color: #fff;
      font-weight: 600;
    }
    .konfig-pole-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 0.2rem;
      font-size: 0.6rem;
      color: var(--text-muted);
    }
    
    /* Rechte Spalte: Nachbarn */
    .konfig-sidebar {
      position: sticky;
      top: 1rem;
    }
    
    .konfig-nachbarn {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem;
    }
    .konfig-nachbarn h3 {
      color: var(--text-primary);
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .nachbarn-gruppe {
      margin-bottom: 0.75rem;
    }
    .nachbarn-label {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 0.3rem;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .nachbarn-liste {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }
    .nachbar-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.4rem 0.6rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .nachbar-card:hover {
      transform: translateX(3px);
      border-color: #666;
    }
    .nachbar-card.exakt {
      border-color: #C62828;
      background: rgba(198,40,40,0.15);
    }
    .nachbar-card.exakt:hover {
      border-color: #E53935;
    }
    .nachbar-name {
      color: var(--text-primary);
      font-size: 0.8rem;
    }
    .nachbar-id, .nachbar-match {
      font-size: 0.7rem;
      font-weight: 600;
    }
    .nachbar-id { color: #C62828; }
    .nachbar-match { color: #4CAF50; }
    
    /* Actions kompakt */
    .konfig-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .konfig-btn {
      flex: 1;
      padding: 0.5rem 0.75rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .konfig-btn:hover {
      border-color: #666;
    }
    .konfig-btn.primary {
      background: #C62828;
      border-color: #C62828;
      color: #fff;
    }
    .konfig-btn.primary:hover {
      background: #E53935;
    }
    
    /* Ergebnis-Bereich (manueller Modus) */
    .konfig-result {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem;
    }
    .konfig-result h3 {
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
    }
    
    /* Hinweis wenn noch nicht genug gewÃ¤hlt */
    .konfig-hint-box {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    .konfig-hint-box .count {
      font-size: 1.5rem;
      font-weight: 700;
      color: #9C27B0;
      display: block;
      margin-bottom: 0.25rem;
    }
    
    /* Fieber-Container */
    #fieber-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 2rem;
      overflow-y: auto;
    }
    .fieber-skala {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-width: 900px;
      margin: 0 auto;
    }
    .fieber-zeile {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .fieber-label {
      width: 150px;
      font-size: 0.85rem;
      text-align: right;
      cursor: pointer;
    }
    .fieber-label:hover { color: #E53935; }
    .fieber-bar {
      flex: 1;
      height: 24px;
      background: #252525;
      border-radius: 4px;
      overflow: hidden;
    }
    .fieber-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s;
    }
    .fieber-fill.heiss { background: linear-gradient(to right, #FF9800, #f44336); }
    .fieber-fill.warm { background: linear-gradient(to right, #4CAF50, #FF9800); }
    .fieber-fill.kalt { background: linear-gradient(to right, #2196F3, #4CAF50); }
    .fieber-fill.tot { background: #444; }
    
    /* Personen-Container */
    #personen-container {
      display: none;
      flex: 1;
      flex-direction: column;
      padding: 2rem;
      overflow-y: auto;
    }
    .personen-filter {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
    }
    .personen-filter button {
      background: #252525;
      border: 1px solid #333;
      color: #aaa;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
    }
    .personen-filter button:hover { border-color: #666; }
    .personen-filter button.active { background: #E53935; border-color: #E53935; color: #fff; }
    .personen-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .person-card {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .person-card:hover { border-color: #E53935; transform: translateY(-2px); }
    .person-card .header {
      display: flex;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }
    .person-card .avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }
    .person-card .info { flex: 1; }
    .person-card .name { font-weight: 600; color: #fff; }
    .person-card .leben { font-size: 0.8rem; color: #666; }
    .person-card .bio { font-size: 0.85rem; color: #aaa; line-height: 1.4; margin-bottom: 0.75rem; }
    .person-card .positionen {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }
    .person-card .pos-tag {
      background: rgba(229, 57, 53, 0.2);
      color: #E53935;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      font-size: 0.7rem;
    }
    .person-detail {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 1000;
    }
    .person-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 999;
    }
    
    /* Animation fÃ¼r Willkommens-Banner */
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
    
    /* Highlight fÃ¼r Generator-Knoten */
    .generator-highlight {
      animation: pulseHighlight 2s infinite;
    }
    
    @keyframes pulseHighlight {
      0%, 100% { box-shadow: 0 0 10px rgba(198,40,40,0.5); }
      50% { box-shadow: 0 0 25px rgba(198,40,40,0.9); }
    }
  </style>
</head>
<body class="palette-expanded">
  <header>
    <div>
      <h1>DAS WESEN DES LINKEN DENKENS</h1>
      <div class="stats" id="stats"></div>
    </div>
    <div style="display: flex; gap: 0.5rem; align-items: center;">
      <div class="suche-wrapper">
        <input type="text" id="suche-input" placeholder="ğŸ” Suchen..." 
               style="background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); padding: 0.4rem 0.8rem; border-radius: 20px; width: 200px; font-size: 0.85rem;">
        <div class="suche-ergebnisse" id="suche-ergebnisse"></div>
      </div>
      <button class="info-toggle" onclick="document.getElementById('konzept-box').classList.toggle('open')">â„¹ï¸ Was ist das?</button>
    </div>
  </header>
  
  <!-- NEUE LINSEN-PALETTE -->
  <aside class="linsen-palette expanded" id="linsen-palette">
    <button class="palette-toggle" onclick="togglePalette()" title="Palette ein-/ausklappen">â˜°</button>
    
    <!-- Ansichten -->
    <div class="palette-section">
      <span class="palette-section-label">Ansicht</span>
      <div class="linse-wrapper">
        <div class="linse ansicht" data-typ="ansicht" data-id="wesen" onclick="setAnsicht('wesen')" title="Das Wesen">
          ğŸ”´
          <span class="linse-label">Das Wesen</span>
        </div>
      </div>
      <div class="linse-wrapper">
        <div class="linse ansicht" data-typ="ansicht" data-id="wg" onclick="setAnsicht('wg')" title="Haus">
          ğŸ 
          <span class="linse-label">Haus</span>
        </div>
      </div>
      
      <!-- Labor-Gruppe (aufklappbar) -->
      <div class="linse-gruppe" id="gruppe-labor">
        <div class="linse-wrapper">
          <div class="linse gruppe-header" onclick="toggleGruppe('labor')" title="Labor">
            âš—ï¸
            <span class="linse-label">Labor</span>
            <span class="gruppe-pfeil">â–¸</span>
          </div>
        </div>
        <div class="gruppe-inhalt" id="gruppe-labor-inhalt">
          <div class="linse-wrapper sub">
            <div class="linse ansicht sub" data-typ="ansicht" data-id="stammbaum" onclick="setAnsicht('stammbaum')" title="Stammbaum">
              ğŸŒ³
              <span class="linse-label">Stammbaum</span>
            </div>
          </div>
          <div class="linse-wrapper sub">
            <div class="linse ansicht sub" data-typ="ansicht" data-id="oekosystem" onclick="setAnsicht('oekosystem')" title="Ã–kosystem">
              ğŸŒ¿
              <span class="linse-label">Ã–kosystem</span>
            </div>
          </div>
          <div class="linse-wrapper sub">
            <div class="linse ansicht sub" data-typ="ansicht" data-id="netzwerk" onclick="setAnsicht('netzwerk')" title="Netzwerk">
              ğŸ•¸ï¸
              <span class="linse-label">Netzwerk</span>
            </div>
          </div>
          <div class="linse-wrapper sub">
            <div class="linse ansicht sub" data-typ="ansicht" data-id="chemie" onclick="setAnsicht('chemie')" title="Chemie">
              ğŸ§ª
              <span class="linse-label">Chemie</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Archiv-Gruppe (aufklappbar) -->
      <div class="linse-gruppe" id="gruppe-archiv">
        <div class="linse-wrapper">
          <div class="linse gruppe-header" onclick="toggleGruppe('archiv')" title="Archiv">
            ğŸ“š
            <span class="linse-label">Archiv</span>
            <span class="gruppe-pfeil">â–¸</span>
          </div>
        </div>
        <div class="gruppe-inhalt" id="gruppe-archiv-inhalt">
          <div class="linse-wrapper sub">
            <div class="linse ansicht sub" data-typ="ansicht" data-id="liste" onclick="setAnsicht('liste')" title="Liste">
              ğŸ“‹
              <span class="linse-label">Liste</span>
            </div>
          </div>
          <div class="linse-wrapper sub">
            <div class="linse ansicht sub" data-typ="ansicht" data-id="zeitleiste" onclick="setAnsicht('zeitleiste')" title="Zeit">
              â³
              <span class="linse-label">Zeit</span>
            </div>
          </div>
          <div class="linse-wrapper sub">
            <div class="linse ansicht sub" data-typ="ansicht" data-id="karte" onclick="setAnsicht('karte')" title="Karte">
              ğŸ—ºï¸
              <span class="linse-label">Karte</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Filter (auf Mobile versteckt) -->
    <div class="palette-section filter-section">
      <span class="palette-section-label">+ Filter</span>
      <div class="linse-wrapper">
        <div class="linse filter" data-typ="filter" data-id="personen" onclick="toggleFilter('personen')" title="Personen">
          ğŸ‘¤
          <span class="linse-label">Personen</span>
        </div>
      </div>
      <div class="linse-wrapper">
        <div class="linse filter" data-typ="filter" data-id="fieber" onclick="toggleFilter('fieber')" title="Fieber">
          ğŸŒ¡ï¸
          <span class="linse-label">Fieber</span>
        </div>
      </div>
      <div class="linse-wrapper">
        <div class="linse filter" data-typ="filter" data-id="debatten" onclick="toggleFilter('debatten')" title="Konflikte">
          âš”ï¸
          <span class="linse-label">Konflikte</span>
        </div>
      </div>
      <div class="linse-wrapper">
        <div class="linse filter" data-typ="filter" data-id="epoche" onclick="toggleFilter('epoche')" title="Epoche">
          ğŸŒ€
          <span class="linse-label">Epoche</span>
        </div>
      </div>
      
      <!-- Epoche-Slider -->
      <div class="epoche-slider-vertical" id="epoche-slider-vertical">
        <input type="range" min="1840" max="2025" value="2025" id="epoche-range-v" oninput="updateEpocheV(this.value)">
        <span class="epoche-value" id="epoche-value-v">2025</span>
      </div>
    </div>
    
    <!-- Werkzeuge -->
    <div class="palette-section">
      <span class="palette-section-label">Werkzeuge</span>
      <div class="linse-wrapper">
        <div class="linse werkzeug" data-typ="werkzeug" data-id="zufall" onclick="zeigeZufall()" title="Zufall">
          ğŸ²
          <span class="linse-label">Zufall</span>
        </div>
      </div>
      <div class="linse-wrapper">
        <div class="linse werkzeug" data-typ="werkzeug" data-id="profil" onclick="setAnsicht('wg'); setTimeout(() => renderHaus('profil'), 100);" title="Mein Profil">
          ğŸ¯
          <span class="linse-label">Mein Profil</span>
        </div>
      </div>
      <div class="linse-wrapper">
        <div class="linse werkzeug" data-typ="werkzeug" data-id="fragen" onclick="openWerkzeug('fragen')" title="Fragen">
          â“
          <span class="linse-label">Fragen</span>
        </div>
      </div>
      <div class="linse-wrapper">
        <div class="linse werkzeug" data-typ="werkzeug" data-id="speichern" onclick="openShareModal()" title="Speichern">
          ğŸ’¾
          <span class="linse-label">Speichern</span>
        </div>
      </div>
    </div>
    
    <!-- Extras -->
    <div class="palette-extras">
      <button class="extra-btn" onclick="openThemeModal()" title="Ã„sthetik">ğŸ¨</button>
      <button class="extra-btn" onclick="openShareModal()" title="Teilen">ğŸ“¤</button>
      <button class="extra-btn disabled" title="Login (bald verfÃ¼gbar)">ğŸ”</button>
    </div>
  </aside>
  
  <!-- Schwebende Linse -->
  <div class="floating-linse" id="floating-linse">
    <span id="floating-icon">ğŸ•¸ï¸</span>
  </div>
  
  <!-- Hinweis beim Aufnehmen -->
  <div class="linse-hint" id="linse-hint">
    Klicke auf die Ansicht um die Linse anzuwenden â€¢ <kbd>ESC</kbd> zum Abbrechen
  </div>
  
  <!-- Glow-Effekt beim Anwenden -->
  <div class="viewport-glow" id="viewport-glow"></div>
  
  <!-- Aktive Linsen unten -->
  <div class="active-linsen" id="active-linsen"></div>
  
  <!-- Alte Navigation (versteckt, fÃ¼r KompatibilitÃ¤t) -->
  <nav class="linsen-nav" style="display:none !important;"></nav>
  
  <!-- Theme-Modal -->
  <div class="theme-modal" id="theme-modal" onclick="if(event.target === this) closeThemeModal()">
    <div class="theme-modal-content">
      <h2>ğŸ¨ Ã„sthetik wÃ¤hlen</h2>
      <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Wie soll das Wesen erscheinen?</p>
      <div class="theme-grid">
        <div class="theme-option active" data-theme="default" onclick="setTheme('default')">
          <div class="icon">ğŸ›ï¸</div>
          <div class="name">Monument</div>
          <div class="desc">Klassisch, dokumentarisch</div>
        </div>
        <div class="theme-option" data-theme="myzel" onclick="setTheme('myzel')">
          <div class="icon">ğŸŒ¿</div>
          <div class="name">Myzel</div>
          <div class="desc">Organisch, wachsend</div>
        </div>
        <div class="theme-option" data-theme="barrikade" onclick="setTheme('barrikade')">
          <div class="icon">ğŸ”¥</div>
          <div class="name">Barrikade</div>
          <div class="desc">Agitprop, revolutionÃ¤r</div>
        </div>
        <div class="theme-option" data-theme="terminal" onclick="setTheme('terminal')">
          <div class="icon">ğŸ’»</div>
          <div class="name">Terminal</div>
          <div class="desc">Hacker, CLI</div>
        </div>
        <div class="theme-option" data-theme="kosmos" onclick="setTheme('kosmos')">
          <div class="icon">ğŸŒŒ</div>
          <div class="name">Kosmos</div>
          <div class="desc">Kosmisch, unendlich</div>
        </div>
        <div class="theme-option" data-theme="ruine" onclick="setTheme('ruine')">
          <div class="icon">ğŸšï¸</div>
          <div class="name">Ruine</div>
          <div class="desc">Verfallen, archÃ¤ologisch</div>
        </div>
      </div>
      <button onclick="closeThemeModal()" style="margin-top: 1.5rem; padding: 0.5rem 1rem; background: var(--accent); border: none; color: #fff; cursor: pointer; border-radius: var(--radius);">SchlieÃŸen</button>
    </div>
  </div>
  
  <!-- Share-Modal -->
  <div class="theme-modal" id="share-modal" onclick="if(event.target === this) closeShareModal()">
    <div class="theme-modal-content">
      <h2>ğŸ“¤ Teilen</h2>
      <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Teile das Wesen des linken Denkens</p>
      
      <div class="share-section">
        <h3 style="margin-bottom: 0.5rem; font-size: 0.9rem;">ğŸ”— Link kopieren</h3>
        <div style="display: flex; gap: 0.5rem;">
          <input type="text" id="share-url" readonly style="flex: 1; padding: 0.5rem; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); font-family: var(--font-mono); font-size: 0.8rem; border-radius: var(--radius);">
          <button onclick="copyShareUrl()" style="padding: 0.5rem 1rem; background: var(--accent); border: none; color: #fff; cursor: pointer; border-radius: var(--radius);">Kopieren</button>
        </div>
        <p id="copy-feedback" style="color: var(--accent-secondary); font-size: 0.8rem; margin-top: 0.5rem; display: none;">âœ“ Link kopiert!</p>
      </div>
      
      <div class="share-section" style="margin-top: 1.5rem;">
        <h3 style="margin-bottom: 0.5rem; font-size: 0.9rem;">ğŸ“± Social Media</h3>
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
          <button onclick="shareToMastodon()" class="social-btn" style="background: #6364FF;">ğŸ˜ Mastodon</button>
          <button onclick="shareToTelegram()" class="social-btn" style="background: #0088cc;">âœˆï¸ Telegram</button>
          <button onclick="shareToWhatsApp()" class="social-btn" style="background: #25D366;">ğŸ’¬ WhatsApp</button>
          <button onclick="shareToEmail()" class="social-btn" style="background: #666;">ğŸ“§ E-Mail</button>
        </div>
      </div>
      
      <div class="share-section" style="margin-top: 1.5rem;">
        <h3 style="margin-bottom: 0.5rem; font-size: 0.9rem;">ğŸ“¸ Bild erstellen</h3>
        <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Erstelle ein Bild deiner aktuellen Ansicht</p>
        <button onclick="createShareImage()" style="padding: 0.5rem 1rem; background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); cursor: pointer; border-radius: var(--radius);">ğŸ–¼ï¸ Screenshot erstellen</button>
      </div>
      
      <button onclick="closeShareModal()" style="margin-top: 1.5rem; padding: 0.5rem 1rem; background: var(--accent); border: none; color: #fff; cursor: pointer; border-radius: var(--radius);">SchlieÃŸen</button>
    </div>
  </div>
  
  <!-- Aktive Filter-Anzeige -->
  <div class="filter-bar" id="filter-bar">
    <span class="filter-bar-label">Aktive Filter:</span>
    <div class="filter-chips" id="filter-chips"></div>
    <div class="epoche-control" id="epoche-control">
      <input type="range" min="1840" max="2025" value="2025" id="epoche-range" oninput="updateEpoche(this.value)">
      <span id="epoche-wert">bis 2025</span>
    </div>
  </div>
  
  <div id="konzept-box" class="konzept-box">
    <button class="close-btn" onclick="this.parentElement.classList.remove('open')">Ã—</button>
    <h2>Was ist das hier?</h2>
    
    <p><strong>Dies ist kein Lehrwerk.</strong> Es gibt nicht <em>den</em> Sozialismus, so wie es nicht <em>das</em> Leben gibt. Was du hier siehst, ist ein Versuch, die Vielfalt linken Denkens als das darzustellen, was sie ist: ein lebendiges, widersprÃ¼chliches, atmendes Gewebe von Ideen, Strategien und Visionen.</p>
    
    <h3>Warum verschiedene Linsen?</h3>
    <p>Jede Perspektive zeigt etwas anderes â€” und verbirgt etwas anderes:</p>
    <ul>
      <li><strong>ğŸ•¸ï¸ Netzwerk:</strong> Das Wesen als Ganzes, seine Verbindungen und Cluster</li>
      <li><strong>ğŸ—ºï¸ Karte:</strong> Das Terrain, die Achsen, die VollstÃ¤ndigkeit</li>
      <li><strong>â³ Geschichte:</strong> Wie die Ideen in der Zeit entstanden</li>
      <li><strong>âœŠ Praxis:</strong> Wo Ideen Wirklichkeit wurden</li>
      <li><strong>â“ Fragen:</strong> Was noch offen ist, was niemand endgÃ¼ltig beantwortet hat</li>
      <li><strong>ğŸ§­ Mein Ort:</strong> Wo stehst du in diesem Raum?</li>
      <li><strong>ğŸ  WG:</strong> Das Haus als bewohnter Raum mit Zimmern und AtmosphÃ¤ren</li>
      <li><strong>ğŸŒ¿ Ã–kosystem:</strong> Positionen als Arten â€” wer gedeiht, wer verdrÃ¤ngt, wer kooperiert</li>
      <li><strong>âš—ï¸ Labor:</strong> Ideen als chemische Elemente â€” was reagiert, was explodiert</li>
      <li><strong>ğŸŒ€ Epochen:</strong> Dasselbe Haus in verschiedenen historischen Momenten</li>
      <li><strong>ğŸŒ³ Genealogie:</strong> Die Ahnenreihen â€” wer beeinflusste wen</li>
      <li><strong>ğŸ—£ï¸ Dialoge:</strong> ImaginÃ¤re GesprÃ¤che zwischen den Denkern</li>
      <li><strong>ğŸ’¬ Zitate:</strong> Die Stimmen selbst â€” thematisch sortiert</li>
      <li><strong>ğŸ›ï¸ Konfigurator:</strong> Baue deine eigene Position und finde Nachbarn</li>
      <li><strong>ğŸŒ¡ï¸ Fieberkurve:</strong> Was ist gerade heiÃŸ, was kalt?</li>
    </ul>
    <p>Keine dieser Sichten ist "richtig" oder "vollstÃ¤ndig". Zusammen ergeben sie ein Bild, das mehr ist als seine Teile.</p>
    
    <h3>Wissenschaftlicher Sozialismus?</h3>
    <p>Marx wollte den Sozialismus von der Utopie zur Wissenschaft machen. Aber Wissenschaft bedeutet nicht Dogma â€” es bedeutet: <em>Hypothesen, Experimente, Revisionen, Debatten</em>. Dieses Werkzeug bildet genau das ab: offene Fragen statt geschlossene Antworten, Spannungen statt Harmonien, Prozesse statt ZustÃ¤nde.</p>
    
    <h3>Wie benutzen?</h3>
    <p>Wechsle zwischen den Linsen. Ziehe Knoten aufeinander, um ihre Beziehung zu erkunden. Finde deinen eigenen Ort. Folge den Fragen, nicht den Antworten. Dieses Wesen ist nicht fertig â€” es wÃ¤chst mit jedem, der es benutzt.</p>
  </div>
  
  <main>
    <!-- WESEN: Animierter Einstieg -->
    <div id="wesen-container">
      <canvas id="wesen-canvas"></canvas>
    </div>
    
    <div id="netzwerk-container">
      <canvas id="netzwerk3d"></canvas>
      <div class="legende">
        <div class="legende-section">
          <div class="legende-section-titel">ğŸ”µ Kugel-Farben = Themenbereich</div>
          <div class="legende-item"><div class="legende-kugel" style="background: #E53935;"></div> A: Strategie & Subjekt</div>
          <div class="legende-item"><div class="legende-kugel" style="background: #4CAF50;"></div> B: Ã–konomie & Arbeit</div>
          <div class="legende-item"><div class="legende-kugel" style="background: #2196F3;"></div> C: Gesellschaft & Welt</div>
          <div class="legende-item"><div class="legende-kugel" style="background: #9C27B0;"></div> D: Visionen & Utopie</div>
          <div class="legende-item"><div class="legende-kugel" style="background: #FF9800;"></div> E: Praxis & Mittel</div>
        </div>
        
        <div class="legende-section">
          <div class="legende-section-titel">â– Linien = Verbindungen</div>
          <div class="legende-item"><div class="legende-linie gruen"></div> Hohe AffinitÃ¤t</div>
          <div class="legende-item"><div class="legende-linie orange" style="border-style: dashed;"></div> Debatte/Konflikt</div>
          <div class="legende-item"><div class="legende-linie grau"></div> Verbindung</div>
        </div>
        
        <!-- Fieber-Legende (dynamisch) -->
        <div class="legende-filter" id="legende-fieber">
          <div class="legende-filter-titel">ğŸŒ¡ï¸ Fieber = AktualitÃ¤t</div>
          <div class="legende-fieber-gradient">
            <div class="fieber-gradient-bar"></div>
          </div>
          <div class="fieber-labels">
            <span>kalt</span>
            <span>heiÃŸ</span>
          </div>
          <div style="font-size: 0.65rem; color: #888; margin-top: 0.3rem;">
            GrÃ¶ÃŸe = Relevanz in aktuellen Debatten
          </div>
        </div>
        
        <!-- Konflikte-Legende (dynamisch) -->
        <div class="legende-filter" id="legende-konflikte">
          <div class="legende-filter-titel">âš”ï¸ Konflikte</div>
          <div class="legende-item">
            <div class="legende-linie orange" style="border-style: dashed;"></div>
            <span>Historische Debatte</span>
          </div>
          <div class="legende-item">
            <div class="legende-linie orange" style="opacity: 0.5;"></div>
            <span>Spannung/Widerspruch</span>
          </div>
          <div style="font-size: 0.65rem; color: #888; margin-top: 0.3rem;">
            Klick auf Linie fÃ¼r Details
          </div>
        </div>
        
        <div style="margin-top: 0.75rem; padding-top: 0.5rem; border-top: 1px solid #444; font-size: 0.65rem;">
          ğŸ–±ï¸ Drag = Drehen<br>
          Scroll = Zoom
        </div>
      </div>
    </div>
    
    <div id="liste-container">
      <div class="liste-grid" id="liste-grid"></div>
    </div>
    
    <div id="debatten-container"></div>
    
    <div id="karte-container"></div>
    
    <div id="zeitleiste-container"></div>
    
    <!-- Stammbaum: Genealogie der Ideen -->
    <div id="stammbaum-container"></div>
    
    <div id="bibliothek-container"></div>
    
    <div id="praxis-container"></div>
    
    <div id="fragen-container"></div>
    
    <div id="zufall-container"></div>
    
    <div id="kosmos-container"></div>
    
    <!-- WG: Das Haus als bewohnter Raum -->
    <div id="wg-container"></div>
    
    <!-- Ã–kosystem: Positionen als Arten -->
    <div id="oekosystem-container"></div>
    
    <!-- Chemie: Periodensystem der Ideen -->
    <div id="chemie-container"></div>
    
    <!-- Epochen: Zeitschichten -->
    <div id="zeit-container"></div>
    
    <!-- Stammbaum: Genealogie der Ideen -->
    <div id="stammbaum-container"></div>
    
    <!-- Dialoge: ImaginÃ¤re GesprÃ¤che -->
    <div id="dialoge-container"></div>
    
    <!-- Zitate: Thematisch sortiert -->
    <div id="zitate-container"></div>
    
    <!-- Konfigurator: Baue deine Position -->
    <div id="konfigurator-container"></div>
    
    <!-- Fieberkurve: Was ist heiÃŸ? -->
    <div id="fieber-container"></div>
    
    <!-- Personen: Alle Bewohner*innen -->
    <div id="personen-container"></div>
    
    <div id="reaktor-panel">
      <div class="reaktor-header">
        <div class="reaktor-titel">
          <h2 id="reaktor-a"></h2>
          <span class="vs">âŸ·</span>
          <h2 id="reaktor-b"></h2>
        </div>
        <button class="reaktor-close" onclick="closeReaktor()">Ã—</button>
      </div>
      <div class="reaktor-body" id="reaktor-body"></div>
    </div>
    
    <div id="detail-panel">
      <button class="close-btn" onclick="closePanel()">Ã—</button>
      <div id="detail-content"></div>
    </div>
  </main>
  
  <!-- Globale Filter-Info (erscheint bei aktivem Filter in jeder Ansicht) -->
  <div class="filter-info-global" id="filter-info-global">
    <div class="filter-info-item" id="filter-info-fieber" style="display: none;">
      <div class="legende-filter-titel">ğŸŒ¡ï¸ Fieber = AktualitÃ¤t</div>
      <div class="legende-fieber-gradient">
        <div class="fieber-gradient-bar"></div>
      </div>
      <div class="fieber-labels">
        <span>kalt</span>
        <span>heiÃŸ</span>
      </div>
      <div style="font-size: 0.65rem; color: #888; margin-top: 0.3rem;">
        GrÃ¶ÃŸe = Relevanz in aktuellen Debatten
      </div>
    </div>
    
    <div class="filter-info-item" id="filter-info-konflikte" style="display: none;">
      <div class="legende-filter-titel">âš”ï¸ Konflikte</div>
      <div class="legende-item">
        <div class="legende-linie orange" style="border-style: dashed;"></div>
        <span>Historische Debatte</span>
      </div>
      <div style="font-size: 0.65rem; color: #888; margin-top: 0.3rem;">
        Orange = umstrittene Verbindung
      </div>
    </div>
    
    <div class="filter-info-item" id="filter-info-epoche" style="display: none;">
      <div class="legende-filter-titel">ğŸŒ€ Epoche</div>
      <div style="font-size: 0.65rem; color: #888;">
        Nur Positionen bis zum gewÃ¤hlten Jahr
      </div>
    </div>
    
    <div class="filter-info-item" id="filter-info-personen" style="display: none;">
      <div class="legende-filter-titel">ğŸ‘¤ Personen</div>
      <div style="font-size: 0.65rem; color: #888;">
        Zeigt verknÃ¼pfte Denker*innen
      </div>
    </div>
  </div>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
// ERROR HANDLER
window.onerror = function(msg, url, line, col, error) {
  alert('FEHLER in Zeile ' + line + ':\n' + msg);
  console.error('Fehler:', msg, 'Zeile:', line);
  return false;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATEN: KNOTEN (extern geladen)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let knotenData = {};
let knotenDataLoaded = false;

// Globale Zustandsvariablen (frÃ¼h definiert, damit alle Funktionen darauf zugreifen kÃ¶nnen)
let aktiveAnsicht = 'wesen';
let aktiveFilter = new Set();
let epocheWert = 2025;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIE 15 ARCHETYPEN (vom Generator) - GLOBAL definiert fÃ¼r URL-Parameter
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.archetypen = {
  marxismus_leninismus: { 
    name: "Orthodoxer Marxismus-Leninismus", 
    icon: "â˜­", 
    slogan: "Alle Macht den RÃ¤ten!", 
    farbe: "#B71C1C",
    ideal: {A1:4, A2:2, A3:2, B1:5, B2:2, B3:2, C1:2, C2:2, C3:4, D1:2, D2:2, D3:1, E1:2, E2:2, E3:1}
  },
  libertaerer_sozialismus: { 
    name: "LibertÃ¤rer Sozialismus", 
    icon: "â’¶", 
    slogan: "Keine GÃ¶tter, keine Herren!", 
    farbe: "#212121",
    ideal: {A1:4, A2:4, A3:5, B1:3, B2:5, B3:4, C1:4, C2:4, C3:4, D1:3, D2:5, D3:3, E1:5, E2:5, E3:5}
  },
  raetekommunismus: { 
    name: "RÃ¤tekommunismus", 
    icon: "âš™ï¸", 
    slogan: "Die Befreiung ist das Werk der Arbeiter selbst!", 
    farbe: "#C62828",
    ideal: {A1:5, A2:2, A3:5, B1:4, B2:5, B3:3, C1:2, C2:3, C3:5, D1:2, D2:4, D3:1, E1:2, E2:3, E3:5}
  },
  oekosozialismus: { 
    name: "Ã–kosozialismus", 
    icon: "ğŸŒ", 
    slogan: "System Change, Not Climate Change!", 
    farbe: "#2E7D32",
    ideal: {A1:4, A2:4, A3:3, B1:4, B2:4, B3:5, C1:4, C2:5, C3:5, D1:4, D2:3, D3:3, E1:4, E2:5, E3:4}
  },
  feministischer_sozialismus: { 
    name: "Feministischer Sozialismus", 
    icon: "â™€", 
    slogan: "Das Private ist politisch!", 
    farbe: "#7B1FA2",
    ideal: {A1:3, A2:5, A3:3, B1:3, B2:4, B3:5, C1:5, C2:4, C3:4, D1:4, D2:4, D3:3, E1:5, E2:4, E3:5}
  },
  demokratischer_sozialismus: { 
    name: "Demokratischer Sozialismus", 
    icon: "ğŸŒ¹", 
    slogan: "Sozialismus ist radikale Demokratie!", 
    farbe: "#E91E63",
    ideal: {A1:2, A2:3, A3:2, B1:2, B2:3, B3:3, C1:3, C2:3, C3:3, D1:3, D2:2, D3:2, E1:4, E2:2, E3:2}
  },
  postkapitalismus: { 
    name: "Postkapitalistischer Akzelerationismus", 
    icon: "ğŸš€", 
    slogan: "Fully Automated Luxury Communism!", 
    farbe: "#00BCD4",
    ideal: {A1:3, A2:4, A3:3, B1:4, B2:4, B3:5, C1:4, C2:3, C3:5, D1:5, D2:4, D3:3, E1:4, E2:5, E3:4}
  },
  buen_vivir: { 
    name: "Buen Vivir â€“ Das gute Leben", 
    icon: "ğŸŒº", 
    slogan: "Leben in FÃ¼lle, nicht in Ãœberfluss!", 
    farbe: "#FF9800",
    ideal: {A1:3, A2:5, A3:4, B1:3, B2:5, B3:5, C1:5, C2:5, C3:4, D1:5, D2:4, D3:5, E1:5, E2:5, E3:5}
  },
  autonomismus: { 
    name: "Autonomer Marxismus", 
    icon: "ğŸ´", 
    slogan: "Unsere StÃ¤rke ist unsere Vielheit!", 
    farbe: "#424242",
    ideal: {A1:4, A2:5, A3:4, B1:3, B2:5, B3:4, C1:5, C2:4, C3:5, D1:4, D2:5, D3:3, E1:5, E2:5, E3:5}
  },
  municipalismus: { 
    name: "LibertÃ¤rer Munizipalismus", 
    icon: "ğŸ›ï¸", 
    slogan: "Die Stadt gehÃ¶rt allen!", 
    farbe: "#5C6BC0",
    ideal: {A1:3, A2:4, A3:4, B1:3, B2:5, B3:4, C1:4, C2:5, C3:3, D1:4, D2:3, D3:3, E1:4, E2:5, E3:4}
  },
  trotzkismus: { 
    name: "Trotzkismus", 
    icon: "ğŸ”¥", 
    slogan: "Permanente Revolution!", 
    farbe: "#D32F2F",
    ideal: {A1:5, A2:2, A3:2, B1:5, B2:3, B3:2, C1:2, C2:2, C3:5, D1:3, D2:5, D3:1, E1:3, E2:2, E3:2}
  },
  commons_bewegung: { 
    name: "Commons-Bewegung", 
    icon: "ğŸ¤²", 
    slogan: "GemeingÃ¼ter statt Privateigentum!", 
    farbe: "#43A047",
    ideal: {A1:3, A2:4, A3:4, B1:3, B2:5, B3:4, C1:4, C2:5, C3:4, D1:4, D2:3, D3:3, E1:5, E2:5, E3:5}
  },
  eurokommunismus: { 
    name: "Eurokommunismus", 
    icon: "ğŸ‡ªğŸ‡º", 
    slogan: "Sozialismus in Freiheit!", 
    farbe: "#1565C0",
    ideal: {A1:3, A2:3, A3:2, B1:4, B2:3, B3:3, C1:3, C2:3, C3:4, D1:3, D2:2, D3:2, E1:4, E2:3, E3:3}
  },
  reformsozialismus: { 
    name: "Reformsozialismus", 
    icon: "âš–ï¸", 
    slogan: "Schritt fÃ¼r Schritt zur Gerechtigkeit!", 
    farbe: "#E91E63",
    ideal: {A1:1, A2:3, A3:1, B1:2, B2:2, B3:2, C1:3, C2:3, C3:2, D1:2, D2:1, D3:2, E1:4, E2:1, E3:2}
  },
  linksnationalismus: { 
    name: "Linker Nationalismus", 
    icon: "ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿", 
    slogan: "SouverÃ¤nitÃ¤t der VÃ¶lker!", 
    farbe: "#D84315",
    ideal: {A1:4, A2:2, A3:5, B1:3, B2:5, B3:3, C1:2, C2:3, C3:4, D1:3, D2:4, D3:1, E1:3, E2:5, E3:4}
  },
  eigenstaendig: { 
    name: "EigenstÃ¤ndiger Sozialismus", 
    icon: "ğŸ”¥", 
    slogan: "Eine andere Welt ist mÃ¶glich!", 
    farbe: "#FF5722",
    ideal: {A1:3, A2:3, A3:3, B1:3, B2:3, B3:3, C1:3, C2:3, C3:3, D1:3, D2:3, D3:3, E1:3, E2:3, E3:3}
  }
};

// Lade Knoten-Daten aus externer JSON
fetch('knoten_content.json')
  .then(response => {
    if (!response.ok) throw new Error('Konnte knoten_content.json nicht laden');
    return response.json();
  })
  .then(data => {
    knotenData = data;
    knotenDataLoaded = true;
    console.log(`âœ“ ${Object.keys(knotenData).length} Knoten geladen`);
    // Stats aktualisieren
    document.getElementById('stats').textContent = `${Object.keys(knotenData).length} Positionen Â· ${verbindungenData.length} Verbindungen Â· 21 Linsen`;
    // URL-Parameter ZUERST verarbeiten (setzt generatorProfil etc.)
    if (typeof parseUrlParams === 'function') {
      try { parseUrlParams(); } catch(e) { console.error('Fehler in parseUrlParams:', e); }
    }
    // DANN alle Initialisierungen
    const initFuncs = [
      'initNetzwerk', 'initListe', 'initDebatten', 'initStammbaum', 'initSuche',
      'initKarte', 'initZeitleiste', 'initChemie', 'initOekosystem', 'initFragen',
      'initBibliothek', 'initPraxis', 'initKosmos', 'initWG', 'initEpochen',
      'initDialoge', 'initZitate', 'initKonfigurator', 'initFieber', 'initWesen'
    ];
    initFuncs.forEach(fn => {
      if (typeof window[fn] === 'function') {
        try { window[fn](); } catch(e) { console.error(`Fehler in ${fn}:`, e); }
      }
    });
    // Personen separat laden
    if (typeof loadPersonenData === 'function') {
      loadPersonenData().then(() => {
        if (typeof initPersonen === 'function') initPersonen();
      });
    }
  })
  .catch(err => {
    console.error('Fehler beim Laden der Knoten-Daten:', err);
    document.getElementById('stats').textContent = 'âš ï¸ Daten konnten nicht geladen werden';
  });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STAMMBAUM: Genealogie der Ideen
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const stammbaumData = {
  epochen: [
    { id: "aufklaerung", name: "AufklÃ¤rung", zeit: "1750-1800", farbe: "#FFE082", y: 0,
      beschreibung: "Die Wurzeln: Vernunft, Fortschritt, Gleichheit" },
    { id: "fruehsozialismus", name: "Utopischer Sozialismus", zeit: "1800-1848", farbe: "#A5D6A7", y: 1,
      beschreibung: "Die TrÃ¤umer: Saint-Simon, Fourier, Owen" },
    { id: "klassiker", name: "Wissenschaftlicher Sozialismus", zeit: "1848-1890", farbe: "#E53935", y: 2,
      beschreibung: "Marx und Engels systematisieren die Kritik" },
    { id: "zweite_int", name: "Zweite Internationale", zeit: "1889-1914", farbe: "#EF5350", y: 3,
      beschreibung: "Massenparteien und der groÃŸe Streit" },
    { id: "revolution", name: "Revolutionszeit", zeit: "1917-1945", farbe: "#D32F2F", y: 4,
      beschreibung: "Revolutionen, Faschismus, Weltkriege" },
    { id: "nachkrieg", name: "Nachkriegslinke", zeit: "1945-1989", farbe: "#7986CB", y: 5,
      beschreibung: "Kalter Krieg, 68er, Befreiungsbewegungen" },
    { id: "gegenwart", name: "Gegenwart", zeit: "1989-heute", farbe: "#4FC3F7", y: 6,
      beschreibung: "Nach dem Fall der Mauer: Klimakrise, PrekaritÃ¤t" }
  ],
  
  stroemungen: [
    // AufklÃ¤rung
    { id: "rousseau", name: "Rousseau", epoche: "aufklaerung", x: -0.5, 
      kernidee: "Der Mensch ist gut, die Gesellschaft verdirbt ihn",
      leben: "1712-1778", werke: ["Gesellschaftsvertrag", "Ã‰mile"] },
    { id: "kant", name: "Kant", epoche: "aufklaerung", x: 0.5,
      kernidee: "AufklÃ¤rung ist der Ausgang aus selbstverschuldeter UnmÃ¼ndigkeit",
      leben: "1724-1804", werke: ["Kritik der reinen Vernunft"] },
    { id: "smith", name: "Adam Smith", epoche: "aufklaerung", x: 1.5,
      kernidee: "Arbeitswerttheorie, unsichtbare Hand",
      leben: "1723-1790", werke: ["Wealth of Nations"] },
    { id: "hegel", name: "Hegel", epoche: "aufklaerung", x: 0, wichtig: true,
      kernidee: "Dialektik: These, Antithese, Synthese",
      leben: "1770-1831", werke: ["PhÃ¤nomenologie des Geistes"] },
    { id: "paine", name: "Thomas Paine", epoche: "aufklaerung", x: -1,
      kernidee: "Menschenrechte, VolkssouverÃ¤nitÃ¤t",
      leben: "1737-1809", werke: ["Rights of Man"] },
    
    // FrÃ¼hsozialismus  
    { id: "saint-simon", name: "Saint-Simon", epoche: "fruehsozialismus", x: -1,
      kernidee: "Die Industrie soll von Produzenten gelenkt werden",
      leben: "1760-1825", werke: ["Nouveau Christianisme"] },
    { id: "fourier", name: "Fourier", epoche: "fruehsozialismus", x: 0,
      kernidee: "PhalanstÃ¨res: Leidenschaft statt Zwang",
      leben: "1772-1837", werke: ["Theorie der vier Bewegungen"] },
    { id: "owen", name: "Robert Owen", epoche: "fruehsozialismus", x: 0.8,
      kernidee: "New Harmony: Modellkommunen beweisen MÃ¶glichkeit",
      leben: "1771-1858", werke: ["A New View of Society"] },
    { id: "proudhon", name: "Proudhon", epoche: "fruehsozialismus", x: 2, wichtig: true,
      kernidee: "Eigentum ist Diebstahl, Mutualism",
      leben: "1809-1865", werke: ["Was ist Eigentum?"] },
    { id: "blanqui", name: "Blanqui", epoche: "fruehsozialismus", x: 1.5,
      kernidee: "RevolutionÃ¤rer Putschismus, Diktatur der Minderheit",
      leben: "1805-1881", werke: ["Instruktion fÃ¼r den Aufstand"] },
    { id: "weitling", name: "Weitling", epoche: "fruehsozialismus", x: -0.5,
      kernidee: "Handwerker-Kommunismus, christlicher Sozialismus",
      leben: "1808-1871", werke: ["Garantien der Harmonie"] },
      
    // Klassiker
    { id: "marx", name: "Karl Marx", epoche: "klassiker", x: 0, wichtig: true,
      kernidee: "Historischer Materialismus, Mehrwert, Klassenkampf",
      leben: "1818-1883", werke: ["Das Kapital", "Kommunistisches Manifest", "Grundrisse"] },
    { id: "engels", name: "Friedrich Engels", epoche: "klassiker", x: 0.4,
      kernidee: "Dialektik der Natur, Ursprung der Familie",
      leben: "1820-1895", werke: ["Anti-DÃ¼hring", "Ursprung der Familie"] },
    { id: "bakunin", name: "Michail Bakunin", epoche: "klassiker", x: 2, wichtig: true,
      kernidee: "Alle Staaten sind UnterdrÃ¼cker, Freiheit durch ZerstÃ¶rung",
      leben: "1814-1876", werke: ["Gott und der Staat", "Staatlichkeit und Anarchie"] },
    { id: "kropotkin", name: "Kropotkin", epoche: "klassiker", x: 2.4,
      kernidee: "Gegenseitige Hilfe als Evolutionsprinzip",
      leben: "1842-1921", werke: ["Gegenseitige Hilfe", "Die Eroberung des Brotes"] },
    { id: "lassalle", name: "Lassalle", epoche: "klassiker", x: -1,
      kernidee: "Allgemeiner Deutscher Arbeiterverein, Staatssozialismus",
      leben: "1825-1864", werke: ["Arbeiterprogramm"] },
    { id: "dietzgen", name: "Dietzgen", epoche: "klassiker", x: 0.2,
      kernidee: "Proletarische Philosophie",
      leben: "1828-1888", werke: ["Das Wesen der menschlichen Kopfarbeit"] },
      
    // Zweite Internationale
    { id: "kautsky", name: "Kautsky", epoche: "zweite_int", x: -1,
      kernidee: "Orthodoxer Marxismus, Erfurt-Programm",
      leben: "1854-1938", werke: ["Die Agrarfrage", "Der Weg zur Macht"] },
    { id: "bernstein", name: "Bernstein", epoche: "zweite_int", x: -2,
      kernidee: "Revisionismus: Evolution statt Revolution",
      leben: "1850-1932", werke: ["Die Voraussetzungen des Sozialismus"] },
    { id: "luxemburg", name: "Rosa Luxemburg", epoche: "zweite_int", x: 0.5, wichtig: true,
      kernidee: "Massenstreik, SpontaneitÃ¤t, Freiheit der Andersdenkenden",
      leben: "1871-1919", werke: ["Akkumulation des Kapitals", "Sozialreform oder Revolution"] },
    { id: "bebel", name: "August Bebel", epoche: "zweite_int", x: -1.5,
      kernidee: "Die Frau und der Sozialismus",
      leben: "1840-1913", werke: ["Die Frau und der Sozialismus"] },
    { id: "zetkin", name: "Clara Zetkin", epoche: "zweite_int", x: -0.5,
      kernidee: "Proletarischer Feminismus, Internationaler Frauentag",
      leben: "1857-1933", werke: ["Die Arbeiterinnen- und Frauenfrage"] },
    { id: "jaures", name: "Jean JaurÃ¨s", epoche: "zweite_int", x: -1.8,
      kernidee: "Sozialistischer Humanismus, Pazifismus",
      leben: "1859-1914", werke: ["Histoire socialiste"] },
    { id: "sorel", name: "Georges Sorel", epoche: "zweite_int", x: 1.5,
      kernidee: "Mythos des Generalstreiks, revolutionÃ¤re Gewalt",
      leben: "1847-1922", werke: ["Ãœber die Gewalt"] },
    { id: "plechanow", name: "Plechanow", epoche: "zweite_int", x: -0.8,
      kernidee: "Vater des russischen Marxismus",
      leben: "1856-1918", werke: ["Die Entwicklung der monistischen Geschichtsauffassung"] },
    { id: "liebknecht_w", name: "W. Liebknecht", epoche: "zweite_int", x: -1.3,
      kernidee: "MitgrÃ¼nder SPD, Kriegsgegner",
      leben: "1826-1900", werke: [] },
    { id: "mehring", name: "Franz Mehring", epoche: "zweite_int", x: -0.3,
      kernidee: "Marxistischer Historiker und Kritiker",
      leben: "1846-1919", werke: ["Karl Marx. Geschichte seines Lebens"] },
    { id: "malatesta", name: "Errico Malatesta", epoche: "zweite_int", x: 2.2,
      kernidee: "Anarchistischer Kommunismus, Gradualismus",
      leben: "1853-1932", werke: ["L'Anarchia"] },
      
    // Revolutionszeit
    { id: "lenin", name: "Lenin", epoche: "revolution", x: -0.5, wichtig: true,
      kernidee: "Avantgarde-Partei, Imperialismus, Staat und Revolution",
      leben: "1870-1924", werke: ["Was tun?", "Staat und Revolution", "Imperialismus"] },
    { id: "trotzki", name: "Leo Trotzki", epoche: "revolution", x: 0,
      kernidee: "Permanente Revolution, Kritik der BÃ¼rokratie",
      leben: "1879-1940", werke: ["Die permanente Revolution", "Verratene Revolution"] },
    { id: "stalin", name: "Stalin", epoche: "revolution", x: -1.5,
      kernidee: "Sozialismus in einem Land, Planwirtschaft",
      leben: "1878-1953", werke: ["Ãœber dialektischen und historischen Materialismus"] },
    { id: "gramsci", name: "Antonio Gramsci", epoche: "revolution", x: 0.5, wichtig: true,
      kernidee: "Hegemonie, organische Intellektuelle, Stellungskrieg",
      leben: "1891-1937", werke: ["GefÃ¤ngnishefte"] },
    { id: "lukacs", name: "Georg LukÃ¡cs", epoche: "revolution", x: 0.3,
      kernidee: "Verdinglichung, TotalitÃ¤t, Geschichte und Klassenbewusstsein",
      leben: "1885-1971", werke: ["Geschichte und Klassenbewusstsein"] },
    { id: "korsch", name: "Karl Korsch", epoche: "revolution", x: 0.7,
      kernidee: "Marxismus und Philosophie, RÃ¤tekommunismus",
      leben: "1886-1961", werke: ["Marxismus und Philosophie"] },
    { id: "mao", name: "Mao Zedong", epoche: "revolution", x: -1,
      kernidee: "Bauernrevolution, Widerspruchslehre, Kulturrevolution",
      leben: "1893-1976", werke: ["Ãœber den Widerspruch", "Ãœber die Praxis"] },
    { id: "goldman", name: "Emma Goldman", epoche: "revolution", x: 2, wichtig: true,
      kernidee: "Anarcha-Feminismus, freie Liebe, direkte Aktion",
      leben: "1869-1940", werke: ["Anarchism and Other Essays", "Living My Life"] },
    { id: "cnt", name: "CNT-FAI", epoche: "revolution", x: 2.5,
      kernidee: "Anarchosyndikalismus, Spanische Revolution",
      leben: "1910-1939", werke: [] },
    { id: "liebknecht_k", name: "Karl Liebknecht", epoche: "revolution", x: 0.2,
      kernidee: "Spartakusbund, Der Hauptfeind steht im eigenen Land",
      leben: "1871-1919", werke: ["Militarismus und Antimilitarismus"] },
    { id: "pannekoek", name: "Anton Pannekoek", epoche: "revolution", x: 0.8,
      kernidee: "RÃ¤tekommunismus, ArbeiterrÃ¤te",
      leben: "1873-1960", werke: ["ArbeiterrÃ¤te"] },
    { id: "bloch", name: "Ernst Bloch", epoche: "revolution", x: 0.4, wichtig: true,
      kernidee: "Prinzip Hoffnung, konkrete Utopie",
      leben: "1885-1977", werke: ["Das Prinzip Hoffnung", "Geist der Utopie"] },
    { id: "benjamin", name: "Walter Benjamin", epoche: "revolution", x: 0.6, wichtig: true,
      kernidee: "Geschichtsphilosophie, Aura, dialektisches Bild",
      leben: "1892-1940", werke: ["Ãœber den Begriff der Geschichte", "Das Kunstwerk..."] },
    { id: "kollontai", name: "Alexandra Kollontai", epoche: "revolution", x: -0.3,
      kernidee: "Kommunistischer Feminismus, freie Liebe",
      leben: "1872-1952", werke: ["Die neue Moral und die Arbeiterklasse"] },
    { id: "mariategui", name: "MariÃ¡tegui", epoche: "revolution", x: -0.8,
      kernidee: "Indigener Marxismus, Lateinamerikanischer Sozialismus",
      leben: "1894-1930", werke: ["Sieben Essays zur Interpretation der peruanischen Wirklichkeit"] },
    { id: "ho", name: "Ho Chi Minh", epoche: "revolution", x: -1.2,
      kernidee: "Antikolonialer Kommunismus",
      leben: "1890-1969", werke: ["Der Weg der Revolution"] },
    { id: "cabral", name: "AmÃ­lcar Cabral", epoche: "revolution", x: 1.3,
      kernidee: "Nationale Befreiung, Kultur als Widerstand",
      leben: "1924-1973", werke: ["Die Waffe der Theorie"] },
      
    // Nachkrieg
    { id: "adorno", name: "Theodor W. Adorno", epoche: "nachkrieg", x: 0, wichtig: true,
      kernidee: "Dialektik der AufklÃ¤rung, Kulturindustrie, Negative Dialektik",
      leben: "1903-1969", werke: ["Negative Dialektik", "Dialektik der AufklÃ¤rung"] },
    { id: "horkheimer", name: "Max Horkheimer", epoche: "nachkrieg", x: -0.3,
      kernidee: "Kritische Theorie, Instrumentelle Vernunft",
      leben: "1895-1973", werke: ["Kritik der instrumentellen Vernunft"] },
    { id: "marcuse", name: "Herbert Marcuse", epoche: "nachkrieg", x: 0.5, wichtig: true,
      kernidee: "Der eindimensionale Mensch, GroÃŸe Verweigerung, Eros",
      leben: "1898-1979", werke: ["Der eindimensionale Mensch", "Triebstruktur und Gesellschaft"] },
    { id: "beauvoir", name: "Simone de Beauvoir", epoche: "nachkrieg", x: 1, wichtig: true,
      kernidee: "Man wird nicht als Frau geboren, sondern dazu gemacht",
      leben: "1908-1986", werke: ["Das andere Geschlecht"] },
    { id: "fanon", name: "Frantz Fanon", epoche: "nachkrieg", x: 1.5, wichtig: true,
      kernidee: "Die Verdammten dieser Erde, Entkolonialisierung durch Gewalt",
      leben: "1925-1961", werke: ["Die Verdammten dieser Erde", "Schwarze Haut, weiÃŸe Masken"] },
    { id: "che", name: "Che Guevara", epoche: "nachkrieg", x: -1,
      kernidee: "Fokismus, der Neue Mensch, internationalistischer Kampf",
      leben: "1928-1967", werke: ["Guerillakrieg", "Der neue Mensch"] },
    { id: "althusser", name: "Louis Althusser", epoche: "nachkrieg", x: -0.5,
      kernidee: "Ideologische Staatsapparate, epistemologischer Bruch",
      leben: "1918-1990", werke: ["FÃ¼r Marx", "Ideologie und ideologische Staatsapparate"] },
    { id: "poulantzas", name: "Nicos Poulantzas", epoche: "nachkrieg", x: -0.7,
      kernidee: "Relationale Staatstheorie, strukturaler Marxismus",
      leben: "1936-1979", werke: ["Staatstheorie"] },
    { id: "bookchin", name: "Murray Bookchin", epoche: "nachkrieg", x: 2, wichtig: true,
      kernidee: "Soziale Ã–kologie, libertÃ¤rer Kommunalismus",
      leben: "1921-2006", werke: ["Die Ã–kologie der Freiheit"] },
    { id: "davis", name: "Angela Davis", epoche: "nachkrieg", x: 1.2, wichtig: true,
      kernidee: "GefÃ¤ngnis-industrieller Komplex, IntersektionalitÃ¤t",
      leben: "1944-", werke: ["Are Prisons Obsolete?", "Women, Race & Class"] },
    { id: "james_clr", name: "C.L.R. James", epoche: "nachkrieg", x: 0.8,
      kernidee: "Schwarzer Marxismus, Die schwarzen Jakobiner",
      leben: "1901-1989", werke: ["Die schwarzen Jakobiner"] },
    { id: "fromm", name: "Erich Fromm", epoche: "nachkrieg", x: 0.3,
      kernidee: "Humanistischer Marxismus, Haben oder Sein",
      leben: "1900-1980", werke: ["Haben oder Sein", "Die Furcht vor der Freiheit"] },
    { id: "sartre", name: "Jean-Paul Sartre", epoche: "nachkrieg", x: 0.6,
      kernidee: "Existentialistischer Marxismus",
      leben: "1905-1980", werke: ["Kritik der dialektischen Vernunft"] },
    { id: "mandel", name: "Ernest Mandel", epoche: "nachkrieg", x: -0.8,
      kernidee: "SpÃ¤tkapitalismus, lange Wellen",
      leben: "1923-1995", werke: ["Der SpÃ¤tkapitalismus"] },
    { id: "debord", name: "Guy Debord", epoche: "nachkrieg", x: 1.8,
      kernidee: "Die Gesellschaft des Spektakels, Situationismus",
      leben: "1931-1994", werke: ["Die Gesellschaft des Spektakels"] },
    { id: "gorz", name: "AndrÃ© Gorz", epoche: "nachkrieg", x: 1.3,
      kernidee: "Ã–kosozialismus, Kritik der Arbeit",
      leben: "1923-2007", werke: ["Kritik der Ã¶konomischen Vernunft"] },
    { id: "illich", name: "Ivan Illich", epoche: "nachkrieg", x: 1.6,
      kernidee: "Entschulung, KonvivialitÃ¤t, Werkzeugkritik",
      leben: "1926-2002", werke: ["Entschulung der Gesellschaft"] },
    { id: "freire", name: "Paulo Freire", epoche: "nachkrieg", x: 1.4,
      kernidee: "PÃ¤dagogik der UnterdrÃ¼ckten, dialogische Bildung",
      leben: "1921-1997", werke: ["PÃ¤dagogik der UnterdrÃ¼ckten"] },
    { id: "nkrumah", name: "Kwame Nkrumah", epoche: "nachkrieg", x: -1.2,
      kernidee: "Panafrikanismus, Neokolonialismus",
      leben: "1909-1972", werke: ["Neokolonialismus"] },
    { id: "sankara", name: "Thomas Sankara", epoche: "nachkrieg", x: -1.4,
      kernidee: "Afrikanischer Sozialismus, Anti-Imperialismus",
      leben: "1949-1987", werke: ["Women's Liberation and the African Freedom Struggle"] },
    { id: "hooks", name: "bell hooks", epoche: "nachkrieg", x: 1.1,
      kernidee: "Intersektionaler Feminismus, Liebe als politische Praxis",
      leben: "1952-2021", werke: ["Ain't I a Woman", "All About Love"] },
      
    // Gegenwart
    { id: "zizek", name: "Slavoj Å½iÅ¾ek", epoche: "gegenwart", x: 0,
      kernidee: "Lacan + Marx, Ideologiekritik durch PopulÃ¤rkultur",
      leben: "1949-", werke: ["Das fragile Absolute", "Parallaxe"] },
    { id: "badiou", name: "Alain Badiou", epoche: "gegenwart", x: -0.5,
      kernidee: "Kommunistische Hypothese, Ereignis, Treue",
      leben: "1937-", werke: ["Das Sein und das Ereignis", "Die kommunistische Hypothese"] },
    { id: "harvey", name: "David Harvey", epoche: "gegenwart", x: 0.3, wichtig: true,
      kernidee: "RÃ¤umliche Dimension des Kapitalismus, Akkumulation durch Enteignung",
      leben: "1935-", werke: ["Die Grenzen des Kapitalismus", "Marx' Kapital lesen"] },
    { id: "fraser", name: "Nancy Fraser", epoche: "gegenwart", x: 0.8, wichtig: true,
      kernidee: "Anerkennung und Umverteilung, Kapitalismus kannibalisiert Lebensgrundlagen",
      leben: "1947-", werke: ["Der Allesfresser"] },
    { id: "fisher", name: "Mark Fisher", epoche: "gegenwart", x: 0.5,
      kernidee: "Kapitalistischer Realismus, Hauntology, langsame Abschaffung der Zukunft",
      leben: "1968-2017", werke: ["Kapitalistischer Realismus", "Ghosts of My Life"] },
    { id: "graeber", name: "David Graeber", epoche: "gegenwart", x: 2, wichtig: true,
      kernidee: "Bullshit Jobs, Schulden, Basisdemokratie, Anarchist Anthropology",
      leben: "1961-2020", werke: ["Schulden", "Bullshit Jobs", "AnfÃ¤nge"] },
    { id: "federici", name: "Silvia Federici", epoche: "gegenwart", x: 1.5, wichtig: true,
      kernidee: "Hexenverbrennung und primitive Akkumulation, Care-Arbeit",
      leben: "1942-", werke: ["Caliban und die Hexe", "Revolution at Point Zero"] },
    { id: "saito", name: "Kohei Saito", epoche: "gegenwart", x: 0.2,
      kernidee: "Marx im AnthropozÃ¤n, Degrowth-Kommunismus",
      leben: "1987-", werke: ["Systemsturz", "Marx in the Anthropocene"] },
    { id: "ocalan", name: "Abdullah Ã–calan", epoche: "gegenwart", x: 2.3, wichtig: true,
      kernidee: "Demokratischer KonfÃ¶deralismus, JineolojÃ®, Rojava-Modell",
      leben: "1949-", werke: ["Demokratischer KonfÃ¶deralismus"] },
    { id: "mouffe", name: "Chantal Mouffe", epoche: "gegenwart", x: -0.3,
      kernidee: "Agonistischer Pluralismus, Linkspopulismus",
      leben: "1943-", werke: ["FÃ¼r einen linken Populismus"] },
    { id: "laclau", name: "Ernesto Laclau", epoche: "gegenwart", x: -0.4,
      kernidee: "Hegemonie und radikale Demokratie, Populismus",
      leben: "1935-2014", werke: ["Hegemonie und radikale Demokratie"] },
    { id: "butler", name: "Judith Butler", epoche: "gegenwart", x: 1.2, wichtig: true,
      kernidee: "PerformativitÃ¤t des Geschlechts, Queere Theorie",
      leben: "1956-", werke: ["Das Unbehagen der Geschlechter", "KÃ¶rper von Gewicht"] },
    { id: "spivak", name: "Gayatri Spivak", epoche: "gegenwart", x: 1.4,
      kernidee: "SubalternitÃ¤t, Can the Subaltern Speak?",
      leben: "1942-", werke: ["Can the Subaltern Speak?"] },
    { id: "jameson", name: "Fredric Jameson", epoche: "gegenwart", x: 0.4,
      kernidee: "Postmodernismus als Kulturlogik des SpÃ¤tkapitalismus",
      leben: "1934-", werke: ["Postmodernism"] },
    { id: "streeck", name: "Wolfgang Streeck", epoche: "gegenwart", x: -0.2,
      kernidee: "Gekaufte Zeit, Ende des demokratischen Kapitalismus",
      leben: "1946-", werke: ["Gekaufte Zeit"] },
    { id: "piketty", name: "Thomas Piketty", epoche: "gegenwart", x: -0.8,
      kernidee: "Kapitaldynamik, r > g, Ungleichheit",
      leben: "1971-", werke: ["Das Kapital im 21. Jahrhundert"] },
    { id: "varoufakis", name: "Yanis Varoufakis", epoche: "gegenwart", x: -0.6,
      kernidee: "Progressiver Internationalismus, DiEM25",
      leben: "1961-", werke: ["Die ganze Geschichte"] },
    { id: "dean", name: "Jodi Dean", epoche: "gegenwart", x: -0.4,
      kernidee: "Kommunismus als Horizont, Partei neu denken",
      leben: "1962-", werke: ["The Communist Horizon"] },
    { id: "srnicek", name: "Nick Srnicek", epoche: "gegenwart", x: 0.7,
      kernidee: "Plattform-Kapitalismus, Left Accelerationism",
      leben: "1982-", werke: ["Platform Capitalism", "Inventing the Future"] },
    { id: "bastani", name: "Aaron Bastani", epoche: "gegenwart", x: 0.9,
      kernidee: "Fully Automated Luxury Communism",
      leben: "1983-", werke: ["Fully Automated Luxury Communism"] },
    { id: "malm", name: "Andreas Malm", epoche: "gegenwart", x: 1.0,
      kernidee: "Fossiles Kapital, Klimaaktivismus",
      leben: "1977-", werke: ["Fossil Capital", "How to Blow Up a Pipeline"] },
    { id: "brown", name: "Wendy Brown", epoche: "gegenwart", x: 0.6,
      kernidee: "Neoliberalismus als Entdemokratisierung",
      leben: "1955-", werke: ["Die schleichende Revolution"] }
  ],
  
  verbindungen: [
    // AufklÃ¤rung intern
    { von: "kant", zu: "hegel", typ: "einfluss" },
    { von: "rousseau", zu: "hegel", typ: "einfluss" },
    
    // AufklÃ¤rung â†’ FrÃ¼hsozialismus
    { von: "rousseau", zu: "saint-simon", typ: "einfluss" },
    { von: "rousseau", zu: "proudhon", typ: "einfluss" },
    { von: "smith", zu: "marx", typ: "einfluss" },
    { von: "hegel", zu: "marx", typ: "einfluss" },
    { von: "hegel", zu: "bakunin", typ: "einfluss" },
    
    // FrÃ¼hsozialismus intern
    { von: "saint-simon", zu: "fourier", typ: "einfluss" },
    { von: "blanqui", zu: "marx", typ: "einfluss" },
    
    // FrÃ¼hsozialismus â†’ Klassiker
    { von: "saint-simon", zu: "marx", typ: "einfluss" },
    { von: "fourier", zu: "marx", typ: "einfluss" },
    { von: "proudhon", zu: "marx", typ: "konflikt" },
    { von: "proudhon", zu: "bakunin", typ: "einfluss" },
    { von: "weitling", zu: "marx", typ: "einfluss" },
    
    // Klassiker intern
    { von: "marx", zu: "engels", typ: "einfluss" },
    { von: "marx", zu: "bakunin", typ: "konflikt" },
    { von: "bakunin", zu: "kropotkin", typ: "einfluss" },
    { von: "marx", zu: "lassalle", typ: "konflikt" },
    
    // Klassiker â†’ Zweite Internationale
    { von: "marx", zu: "kautsky", typ: "einfluss" },
    { von: "marx", zu: "bernstein", typ: "einfluss" },
    { von: "marx", zu: "luxemburg", typ: "einfluss" },
    { von: "marx", zu: "bebel", typ: "einfluss" },
    { von: "marx", zu: "plechanow", typ: "einfluss" },
    { von: "marx", zu: "mehring", typ: "einfluss" },
    { von: "engels", zu: "kautsky", typ: "einfluss" },
    { von: "engels", zu: "bebel", typ: "einfluss" },
    { von: "kautsky", zu: "bernstein", typ: "konflikt" },
    { von: "luxemburg", zu: "bernstein", typ: "konflikt" },
    { von: "luxemburg", zu: "kautsky", typ: "konflikt" },
    { von: "kropotkin", zu: "sorel", typ: "einfluss" },
    { von: "kropotkin", zu: "malatesta", typ: "einfluss" },
    { von: "bakunin", zu: "malatesta", typ: "einfluss" },
    
    // Zweite Internationale â†’ Revolution
    { von: "luxemburg", zu: "lenin", typ: "konflikt" },
    { von: "luxemburg", zu: "gramsci", typ: "einfluss" },
    { von: "luxemburg", zu: "liebknecht_k", typ: "einfluss" },
    { von: "kautsky", zu: "lenin", typ: "konflikt" },
    { von: "plechanow", zu: "lenin", typ: "einfluss" },
    { von: "lenin", zu: "trotzki", typ: "einfluss" },
    { von: "lenin", zu: "stalin", typ: "einfluss" },
    { von: "trotzki", zu: "stalin", typ: "konflikt" },
    { von: "lenin", zu: "mao", typ: "einfluss" },
    { von: "lenin", zu: "ho", typ: "einfluss" },
    { von: "marx", zu: "lukacs", typ: "einfluss" },
    { von: "hegel", zu: "lukacs", typ: "einfluss" },
    { von: "lukacs", zu: "gramsci", typ: "einfluss" },
    { von: "lukacs", zu: "korsch", typ: "einfluss" },
    { von: "goldman", zu: "cnt", typ: "einfluss" },
    { von: "bakunin", zu: "cnt", typ: "einfluss" },
    { von: "luxemburg", zu: "pannekoek", typ: "einfluss" },
    { von: "korsch", zu: "pannekoek", typ: "einfluss" },
    { von: "zetkin", zu: "kollontai", typ: "einfluss" },
    { von: "marx", zu: "bloch", typ: "einfluss" },
    { von: "lukacs", zu: "benjamin", typ: "einfluss" },
    { von: "bloch", zu: "benjamin", typ: "einfluss" },
    { von: "marx", zu: "mariategui", typ: "einfluss" },
    { von: "fanon", zu: "cabral", typ: "einfluss" },
    
    // Revolution â†’ Nachkrieg
    { von: "lukacs", zu: "adorno", typ: "einfluss" },
    { von: "lukacs", zu: "horkheimer", typ: "einfluss" },
    { von: "benjamin", zu: "adorno", typ: "einfluss" },
    { von: "gramsci", zu: "althusser", typ: "einfluss" },
    { von: "marx", zu: "althusser", typ: "einfluss" },
    { von: "adorno", zu: "marcuse", typ: "einfluss" },
    { von: "horkheimer", zu: "marcuse", typ: "einfluss" },
    { von: "fanon", zu: "davis", typ: "einfluss" },
    { von: "che", zu: "fanon", typ: "einfluss" },
    { von: "mao", zu: "che", typ: "einfluss" },
    { von: "althusser", zu: "poulantzas", typ: "einfluss" },
    { von: "kropotkin", zu: "bookchin", typ: "einfluss" },
    { von: "marx", zu: "fromm", typ: "einfluss" },
    { von: "beauvoir", zu: "davis", typ: "einfluss" },
    { von: "beauvoir", zu: "hooks", typ: "einfluss" },
    { von: "sartre", zu: "fanon", typ: "einfluss" },
    { von: "lukacs", zu: "debord", typ: "einfluss" },
    { von: "marcuse", zu: "debord", typ: "einfluss" },
    { von: "james_clr", zu: "davis", typ: "einfluss" },
    { von: "freire", zu: "hooks", typ: "einfluss" },
    { von: "fanon", zu: "nkrumah", typ: "einfluss" },
    { von: "nkrumah", zu: "sankara", typ: "einfluss" },
    { von: "gorz", zu: "illich", typ: "einfluss" },
    { von: "marcuse", zu: "gorz", typ: "einfluss" },
    
    // Nachkrieg â†’ Gegenwart
    { von: "althusser", zu: "badiou", typ: "einfluss" },
    { von: "althusser", zu: "zizek", typ: "einfluss" },
    { von: "gramsci", zu: "harvey", typ: "einfluss" },
    { von: "gramsci", zu: "mouffe", typ: "einfluss" },
    { von: "gramsci", zu: "laclau", typ: "einfluss" },
    { von: "adorno", zu: "fisher", typ: "einfluss" },
    { von: "marcuse", zu: "fisher", typ: "einfluss" },
    { von: "debord", zu: "fisher", typ: "einfluss" },
    { von: "davis", zu: "fraser", typ: "einfluss" },
    { von: "federici", zu: "fraser", typ: "einfluss" },
    { von: "hooks", zu: "fraser", typ: "einfluss" },
    { von: "marx", zu: "saito", typ: "einfluss" },
    { von: "gorz", zu: "saito", typ: "einfluss" },
    { von: "graeber", zu: "ocalan", typ: "einfluss" },
    { von: "bookchin", zu: "ocalan", typ: "einfluss" },
    { von: "beauvoir", zu: "butler", typ: "einfluss" },
    { von: "althusser", zu: "butler", typ: "einfluss" },
    { von: "gramsci", zu: "spivak", typ: "einfluss" },
    { von: "fanon", zu: "spivak", typ: "einfluss" },
    { von: "althusser", zu: "jameson", typ: "einfluss" },
    { von: "lukacs", zu: "jameson", typ: "einfluss" },
    { von: "poulantzas", zu: "streeck", typ: "einfluss" },
    { von: "harvey", zu: "streeck", typ: "einfluss" },
    { von: "marx", zu: "piketty", typ: "einfluss" },
    { von: "gramsci", zu: "dean", typ: "einfluss" },
    { von: "badiou", zu: "dean", typ: "einfluss" },
    { von: "fisher", zu: "srnicek", typ: "einfluss" },
    { von: "srnicek", zu: "bastani", typ: "einfluss" },
    { von: "marx", zu: "malm", typ: "einfluss" },
    { von: "gorz", zu: "malm", typ: "einfluss" },
    { von: "althusser", zu: "brown", typ: "einfluss" },
    { von: "federici", zu: "butler", typ: "einfluss" },
    { von: "mouffe", zu: "laclau", typ: "einfluss" },
    { von: "mandel", zu: "harvey", typ: "einfluss" },
    { von: "mandel", zu: "jameson", typ: "einfluss" }
  ]
};


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATEN: VERBINDUNGEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const verbindungenData = [
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // A1: REFORM/REVOLUTION - Spektrum verbinden
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "A1-1", "zu": "A1-2", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Strikte Reform nah an radikaler Reform" },
  { "von": "A1-2", "zu": "A1-3", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Radikale Reform nah an Doppelstrategie" },
  { "von": "A1-2", "zu": "A1-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Radikale Reform nah an Prozess" },
  { "von": "A1-3", "zu": "A1-4", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Luxemburg: Doppelstrategie als Prozess" },
  { "von": "A1-4", "zu": "A1-5", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Prozess kann in Aufstand mÃ¼nden" },
  { "von": "A1-1", "zu": "A1-5", "typ": "debatte", "staerke": 0.10, "beschreibung": "Reform vs. Revolution - Grundkonflikt" },
  { "von": "A1-1", "zu": "D2-1", "typ": "affinitaet", "staerke": 0.95, "beschreibung": "Strikte Reform + Gradualismus" },
  { "von": "A1-5", "zu": "D2-5", "typ": "affinitaet", "staerke": 0.95, "beschreibung": "Sofortige Revolution + Bruch" },
  { "von": "A1-3", "zu": "A3-3", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Doppelstrategie + Staat als Terrain" },
  { "von": "A1-2", "zu": "D1-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Radikale Reform baut reale Utopien" },
  { "von": "A1-4", "zu": "D2-4", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "RevolutionÃ¤rer Prozess ist rupturell" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // A2: SUBJEKT - Spektrum verbinden
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "A2-1", "zu": "A2-2", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Industrieproletariat ist Kern der Klasse" },
  { "von": "A2-2", "zu": "A2-3", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Klassensubjekt erweitert sich" },
  { "von": "A2-3", "zu": "A2-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Erweiterte Klasse nah an Multitude" },
  { "von": "A2-4", "zu": "A2-5", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Multitude nah an Prozesssubjekt" },
  { "von": "A2-1", "zu": "A2-5", "typ": "debatte", "staerke": 0.25, "beschreibung": "Festes vs. fluides Subjekt" },
  { "von": "A2-2", "zu": "A2-4", "typ": "debatte", "staerke": 0.50, "beschreibung": "Klasse vs. Multitude" },
  { "von": "A2-1", "zu": "B3-1", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Industrieproletariat + VollbeschÃ¤ftigung" },
  { "von": "A2-3", "zu": "B3-4", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Prekariat braucht Grundeinkommen" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // A3: STAAT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "A3-1", "zu": "A3-2", "typ": "affinitaet", "staerke": 0.50, "beschreibung": "Beide nutzen den Staat, aber anders" },
  { "von": "A3-2", "zu": "A3-3", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Poulantzas korrigiert Lenin" },
  { "von": "A3-3", "zu": "A3-4", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Terrain-KÃ¤mpfe kÃ¶nnen zu Exodus fÃ¼hren" },
  { "von": "A3-4", "zu": "A3-5", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Autonomismus nah an Anarchismus" },
  { "von": "A3-5", "zu": "B2-5", "typ": "affinitaet", "staerke": 0.95, "beschreibung": "Anarchismus + Selbstverwaltung" },
  { "von": "A3-5", "zu": "E3-5", "typ": "affinitaet", "staerke": 0.90, "beschreibung": "Anarchismus + Basisbildung" },
  { "von": "A3-5", "zu": "A3-2", "typ": "debatte", "staerke": 0.20, "beschreibung": "Bakunin vs. Marx" },
  { "von": "A3-5", "zu": "A3-1", "typ": "debatte", "staerke": 0.10, "beschreibung": "Anarchismus vs. Etatismus" },
  { "von": "A3-5", "zu": "C2-5", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Bookchin: Anarchismus + SozialÃ¶kologie" },
  { "von": "A3-5", "zu": "E2-2", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Anarchismus + FÃ¶deralismus" },
  { "von": "A3-2", "zu": "E3-1", "typ": "affinitaet", "staerke": 0.90, "beschreibung": "Leninismus + Avantgarde" },
  { "von": "A3-2", "zu": "D2-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Leninismus + Revolution" },
  { "von": "A3-2", "zu": "A2-2", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Leninismus + Klassensubjekt" },
  { "von": "A3-2", "zu": "B1-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Leninismus + Zentralplanung" },
  { "von": "A3-2", "zu": "B2-1", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Leninismus + Verstaatlichung" },
  { "von": "A3-2", "zu": "E3-2", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Leninismus + Kaderschulung" },
  { "von": "A3-2", "zu": "E2-1", "typ": "affinitaet", "staerke": 0.90, "beschreibung": "Leninismus + Zentralismus" },
  { "von": "A3-1", "zu": "D2-1", "typ": "affinitaet", "staerke": 0.90, "beschreibung": "Etatismus + Reform" },
  { "von": "A3-1", "zu": "B1-2", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Etatismus + regulierter Markt" },
  { "von": "A3-1", "zu": "B2-2", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Etatismus + Ã¶ffentliches Eigentum" },
  { "von": "A3-3", "zu": "E2-3", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Staat als Terrain + Mehrebenen-KÃ¤mpfe" },
  { "von": "A3-4", "zu": "B2-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Autonomismus + Selbstverwaltung" },
  { "von": "A3-4", "zu": "D2-2", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Autonomismus + interstitielle Strategie" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // B1: MARKT/PLAN
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "B1-1", "zu": "B1-2", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Marktsozialismus nah an Regulierung" },
  { "von": "B1-2", "zu": "B1-3", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Regulierter Markt nah an Mischsystem" },
  { "von": "B1-3", "zu": "B1-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Mischsystem nah an demokratischer Planung" },
  { "von": "B1-4", "zu": "B1-5", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Demokratische vs. zentrale Planung" },
  { "von": "B1-1", "zu": "B1-5", "typ": "debatte", "staerke": 0.20, "beschreibung": "Markt vs. Plan - Grundkonflikt" },
  { "von": "B1-1", "zu": "B2-4", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Marktsozialismus + Genossenschaften" },
  { "von": "B1-5", "zu": "B2-1", "typ": "affinitaet", "staerke": 0.90, "beschreibung": "Zentralplanung + Verstaatlichung" },
  { "von": "B1-4", "zu": "B2-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Demokratische Planung + Selbstverwaltung" },
  { "von": "B1-3", "zu": "B2-3", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Mischsystem + gemischte Eigentumsformen" },
  { "von": "B1-2", "zu": "C2-2", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Regulierter Markt ermÃ¶glicht grÃ¼nes Wachstum" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // B2: BESITZ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "B2-1", "zu": "B2-2", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Verstaatlichung nah an Ã¶ffentlichem Eigentum" },
  { "von": "B2-2", "zu": "B2-3", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Ã–ffentliches Eigentum nah an Mischformen" },
  { "von": "B2-3", "zu": "B2-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Mischformen enthalten Genossenschaften" },
  { "von": "B2-4", "zu": "B2-5", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Genossenschaften nah an Selbstverwaltung" },
  { "von": "B2-1", "zu": "B2-5", "typ": "debatte", "staerke": 0.30, "beschreibung": "Verstaatlichung vs. Selbstverwaltung" },
  { "von": "B2-2", "zu": "A3-1", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Ã–ffentliches Eigentum + Etatismus" },
  { "von": "B2-3", "zu": "D1-4", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Mischformen als reale Utopie" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // B3: ARBEIT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "B3-1", "zu": "B3-2", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "VollbeschÃ¤ftigung braucht gute Arbeit" },
  { "von": "B3-2", "zu": "B3-3", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Gute Arbeit heiÃŸt auch weniger Arbeit" },
  { "von": "B3-3", "zu": "B3-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "ArbeitszeitverkÃ¼rzung + Grundeinkommen" },
  { "von": "B3-4", "zu": "B3-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Grundeinkommen nah an Post-Work" },
  { "von": "B3-1", "zu": "B3-5", "typ": "debatte", "staerke": 0.20, "beschreibung": "VollbeschÃ¤ftigung vs. Post-Work" },
  { "von": "B3-5", "zu": "C2-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Post-Work + Ã–kosozialismus (Degrowth)" },
  { "von": "B3-2", "zu": "C1-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Gute Arbeit muss Care-Arbeit einschlieÃŸen" },
  { "von": "B3-3", "zu": "C2-4", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Weniger arbeiten = weniger produzieren" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // C1: FEMINISMUS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "C1-1", "zu": "C1-2", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Klassenprimat nah an sozialistischem Feminismus" },
  { "von": "C1-2", "zu": "C1-3", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Sozialistischer Feminismus Ã¶ffnet fÃ¼r IntersektionalitÃ¤t" },
  { "von": "C1-3", "zu": "C1-4", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "IntersektionalitÃ¤t sieht Care-Arbeit" },
  { "von": "C1-4", "zu": "C1-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Care-Revolution nah an Radikalfeminismus" },
  { "von": "C1-1", "zu": "C1-5", "typ": "debatte", "staerke": 0.30, "beschreibung": "Nebenwiderspruch-Debatte" },
  { "von": "C1-1", "zu": "A2-2", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Klassenprimat + Klassensubjekt" },
  { "von": "C1-2", "zu": "A2-2", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Sozialistischer Feminismus bleibt bei Klasse" },
  { "von": "C1-3", "zu": "A2-4", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "IntersektionalitÃ¤t + Multitude" },
  { "von": "C1-5", "zu": "A2-4", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Radikalfeminismus + Multitude" },
  { "von": "C1-5", "zu": "B3-5", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Care-Kritik + Post-Work" },
  { "von": "C1-4", "zu": "B3-5", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Care-Revolution + Post-Work" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // C2: NATUR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "C2-1", "zu": "C2-2", "typ": "affinitaet", "staerke": 0.55, "beschreibung": "Produktivismus glaubt an grÃ¼ne Technik" },
  { "von": "C2-2", "zu": "C2-3", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "GrÃ¼nes Wachstum + Nachhaltigkeit" },
  { "von": "C2-3", "zu": "C2-4", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Nachhaltigkeit kann zu Ã–kosozialismus fÃ¼hren" },
  { "von": "C2-4", "zu": "C2-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Ã–kosozialismus nah an Naturrechte" },
  { "von": "C2-1", "zu": "C2-4", "typ": "debatte", "staerke": 0.20, "beschreibung": "Produktivismus vs. Ã–kosozialismus" },
  { "von": "C2-2", "zu": "C2-4", "typ": "debatte", "staerke": 0.40, "beschreibung": "GrÃ¼nes Wachstum vs. Degrowth" },
  { "von": "C2-5", "zu": "A3-5", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Bookchin: SozialÃ¶kologie + Anarchismus" },
  { "von": "C2-5", "zu": "E2-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Naturrechte + Kommunalismus" },
  { "von": "C2-1", "zu": "B1-5", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Produktivismus + Zentralplanung" },
  { "von": "C2-3", "zu": "B1-2", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Nachhaltige Entwicklung braucht Regulierung" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // C3: INTERNATIONAL
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "C3-1", "zu": "C3-2", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Nationaler Weg kann regional werden" },
  { "von": "C3-2", "zu": "C3-3", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Regional ist schon international" },
  { "von": "C3-3", "zu": "C3-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Internationalismus nah an permanenter Revolution" },
  { "von": "C3-4", "zu": "C3-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Permanente Revolution nah an global" },
  { "von": "C3-1", "zu": "C3-5", "typ": "debatte", "staerke": 0.15, "beschreibung": "National vs. Global - Stalin vs. Trotzki" },
  { "von": "C3-3", "zu": "A2-2", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Internationalismus + Klassensubjekt" },
  { "von": "C3-5", "zu": "A2-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Globale Multitude" },
  { "von": "C3-1", "zu": "E2-1", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Nationaler Weg + Zentralismus" },
  { "von": "C3-2", "zu": "E2-2", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Regionale BÃ¼ndnisse + FÃ¶deralismus" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // D1: UTOPIE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "D1-1", "zu": "D1-2", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Anti-Utopismus nah an negativer Utopie" },
  { "von": "D1-2", "zu": "D1-3", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Negation kann Prozess werden" },
  { "von": "D1-3", "zu": "D1-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Prozess findet reale Utopien" },
  { "von": "D1-4", "zu": "D1-5", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Reale Utopien kÃ¶nnen konkret werden" },
  { "von": "D1-1", "zu": "D1-5", "typ": "debatte", "staerke": 0.20, "beschreibung": "Anti-Utopismus vs. konkrete Utopie" },
  { "von": "D1-2", "zu": "D3-1", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Negative Utopie + strenger Materialismus" },
  { "von": "D1-4", "zu": "D2-2", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Reale Utopien + interstitielle Strategie" },
  { "von": "D1-4", "zu": "A1-2", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Reale Utopien durch radikale Reformen" },
  { "von": "D1-5", "zu": "B1-4", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Konkrete Utopie + demokratische Planung" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // D2: TRANSFORMATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "D2-1", "zu": "D2-2", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Reform kann interstitiell sein" },
  { "von": "D2-2", "zu": "D2-3", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Interstitiell braucht manchmal Staat" },
  { "von": "D2-3", "zu": "D2-4", "typ": "affinitaet", "staerke": 0.55, "beschreibung": "Symbiotisch kann rupturell werden" },
  { "von": "D2-4", "zu": "D2-5", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Rupturell nah an Revolution" },
  { "von": "D2-1", "zu": "D2-5", "typ": "debatte", "staerke": 0.15, "beschreibung": "Reform vs. Revolution" },
  { "von": "D2-2", "zu": "A3-4", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Interstitiell + Autonomismus" },
  { "von": "D2-3", "zu": "A3-3", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Symbiotisch + Staat als Terrain" },
  { "von": "D2-3", "zu": "A3-1", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Symbiotisch nutzt Etatismus" },
  { "von": "D2-4", "zu": "A1-4", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Rupturell + revolutionÃ¤rer Prozess" },
  { "von": "D2-4", "zu": "E1-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Rupturell braucht Bewegungen" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // D3: SPIRITUALITÃ„T
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "D3-1", "zu": "D3-2", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Materialismus akzeptiert Humanismus" },
  { "von": "D3-2", "zu": "D3-3", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Humanismus ist offen" },
  { "von": "D3-3", "zu": "D3-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Offenheit ermÃ¶glicht Befreiungstheologie" },
  { "von": "D3-4", "zu": "D3-5", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Befreiungstheologie nah an spirituellem Sozialismus" },
  { "von": "D3-1", "zu": "D3-5", "typ": "debatte", "staerke": 0.20, "beschreibung": "Materialismus vs. SpiritualitÃ¤t" },
  { "von": "D3-4", "zu": "C3-3", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Befreiungstheologie + Internationalismus" },
  { "von": "D3-5", "zu": "A3-5", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Landauer: Spiritueller Anarchismus" },
  { "von": "D3-1", "zu": "A2-2", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Materialismus + Klassensubjekt" },
  { "von": "D3-3", "zu": "E1-3", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Offenheit ermÃ¶glicht breite BÃ¼ndnisse" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // E1: BÃœNDNISSE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "E1-1", "zu": "E1-2", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Klassenreinheit kann KlassenbÃ¼ndnis werden" },
  { "von": "E1-2", "zu": "E1-3", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "KlassenbÃ¼ndnis kann breiter werden" },
  { "von": "E1-3", "zu": "E1-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Breite BÃ¼ndnisse werden bewegungsorientiert" },
  { "von": "E1-4", "zu": "E1-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Bewegungen werden Netzwerke" },
  { "von": "E1-1", "zu": "E1-5", "typ": "debatte", "staerke": 0.20, "beschreibung": "Klassenreinheit vs. Netzwerk" },
  { "von": "E1-2", "zu": "A2-2", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "KlassenbÃ¼ndnis + Klassensubjekt" },
  { "von": "E1-3", "zu": "A2-4", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Breite BÃ¼ndnisse + Multitude" },
  { "von": "E1-5", "zu": "A2-4", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Netzwerk + Multitude" },
  { "von": "E1-4", "zu": "A2-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Bewegungsorientiert + Multitude" },
  { "von": "E1-1", "zu": "A2-1", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Klassenreinheit + Industrieproletariat" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // E2: EBENEN
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "E2-1", "zu": "E2-2", "typ": "debatte", "staerke": 0.40, "beschreibung": "Zentralismus vs. FÃ¶deralismus" },
  { "von": "E2-2", "zu": "E2-3", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "FÃ¶deralismus ist Mehrebenen" },
  { "von": "E2-3", "zu": "E2-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Mehrebenen betont Kommune" },
  { "von": "E2-4", "zu": "E2-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Kommunalismus ist basisdemokratisch" },
  { "von": "E2-1", "zu": "E2-5", "typ": "debatte", "staerke": 0.15, "beschreibung": "Zentralismus vs. Basisdemokratie" },
  { "von": "E2-1", "zu": "A3-2", "typ": "affinitaet", "staerke": 0.90, "beschreibung": "Zentralismus + Leninismus" },
  { "von": "E2-4", "zu": "A3-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Kommunalismus + Anarchismus" },
  { "von": "E2-4", "zu": "C2-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Kommunalismus + SozialÃ¶kologie" },
  { "von": "E2-5", "zu": "B2-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Basisdemokratie + Selbstverwaltung" },
  { "von": "E2-2", "zu": "A3-5", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "FÃ¶deralismus + Anarchismus" },
  { "von": "E2-3", "zu": "A3-3", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Mehrebenen + Staat als Terrain" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // E3: BILDUNG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "E3-1", "zu": "E3-2", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Avantgarde macht Kaderschulung" },
  { "von": "E3-2", "zu": "E3-3", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Kaderschulung kann offener werden" },
  { "von": "E3-3", "zu": "E3-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Politische Bildung trifft Bewegungslernen" },
  { "von": "E3-4", "zu": "E3-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Bewegungslernen ist Basisbildung" },
  { "von": "E3-1", "zu": "E3-5", "typ": "debatte", "staerke": 0.20, "beschreibung": "Avantgarde vs. Basisbildung" },
  { "von": "E3-2", "zu": "A3-2", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Kaderschulung + Leninismus" },
  { "von": "E3-2", "zu": "E2-1", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Kaderschulung + Zentralismus" },
  { "von": "E3-5", "zu": "A3-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Basisbildung + Anarchismus" },
  { "von": "E3-3", "zu": "D3-3", "typ": "affinitaet", "staerke": 0.55, "beschreibung": "Politische Bildung ist offen" },
  { "von": "E3-4", "zu": "E1-4", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Bewegungslernen + Bewegungsorientiert" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CROSS-ACHSEN (die spannenden)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "B2-5", "zu": "E3-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Selbstverwaltung + Basisbildung" },
  { "von": "C1-5", "zu": "A2-2", "typ": "debatte", "staerke": 0.40, "beschreibung": "Nebenwiderspruch-Debatte" },
  { "von": "B3-3", "zu": "D1-4", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "4-Tage-Woche als reale Utopie" },
  { "von": "E1-3", "zu": "C1-3", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Breite BÃ¼ndnisse brauchen IntersektionalitÃ¤t" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // F1: TECHNOLOGIE - Spektrum verbinden
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "F1-1", "zu": "F1-2", "typ": "affinitaet", "staerke": 0.75, "beschreibung": "Neo-Luddismus nah an Technologie-Skepsis" },
  { "von": "F1-2", "zu": "F1-3", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Skepsis kann zu kritischer Aneignung werden" },
  { "von": "F1-3", "zu": "F1-4", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Kritische Aneignung teilt Modernismus mit Akzelerationismus" },
  { "von": "F1-4", "zu": "F1-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Akzelerationismus mÃ¼ndet in FALC" },
  { "von": "F1-1", "zu": "F1-5", "typ": "debatte", "staerke": 0.20, "beschreibung": "Technologie ablehnen vs. maximieren" },
  { "von": "F1-3", "zu": "B2-4", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Platform Cooperativism = Plattform + Genossenschaft" },
  { "von": "F1-5", "zu": "B3-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "FALC braucht Post-Work" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // F2: DEMOKRATIEFORM - Spektrum verbinden
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "F2-1", "zu": "F2-2", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Avantgarde praktiziert demokratischen Zentralismus" },
  { "von": "F2-2", "zu": "F2-3", "typ": "affinitaet", "staerke": 0.50, "beschreibung": "Zentralismus vs. ReprÃ¤sentation - Spannung" },
  { "von": "F2-3", "zu": "F2-4", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "ReprÃ¤sentation kann zu RÃ¤ten radikalisiert werden" },
  { "von": "F2-4", "zu": "F2-5", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "RÃ¤te nahe an Basisdemokratie" },
  { "von": "F2-1", "zu": "F2-5", "typ": "debatte", "staerke": 0.15, "beschreibung": "Avantgarde vs. Basisdemokratie - Grundkonflikt" },
  { "von": "F2-1", "zu": "A3-1", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Avantgarde + starker Staat" },
  { "von": "F2-5", "zu": "A3-5", "typ": "affinitaet", "staerke": 0.85, "beschreibung": "Basisdemokratie + Anti-Etatismus" },

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // F3: GEWALT & MITTEL - Spektrum verbinden
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  { "von": "F3-1", "zu": "F3-2", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Pazifismus nahe an gewaltfreiem Widerstand" },
  { "von": "F3-2", "zu": "F3-3", "typ": "affinitaet", "staerke": 0.60, "beschreibung": "Gewaltfreiheit kann zu taktischer FlexibilitÃ¤t werden" },
  { "von": "F3-3", "zu": "F3-4", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "FlexibilitÃ¤t Ã¶ffnet TÃ¼r zu Militanz" },
  { "von": "F3-4", "zu": "F3-5", "typ": "affinitaet", "staerke": 0.70, "beschreibung": "Militanz kann zu bewaffnetem Kampf eskalieren" },
  { "von": "F3-1", "zu": "F3-5", "typ": "debatte", "staerke": 0.10, "beschreibung": "Pazifismus vs. bewaffneter Kampf - absoluter Gegensatz" },
  { "von": "F3-5", "zu": "A1-5", "typ": "affinitaet", "staerke": 0.80, "beschreibung": "Bewaffneter Kampf + Revolution" },
  { "von": "F3-2", "zu": "A1-2", "typ": "affinitaet", "staerke": 0.65, "beschreibung": "Gewaltfreier Widerstand + radikale Reform" }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATEN: DEBATTEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const debattenData = [
  {
    "id": "marx-bakunin",
    "titel": "Staat erobern oder zerschlagen?",
    "frage": "Kann der Staat ein Werkzeug der Befreiung sein â€“ oder ist er immer Herrschaft?",
    "seite_a": {
      "position": "Der Arbeiterstaat ist notwendig",
      "argumente": ["Ohne Staatsmacht keine Enteignung mÃ¶glich", "Der Staat stirbt ab nach Sieg", "Anarchismus ist unpraktisch"]
    },
    "seite_b": {
      "position": "Jeder Staat ist UnterdrÃ¼ckung",
      "argumente": ["Wer den Staat erobert, wird von ihm erobert", "Der Staat stirbt nie ab", "Freiheit nicht durch Unfreiheit"]
    },
    "historisch": { "wann": "1872", "anlass": "Spaltung der Ersten Internationale", "ausgang": "Marx setzt sich durch, Bakunin ausgeschlossen" },
    "texte": [
      { "titel": "Staatlichkeit und Anarchie", "autor": "Bakunin", "url": "https://theanarchistlibrary.org/library/mikhail-bakunin-statism-and-anarchy" },
      { "titel": "Staat und Revolution", "autor": "Lenin", "url": "https://www.marxists.org/deutsch/archiv/lenin/1917/staatrev/index.htm" }
    ]
  },
  {
    "id": "reform-revolution",
    "titel": "Reform oder Revolution?",
    "frage": "KÃ¶nnen wir den Kapitalismus Schritt fÃ¼r Schritt Ã¼berwinden â€“ oder braucht es einen Bruch?",
    "seite_a": {
      "position": "Der Weg ist alles",
      "argumente": ["Revolution fÃ¼hrt zu Terror", "Demokratie ermÃ¶glicht Wandel", "Arbeiterklasse nicht bereit"]
    },
    "seite_b": {
      "position": "Kein gradueller Ãœbergang mÃ¶glich",
      "argumente": ["Herrschende geben nie freiwillig auf", "Reformen werden zurÃ¼ckgenommen", "System nicht reformierbar"]
    },
    "historisch": { "wann": "1899", "anlass": "Bernstein-Debatte in der SPD", "ausgang": "RevolutionÃ¤re Rhetorik, reformistische Praxis" },
    "texte": [
      { "titel": "Sozialreform oder Revolution?", "autor": "Luxemburg", "url": "https://www.marxists.org/deutsch/archiv/luxemburg/1899/sozam/index.htm" },
      { "titel": "Die Voraussetzungen des Sozialismus", "autor": "Bernstein", "url": "https://www.marxists.org/deutsch/archiv/bernstein/1899/voraus/index.html" }
    ]
  },
  {
    "id": "markt-plan",
    "titel": "Markt oder Plan?",
    "frage": "Wie koordinieren wir eine sozialistische Wirtschaft?",
    "seite_a": {
      "position": "Sozialismus braucht Markt",
      "argumente": ["Preise transportieren Information", "Planung fÃ¼hrt zu BÃ¼rokratie", "Genossenschaften kÃ¶nnen konkurrieren"]
    },
    "seite_b": {
      "position": "Markt ist das Problem",
      "argumente": ["Markt erzeugt Ungleichheit", "Rationale Planung ist effizienter", "BedÃ¼rfnisse statt Profit"]
    },
    "historisch": { "wann": "1920-1940", "anlass": "Sozialistische Kalkulationsdebatte", "ausgang": "Beide Seiten beanspruchen Sieg" },
    "texte": []
  },
  {
    "id": "klasse-multitude",
    "titel": "Wer macht Geschichte?",
    "frage": "Ist die Arbeiterklasse DAS revolutionÃ¤re Subjekt â€“ oder gibt es viele KÃ¤mpfe?",
    "seite_a": {
      "position": "Die Arbeiterklasse",
      "argumente": ["Nur sie kann Produktion lahmlegen", "Andere KÃ¤mpfe sind sekundÃ¤r", "IdentitÃ¤tspolitik spaltet"]
    },
    "seite_b": {
      "position": "Viele Subjekte",
      "argumente": ["'Die' Arbeiterklasse gibt es nicht mehr", "Feminismus etc. keine NebenwidersprÃ¼che", "Multitude reicher als Klasse"]
    },
    "historisch": { "wann": "1970er-heute", "anlass": "Neue Soziale Bewegungen", "ausgang": "Offen" },
    "texte": []
  },
  {
    "id": "national-global",
    "titel": "Sozialismus in einem Land oder Weltrevolution?",
    "frage": "Kann Sozialismus in einer kapitalistischen Welt Ã¼berleben â€“ oder muss er sich ausbreiten?",
    "seite_a": {
      "position": "Sozialismus in einem Land mÃ¶glich",
      "argumente": ["Nicht auf Weltrevolution warten", "Aufbau hier und jetzt", "Ausstrahlung durch Erfolg"]
    },
    "seite_b": {
      "position": "Revolution muss international werden",
      "argumente": ["Isolation fÃ¼hrt zu Deformation", "Kapital ist global", "Permanente Revolution nÃ¶tig"]
    },
    "historisch": { "wann": "1924-1927", "anlass": "Stalin vs. Trotzki", "ausgang": "Stalin setzt sich durch, Trotzki verbannt" },
    "texte": [
      { "titel": "Die permanente Revolution", "autor": "Trotzki", "url": "https://www.marxists.org/deutsch/archiv/trotzki/1930/permrev/index.htm" }
    ]
  },
  {
    "id": "organisation",
    "titel": "Zentralismus oder Basisdemokratie?",
    "frage": "Wie organisieren wir uns, um zu gewinnen â€“ von oben oder von unten?",
    "seite_a": {
      "position": "Demokratischer Zentralismus",
      "argumente": ["Einheitliches Handeln nÃ¶tig gegen starken Gegner", "Diskussion ja, aber dann geschlossenes Auftreten", "Dezentralismus ist SchwÃ¤che"]
    },
    "seite_b": {
      "position": "Basisdemokratie",
      "argumente": ["Zentralismus fÃ¼hrt zu BÃ¼rokratie und Diktatur", "Befreiung muss von unten kommen", "Mittel mÃ¼ssen dem Ziel entsprechen"]
    },
    "historisch": { "wann": "1903-heute", "anlass": "Bolschewiki vs. Menschewiki und viele Folgekonflikte", "ausgang": "Zentralismus hat oft gesiegt, aber nie dauerhaft Ã¼berzeugt" },
    "texte": []
  }
];


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBALE FILTER-DATEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Temperatur-Cache fÃ¼r alle Positionen
const temperaturCache = {};

function berechneTemperaturen() {
  Object.values(knotenData).forEach(k => {
    let temp = 0;
    let debatten = 0;
    
    verbindungenData.forEach(v => {
      if (v.von === k.id || v.zu === k.id) {
        temp += v.staerke * 10;
        if (v.typ === 'debatte') debatten++;
      }
    });
    
    const heisseThemen = ['Ã–kosozialismus', 'Post-Work', 'Grundeinkommen', 'IntersektionalitÃ¤t', 'Multitude', 'Care-Revolution', 'Degrowth', 'Feminismus', 'Antirassismus'];
    if (heisseThemen.some(t => k.name.includes(t))) {
      temp += 20;
    }
    
    temp += debatten * 10;
    temperaturCache[k.id] = Math.min(100, temp);
  });
}

// Epochen-Zuordnung
function getEpocheForPosition(id) {
  const knoten = knotenData[id];
  if (!knoten) return 2000;
  
  const achse = knoten.achse;
  if (achse === 'A1') return 1900;
  if (achse === 'A2') return 1920;
  if (achse === 'A3') return 1960;
  if (achse === 'B1') return 1970;
  if (achse === 'B2') return 1980;
  if (achse === 'C1') return 1990;
  if (achse === 'C2') return 2000;
  if (achse === 'D1') return 1950;
  if (achse === 'D2') return 2010;
  if (achse === 'E1') return 1940;
  if (achse === 'E2') return 2000;
  return 1970;
}

// Temperaturen beim Laden berechnen
berechneTemperaturen();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTER-FUNKTIONEN FÃœR ANSICHTEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let personenObjekte = [];

function applyFiltersToNetzwerk(filter, epoche) {
  if (!nodeObjects || Object.keys(nodeObjects).length === 0) return;
  
  const hasFieber = filter.has('fieber');
  const hasPersonen = filter.has('personen');
  const hasEpoche = filter.has('epoche');
  const hasDebatten = filter.has('debatten');
  
  const getFieberFarbe = (temp) => {
    if (temp >= 60) return 0xf44336;
    if (temp >= 40) return 0xFF9800;
    if (temp >= 20) return 0x4CAF50;
    return 0x2196F3;
  };
  
  const achsenFarben = {
    'A': 0xE53935, 'B': 0x4CAF50, 'C': 0x2196F3, 'D': 0x9C27B0, 'E': 0xFF9800, 'F': 0x00BCD4
  };
  
  // Knoten aktualisieren
  nodes3d.forEach(node => {
    const sphere = nodeObjects[node.id];
    if (!sphere) return;
    
    // Epochen-Filter
    if (hasEpoche) {
      const entstehung = getEpocheForPosition(node.id);
      const sichtbar = entstehung <= epoche;
      sphere.visible = sichtbar;
    } else {
      sphere.visible = true;
    }
    
    // Fieber-Filter (Skalierung)
    if (hasFieber && sphere.visible) {
      const temp = temperaturCache[node.id] || 0;
      const scale = 0.8 + (temp / 100) * 0.8;
      sphere.scale.set(scale, scale, scale);
    } else {
      sphere.scale.set(1, 1, 1);
    }
  });
  
  // Verbindungen aktualisieren
  if (linkObjects) {
    linkObjects.forEach(line => {
      if (!line.userData.link) return;
      
      const sourceVisible = nodeObjects[line.userData.source]?.visible ?? true;
      const targetVisible = nodeObjects[line.userData.target]?.visible ?? true;
      line.visible = sourceVisible && targetVisible;
      
      // Debatten-Filter
      if (hasDebatten && line.visible) {
        if (line.userData.link.typ === 'debatte') {
          line.material.opacity = 1.0;
          line.material.color.setHex(0xFF5722);
        } else {
          line.material.opacity = 0.1;
        }
      } else if (line.visible) {
        const link = line.userData.link;
        if (link.typ === 'debatte') {
          line.material.opacity = 0.6;
          line.material.color.setHex(0xFF9800);
        } else if (link.staerke > 0.8) {
          line.material.opacity = 0.8;
          line.material.color.setHex(0x4CAF50);
        } else {
          line.material.opacity = 0.3 + link.staerke * 0.4;
          line.material.color.setHex(0x555555);
        }
      }
    });
  }
  
  // Personen einblenden
  if (hasPersonen) {
    if (personenObjekte.length === 0) {
      erstellePersonenImNetzwerk();
    }
    personenObjekte.forEach(p => p.visible = true);
  } else {
    personenObjekte.forEach(p => p.visible = false);
  }
}

function erstellePersonenImNetzwerk() {
  if (!scene) return;
  
  nodes3d.forEach(node => {
    const knoten = knotenData[node.id];
    if (!knoten || !knoten.bewohner) return;
    
    const bewohner = [
      ...(knoten.bewohner.klassiker || []),
      ...(knoten.bewohner.zeitgenossen || [])
    ];
    
    if (bewohner.length === 0) return;
    
    bewohner.slice(0, 5).forEach((name, i) => {
      const winkel = (i / Math.min(bewohner.length, 5)) * Math.PI * 2;
      const radius = 25;
      
      const geometry = new THREE.SphereGeometry(4, 8, 8);
      const material = new THREE.MeshBasicMaterial({ 
        color: 0xffffff,
        transparent: true,
        opacity: 0.8
      });
      const sphere = new THREE.Mesh(geometry, material);
      
      sphere.position.set(
        node.x + Math.cos(winkel) * radius,
        node.y + Math.sin(winkel) * radius,
        node.z
      );
      
      sphere.userData = { type: 'person', name: name, position: node.id };
      sphere.visible = false;
      scene.add(sphere);
      personenObjekte.push(sphere);
    });
  });
}

function applyFiltersToListe(filter, epoche) {
  const container = document.getElementById('liste-container');
  if (!container) return;
  
  const hasFieber = filter.has('fieber');
  const hasPersonen = filter.has('personen');
  const hasEpoche = filter.has('epoche');
  
  let positionen = Object.values(knotenData).map(k => ({
    ...k,
    temperatur: temperaturCache[k.id] || 0,
    entstehung: getEpocheForPosition(k.id),
    bewohnerListe: [...(k.bewohner?.klassiker || []), ...(k.bewohner?.zeitgenossen || [])]
  }));
  
  if (hasEpoche) {
    positionen = positionen.filter(p => p.entstehung <= epoche);
  }
  
  if (hasFieber) {
    positionen.sort((a, b) => b.temperatur - a.temperatur);
  } else {
    positionen.sort((a, b) => a.name.localeCompare(b.name));
  }
  
  let html = '<div class="liste-header">';
  html += `<h2>ğŸ“‹ Alle Positionen (${positionen.length})</h2>`;
  if (hasFieber) html += '<p style="color: #FF9800; font-size: 0.8rem;">ğŸ”¥ Sortiert nach Fieber</p>';
  if (hasEpoche) html += `<p style="color: #FF9800; font-size: 0.8rem;">ğŸ“… Bis ${epoche}</p>`;
  html += '</div><div class="liste-grid">';
  
  positionen.forEach(p => {
    html += `<div class="liste-item" onclick="showKnoten('${p.id}')" style="${hasFieber ? 'border-left: 3px solid ' + (p.temperatur >= 60 ? '#f44336' : p.temperatur >= 30 ? '#FF9800' : '#2196F3') : ''}">`;
    html += `<div class="liste-name">${p.name}</div>`;
    html += `<div class="liste-achse">${p.achse}</div>`;
    if (hasPersonen && p.bewohnerListe.length > 0) {
      html += `<div style="font-size: 0.7rem; color: #888; margin-top: 0.3rem;">ğŸ‘¤ ${p.bewohnerListe.slice(0, 2).join(', ')}${p.bewohnerListe.length > 2 ? '...' : ''}</div>`;
    }
    html += '</div>';
  });
  
  html += '</div>';
  container.innerHTML = html;
}

function applyFiltersToKarte(filter, epoche) {
  const container = document.getElementById('karte-container');
  if (!container) return;
  
  const hasFieber = filter.has('fieber');
  const hasPersonen = filter.has('personen');
  const hasEpoche = filter.has('epoche');
  
  const achsen = [
    { id: 'A1', name: 'Reform/Revolution' },
    { id: 'A2', name: 'Subjekt' },
    { id: 'A3', name: 'Staat' },
    { id: 'B1', name: 'Markt/Plan' },
    { id: 'B2', name: 'Besitz' },
    { id: 'B3', name: 'Arbeit' },
    { id: 'C1', name: 'Feminismus' },
    { id: 'C2', name: 'Natur' },
    { id: 'C3', name: 'International' },
    { id: 'D1', name: 'Utopie' },
    { id: 'D2', name: 'Transformation' },
    { id: 'D3', name: 'SpiritualitÃ¤t' },
    { id: 'E1', name: 'BÃ¼ndnisse' },
    { id: 'E2', name: 'Ebenen' },
    { id: 'E3', name: 'Bildung' },
    { id: 'F1', name: 'Technologie' },
    { id: 'F2', name: 'Demokratieform' },
    { id: 'F3', name: 'Gewalt/Mittel' }
  ];
  
  let html = '<div class="karte-wrapper">';
  html += '<div class="karte-header">â† gemÃ¤ÃŸigt | radikal â†’</div>';
  
  if (hasFieber) html += '<p style="color: #FF9800; font-size: 0.8rem; margin-bottom: 1rem;">ğŸ”¥ Fieber-FÃ¤rbung aktiv</p>';
  if (hasEpoche) html += `<p style="color: #FF9800; font-size: 0.8rem; margin-bottom: 1rem;">ğŸ“… Bis ${epoche}</p>`;
  
  achsen.forEach(achse => {
    html += `<div class="karte-grid" style="margin-bottom: 1rem;">`;
    html += `<div class="karte-achse-label" style="grid-column: 1 / -1;">${achse.id}: ${achse.name}</div>`;
    
    for (let pos = 1; pos <= 5; pos++) {
      const id = `${achse.id}-${pos}`;
      const knoten = knotenData[id];
      
      if (knoten) {
        const temp = temperaturCache[id] || 0;
        const entstehung = getEpocheForPosition(id);
        const sichtbar = !hasEpoche || entstehung <= epoche;
        const bewohner = [...(knoten.bewohner?.klassiker || []), ...(knoten.bewohner?.zeitgenossen || [])];
        
        const fieberStyle = hasFieber ? 
          `background: ${temp >= 60 ? 'rgba(244,67,54,0.3)' : temp >= 30 ? 'rgba(255,152,0,0.3)' : 'rgba(33,150,243,0.2)'};` : '';
        
        html += `<div class="karte-cell" onclick="showKnoten('${id}')" style="${fieberStyle}${!sichtbar ? 'opacity: 0.2;' : ''}">
          <div class="name">${knoten.name}</div>
          <div class="id">${id}</div>
          ${hasPersonen && bewohner.length > 0 ? `<div style="font-size: 0.6rem; color: #888;">ğŸ‘¤ ${bewohner.length}</div>` : ''}
        </div>`;
      } else {
        html += `<div class="karte-cell" style="opacity: 0.3;">
          <div class="id">${id}</div>
        </div>`;
      }
    }
    html += '</div>';
  });
  
  html += '</div>';
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NETZWERK (3D)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let scene, camera, renderer;
let nodeObjects = {};
let linkObjects = [];
let nodes3d = [];
let links3d = [];

function initNetzwerk() {
  const container = document.getElementById('netzwerk-container');
  const canvas = document.getElementById('netzwerk3d');
  
  if (!container || !canvas) {
    console.error('Netzwerk: Container oder Canvas nicht gefunden');
    return;
  }
  
  // Warte auf Container-GrÃ¶ÃŸe
  let width = container.offsetWidth || container.clientWidth;
  let height = container.offsetHeight || container.clientHeight;
  
  // Falls immer noch 0, berechne aus Window
  if (width <= 0) {
    width = window.innerWidth - 80;
  }
  if (height <= 0) {
    height = window.innerHeight - 60;
  }
  
  // Canvas explizit setzen
  canvas.width = width;
  canvas.height = height;
  canvas.style.width = width + 'px';
  canvas.style.height = height + 'px';
  
  // Scene
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x1a1a1a);
  
  // Camera
  camera = new THREE.PerspectiveCamera(60, width / height, 1, 5000);
  camera.position.z = 800;
  
  // Renderer
  renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
  renderer.setSize(width, height);
  renderer.setPixelRatio(window.devicePixelRatio);
  
  // Rotation Control
  let isDragging = false;
  let previousMousePosition = { x: 0, y: 0 };
  let targetRotation = { x: 0, y: 0 };
  let hoveredNode = null;
  let draggedNode = null;
  let dragPlane = new THREE.Plane();
  
  canvas.addEventListener('mousedown', (e) => {
    if (e.button === 0 && !hoveredNode) {
      isDragging = true;
      previousMousePosition = { x: e.clientX, y: e.clientY };
    }
  });
  
  canvas.addEventListener('mousemove', (e) => {
    if (isDragging && !draggedNode) {
      const deltaX = e.clientX - previousMousePosition.x;
      const deltaY = e.clientY - previousMousePosition.y;
      targetRotation.y += deltaX * 0.005;
      targetRotation.x += deltaY * 0.005;
      previousMousePosition = { x: e.clientX, y: e.clientY };
    }
  });
  
  canvas.addEventListener('mouseup', () => { isDragging = false; });
  canvas.addEventListener('mouseleave', () => { isDragging = false; });
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // TOUCH EVENTS FÃœR MOBILE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  let touchStartDistance = 0;
  let initialCameraZ = camera.position.z;
  let lastTouchPos = { x: 0, y: 0 };
  let isTouching = false;
  let touchHintShown = false;
  
  // Touch-Hinweis anzeigen
  function showTouchHint() {
    if (touchHintShown) return;
    touchHintShown = true;
    
    let hint = document.querySelector('.touch-hint');
    if (!hint) {
      hint = document.createElement('div');
      hint.className = 'touch-hint';
      hint.textContent = 'ğŸ‘† Wischen zum Drehen Â· ğŸ¤ Pinch zum Zoomen';
      document.body.appendChild(hint);
    }
    hint.classList.add('visible');
    setTimeout(() => hint.classList.remove('visible'), 3000);
  }
  
  // Touch Start
  canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    showTouchHint();
    
    if (e.touches.length === 1) {
      // Ein Finger - Drehen
      isTouching = true;
      lastTouchPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    } else if (e.touches.length === 2) {
      // Zwei Finger - Zoom vorbereiten
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      touchStartDistance = Math.sqrt(dx * dx + dy * dy);
      initialCameraZ = camera.position.z;
    }
  }, { passive: false });
  
  // Touch Move
  canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    
    if (e.touches.length === 1 && isTouching) {
      // Ein Finger - Drehen
      const touch = e.touches[0];
      const deltaX = touch.clientX - lastTouchPos.x;
      const deltaY = touch.clientY - lastTouchPos.y;
      
      targetRotation.y += deltaX * 0.008;
      targetRotation.x += deltaY * 0.008;
      
      lastTouchPos = { x: touch.clientX, y: touch.clientY };
    } else if (e.touches.length === 2 && touchStartDistance > 0) {
      // Zwei Finger - Zoom (Pinch)
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      const currentDistance = Math.sqrt(dx * dx + dy * dy);
      
      const scale = touchStartDistance / currentDistance;
      camera.position.z = Math.max(200, Math.min(2000, initialCameraZ * scale));
    }
  }, { passive: false });
  
  // Touch End
  canvas.addEventListener('touchend', (e) => {
    isTouching = false;
    if (e.touches.length < 2) {
      touchStartDistance = 0;
    }
    if (e.touches.length === 1) {
      lastTouchPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
      isTouching = true;
    }
  });
  
  canvas.addEventListener('touchcancel', () => {
    isTouching = false;
    touchStartDistance = 0;
  });
  
  // Zoom
  canvas.addEventListener('wheel', (e) => {
    e.preventDefault();
    camera.position.z += e.deltaY * 0.5;
    camera.position.z = Math.max(200, Math.min(2000, camera.position.z));
  });
  
  // Daten vorbereiten
  nodes3d = Object.values(knotenData).map(k => ({
    id: k.id,
    name: k.name,
    achse: k.achse,
    position: k.position,
    x: (Math.random() - 0.5) * 600,
    y: (Math.random() - 0.5) * 600,
    z: (Math.random() - 0.5) * 600,
    vx: 0, vy: 0, vz: 0
  }));
  
    
  links3d = verbindungenData.map(v => ({
    source: v.von,
    target: v.zu,
    typ: v.typ,
    staerke: v.staerke,
    beschreibung: v.beschreibung
  }));
  
  // Knoten erstellen - mit Textur-Beschriftung auf der Kugel
  const achsenFarben = {
    'A': 0xE53935, 'B': 0x4CAF50, 'C': 0x2196F3, 'D': 0x9C27B0, 'E': 0xFF9800, 'F': 0x00BCD4
  };
  
  // Funktion: Textur mit Text fÃ¼r Kugel erstellen
  function createLabeledSphereTexture(name, baseColor) {
    const canvas = document.createElement('canvas');
    canvas.width = 512;
    canvas.height = 256;
    const ctx = canvas.getContext('2d');
    
    // Hintergrund mit Achsen-Farbe
    const hexColor = '#' + baseColor.toString(16).padStart(6, '0');
    ctx.fillStyle = hexColor;
    ctx.fillRect(0, 0, 512, 256);
    
    // Leichter Gradient fÃ¼r 3D-Effekt
    const gradient = ctx.createLinearGradient(0, 0, 0, 256);
    gradient.addColorStop(0, 'rgba(255,255,255,0.2)');
    gradient.addColorStop(0.5, 'rgba(255,255,255,0)');
    gradient.addColorStop(1, 'rgba(0,0,0,0.3)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, 512, 256);
    
    // Text umbrechen
    function wrapText(text, maxWidth) {
      const words = text.split(' ');
      const lines = [];
      let currentLine = '';
      words.forEach(word => {
        const testLine = currentLine ? currentLine + ' ' + word : word;
        if (ctx.measureText(testLine).width > maxWidth && currentLine) {
          lines.push(currentLine);
          currentLine = word;
        } else {
          currentLine = testLine;
        }
      });
      if (currentLine) lines.push(currentLine);
      return lines;
    }
    
    // Text-Konfiguration - kleine Schrift
    const maxWidth = 460;
    const maxLines = 3;
    let fontSize = 19;
    let lines = [];
    
    // SchriftgrÃ¶ÃŸe anpassen bis es passt
    while (fontSize >= 10) {
      ctx.font = `bold ${fontSize}px Arial`;
      lines = wrapText(name, maxWidth);
      if (lines.length <= maxLines) break;
      fontSize -= 2;
    }
    
    // Falls immer noch zu viele Zeilen, kÃ¼rzen
    if (lines.length > maxLines) {
      lines = lines.slice(0, maxLines);
      lines[maxLines - 1] = lines[maxLines - 1].slice(0, -3) + 'â€¦';
    }
    
    // Text zeichnen
    ctx.font = `bold ${fontSize}px Arial`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    
    const lineHeight = fontSize * 1.2;
    const totalHeight = lines.length * lineHeight;
    const startY = (256 - totalHeight) / 2 + lineHeight / 2;
    
    lines.forEach((line, i) => {
      const y = startY + i * lineHeight;
      // Schatten
      ctx.fillStyle = 'rgba(0,0,0,0.5)';
      ctx.fillText(line, 258, y + 2);
      // Haupttext
      ctx.fillStyle = '#ffffff';
      ctx.fillText(line, 256, y);
    });
    
    return new THREE.CanvasTexture(canvas);
  }
  
  nodes3d.forEach(node => {
    const farbe = achsenFarben[node.achse[0]] || 0xffffff;
    
    // Kugel mit Textur-Label
    const texture = createLabeledSphereTexture(node.name, farbe);
    const material = new THREE.MeshBasicMaterial({ map: texture });
    const nodeGeometry = new THREE.SphereGeometry(12, 32, 32);
    const sphere = new THREE.Mesh(nodeGeometry, material);
    sphere.position.set(node.x, node.y, node.z);
    sphere.userData = { id: node.id, name: node.name };
    scene.add(sphere);
    nodeObjects[node.id] = sphere;
  });
  
  // Verbindungen erstellen
  links3d.forEach(link => {
    const sourceNode = nodes3d.find(n => n.id === link.source);
    const targetNode = nodes3d.find(n => n.id === link.target);
    if (!sourceNode || !targetNode) return;
    
    const geometry = new THREE.BufferGeometry();
    const positions = new Float32Array([
      sourceNode.x, sourceNode.y, sourceNode.z,
      targetNode.x, targetNode.y, targetNode.z
    ]);
    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    
    let color, opacity;
    if (link.typ === 'debatte') {
      color = 0xFF9800;
      opacity = 0.6;
    } else if (link.staerke > 0.8) {
      color = 0x4CAF50;
      opacity = 0.8;
    } else {
      color = 0x555555;
      opacity = 0.3 + link.staerke * 0.4;
    }
    
    const material = new THREE.LineBasicMaterial({ 
      color: color, 
      transparent: true, 
      opacity: opacity,
      linewidth: 1 + link.staerke * 2
    });
    
    const line = new THREE.Line(geometry, material);
    line.userData = { source: link.source, target: link.target, link: link };
    scene.add(line);
    linkObjects.push(line);
  });
  
  // Raycaster
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();
  
  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
    
    if (draggedNode) {
      raycaster.setFromCamera(mouse, camera);
      const intersect = new THREE.Vector3();
      raycaster.ray.intersectPlane(dragPlane, intersect);
      if (intersect) {
        const node = nodes3d.find(n => n.id === draggedNode.userData.id);
        if (node) {
          node.x = intersect.x;
          node.y = intersect.y;
          node.z = intersect.z;
        }
      }
    } else {
      raycaster.setFromCamera(mouse, camera);
      const spheres = Object.values(nodeObjects).filter(o => o.type === 'Mesh');
      const intersects = raycaster.intersectObjects(spheres);
      
      if (intersects.length > 0) {
        const newHovered = intersects[0].object;
        if (hoveredNode !== newHovered) {
          if (hoveredNode) hoveredNode.scale.set(1, 1, 1);
          hoveredNode = newHovered;
          hoveredNode.scale.set(1.2, 1.2, 1.2);
          canvas.style.cursor = 'pointer';
        }
      } else {
        if (hoveredNode) {
          hoveredNode.scale.set(1, 1, 1);
          hoveredNode = null;
        }
        canvas.style.cursor = 'grab';
      }
    }
  });
  
  canvas.addEventListener('mousedown', (e) => {
    if (hoveredNode && e.button === 0) {
      draggedNode = hoveredNode;
      canvas.style.cursor = 'grabbing';
      const cameraDirection = new THREE.Vector3();
      camera.getWorldDirection(cameraDirection);
      dragPlane.setFromNormalAndCoplanarPoint(cameraDirection, hoveredNode.position);
    }
  });
  
  canvas.addEventListener('mouseup', (e) => {
    if (draggedNode) {
      nodes3d.forEach(n => {
        const obj = nodeObjects[n.id];
        obj.scale.set(1, 1, 1);
      });
      
      draggedNode = null;
      canvas.style.cursor = hoveredNode ? 'pointer' : 'grab';
    }
  });
  
  canvas.addEventListener('click', (e) => {
    if (hoveredNode && !draggedNode) {
      showKnoten(hoveredNode.userData.id);
    }
  });
  
  // Animation Loop
  function animate() {
    requestAnimationFrame(animate);
    
    simulate3D();
    
    scene.rotation.y += (targetRotation.y - scene.rotation.y) * 0.1;
    scene.rotation.x += (targetRotation.x - scene.rotation.x) * 0.1;
    
    nodes3d.forEach(node => {
      const sphere = nodeObjects[node.id];
      if (sphere) sphere.position.set(node.x, node.y, node.z);
    });
    
    linkObjects.forEach(line => {
      const sourceNode = nodes3d.find(n => n.id === line.userData.source);
      const targetNode = nodes3d.find(n => n.id === line.userData.target);
      if (sourceNode && targetNode) {
        const positions = line.geometry.attributes.position.array;
        positions[0] = sourceNode.x; positions[1] = sourceNode.y; positions[2] = sourceNode.z;
        positions[3] = targetNode.x; positions[4] = targetNode.y; positions[5] = targetNode.z;
        line.geometry.attributes.position.needsUpdate = true;
      }
    });
    
    renderer.render(scene, camera);
  }
  
  animate();
  
  // Loading-Text entfernen
  const loadingEl = document.getElementById('netzwerk-loading');
  if (loadingEl) loadingEl.style.display = 'none';
  
    
  window.addEventListener('resize', () => {
    let w = container.clientWidth || container.offsetWidth;
    let h = container.clientHeight || container.offsetHeight;
    if (w <= 0) w = window.innerWidth - 80;
    if (h <= 0) h = window.innerHeight - 60;
    camera.aspect = w / h;
    camera.updateProjectionMatrix();
    renderer.setSize(w, h);
  });
}

function simulate3D() {
  const alpha = 0.02;
  const repulsion = 3000;
  const attraction = 0.01;
  const centerForce = 0.001;
  
  for (let i = 0; i < nodes3d.length; i++) {
    for (let j = i + 1; j < nodes3d.length; j++) {
      const a = nodes3d[i];
      const b = nodes3d[j];
      const dx = b.x - a.x;
      const dy = b.y - a.y;
      const dz = b.z - a.z;
      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz) || 1;
      const force = repulsion / (dist * dist);
      
      const fx = (dx / dist) * force * alpha;
      const fy = (dy / dist) * force * alpha;
      const fz = (dz / dist) * force * alpha;
      
      a.vx -= fx; a.vy -= fy; a.vz -= fz;
      b.vx += fx; b.vy += fy; b.vz += fz;
    }
  }
  
  links3d.forEach(link => {
    const source = nodes3d.find(n => n.id === link.source);
    const target = nodes3d.find(n => n.id === link.target);
    if (!source || !target) return;
    
    const dx = target.x - source.x;
    const dy = target.y - source.y;
    const dz = target.z - source.z;
    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz) || 1;
    
    const targetDist = 100 - link.staerke * 50;
    const force = (dist - targetDist) * attraction * link.staerke;
    
    const fx = (dx / dist) * force;
    const fy = (dy / dist) * force;
    const fz = (dz / dist) * force;
    
    source.vx += fx; source.vy += fy; source.vz += fz;
    target.vx -= fx; target.vy -= fy; target.vz -= fz;
  });
  
  nodes3d.forEach(node => {
    node.vx -= node.x * centerForce;
    node.vy -= node.y * centerForce;
    node.vz -= node.z * centerForce;
  });
  
  nodes3d.forEach(node => {
    node.vx *= 0.9; node.vy *= 0.9; node.vz *= 0.9;
    node.x += node.vx; node.y += node.vy; node.z += node.vz;
  });
  
  if (Math.random() < 0.01) {
    const randomNode = nodes3d[Math.floor(Math.random() * nodes3d.length)];
    randomNode.vx += (Math.random() - 0.5) * 3;
    randomNode.vy += (Math.random() - 0.5) * 3;
    randomNode.vz += (Math.random() - 0.5) * 3;
  }
}

function showReaktion(idA, idB) {
  const a = knotenData[idA];
  const b = knotenData[idB];
  if (!a || !b) return;
  
  const analyse = analysiereVerbindung(idA, idB);
  const synthese = generiereSynthese(a, b, analyse);
  
  const panel = document.getElementById('detail-panel');
  panel.innerHTML = `
    <button class="close-btn" onclick="closePanel()">Ã—</button>
    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
      <h1 style="font-size: 1.2rem; color: #E53935; margin: 0;">${a.name}</h1>
      <span style="font-size: 1.5rem; color: #666;">âŸ·</span>
      <h1 style="font-size: 1.2rem; color: #E53935; margin: 0;">${b.name}</h1>
    </div>
    
    <section>
      <h2>Verbindung</h2>
      ${analyse.direkteVerbindung ? `
        <div style="background: #2a2a2a; padding: 1rem; border-radius: 4px; border-left: 3px solid ${analyse.direkteVerbindung.typ === 'debatte' ? '#FF9800' : '#4CAF50'};">
          <strong>${analyse.direkteVerbindung.typ === 'debatte' ? 'âš”ï¸ Debatte' : 'ğŸ¤ AffinitÃ¤t'}</strong>
          <p style="margin: 0.5rem 0 0 0; color: #aaa;">${analyse.direkteVerbindung.beschreibung || ''}</p>
          <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem;">StÃ¤rke: ${Math.round(analyse.direkteVerbindung.staerke * 100)}%</p>
        </div>
      ` : `
        <div style="background: #2a2a2a; padding: 1rem; border-radius: 4px; border-left: 3px solid #666;">
          <strong>Keine direkte Verbindung dokumentiert</strong>
          ${analyse.pfad ? `<p style="margin: 0.5rem 0 0 0; color: #888; font-size: 0.85rem;">
            Pfad: ${analyse.pfad.map(id => knotenData[id]?.name || id).join(' â†’ ')}
          </p>` : ''}
        </div>
      `}
    </section>
    
    ${analyse.gemeinsameNachbarn.length > 0 ? `
    <section>
      <h2>Gemeinsame Nachbarn</h2>
      <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
        ${analyse.gemeinsameNachbarn.map(n => `
          <span onclick="showReaktion('${idA}', '${n.id}')" 
                style="background: #333; padding: 0.3rem 0.6rem; border-radius: 3px; cursor: pointer; font-size: 0.85rem;">
            ${n.name}
          </span>
        `).join('')}
      </div>
    </section>
    ` : ''}
    
    <section>
      <h2>Synthese / Spannung</h2>
      <p style="line-height: 1.6;">${synthese.text}</p>
      ${synthese.frage ? `
        <div style="background: #2a2a2a; padding: 0.75rem; border-left: 3px solid #FF9800; margin-top: 1rem; font-style: italic; color: #aaa;">
          ${synthese.frage}
        </div>
      ` : ''}
    </section>
    
    <div style="margin-top: 2rem; display: flex; gap: 0.5rem;">
      <button onclick="showKnoten('${idA}')" style="flex: 1; background: #333; border: none; color: #fff; padding: 0.75rem; cursor: pointer; border-radius: 4px;">
        â†’ ${a.name}
      </button>
      <button onclick="showKnoten('${idB}')" style="flex: 1; background: #333; border: none; color: #fff; padding: 0.75rem; cursor: pointer; border-radius: 4px;">
        â†’ ${b.name}
      </button>
    </div>
  `;
  panel.classList.add('open');
}

function initListe() {
  const container = document.getElementById('liste-container');
  const grid = document.getElementById('liste-grid');
  
  // Header hinzufÃ¼gen
  const header = document.createElement('div');
  header.className = 'liste-header';
  header.innerHTML = `
    <h2>ğŸ“‹ Alle Positionen</h2>
    <p>${Object.keys(knotenData).length} StrÃ¶mungen und Konzepte des linken Denkens</p>
  `;
  container.insertBefore(header, grid);
  
  // Filter-Bar hinzufÃ¼gen
  const filterBar = document.createElement('div');
  filterBar.className = 'liste-filter-bar';
  filterBar.innerHTML = `
    <button class="liste-filter-btn active" data-filter="alle">Alle</button>
    <button class="liste-filter-btn" data-filter="A">A: Staat</button>
    <button class="liste-filter-btn" data-filter="B">B: Wirtschaft</button>
    <button class="liste-filter-btn" data-filter="C">C: Gesellschaft</button>
    <button class="liste-filter-btn" data-filter="D">D: Strategie</button>
    <button class="liste-filter-btn" data-filter="E">E: Theorie</button>
    <button class="liste-filter-btn" data-filter="F">F: Ã–kologie</button>
  `;
  container.insertBefore(filterBar, grid);
  
  // Filter-Buttons aktivieren
  filterBar.querySelectorAll('.liste-filter-btn').forEach(btn => {
    btn.onclick = () => {
      filterBar.querySelectorAll('.liste-filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      filterListeByAchse(btn.dataset.filter);
    };
  });
  
  // Verbindungen zÃ¤hlen
  const verbindungCount = {};
  verbindungenData.forEach(v => {
    verbindungCount[v.von] = (verbindungCount[v.von] || 0) + 1;
    verbindungCount[v.zu] = (verbindungCount[v.zu] || 0) + 1;
  });
  
  const sortedNodes = Object.values(knotenData).sort((a, b) => {
    if (a.achse < b.achse) return -1;
    if (a.achse > b.achse) return 1;
    return a.position - b.position;
  });
  
  sortedNodes.forEach(k => {
    const div = document.createElement('div');
    div.className = 'liste-item';
    div.dataset.achse = k.achse;
    const verbindungen = verbindungCount[k.id] || 0;
    div.innerHTML = `
      <div class="item-header">
        <div class="name">${k.name}</div>
        <span class="achse-badge">${k.achse}-${k.position}</span>
      </div>
      <p class="beschreibung">${k.beschreibung?.substring(0, 120) || ''}${k.beschreibung?.length > 120 ? 'â€¦' : ''}</p>
      <div class="item-footer">
        <span class="verbindungen">ğŸ”— ${verbindungen} Verbindungen</span>
        <span>â†’ Details</span>
      </div>
    `;
    div.onclick = () => showKnoten(k.id);
    grid.appendChild(div);
  });
}

function filterListeByAchse(filter) {
  const items = document.querySelectorAll('.liste-item');
  items.forEach(item => {
    if (filter === 'alle' || item.dataset.achse.startsWith(filter)) {
      item.style.display = 'block';
    } else {
      item.style.display = 'none';
    }
  });
}

function initDebatten() {
  const container = document.getElementById('debatten-container');
  debattenData.forEach(d => {
    const card = document.createElement('div');
    card.className = 'debatte-card';
    card.innerHTML = `
      <h2>${d.titel}</h2>
      <p class="frage">${d.frage}</p>
      <div class="debatte-seiten">
        <div class="debatte-seite a">
          <h4>ğŸ”´ ${d.seite_a.position}</h4>
          <ul>${d.seite_a.argumente.map(a => `<li>${a}</li>`).join('')}</ul>
        </div>
        <div class="debatte-seite b">
          <h4>ğŸ”µ ${d.seite_b.position}</h4>
          <ul>${d.seite_b.argumente.map(a => `<li>${a}</li>`).join('')}</ul>
        </div>
      </div>
      ${d.historisch ? `<div class="debatte-historisch"><strong>${d.historisch.wann}:</strong> ${d.historisch.anlass}<br><strong>Ausgang:</strong> ${d.historisch.ausgang}</div>` : ''}
      ${d.texte?.length ? `<div class="debatte-texte"><strong>Texte:</strong> ${d.texte.map(t => `<a href="${t.url}" target="_blank">${t.autor}</a>`).join(' Â· ')}</div>` : ''}
    `;
    container.appendChild(card);
  });
}

function showKnoten(id) {
  const k = knotenData[id];
  if (!k) return;
  
  const verbindungen = verbindungenData.filter(v => v.von === id || v.zu === id).map(v => ({
    ...v,
    ziel: v.von === id ? v.zu : v.von,
    zielName: knotenData[v.von === id ? v.zu : v.von]?.name
  }));
  
  // Helper: Namen klickbar machen
  const linkifyName = (name) => {
    const cleanName = name.replace(/\s*\(\d{4}.*?\)\s*/g, '').trim();
    return `<span class="person-link" onclick="searchPerson('${cleanName.replace(/'/g, "\\'")}')">${name}</span>`;
  };
  
  document.getElementById('detail-content').innerHTML = `
    <span class="achse-tag">${k.achse}-${k.position}</span>
    <h2>${k.name}</h2>
    <p class="beschreibung">${k.beschreibung}</p>
    ${k.zitate?.length ? `<h3>ğŸ’¬ Stimmen</h3>${k.zitate.map(z => `<div class="zitat">"${z.text}"<div class="zitat-autor">â€” <span class="person-link" onclick="searchPerson('${z.autor.replace(/'/g, "\\'")}')">${z.autor}</span>${z.quelle ? `, ${z.quelle}` : ''}${z.jahr ? ` (${z.jahr})` : ''}</div></div>`).join('')}` : ''}
    ${k.bewohner?.klassiker?.length ? `<h3>ğŸ›ï¸ Klassiker</h3><div class="bewohner">${k.bewohner.klassiker.map(b => linkifyName(b)).join('')}</div>` : ''}
    ${k.bewohner?.zeitgenossen?.length ? `<h3>ğŸ‘¤ Zeitgenossen</h3><div class="bewohner">${k.bewohner.zeitgenossen.map(b => linkifyName(b)).join('')}</div>` : ''}
    ${k.literatur?.length ? `<h3>ğŸ“š Literatur</h3>${k.literatur.map(l => `<div class="literatur-item"><div class="titel">${l.titel}${l.frei ? '<span class="frei-tag">FREI</span>' : ''}</div><div class="autor">${l.autor}${l.jahr ? ` (${l.jahr})` : ''}</div>${l.notiz ? `<div style="font-size:0.8rem;color:#aaa;margin:0.3rem 0">${l.notiz}</div>` : ''}${l.url ? `<a href="${l.url}" target="_blank">â†’ Lesen</a>` : ''}</div>`).join('')}` : ''}
    ${k.praxis?.length ? `<h3>âœŠ Praxis</h3>${k.praxis.map(p => `<div class="literatur-item"><div class="titel">${p.name}</div><div class="autor">${p.ort}, ${p.zeit}</div><div style="font-size:0.85rem;color:#aaa;margin-top:0.3rem">${p.beschreibung}</div></div>`).join('')}` : ''}
    ${verbindungen.length ? `<h3>ğŸ”— Verbindungen</h3><div class="verbindungen">${verbindungen.map(v => `<span class="verbindung ${v.staerke > 0.8 ? 'stark' : ''} ${v.typ === 'debatte' ? 'debatte' : ''}" onclick="showKnoten('${v.ziel}')" title="${v.beschreibung || ''}">${v.zielName}</span>`).join('')}</div>` : ''}
    ${k.fragen?.length ? `<h3>â“ Offene Fragen</h3><ul style="list-style:none;font-size:0.9rem;color:#aaa">${k.fragen.map(f => `<li style="margin-bottom:0.5rem">â€¢ ${f}</li>`).join('')}</ul>` : ''}
    ${k.atmosphaere ? `<h3>ğŸŒ«ï¸ AtmosphÃ¤re</h3><div class="atmosphaere"><strong>Stimmung:</strong> ${k.atmosphaere.stimmung}<br><strong>GerÃ¤usche:</strong> ${k.atmosphaere.geraeusche}<br><strong>Geruch:</strong> ${k.atmosphaere.geruch}</div>` : ''}
  `;
  document.getElementById('detail-panel').classList.add('open');
}

// Person suchen und alle ihre Positionen zeigen
function searchPerson(name) {
  // Erst in personenData suchen (reichhaltige Daten)
  const cleanName = name.replace(/\s*\(\d{4}.*?\)\s*/g, '').replace(/\s*\(\*\d{4}\)\s*/g, '').trim().toLowerCase();
  
  // Mehrere Matching-Strategien
  const personInDb = personenData.find(p => {
    const pName = p.name.toLowerCase();
    // Exakter Match
    if (pName === cleanName) return true;
    // EnthÃ¤lt (fÃ¼r Teilnamen)
    if (pName.includes(cleanName) || cleanName.includes(pName)) return true;
    // Nachname-Match (letztes Wort)
    const nachname = cleanName.split(' ').pop();
    if (nachname.length > 3 && pName.includes(nachname)) return true;
    return false;
  });
  
  if (personInDb) {
    // Person gefunden in personenData -> zeige reichhaltige Ansicht
    showPerson(personInDb.id);
    return;
  }
  
  // Fallback: Finde alle Knoten wo diese Person vorkommt
  const gefunden = [];
  Object.values(knotenData).forEach(k => {
    const alleNamen = [
      ...(k.bewohner?.klassiker || []),
      ...(k.bewohner?.zeitgenossen || []),
      ...(k.zitate?.map(z => z.autor) || [])
    ];
    if (alleNamen.some(n => n.includes(name) || name.includes(n.replace(/\s*\(\d{4}.*?\)\s*/g, '').trim()))) {
      gefunden.push(k);
    }
  });
  
  if (gefunden.length === 1) {
    showKnoten(gefunden[0].id);
  } else if (gefunden.length > 1) {
    // Zeige Auswahl
    document.getElementById('detail-content').innerHTML = `
      <h2>ğŸ” ${name}</h2>
      <p style="color: var(--text-secondary)">Diese Person findet sich in ${gefunden.length} Positionen:</p>
      <div class="verbindungen" style="margin-top: 1rem">
        ${gefunden.map(k => `<span class="verbindung" onclick="showKnoten('${k.id}')">${k.name} (${k.achse})</span>`).join('')}
      </div>
    `;
    document.getElementById('detail-panel').classList.add('open');
  } else {
    // Nicht gefunden - zeige Info
    document.getElementById('detail-content').innerHTML = `
      <h2>ğŸ‘¤ ${name}</h2>
      <p style="color: var(--text-secondary)">Noch keine detaillierten Informationen zu dieser Person.</p>
      <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">Diese Person wird in Zukunft mit Biografie, Werken und Beziehungen zu anderen Denkern ergÃ¤nzt.</p>
    `;
    document.getElementById('detail-panel').classList.add('open');
  }
}

function closePanel() {
  document.getElementById('detail-panel').classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUCHE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function globalSearch(query) {
  if (!query || query.length < 2) return;
  
  const q = query.toLowerCase();
  const results = {
    positionen: [],
    personen: [],
    zitate: [],
    stammbaum: []
  };
  
  // Positionen durchsuchen
  Object.values(knotenData).forEach(k => {
    if (k.name.toLowerCase().includes(q) || 
        k.beschreibung.toLowerCase().includes(q) ||
        (k.bewohner?.klassiker || []).some(b => b.toLowerCase().includes(q)) ||
        (k.bewohner?.zeitgenossen || []).some(b => b.toLowerCase().includes(q))) {
      results.positionen.push(k);
    }
    
    // Zitate durchsuchen
    (k.zitate || []).forEach(z => {
      if (z.text.toLowerCase().includes(q) || z.autor.toLowerCase().includes(q)) {
        results.zitate.push({ ...z, position: k });
      }
    });
  });
  
  // Stammbaum durchsuchen
  stammbaumData.stroemungen.forEach(s => {
    if (s.name.toLowerCase().includes(q) || 
        s.kernidee.toLowerCase().includes(q) ||
        (s.werke || []).some(w => w.toLowerCase().includes(q))) {
      results.stammbaum.push(s);
    }
  });
  
  // Ergebnisse anzeigen
  showSearchResults(query, results);
}

function showSearchResults(query, results) {
  const total = results.positionen.length + results.zitate.length + results.stammbaum.length;
  
  let html = `
    <h2>ğŸ” "${query}"</h2>
    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">${total} Ergebnisse</p>
  `;
  
  if (results.positionen.length) {
    html += `
      <h3>ğŸ“ Positionen (${results.positionen.length})</h3>
      <div class="verbindungen" style="margin-bottom: 1.5rem;">
        ${results.positionen.slice(0, 10).map(p => 
          `<span class="verbindung" onclick="showKnoten('${p.id}')">${p.name} <small style="opacity:0.6">(${p.achse})</small></span>`
        ).join('')}
        ${results.positionen.length > 10 ? `<span style="color:#888;font-size:0.8rem;">...und ${results.positionen.length - 10} mehr</span>` : ''}
      </div>
    `;
  }
  
  if (results.stammbaum.length) {
    html += `
      <h3>ğŸ‘¤ Denker*innen (${results.stammbaum.length})</h3>
      <div class="verbindungen" style="margin-bottom: 1.5rem;">
        ${results.stammbaum.slice(0, 10).map(s => 
          `<span class="verbindung" onclick="showStammbaumPerson('${s.id}')">${s.name} <small style="opacity:0.6">(${s.leben || ''})</small></span>`
        ).join('')}
        ${results.stammbaum.length > 10 ? `<span style="color:#888;font-size:0.8rem;">...und ${results.stammbaum.length - 10} mehr</span>` : ''}
      </div>
    `;
  }
  
  if (results.zitate.length) {
    html += `
      <h3>ğŸ’¬ Zitate (${results.zitate.length})</h3>
      <div style="margin-bottom: 1.5rem;">
        ${results.zitate.slice(0, 5).map(z => `
          <div class="zitat" style="cursor:pointer;" onclick="showKnoten('${z.position.id}')">
            "${z.text.substring(0, 100)}${z.text.length > 100 ? '...' : ''}"
            <div class="zitat-autor">â€” ${z.autor}</div>
          </div>
        `).join('')}
        ${results.zitate.length > 5 ? `<p style="color:#888;font-size:0.8rem;">...und ${results.zitate.length - 5} mehr</p>` : ''}
      </div>
    `;
  }
  
  if (total === 0) {
    html += `<p style="color: var(--text-secondary);">Keine Ergebnisse gefunden.</p>`;
  }
  
  document.getElementById('detail-content').innerHTML = html;
  document.getElementById('detail-panel').classList.add('open');
}

// Stats - wird aktualisiert wenn knotenData geladen ist
document.getElementById('stats').textContent = `Lade Daten...`;

// Init - ALLE Initialisierungen erfolgen nach dem Laden von knotenData (siehe fetch oben)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KARTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initKarte() {
  const container = document.getElementById('karte-container');
  
  const achsen = [
    { id: 'A1', name: 'Reform vs. Revolution', kategorie: 'A' },
    { id: 'A2', name: 'RevolutionÃ¤res Subjekt', kategorie: 'A' },
    { id: 'A3', name: 'Rolle des Staates', kategorie: 'A' },
    { id: 'B1', name: 'Markt vs. Plan', kategorie: 'B' },
    { id: 'B2', name: 'Eigentumsformen', kategorie: 'B' },
    { id: 'B3', name: 'Zukunft der Arbeit', kategorie: 'B' },
    { id: 'C1', name: 'Feminismus', kategorie: 'C' },
    { id: 'C2', name: 'Mensch & Natur', kategorie: 'C' },
    { id: 'C3', name: 'Internationalismus', kategorie: 'C' },
    { id: 'D1', name: 'Utopie & Pragmatismus', kategorie: 'D' },
    { id: 'D2', name: 'Transformationswege', kategorie: 'D' },
    { id: 'D3', name: 'SpiritualitÃ¤t', kategorie: 'D' },
    { id: 'E1', name: 'BÃ¼ndnispolitik', kategorie: 'E' },
    { id: 'E2', name: 'Politische Ebenen', kategorie: 'E' },
    { id: 'E3', name: 'Bildung & Kultur', kategorie: 'E' },
    { id: 'F1', name: 'Technologie', kategorie: 'F' },
    { id: 'F2', name: 'Demokratieformen', kategorie: 'F' },
    { id: 'F3', name: 'Mittel & Gewalt', kategorie: 'F' }
  ];
  
  const kategorieNamen = {
    'A': 'Staat & Transformation',
    'B': 'Wirtschaft',
    'C': 'Gesellschaft',
    'D': 'Strategie',
    'E': 'Organisation',
    'F': 'Praxis'
  };
  
  let html = `
    <div class="karte-header">
      <h2>ğŸ—ºï¸ Politische Landkarte</h2>
      <p>90 Positionen auf 18 Achsen â€” von gemÃ¤ÃŸigt bis radikal</p>
    </div>
    
    <div class="karte-legende">
      <span>â† gemÃ¤ÃŸigt</span>
      <span>1 â€” 2 â€” 3 â€” 4 â€” 5</span>
      <span>radikal â†’</span>
    </div>
    
    <div class="karte-wrapper">
  `;
  
  achsen.forEach(achse => {
    html += `<div class="karte-achse-group" data-achse="${achse.id}">`;
    html += `<div class="karte-achse-header">
      <span class="karte-achse-code">${achse.id}</span>
      <span class="karte-achse-name">${achse.name}</span>
    </div>`;
    
    html += `<div class="karte-grid">`;
    
    for (let pos = 1; pos <= 5; pos++) {
      const id = `${achse.id}-${pos}`;
      const knoten = knotenData[id];
      if (knoten) {
        html += `<div class="karte-cell filled" onclick="showKnoten('${id}')">
          <div class="name">${knoten.name}</div>
          <div class="position">${pos}</div>
        </div>`;
      } else {
        html += `<div class="karte-cell empty">
          <div class="position">${pos}</div>
        </div>`;
      }
    }
    
    html += '</div></div>';
  });
  
  html += '</div>';
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZEITLEISTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initZeitleiste() {
  const container = document.getElementById('zeitleiste-container');
  
  // Sammle alle historischen Ereignisse
  const ereignisse = [];
  
  Object.values(knotenData).forEach(k => {
    // Klassiker mit Lebensdaten
    k.bewohner?.klassiker?.forEach(person => {
      const match = person.match(/\((\d{4})-(\d{4})\)/);
      if (match) {
        const name = person.replace(/\s*\([^)]*\)/, '');
        ereignisse.push({
          jahr: parseInt(match[1]),
          typ: 'geburt',
          titel: `${name} geboren`,
          beschreibung: `Klassiker fÃ¼r: ${k.name}`,
          kontext: k.id
        });
      }
    });
    
    // Praxis-Beispiele
    k.praxis?.forEach(p => {
      const match = p.zeit.match(/(\d{4})/);
      if (match) {
        ereignisse.push({
          jahr: parseInt(match[1]),
          typ: 'praxis',
          titel: p.name,
          beschreibung: p.beschreibung,
          ort: p.ort,
          kontext: k.id
        });
      }
    });
    
    // Literatur
    k.literatur?.forEach(l => {
      if (l.jahr && l.jahr < 2000) {
        ereignisse.push({
          jahr: l.jahr,
          typ: 'text',
          titel: `"${l.titel}"`,
          beschreibung: `von ${l.autor}`,
          kontext: k.id
        });
      }
    });
  });
  
  // Sortieren nach Jahr
  ereignisse.sort((a, b) => a.jahr - b.jahr);
  
  // Duplikate entfernen (nach Titel)
  const seen = new Set();
  const unique = ereignisse.filter(e => {
    if (seen.has(e.titel)) return false;
    seen.add(e.titel);
    return true;
  });
  
  const icons = { praxis: 'âœŠ', text: 'ğŸ“–', geburt: 'ğŸ‘¤' };
  const typLabels = { praxis: 'Praxis', text: 'Werk', geburt: 'Person' };
  
  let html = `
    <div class="zeitleiste-header">
      <h2>â³ Geschichte des linken Denkens</h2>
      <p>${unique.length} Ereignisse von ${unique[0]?.jahr || '?'} bis ${unique[unique.length-1]?.jahr || '?'}</p>
    </div>
    
    <div class="zeitleiste-filter">
      <button class="zeitleiste-filter-btn active" data-filter="alle">Alle</button>
      <button class="zeitleiste-filter-btn" data-filter="praxis">âœŠ Praxis</button>
      <button class="zeitleiste-filter-btn" data-filter="text">ğŸ“– Werke</button>
      <button class="zeitleiste-filter-btn" data-filter="geburt">ğŸ‘¤ Personen</button>
    </div>
    
    <div class="zeitleiste-wrapper">
  `;
  
  let lastEpoche = '';
  
  unique.slice(0, 60).forEach(e => {
    // Epochen-Marker einfÃ¼gen
    let epoche = '';
    if (e.jahr < 1800) epoche = 'AufklÃ¤rung';
    else if (e.jahr < 1850) epoche = 'FrÃ¼hsozialismus';
    else if (e.jahr < 1890) epoche = 'Klassiker';
    else if (e.jahr < 1920) epoche = 'Zweite Internationale';
    else if (e.jahr < 1945) epoche = 'Revolutionszeit';
    else if (e.jahr < 1990) epoche = 'Nachkriegslinke';
    else epoche = 'Gegenwart';
    
    if (epoche !== lastEpoche) {
      html += `<div class="zeitleiste-epoche"><span class="zeitleiste-epoche-label">${epoche}</span></div>`;
      lastEpoche = epoche;
    }
    
    html += `
      <div class="zeitleiste-item" data-typ="${e.typ}" onclick="showKnoten('${e.kontext}')">
        <div class="zeitleiste-jahr">${e.jahr}</div>
        <div class="zeitleiste-card">
          <div class="zeitleiste-card-header">
            <span class="zeitleiste-icon">${icons[e.typ]}</span>
            <h3>${e.titel}</h3>
          </div>
          <p>${e.beschreibung}</p>
          ${e.ort ? `<p class="ort">ğŸ“ ${e.ort}</p>` : ''}
          <span class="tag ${e.typ}">${typLabels[e.typ]}</span>
        </div>
      </div>
    `;
  });
  
  html += '</div>';
  container.innerHTML = html;
  
  // Filter-Buttons aktivieren
  container.querySelectorAll('.zeitleiste-filter-btn').forEach(btn => {
    btn.onclick = () => {
      container.querySelectorAll('.zeitleiste-filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const filter = btn.dataset.filter;
      container.querySelectorAll('.zeitleiste-item').forEach(item => {
        if (filter === 'alle' || item.dataset.typ === filter) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    };
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BIBLIOTHEK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initBibliothek() {
  const container = document.getElementById('bibliothek-container');
  
  // Sammle alle Literatur
  const buecher = [];
  
  Object.values(knotenData).forEach(k => {
    k.literatur?.forEach(l => {
      buecher.push({
        ...l,
        kontext: k.name,
        kontextId: k.id
      });
    });
  });
  
  // Sortieren: Frei zuerst, dann nach Schwierigkeit
  const frei = buecher.filter(b => b.frei).sort((a, b) => (a.schwierigkeit || 3) - (b.schwierigkeit || 3));
  const nichtFrei = buecher.filter(b => !b.frei).sort((a, b) => (a.schwierigkeit || 3) - (b.schwierigkeit || 3));
  
  let html = '<div class="bibliothek-wrapper">';
  
  html += '<div class="bibliothek-section">';
  html += `<h2>ğŸ“– Frei verfÃ¼gbar (${frei.length} Texte)</h2>`;
  frei.forEach(b => {
    const sterne = 'â˜…'.repeat(b.schwierigkeit || 1) + 'â˜†'.repeat(5 - (b.schwierigkeit || 1));
    html += `
      <div class="buch-item" onclick="showKnoten('${b.kontextId}')" style="cursor: pointer;">
        <div class="buch-info">
          <div class="titel">${b.titel}</div>
          <div class="autor">${b.autor}${b.jahr ? ` (${b.jahr})` : ''}</div>
          <div class="kontext">â†’ ${b.kontext}</div>
          ${b.notiz ? `<div class="kontext" style="color: #4CAF50;">${b.notiz}</div>` : ''}
        </div>
        <div class="buch-meta">
          <div style="color: #888;">${sterne}</div>
          ${b.url ? `<a href="${b.url}" target="_blank" onclick="event.stopPropagation();">Lesen â†’</a>` : ''}
        </div>
      </div>
    `;
  });
  html += '</div>';
  
  html += '<div class="bibliothek-section">';
  html += `<h2>ğŸ“š Weitere Literatur (${nichtFrei.length} Texte)</h2>`;
  nichtFrei.forEach(b => {
    const sterne = 'â˜…'.repeat(b.schwierigkeit || 1) + 'â˜†'.repeat(5 - (b.schwierigkeit || 1));
    html += `
      <div class="buch-item" onclick="showKnoten('${b.kontextId}')" style="cursor: pointer;">
        <div class="buch-info">
          <div class="titel">${b.titel}</div>
          <div class="autor">${b.autor}${b.jahr ? ` (${b.jahr})` : ''}</div>
          <div class="kontext">â†’ ${b.kontext}</div>
        </div>
        <div class="buch-meta">
          <div style="color: #888;">${sterne}</div>
        </div>
      </div>
    `;
  });
  html += '</div>';
  
  html += '</div>';
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRAXIS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initPraxis() {
  const container = document.getElementById('praxis-container');
  
  // Sammle alle Praxis-Beispiele
  const beispiele = [];
  
  Object.values(knotenData).forEach(k => {
    k.praxis?.forEach(p => {
      beispiele.push({
        ...p,
        kontext: k.name,
        kontextId: k.id
      });
    });
  });
  
  // Sortieren nach Zeit (neueste zuerst)
  beispiele.sort((a, b) => {
    const jahrA = parseInt(a.zeit.match(/(\d{4})/)?.[1] || 0);
    const jahrB = parseInt(b.zeit.match(/(\d{4})/)?.[1] || 0);
    return jahrB - jahrA;
  });
  
  let html = '<div class="praxis-wrapper">';
  html += `<h2 style="color: #4CAF50; margin-bottom: 1.5rem;">âœŠ ${beispiele.length} Praxis-Beispiele</h2>`;
  html += '<div class="praxis-grid">';
  
  beispiele.forEach(p => {
    html += `
      <div class="praxis-card" onclick="showKnoten('${p.kontextId}')" style="cursor: pointer;">
        <h3>${p.name}</h3>
        <div class="meta">${p.ort} Â· ${p.zeit}</div>
        <div class="beschreibung">${p.beschreibung}</div>
        <div class="kontext">â†’ ${p.kontext}</div>
      </div>
    `;
  });
  
  html += '</div></div>';
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FRAGEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initFragen() {
  const container = document.getElementById('fragen-container');
  
  // Sammle alle Fragen
  const fragen = [];
  
  Object.values(knotenData).forEach(k => {
    k.fragen?.forEach(f => {
      fragen.push({
        frage: f,
        kontext: k.name,
        kontextId: k.id
      });
    });
  });
  
  // ZufÃ¤llig mischen
  fragen.sort(() => Math.random() - 0.5);
  
  let html = '<div class="fragen-wrapper">';
  html += `<h2 style="color: #FF9800; margin-bottom: 1.5rem;">â“ ${fragen.length} offene Fragen</h2>`;
  html += '<p style="color: #888; margin-bottom: 1.5rem;">Fragen, auf die das linke Denken noch keine endgÃ¼ltigen Antworten hat...</p>';
  
  fragen.forEach(f => {
    html += `
      <div class="frage-item" onclick="showKnoten('${f.kontextId}')">
        <div class="frage">${f.frage}</div>
        <div class="kontext">gestellt in: ${f.kontext}</div>
      </div>
    `;
  });
  
  html += '</div>';
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZUFALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initZufall() {
  // Nur Container vorbereiten, KEIN automatisches Popup mehr
  // showRandomKnoten wird nur noch manuell via Button aufgerufen
}

// PrÃ¼ft ob Mobile
function isMobile() {
  return window.innerWidth <= 600;
}

function zeigeZufall() {
  // WÃ¤hle zufÃ¤lligen Knoten
  const ids = Object.keys(knotenData);
  const randomId = ids[Math.floor(Math.random() * ids.length)];
  
  if (isMobile()) {
    // MOBILE: Nur Info-Panel wechseln, Ansicht bleibt
    showKnoten(randomId);
  } else {
    // DESKTOP: Ansicht + Info-Panel wechseln
    const ansichten = ['netzwerk', 'liste', 'chemie', 'stammbaum', 'oekosystem', 'karte', 'zeitleiste'];
    const zufallsAnsicht = ansichten[Math.floor(Math.random() * ansichten.length)];
    
    setAnsicht(zufallsAnsicht);
    
    setTimeout(() => {
      showKnoten(randomId);
      
      // Spezielle Aktionen je nach Ansicht
      if (zufallsAnsicht === 'netzwerk' && nodeObjects[randomId]) {
        const node = nodeObjects[randomId];
        const targetPos = node.position.clone();
        animateCameraTo(targetPos);
      }
    }, 200);
  }
}

function animateCameraTo(targetPos) {
  if (!camera) return;
  
  const startPos = camera.position.clone();
  const endPos = targetPos.clone();
  endPos.z += 200; // Etwas Abstand
  
  let progress = 0;
  const duration = 1000;
  const startTime = Date.now();
  
  function animate() {
    progress = Math.min(1, (Date.now() - startTime) / duration);
    const eased = 1 - Math.pow(1 - progress, 3); // Ease out
    
    camera.position.x = startPos.x + (endPos.x - startPos.x) * eased;
    camera.position.y = startPos.y + (endPos.y - startPos.y) * eased;
    camera.position.z = startPos.z + (endPos.z - startPos.z) * eased;
    
    if (progress < 1) {
      requestAnimationFrame(animate);
    }
  }
  
  animate();
}

function showRandomKnoten() {
  const container = document.getElementById('zufall-container');
  const ids = Object.keys(knotenData);
  const randomId = ids[Math.floor(Math.random() * ids.length)];
  const k = knotenData[randomId];
  
  const zitat = k.zitate?.[0];
  
  let html = `
    <div class="zufall-card">
      <button class="zufall-close" onclick="closeZufall()">Ã—</button>
      <div class="achse">${k.achse}-${k.position}</div>
      <h2>${k.name}</h2>
      <p class="beschreibung">${k.beschreibung}</p>
      ${zitat ? `
        <div class="zitat">
          "${zitat.text}"
          <div style="font-size: 0.8rem; color: #888; margin-top: 0.5rem; font-style: normal;">â€” ${zitat.autor}</div>
        </div>
      ` : ''}
      <button class="zufall-btn" onclick="showRandomKnoten()">ğŸ² NÃ¤chster Zufall</button>
      <button class="zufall-btn secondary" onclick="showKnoten('${k.id}')">Details â†’</button>
    </div>
  `;
  
  container.innerHTML = html;
}

// SchlieÃŸt das Zufall-Fenster und kehrt zur vorherigen Ansicht zurÃ¼ck
function closeZufall() {
  const container = document.getElementById('zufall-container');
  container.innerHTML = '';
  // ZurÃ¼ck zur letzten Ansicht oder Default
  if (aktiveAnsicht === 'zufall' || !aktiveAnsicht) {
    setAnsicht('wesen');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MEIN KOSMOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let userVektor = {};

function initKosmos() {
  const container = document.getElementById('kosmos-container');
  
  const achsen = [
    { id: 'A1', name: 'Reform/Revolution', links: 'Reform', rechts: 'Revolution' },
    { id: 'A2', name: 'Subjekt', links: 'Industrieproletariat', rechts: 'Prozesssubjekt' },
    { id: 'A3', name: 'Staat', links: 'Etatismus', rechts: 'Anarchismus' },
    { id: 'B1', name: 'Markt/Plan', links: 'Markt', rechts: 'Zentralplan' },
    { id: 'B2', name: 'Besitz', links: 'Verstaatlichung', rechts: 'Selbstverwaltung' },
    { id: 'B3', name: 'Arbeit', links: 'VollbeschÃ¤ftigung', rechts: 'Post-Work' },
    { id: 'C1', name: 'Feminismus', links: 'Klassenprimat', rechts: 'Radikalfeminismus' },
    { id: 'C2', name: 'Natur', links: 'Produktivismus', rechts: 'Naturrechte' },
    { id: 'C3', name: 'International', links: 'National', rechts: 'Global' },
    { id: 'D2', name: 'Transformation', links: 'Reform', rechts: 'Revolution' },
    { id: 'E2', name: 'Ebenen', links: 'Zentralismus', rechts: 'Basisdemokratie' }
  ];
  
  let html = '<div class="kosmos-wrapper">';
  html += `
    <div class="kosmos-intro">
      <h2>ğŸ§­ Wo stehst du?</h2>
      <p>Bewege die Regler, um deine Position zu finden. Dann zeigen wir dir deine Nachbarn.</p>
    </div>
  `;
  
  achsen.forEach(a => {
    userVektor[a.id] = 3; // Default: Mitte
    html += `
      <div class="kosmos-slider-group">
        <label>
          <span>${a.name}</span>
          <span class="achse-name">${a.id}</span>
        </label>
        <input type="range" min="1" max="5" value="3" id="slider-${a.id}" oninput="updateKosmos()">
        <div class="labels">
          <span>${a.links}</span>
          <span>${a.rechts}</span>
        </div>
      </div>
    `;
  });
  
  html += '<div id="kosmos-result" class="kosmos-result" style="display: none;"></div>';
  html += '</div>';
  
  container.innerHTML = html;
}

function updateKosmos() {
  // Lese alle Slider-Werte
  Object.keys(userVektor).forEach(id => {
    const slider = document.getElementById(`slider-${id}`);
    if (slider) userVektor[id] = parseInt(slider.value);
  });
  
  // Berechne Distanz zu allen Knoten
  const distanzen = [];
  
  Object.values(knotenData).forEach(k => {
    const achse = k.achse;
    if (userVektor[achse] !== undefined) {
      const distanz = Math.abs(userVektor[achse] - k.position);
      distanzen.push({
        id: k.id,
        name: k.name,
        distanz: distanz,
        achse: achse
      });
    }
  });
  
  // Sortieren nach Distanz
  distanzen.sort((a, b) => a.distanz - b.distanz);
  
  // Zeige Ergebnis
  const resultDiv = document.getElementById('kosmos-result');
  resultDiv.style.display = 'block';
  
  const nahe = distanzen.filter(d => d.distanz === 0);
  const nah = distanzen.filter(d => d.distanz === 1);
  const mittel = distanzen.filter(d => d.distanz === 2);
  
  let html = '<h3>Deine Position im Haus</h3>';
  
  if (nahe.length) {
    html += '<p style="color: #4CAF50; margin: 0.5rem 0;">ğŸ¯ Genau hier stehst du:</p>';
    html += '<div class="kosmos-nachbarn">';
    nahe.forEach(d => {
      html += `<span class="kosmos-nachbar" onclick="showKnoten('${d.id}')" style="background: #4CAF50; color: #fff;">${d.name}</span>`;
    });
    html += '</div>';
  }
  
  if (nah.length) {
    html += '<p style="color: #aaa; margin: 1rem 0 0.5rem;">ğŸ“ Direkte Nachbarn:</p>';
    html += '<div class="kosmos-nachbarn">';
    nah.slice(0, 10).forEach(d => {
      html += `<span class="kosmos-nachbar" onclick="showKnoten('${d.id}')">${d.name}</span>`;
    });
    html += '</div>';
  }
  
  if (mittel.length) {
    html += '<p style="color: #666; margin: 1rem 0 0.5rem;">ğŸ”­ In Sichtweite:</p>';
    html += '<div class="kosmos-nachbarn">';
    mittel.slice(0, 8).forEach(d => {
      html += `<span class="kosmos-nachbar" onclick="showKnoten('${d.id}')" style="opacity: 0.7;">${d.name}</span>`;
    });
    html += '</div>';
  }
  
  resultDiv.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WG: Das Haus als bewohnter Raum
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initWG() {
  const container = document.getElementById('wg-container');
  
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SPANNUNGSFELDER: Welche Achsen erzeugen interessante Debatten?
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  window.spannungsFelder = {
    A1: {
      name: "Reform vs. Revolution",
      fragen: [
        "Kann man den Kapitalismus von innen Ã¼berwinden, oder braucht es einen Bruch?",
        "Sind Wahlen ein Weg zur Transformation oder eine Sackgasse?",
        "Wie viel Kompromiss vertrÃ¤gt radikale Politik?"
      ]
    },
    A2: {
      name: "Wer ist das revolutionÃ¤re Subjekt?",
      fragen: [
        "Ist die Arbeiterklasse noch der Motor der VerÃ¤nderung?",
        "KÃ¶nnen verschiedene KÃ¤mpfe vereint werden, ohne ihre Eigenheit zu verlieren?",
        "Wer spricht fÃ¼r wen â€“ und wer sollte schweigen?"
      ]
    },
    A3: {
      name: "Staat: Werkzeug oder Feind?",
      fragen: [
        "Kann der Staat ein Instrument der Befreiung sein?",
        "Wie verhindert man, dass Revolution in neue Herrschaft umschlÃ¤gt?",
        "Brauchen wir Institutionen oder Autonomie?"
      ]
    },
    B1: {
      name: "Markt oder Plan?",
      fragen: [
        "Wer entscheidet, was produziert wird â€“ und wie?",
        "Kann demokratische Planung funktionieren ohne BÃ¼rokratie?",
        "Gibt es einen Sozialismus mit Markt?"
      ]
    },
    B2: {
      name: "Eigentum neu denken",
      fragen: [
        "Was gehÃ¶rt allen â€“ und wie verwalten wir es?",
        "Staatseigentum oder Commons: Was ist sozialistischer?",
        "Kann Eigentum Ã¼berhaupt abgeschafft werden?"
      ]
    },
    B3: {
      name: "Zukunft der Arbeit",
      fragen: [
        "Weniger arbeiten oder besser arbeiten?",
        "Ist eine Welt ohne Lohnarbeit mÃ¶glich?",
        "Wer macht die Drecksarbeit in der Utopie?"
      ]
    },
    C1: {
      name: "Feminismus & Klasse",
      fragen: [
        "Ist Patriarchat ein Nebenwiderspruch?",
        "KÃ¶nnen MÃ¤nner Feministen sein â€“ und was bedeutet das?",
        "Was kommt zuerst: Klassenkampf oder Geschlechterkampf?"
      ]
    },
    C2: {
      name: "Ã–kologie & Sozialismus",
      fragen: [
        "Kann es grÃ¼nes Wachstum geben â€“ oder brauchen wir Degrowth?",
        "Wie verteilen wir die Kosten der Ã¶kologischen Transformation gerecht?",
        "Haben Tiere und Natur eigene Rechte?"
      ]
    },
    C3: {
      name: "Internationalismus",
      fragen: [
        "Sozialismus in einem Land â€“ oder weltweit oder gar nicht?",
        "Wie solidarisch kÃ¶nnen wir sein ohne Grenzen aufzulÃ¶sen?",
        "Was schulden wir dem Globalen SÃ¼den?"
      ]
    },
    D1: {
      name: "Utopie: Ja oder Nein?",
      fragen: [
        "Brauchen wir ein Bild vom Ziel â€“ oder ist das gefÃ¤hrlich?",
        "Wie konkret darf Utopie sein?",
        "Ist der Weg das Ziel â€“ oder gibt es ein Ankommen?"
      ]
    },
    D2: {
      name: "Transformation: Wie radikal?",
      fragen: [
        "Kann man die Welt langsam Ã¤ndern â€“ oder braucht es einen Bruch?",
        "Sind Reformen Etappen oder Ablenkung?",
        "Wie viel Gewalt vertrÃ¤gt die Revolution?"
      ]
    },
    D3: {
      name: "SpiritualitÃ¤t & Politik",
      fragen: [
        "Hat Sozialismus eine spirituelle Dimension?",
        "KÃ¶nnen religiÃ¶se Menschen gute Sozialist*innen sein?",
        "Braucht Widerstand innere Transformation?"
      ]
    },
    E1: {
      name: "BÃ¼ndnispolitik",
      fragen: [
        "Mit wem kÃ¶nnen wir BÃ¼ndnisse eingehen â€“ und mit wem nicht?",
        "VerwÃ¤ssern breite BÃ¼ndnisse unsere Ziele?",
        "Wie umgehen mit Liberalen, die sich links fÃ¼hlen?"
      ]
    },
    E2: {
      name: "Politische Ebenen",
      fragen: [
        "Lokal handeln oder zentral organisieren?",
        "Kann man Kommune und Weltrevolution zusammendenken?",
        "Wer koordiniert den Widerstand?"
      ]
    },
    E3: {
      name: "Bildung & Bewusstsein",
      fragen: [
        "Kann man Menschen zum Sozialismus erziehen?",
        "Theorie oder Praxis: Was kommt zuerst?",
        "Wie lernen wir aus vergangenen Fehlern?"
      ]
    },
    E4: {
      name: "Mittel & Gewalt",
      fragen: [
        "Heiligt der Zweck die Mittel?",
        "Ist Gewalt gegen Sachen auch Gewalt?",
        "Wie radikal darf Widerstand sein?"
      ]
    }
  };
  
  // WG-Namen fÃ¼r zufÃ¤llige Zuweisung
  window.wgNamen = [
    { name: "Rote Flora", icon: "ğŸŒº" },
    { name: "Barrikade", icon: "ğŸš§" },
    { name: "Treibhaus", icon: "ğŸŒ±" },
    { name: "Salon Rosa", icon: "ğŸŒ¹" },
    { name: "Freiraum", icon: "ğŸ´" },
    { name: "Kollektiv", icon: "âš™ï¸" },
    { name: "Utopia", icon: "âœ¨" },
    { name: "Commune", icon: "ğŸ¤" }
  ];
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // HAUS-STRUKTUR (fÃ¼r Funktional-Modus)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  window.hausStruktur = [
    {
      name: "Dachgeschoss",
      icon: "ğŸ”ï¸",
      untertitel: "Visionen & TrÃ¤ume",
      beschreibung: "Hier wird getrÃ¤umt, in die Ferne geschaut, das UnmÃ¶gliche gedacht.",
      zimmer: [
        { achse: "D1", name: "Utopie-Zimmer", beschreibung: "Wie soll die Welt aussehen?", einbringen: "Entwickle konkrete Zukunftsbilder und teile sie mit anderen." },
        { achse: "D2", name: "Transformations-Labor", beschreibung: "Wie kommen wir dahin?", einbringen: "Experimentiere mit neuen Wegen des Wandels." },
        { achse: "D3", name: "Sinn-Raum", beschreibung: "Was trÃ¤gt uns?", einbringen: "Erkunde die spirituellen und emotionalen Dimensionen." }
      ]
    },
    {
      name: "Erster Stock",
      icon: "ğŸ›ï¸",
      untertitel: "Strategie & Subjekt",
      beschreibung: "Hier wird geplant, debattiert, organisiert.",
      zimmer: [
        { achse: "A1", name: "Taktik-BÃ¼ro", beschreibung: "Reform oder Revolution?", einbringen: "Diskutiere Strategien und entwickle AktionsplÃ¤ne." },
        { achse: "A2", name: "Subjekt-Werkstatt", beschreibung: "Wer macht die VerÃ¤nderung?", einbringen: "Vernetze verschiedene Gruppen und Bewegungen." },
        { achse: "A3", name: "Staatstheorie-Bibliothek", beschreibung: "Was tun mit dem Staat?", einbringen: "Analysiere Machtstrukturen und entwickle Alternativen." },
        { achse: "A4", name: "Orga-Zentrale", beschreibung: "Wie organisieren wir uns?", einbringen: "Baue demokratische Strukturen auf und verbessere sie." }
      ]
    },
    {
      name: "Erdgeschoss",
      icon: "ğŸ­",
      untertitel: "Ã–konomie & Arbeit",
      beschreibung: "Hier wird produziert, verteilt, gestritten ums Materielle.",
      zimmer: [
        { achse: "B1", name: "Plan-KÃ¼che", beschreibung: "Markt oder Plan?", einbringen: "Entwickle konkrete Wirtschaftsmodelle und teste sie." },
        { achse: "B2", name: "Eigentums-Kammer", beschreibung: "Wem gehÃ¶rt was?", einbringen: "Erforsche und erprobe neue Eigentumsformen." },
        { achse: "B3", name: "Arbeits-Werkstatt", beschreibung: "Wie wollen wir arbeiten?", einbringen: "KÃ¤mpfe fÃ¼r bessere Arbeitsbedingungen oder weniger Arbeit." }
      ]
    },
    {
      name: "Souterrain",
      icon: "ğŸŒ",
      untertitel: "Gesellschaft & Welt",
      beschreibung: "Hier werden die Fundamente gelegt, die Verbindungen geknÃ¼pft.",
      zimmer: [
        { achse: "C1", name: "Feminismus-Salon", beschreibung: "Geschlecht und Klasse?", einbringen: "Verbinde verschiedene KÃ¤mpfe und Perspektiven." },
        { achse: "C2", name: "Natur-GewÃ¤chshaus", beschreibung: "Mensch und Natur?", einbringen: "Entwickle Ã¶kosozialistische Praxis." },
        { achse: "C3", name: "Internationalismus-Karte", beschreibung: "Lokal oder global?", einbringen: "KnÃ¼pfe internationale Verbindungen." }
      ]
    },
    {
      name: "Keller",
      icon: "ğŸ”§",
      untertitel: "Praxis & Mittel",
      beschreibung: "Hier wird es konkret. Hier passiert es.",
      zimmer: [
        { achse: "E1", name: "BÃ¼ndnis-Schmiede", beschreibung: "Mit wem zusammen?", einbringen: "Baue BrÃ¼cken zwischen Bewegungen und Gruppen." },
        { achse: "E2", name: "Ebenen-Zentrale", beschreibung: "Auf welcher Ebene kÃ¤mpfen?", einbringen: "Koordiniere lokale, regionale und nationale Arbeit." },
        { achse: "E3", name: "Bildungs-Keller", beschreibung: "Wie lernen wir?", einbringen: "Organisiere Workshops, Lesekreise, Bildungsarbeit." },
        { achse: "E4", name: "Aktions-Kammer", beschreibung: "Welche Mittel?", einbringen: "Plane und fÃ¼hre Aktionen durch." }
      ]
    }
  ];
  
  // Achsen-Metadaten
  window.achsenMeta = {
    A1: { pole: ["Reform", "Strukturref.", "Doppelstrat.", "Hegemonie", "Revolution"] },
    A2: { pole: ["Arbeiter", "Lohnabh.", "Multitude", "Intersekt.", "Alles Leben"] },
    A3: { pole: ["Erobern", "Umbauen", "Terrain", "Ignorieren", "Abschaffen"] },
    A4: { pole: ["Zentralist.", "Partei", "Bewegung", "Netzwerk", "Basisdem."] },
    B1: { pole: ["Markt", "Reguliert", "Mischung", "Dem.Plan", "Vollplanung"] },
    B2: { pole: ["Staatsbesitz", "Ã–ffentlich", "Gemischt", "Genossen.", "Commons"] },
    B3: { pole: ["Vollbesch.", "Gute Arbeit", "Reduktion", "BGE", "Post-Work"] },
    C1: { pole: ["Klasse erst", "Sozial.", "Dual", "Intersekt.", "Radikal"] },
    C2: { pole: ["Produktiv.", "GrÃ¼n", "Nachhaltig", "Ã–kosoz.", "Naturrechte"] },
    C3: { pole: ["National", "SolidaritÃ¤t", "Kooperation", "Global", "No Border"] },
    D1: { pole: ["Anti", "Negativ", "Prozess", "Real-Utop.", "Konkret"] },
    D2: { pole: ["Graduell", "Interstit.", "Symbiotisch", "Rupturell", "Revolution"] },
    D3: { pole: ["SÃ¤kular", "Offen", "Ã–kumenisch", "Spirituell", "Mystisch"] },
    E1: { pole: ["Klassenlinie", "Kern", "Breite", "Bewegungen", "Alle"] },
    E2: { pole: ["Zentral", "FÃ¶deral", "Mehrebenen", "Kommunal", "Basisdem."] },
    E3: { pole: ["AufklÃ¤rung", "Theorie", "Praxis", "Erfahrung", "PrÃ¤figur."] },
    E4: { pole: ["Strikt legal", "Zivil", "Aktionen", "Militant", "Alle Mittel"] }
  };
  
  // Initial rendern
  renderHaus('erkunden');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HAUPT-RENDER: Zwei Modi
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderHaus(modus) {
  const container = document.getElementById('wg-container');
  const profil = generatorProfil || konfigAuswahl || {};
  const archetyp = generatorArchetyp || null;
  
  let html = '';
  
  // Header mit 3 Tabs
  html += `
    <div class="haus-header">
      <h2>ğŸ  Das Haus des linken Denkens</h2>
      <div class="haus-tabs">
        <button class="haus-tab ${modus === 'erkunden' ? 'active' : ''}" onclick="renderHaus('erkunden')">ğŸšª Erkunden</button>
        <button class="haus-tab ${modus === 'profil' ? 'active' : ''}" onclick="renderHaus('profil')">ğŸ¯ Mein Profil</button>
        <button class="haus-tab ${modus === 'wg' ? 'active' : ''}" onclick="renderHaus('wg')">ğŸ“º Talkshow</button>
      </div>
    </div>
  `;
  
  // Inhalt je nach Modus
  if (modus === 'erkunden' || modus === 'funktional') {
    html += renderErkundenModus(profil);
  } else if (modus === 'profil' || modus === 'definition') {
    html += renderMeinProfilModus(profil, archetyp);
  } else if (modus === 'wg') {
    html += renderWGModus(archetyp);
  }
  
  container.innerHTML = html;
  
  // Nach dem Rendern: Drag & Drop initialisieren wenn Profil-Tab
  if (modus === 'profil' || modus === 'definition') {
    initDefinitionDragDrop();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ERKUNDEN-MODUS: Das Haus durchstÃ¶bern (ohne persÃ¶nliches Profil nÃ¶tig)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderErkundenModus(profil) {
  const hatProfil = Object.keys(profil).length > 0;
  
  let html = '';
  
  html += `
    <div class="haus-banner funktional">
      <span class="banner-icon">ğŸšª</span>
      <div class="banner-text">
        <strong>Erkunde das Haus des linken Denkens</strong>
        <span>Klicke auf ein Zimmer, um die verschiedenen Positionen zu entdecken.${hatProfil ? ' Deine Positionen leuchten rot.' : ''}</span>
      </div>
    </div>
    <div class="haus-gebaeude">
  `;
  
  window.hausStruktur.forEach(etage => {
    const hatAktive = etage.zimmer.some(z => profil[z.achse] !== undefined);
    
    html += `
      <div class="haus-etage ${hatAktive ? 'aktiv' : ''}">
        <div class="etage-header">
          <span class="etage-icon">${etage.icon}</span>
          <div class="etage-info">
            <h3>${etage.name}</h3>
            <span class="etage-untertitel">${etage.untertitel}</span>
          </div>
        </div>
        <div class="etage-zimmer">
    `;
    
    etage.zimmer.forEach(zimmer => {
      const achse = zimmer.achse;
      const meinePos = profil[achse];
      const meta = window.achsenMeta[achse] || { pole: ['1','2','3','4','5'] };
      
      html += `
        <div class="haus-zimmer ${meinePos ? 'meine-position' : ''}" data-achse="${achse}" onclick="zeigeZimmerDetail('${achse}')">
          <div class="zimmer-kopf">
            <span class="zimmer-achse">${achse}</span>
            <span class="zimmer-name">${zimmer.name}</span>
          </div>
          <div class="zimmer-spektrum">
            ${[1,2,3,4,5].map(pos => {
              const knotenId = `${achse}-${pos}`;
              const istMeins = meinePos === pos;
              return `
                <div class="spektrum-pos ${istMeins ? 'meine' : ''}" 
                     onclick="event.stopPropagation(); showKnoten('${knotenId}')"
                     title="${meta.pole[pos-1]}">
                  <span class="pos-zahl">${pos}</span>
                  ${istMeins ? '<span class="pos-du">â—</span>' : ''}
                </div>
              `;
            }).join('')}
          </div>
          <div class="zimmer-pole">
            <span>${meta.pole[0]}</span>
            <span>${meta.pole[4]}</span>
          </div>
        </div>
      `;
    });
    
    html += `
        </div>
      </div>
    `;
  });
  
  html += `</div>`;
  return html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WG-MODUS: ZufÃ¤llige WGs mit Archetypen
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderWGModus(userArchetyp) {
  const archetypen = window.archetypen;
  
  // Alle Archetyp-IDs
  const alleArchetypen = Object.keys(archetypen);
  
  // Mische und wÃ¤hle 4 GÃ¤ste
  const gemischt = [...alleArchetypen].sort(() => Math.random() - 0.5);
  const gaeste = gemischt.slice(0, 4);
  
  // Falls User-Archetyp dabei ist, entfernen (User ist separater 5. Gast)
  if (userArchetyp && gaeste.includes(userArchetyp)) {
    const idx = gaeste.indexOf(userArchetyp);
    gaeste[idx] = gemischt.find(a => !gaeste.includes(a) && a !== userArchetyp);
  }
  
  // Global speichern
  window.aktuelleGaeste = gaeste;
  window.userArchetyp = userArchetyp;
  
  // User-Archetyp Info
  const userArchetypInfo = userArchetyp ? archetypen[userArchetyp] : null;
  
  let html = '';
  
  // Header
  html += `
    <div class="talkshow-header">
      <div class="talkshow-logo">ğŸ“º</div>
      <div class="talkshow-titel">
        <h2>Talkshow-Generator</h2>
        <p>Vier StrÃ¶mungen, eine Debatte, offene Fragen</p>
      </div>
      <button class="talkshow-neu-btn" onclick="renderHaus('wg')">ğŸ² Neue GÃ¤ste</button>
    </div>
  `;
  
  // GÃ¤ste-Vorstellung
  html += `
    <div class="talkshow-gaeste">
      <div class="gaeste-label">ğŸ¤ Heute zu Gast:</div>
      <div class="gaeste-reihe">
        ${gaeste.map(id => {
          const g = archetypen[id];
          return `
            <div class="gast-karte" style="--accent: ${g.farbe}">
              <div class="gast-icon">${g.icon}</div>
              <div class="gast-name">${g.name}</div>
              <div class="gast-slogan">"${g.slogan}"</div>
            </div>
          `;
        }).join('')}
      </div>
    </div>
  `;
  
  // User-Einschaltung (Teaser)
  if (userArchetypInfo) {
    html += `
      <div class="talkshow-user">
        <div class="user-badge" style="--accent: ${userArchetypInfo.farbe}">
          <span class="user-icon">${userArchetypInfo.icon}</span>
          <div class="user-info">
            <span class="user-label">Du als:</span>
            <span class="user-name">${userArchetypInfo.name}</span>
          </div>
        </div>
        <div class="user-einschalten">
          <span class="einschalten-teaser">ğŸ“ Einschalten?</span>
          <a href="mailto:info@das-linke-wesen.de?subject=Talkshow-Einschaltung&body=Ich mÃ¶chte mich als ${encodeURIComponent(userArchetypInfo.name)} in die Talkshow einschalten!" class="einschalten-btn">
            Schreib uns!
          </a>
        </div>
      </div>
    `;
  } else {
    html += `
      <div class="talkshow-user kein-archetyp">
        <span>ğŸ­</span>
        <p>Mach den <strong>Generator</strong>, um deinen Archetyp zu finden und dich spÃ¤ter einzuschalten!</p>
      </div>
    `;
  }
  
  // Debatte starten Button
  html += `
    <div class="talkshow-start">
      <button class="debatte-starten-btn" onclick="zeigeTalkshow()">
        ğŸ¬ Debatte starten
      </button>
    </div>
  `;
  
  // Zukunfts-Teaser
  html += `
    <div class="talkshow-zukunft">
      <span>ğŸ”œ</span>
      <div>
        <strong>Bald: Social(ist) Media Network</strong>
        <p>Echte Menschen Ã¼bernehmen die Rollen. Live-Debatten. Du mittendrin.</p>
      </div>
    </div>
  `;
  
  return html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZIMMER-DETAIL Popup
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function zeigeZimmerDetail(achse) {
  const zimmer = window.hausStruktur
    .flatMap(e => e.zimmer)
    .find(z => z.achse === achse);
  
  if (!zimmer) return;
  
  const profil = generatorProfil || konfigAuswahl || {};
  const meinePos = profil[achse];
  const meta = window.achsenMeta[achse];
  
  let posText = '';
  let positionDetails = '';
  
  if (meinePos) {
    const knotenId = `${achse}-${meinePos}`;
    const knoten = knotenData[knotenId];
    
    posText = `
      <div class="zimmer-meine-pos">
        <div class="pos-header">
          <span class="pos-label">Deine Position:</span>
          <span class="pos-nummer">${meinePos}</span>
          <span class="pos-name">${knoten?.name || meta?.pole[meinePos-1] || ''}</span>
        </div>
      </div>
    `;
    
    if (knoten) {
      // Zeige Details zur spezifischen Position
      positionDetails = `
        <div class="position-details">
          <p class="position-beschreibung">${knoten.beschreibung || ''}</p>
          
          ${knoten.zitate?.length ? `
            <div class="position-zitat">
              <span class="zitat-icon">ğŸ’¬</span>
              <blockquote>"${knoten.zitate[0].text}"</blockquote>
              <cite>â€” ${knoten.zitate[0].autor}</cite>
            </div>
          ` : ''}
          
          ${knoten.bewohner?.klassiker?.length || knoten.bewohner?.zeitgenossen?.length ? `
            <div class="position-bewohner">
              <span class="bewohner-label">Hier denken auch:</span>
              <span class="bewohner-namen">${[...(knoten.bewohner?.klassiker || []), ...(knoten.bewohner?.zeitgenossen || [])].slice(0, 3).join(', ')}</span>
            </div>
          ` : ''}
          
          <button class="position-mehr-btn" onclick="event.stopPropagation(); this.closest('.zimmer-detail-overlay').remove(); showKnoten('${knotenId}');">
            ğŸ“– Mehr erfahren
          </button>
        </div>
      `;
    }
  }
  
  // Alle 5 Positionen des Zimmers zeigen
  const spektrumHtml = `
    <div class="zimmer-spektrum-detail">
      <div class="spektrum-label-links">${meta?.pole[0] || '1'}</div>
      <div class="spektrum-positionen">
        ${[1,2,3,4,5].map(pos => {
          const knotenId = `${achse}-${pos}`;
          const knoten = knotenData[knotenId];
          const istMeins = meinePos === pos;
          return `
            <div class="spektrum-pos-detail ${istMeins ? 'meine' : ''}" 
                 onclick="event.stopPropagation(); document.querySelector('.zimmer-detail-overlay').remove(); showKnoten('${knotenId}');"
                 title="${knoten?.name || pos}">
              <span class="pos-num">${pos}</span>
              <span class="pos-title">${knoten?.name || ''}</span>
              ${istMeins ? '<span class="pos-marker">â—</span>' : ''}
            </div>
          `;
        }).join('')}
      </div>
      <div class="spektrum-label-rechts">${meta?.pole[4] || '5'}</div>
    </div>
  `;
  
  const html = `
    <div class="zimmer-detail-overlay" onclick="this.remove()">
      <div class="zimmer-detail-popup" onclick="event.stopPropagation()">
        <button class="zimmer-detail-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
        <h3>${zimmer.achse} â€” ${zimmer.name}</h3>
        <p class="zimmer-frage">${zimmer.beschreibung}</p>
        
        ${spektrumHtml}
        
        ${posText}
        ${positionDetails}
        
        <div class="zimmer-einbringen">
          <h4>ğŸ’¡ Wie du dich einbringen kannst:</h4>
          <p>${zimmer.einbringen}</p>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', html);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MEIN SOZIALISMUS - PersÃ¶nliche Definition
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Globaler State fÃ¼r die Definition
let meineSozialismusDefinition = {
  kern: [],      // Unverzichtbar
  wichtig: [],   // GehÃ¶rt dazu
  relevant: [],  // Spielt eine Rolle
  eigeneTexte: {}, // Eigene Formulierungen pro Position
  freitext: ''   // Direkter Text
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MEIN PROFIL MODUS: Kombiniert Konfigurator + Empfehlungen + Definition
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderMeinProfilModus(profil, archetyp) {
  const hatProfil = Object.keys(profil).length > 0;
  const achsenMeta = window.achsenMeta;
  
  let html = `<div class="mein-profil-container">`;
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SEKTION 1: Profil-Ãœbersicht / Achsen-Auswahl
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  if (hatProfil) {
    // Kompakte Profil-Anzeige mit Bearbeiten-Option
    html += `
      <div class="profil-header-card">
        <div class="profil-header-top">
          <div class="profil-icon">ğŸ¯</div>
          <div class="profil-info">
            <h3>Dein Profil</h3>
            ${archetyp ? `<span class="profil-archetyp">${archetyp}</span>` : ''}
          </div>
          <button class="profil-edit-btn" onclick="toggleProfilEditor()">âœï¸ Bearbeiten</button>
        </div>
        
        <div class="profil-kompakt" id="profil-kompakt">
          ${renderProfilKompakt(profil)}
        </div>
        
        <div class="profil-editor hidden" id="profil-editor">
          ${renderProfilEditor(profil)}
        </div>
        
        <div class="profil-actions">
          <button class="profil-action-btn" onclick="generiereProfilUrl()">ğŸ”— Meine URL</button>
          <button class="profil-action-btn secondary" onclick="window.open('../?start=2', '_blank')">ğŸ² Im Generator Ã¶ffnen</button>
        </div>
      </div>
    `;
  } else {
    // Kein Profil: Einladung zum AusfÃ¼llen
    html += `
      <div class="profil-header-card leer">
        <div class="profil-leer-content">
          <div class="profil-leer-icon">ğŸ¯</div>
          <h3>Wo stehst du?</h3>
          <p>Erstelle dein persÃ¶nliches Profil, um passende Empfehlungen zu erhalten und deinen Platz im Haus zu finden.</p>
          <div class="profil-start-options">
            <button class="profil-start-btn primary" onclick="toggleProfilEditor(); document.getElementById('profil-editor').classList.remove('hidden');">
              ğŸ›ï¸ Schnell-Profil erstellen
            </button>
            <a href="../?start=2" class="profil-start-btn secondary">
              ğŸ² AusfÃ¼hrlich im Generator
            </a>
          </div>
        </div>
        
        <div class="profil-editor hidden" id="profil-editor">
          ${renderProfilEditor(profil)}
        </div>
      </div>
    `;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SEKTION 2: Hier wirst du gebraucht (wenn Profil vorhanden)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  if (hatProfil) {
    html += renderDeinPlatz(profil, archetyp);
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SEKTION 3: Mein Sozialismus Definition
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  html += renderMeinSozialismusIntern(profil);
  
  html += `</div>`; // Ende mein-profil-container
  
  return html;
}

// Kompakte Darstellung des Profils (nur ausgefÃ¼llte Achsen)
function renderProfilKompakt(profil) {
  const achsen = Object.entries(profil);
  if (achsen.length === 0) return '<p class="profil-leer-text">Noch keine Positionen gewÃ¤hlt</p>';
  
  let html = '<div class="profil-chips">';
  achsen.forEach(([achse, wert]) => {
    const meta = window.achsenMeta[achse];
    const polName = meta?.pole[wert - 1] || wert;
    html += `<span class="profil-chip" onclick="showKnoten('${achse}-${wert}')">${achse}: ${polName}</span>`;
  });
  html += '</div>';
  return html;
}

// Editor fÃ¼r Profil-Bearbeitung (kompakte Slider)
function renderProfilEditor(profil) {
  const achsenDef = [
    { id: 'A1', name: 'Reform â†” Revolution' },
    { id: 'A2', name: 'Rev. Subjekt' },
    { id: 'A3', name: 'Staat' },
    { id: 'A4', name: 'Organisation' },
    { id: 'B1', name: 'Markt â†” Plan' },
    { id: 'B2', name: 'Eigentum' },
    { id: 'B3', name: 'Arbeit' },
    { id: 'C1', name: 'Feminismus' },
    { id: 'C2', name: 'Natur' },
    { id: 'C3', name: 'International' },
    { id: 'D1', name: 'Utopie' },
    { id: 'D2', name: 'Transformation' },
    { id: 'E1', name: 'BÃ¼ndnisse' },
    { id: 'E2', name: 'Ebenen' }
  ];
  
  let html = '<div class="profil-editor-grid">';
  
  achsenDef.forEach(achse => {
    const wert = profil[achse.id] || 0;
    const meta = window.achsenMeta[achse.id] || { pole: ['1','2','3','4','5'] };
    
    html += `
      <div class="profil-achse-row">
        <span class="profil-achse-label">${achse.id}</span>
        <div class="profil-achse-slider">
          ${[1,2,3,4,5].map(pos => `
            <button class="profil-pos ${wert === pos ? 'selected' : ''}" 
                    onclick="updateProfilPosition('${achse.id}', ${pos})"
                    title="${meta.pole[pos-1]}">
              ${pos}
            </button>
          `).join('')}
        </div>
      </div>
    `;
  });
  
  html += '</div>';
  html += `
    <div class="profil-editor-actions">
      <button class="profil-save-btn" onclick="speichereProfilUndRender()">âœ“ Speichern</button>
      <button class="profil-cancel-btn" onclick="toggleProfilEditor()">âœ• Abbrechen</button>
    </div>
  `;
  
  return html;
}

// Toggle fÃ¼r Profil-Editor
function toggleProfilEditor() {
  const kompakt = document.getElementById('profil-kompakt');
  const editor = document.getElementById('profil-editor');
  
  if (kompakt) kompakt.classList.toggle('hidden');
  if (editor) editor.classList.toggle('hidden');
}

// Position im Profil aktualisieren
function updateProfilPosition(achse, pos) {
  if (!konfigAuswahl) konfigAuswahl = {};
  konfigAuswahl[achse] = pos;
  
  // Button-States aktualisieren
  const row = document.querySelector(`.profil-achse-row .profil-achse-label`);
  document.querySelectorAll(`.profil-achse-row`).forEach(row => {
    const label = row.querySelector('.profil-achse-label');
    if (label && label.textContent === achse) {
      row.querySelectorAll('.profil-pos').forEach((btn, i) => {
        btn.classList.toggle('selected', i + 1 === pos);
      });
    }
  });
}

// Profil speichern und Ansicht neu rendern
function speichereProfilUndRender() {
  // konfigAuswahl ist bereits aktualisiert
  generatorProfil = { ...konfigAuswahl };
  renderHaus('profil');
}

// URL mit Profil generieren
function generiereProfilUrl() {
  const profil = generatorProfil || konfigAuswahl || {};
  if (Object.keys(profil).length === 0) {
    alert('Erstelle zuerst ein Profil!');
    return;
  }
  
  // Profil zu URL-Parameter konvertieren
  const profilString = Object.entries(profil)
    .map(([achse, wert]) => `${achse}:${wert}`)
    .join(',');
  
  const baseUrl = window.location.origin + window.location.pathname;
  const url = `${baseUrl}?profil=${profilString}`;
  
  // Kopieren und Feedback
  navigator.clipboard.writeText(url).then(() => {
    alert('âœ“ URL kopiert!\n\nDiese URL enthÃ¤lt dein komplettes Profil. Speichere sie als Lesezeichen oder teile sie.');
  }).catch(() => {
    prompt('Kopiere diese URL:', url);
  });
}

// Interne Version von renderMeinSozialismus (ohne Container)
function renderMeinSozialismusIntern(profil) {
  const hatProfil = Object.keys(profil).length > 0;
  
  // Lade gespeicherte Definition aus localStorage
  const gespeichert = localStorage.getItem('meinSozialismus');
  if (gespeichert) {
    try {
      meineSozialismusDefinition = JSON.parse(gespeichert);
    } catch(e) {}
  }
  
  // Wenn noch keine Definition aber Profil vorhanden: initialisiere aus Profil
  if (meineSozialismusDefinition.kern.length === 0 && hatProfil) {
    initDefinitionAusProfil(profil);
  }
  
  let html = `
    <div class="ms-section">
      <div class="ms-section-header">
        <h3>ğŸ”´ Mein Sozialismus</h3>
        <p>Definiere, was Sozialismus fÃ¼r dich bedeutet</p>
      </div>
      
      <div class="ms-editor">
        <div class="ms-kategorien">
          
          <!-- KERN -->
          <div class="ms-kategorie" data-kategorie="kern">
            <div class="ms-kategorie-header">
              <span class="ms-kategorie-icon">ğŸ”¥</span>
              <div>
                <h4>Unverzichtbar</h4>
                <span class="ms-kategorie-info">Das ist der Kern meines Sozialismus</span>
              </div>
            </div>
            <div class="ms-dropzone" data-kategorie="kern">
              ${renderDefinitionItems('kern')}
              <div class="ms-dropzone-hint">Ziehe Positionen hierher</div>
            </div>
          </div>
          
          <!-- WICHTIG -->
          <div class="ms-kategorie" data-kategorie="wichtig">
            <div class="ms-kategorie-header">
              <span class="ms-kategorie-icon">ğŸ’¡</span>
              <div>
                <h4>Wichtig</h4>
                <span class="ms-kategorie-info">GehÃ¶rt fÃ¼r mich dazu</span>
              </div>
            </div>
            <div class="ms-dropzone" data-kategorie="wichtig">
              ${renderDefinitionItems('wichtig')}
              <div class="ms-dropzone-hint">Ziehe Positionen hierher</div>
            </div>
          </div>
          
          <!-- RELEVANT -->
          <div class="ms-kategorie" data-kategorie="relevant">
            <div class="ms-kategorie-header">
              <span class="ms-kategorie-icon">ğŸ“</span>
              <div>
                <h4>Auch relevant</h4>
                <span class="ms-kategorie-info">Spielt eine Rolle</span>
              </div>
            </div>
            <div class="ms-dropzone" data-kategorie="relevant">
              ${renderDefinitionItems('relevant')}
              <div class="ms-dropzone-hint">Ziehe Positionen hierher</div>
            </div>
          </div>
          
        </div>
        
        <!-- HinzufÃ¼gen -->
        <div class="ms-hinzufuegen">
          <button class="ms-add-btn" onclick="zeigePositionAuswahl()">
            â• Position hinzufÃ¼gen
          </button>
        </div>
      </div>
    </div>
  `;
  
  return html;
}

function renderMeinSozialismus(profil) {
  const hatProfil = Object.keys(profil).length > 0;
  const achsenMeta = window.achsenMeta;
  
  // Lade gespeicherte Definition aus localStorage
  const gespeichert = localStorage.getItem('meinSozialismus');
  if (gespeichert) {
    try {
      meineSozialismusDefinition = JSON.parse(gespeichert);
    } catch(e) {}
  }
  
  // Wenn noch keine Definition aber Profil vorhanden: initialisiere aus Profil
  if (meineSozialismusDefinition.kern.length === 0 && hatProfil) {
    initDefinitionAusProfil(profil);
  }
  
  let html = `
    <div class="mein-sozialismus-container">
      <div class="ms-intro">
        <h3>ğŸ”´ Definiere deinen Sozialismus</h3>
        <p>Was bedeutet Sozialismus fÃ¼r dich? Gewichte deine Positionen, formuliere sie in deinen Worten, 
           fÃ¼ge eigene Punkte hinzu. Am Ende steht deine ganz persÃ¶nliche Definition.</p>
      </div>
      
      <div class="ms-editor">
        <div class="ms-kategorien">
          
          <!-- KERN -->
          <div class="ms-kategorie" data-kategorie="kern">
            <div class="ms-kategorie-header">
              <span class="ms-kategorie-icon">ğŸ”¥</span>
              <div>
                <h4>Unverzichtbar</h4>
                <span class="ms-kategorie-info">Das ist der Kern meines Sozialismus</span>
              </div>
            </div>
            <div class="ms-dropzone" data-kategorie="kern">
              ${renderDefinitionItems('kern')}
              <div class="ms-dropzone-hint">Ziehe Positionen hierher</div>
            </div>
          </div>
          
          <!-- WICHTIG -->
          <div class="ms-kategorie" data-kategorie="wichtig">
            <div class="ms-kategorie-header">
              <span class="ms-kategorie-icon">ğŸ’¡</span>
              <div>
                <h4>Wichtig</h4>
                <span class="ms-kategorie-info">GehÃ¶rt fÃ¼r mich dazu</span>
              </div>
            </div>
            <div class="ms-dropzone" data-kategorie="wichtig">
              ${renderDefinitionItems('wichtig')}
              <div class="ms-dropzone-hint">Ziehe Positionen hierher</div>
            </div>
          </div>
          
          <!-- RELEVANT -->
          <div class="ms-kategorie" data-kategorie="relevant">
            <div class="ms-kategorie-header">
              <span class="ms-kategorie-icon">ğŸ“</span>
              <div>
                <h4>Auch relevant</h4>
                <span class="ms-kategorie-info">Spielt eine Rolle</span>
              </div>
            </div>
            <div class="ms-dropzone" data-kategorie="relevant">
              ${renderDefinitionItems('relevant')}
              <div class="ms-dropzone-hint">Ziehe Positionen hierher</div>
            </div>
          </div>
          
        </div>
        
        <!-- HinzufÃ¼gen -->
        <div class="ms-hinzufuegen">
          <button class="ms-add-btn" onclick="zeigePositionAuswahl()">
            â• Position aus dem Wesen hinzufÃ¼gen
          </button>
          <button class="ms-add-custom-btn" onclick="zeigeEigenenPunktDialog()">
            âœï¸ Eigenen Punkt hinzufÃ¼gen
          </button>
        </div>
      </div>
      
      <!-- Live-Vorschau der Definition -->
      <div class="ms-vorschau">
        <div class="ms-vorschau-header">
          <h4>ğŸ“œ Deine Definition</h4>
          <button class="ms-edit-text-btn" onclick="toggleFreitextEditor()">âœï¸ Direkt bearbeiten</button>
        </div>
        <div class="ms-vorschau-text" id="ms-vorschau-text">
          ${generiereDefinitionsText()}
        </div>
        <div class="ms-freitext-editor" id="ms-freitext-editor" style="display:none;">
          <textarea id="ms-freitext-textarea" placeholder="Schreibe deine Definition in eigenen Worten...">${meineSozialismusDefinition.freitext || ''}</textarea>
          <button class="ms-save-freitext" onclick="speichereFreitext()">Ãœbernehmen</button>
        </div>
      </div>
      
      <!-- Aktionen -->
      <div class="ms-aktionen">
        <button class="ms-btn-primary" onclick="teileDefinition()">
          ğŸ”— Teilen
        </button>
        <button class="ms-btn-secondary" onclick="kopiereDefinition()">
          ğŸ“‹ Kopieren
        </button>
        <button class="ms-btn-secondary" onclick="speichereDefinition()">
          ğŸ’¾ Speichern
        </button>
        <button class="ms-btn-danger" onclick="resetDefinition()">
          ğŸ”„ ZurÃ¼cksetzen
        </button>
      </div>
      
    </div>
  `;
  
  return html;
}

// Initialisiert Definition aus Generator-Profil
function initDefinitionAusProfil(profil) {
  const achsenMeta = window.achsenMeta;
  const items = [];
  
  Object.entries(profil).forEach(([achse, pos]) => {
    const knotenId = `${achse}-${pos}`;
    const knoten = knotenData[knotenId];
    const meta = achsenMeta[achse];
    const zimmer = window.hausStruktur
      .flatMap(e => e.zimmer)
      .find(z => z.achse === achse);
    
    items.push({
      id: knotenId,
      achse: achse,
      position: pos,
      label: knoten?.name || meta?.pole[pos-1] || `Position ${pos}`,
      zimmer: zimmer?.name || achse,
      quelle: 'generator'
    });
  });
  
  // Verteile auf Kategorien basierend auf Extremheit
  items.forEach(item => {
    const extremheit = Math.abs(item.position - 3);
    if (extremheit >= 2) {
      meineSozialismusDefinition.kern.push(item);
    } else if (extremheit >= 1) {
      meineSozialismusDefinition.wichtig.push(item);
    } else {
      meineSozialismusDefinition.relevant.push(item);
    }
  });
}

// Rendert die Items einer Kategorie
function renderDefinitionItems(kategorie) {
  const items = meineSozialismusDefinition[kategorie] || [];
  
  if (items.length === 0) return '';
  
  return items.map((item, index) => `
    <div class="ms-item" draggable="true" data-id="${item.id}" data-kategorie="${kategorie}" data-index="${index}">
      <div class="ms-item-drag">â‹®â‹®</div>
      <div class="ms-item-content">
        <div class="ms-item-header">
          <span class="ms-item-achse">${item.achse}</span>
          <span class="ms-item-label">${item.label}</span>
          ${item.quelle === 'custom' ? '<span class="ms-item-custom">âœï¸</span>' : ''}
        </div>
        ${meineSozialismusDefinition.eigeneTexte[item.id] ? 
          `<div class="ms-item-eigentext">"${meineSozialismusDefinition.eigeneTexte[item.id]}"</div>` : 
          `<div class="ms-item-zimmer">${item.zimmer}</div>`
        }
      </div>
      <div class="ms-item-actions">
        <button class="ms-item-edit" onclick="bearbeitePosition('${item.id}')" title="Eigene Formulierung">âœï¸</button>
        <button class="ms-item-remove" onclick="entfernePosition('${item.id}', '${kategorie}')" title="Entfernen">Ã—</button>
      </div>
    </div>
  `).join('');
}

// Generiert den Definitions-Text
function generiereDefinitionsText() {
  const { kern, wichtig, relevant, freitext, eigeneTexte } = meineSozialismusDefinition;
  
  // Wenn Freitext vorhanden, diesen verwenden
  if (freitext && freitext.trim()) {
    return `<p>${freitext}</p>`;
  }
  
  // Sonst automatisch generieren
  if (kern.length === 0 && wichtig.length === 0 && relevant.length === 0) {
    return '<p class="ms-vorschau-leer">Ziehe Positionen in die Kategorien, um deine Definition zu erstellen...</p>';
  }
  
  let text = '<p><strong>Sozialismus heiÃŸt fÃ¼r mich:</strong></p><p>';
  
  if (kern.length > 0) {
    const kernTexte = kern.map(k => eigeneTexte[k.id] || k.label.toLowerCase());
    text += `Vor allem ${kernTexte.join(' und ')}. `;
  }
  
  if (wichtig.length > 0) {
    const wichtigTexte = wichtig.map(w => eigeneTexte[w.id] || w.label.toLowerCase());
    text += `Dazu gehÃ¶rt fÃ¼r mich ${wichtigTexte.join(', ')}. `;
  }
  
  if (relevant.length > 0) {
    const relevantTexte = relevant.map(r => eigeneTexte[r.id] || r.label.toLowerCase());
    text += `Auch ${relevantTexte.join(' und ')} ${relevant.length === 1 ? 'spielt' : 'spielen'} eine Rolle.`;
  }
  
  text += '</p>';
  
  return text;
}

// Drag & Drop initialisieren
function initDefinitionDragDrop() {
  const items = document.querySelectorAll('.ms-item');
  const dropzones = document.querySelectorAll('.ms-dropzone');
  
  items.forEach(item => {
    item.addEventListener('dragstart', (e) => {
      e.dataTransfer.setData('text/plain', JSON.stringify({
        id: item.dataset.id,
        kategorie: item.dataset.kategorie,
        index: item.dataset.index
      }));
      item.classList.add('dragging');
    });
    
    item.addEventListener('dragend', () => {
      item.classList.remove('dragging');
    });
  });
  
  dropzones.forEach(zone => {
    zone.addEventListener('dragover', (e) => {
      e.preventDefault();
      zone.classList.add('dragover');
    });
    
    zone.addEventListener('dragleave', () => {
      zone.classList.remove('dragover');
    });
    
    zone.addEventListener('drop', (e) => {
      e.preventDefault();
      zone.classList.remove('dragover');
      
      const data = JSON.parse(e.dataTransfer.getData('text/plain'));
      const neueKategorie = zone.dataset.kategorie;
      
      bewegePosition(data.id, data.kategorie, neueKategorie);
    });
  });
}

// Position zwischen Kategorien bewegen
function bewegePosition(id, vonKategorie, nachKategorie) {
  if (vonKategorie === nachKategorie) return;
  
  const item = meineSozialismusDefinition[vonKategorie].find(i => i.id === id);
  if (!item) return;
  
  // Entfernen aus alter Kategorie
  meineSozialismusDefinition[vonKategorie] = meineSozialismusDefinition[vonKategorie].filter(i => i.id !== id);
  
  // HinzufÃ¼gen zu neuer Kategorie
  meineSozialismusDefinition[nachKategorie].push(item);
  
  // Speichern und neu rendern
  speichereDefinitionLokal();
  renderHaus('definition');
}

// Position entfernen
function entfernePosition(id, kategorie) {
  meineSozialismusDefinition[kategorie] = meineSozialismusDefinition[kategorie].filter(i => i.id !== id);
  delete meineSozialismusDefinition.eigeneTexte[id];
  speichereDefinitionLokal();
  renderHaus('definition');
}

// Eigene Formulierung bearbeiten
function bearbeitePosition(id) {
  const aktuellerText = meineSozialismusDefinition.eigeneTexte[id] || '';
  
  const html = `
    <div class="ms-edit-overlay" onclick="this.remove()">
      <div class="ms-edit-popup" onclick="event.stopPropagation()">
        <h4>âœï¸ Eigene Formulierung</h4>
        <p>Wie wÃ¼rdest du diese Position in eigenen Worten beschreiben?</p>
        <textarea id="ms-edit-textarea" placeholder="z.B. 'Kein Sozialismus ohne Klimagerechtigkeit'">${aktuellerText}</textarea>
        <div class="ms-edit-buttons">
          <button onclick="speichereEigeneFormulierung('${id}')">Speichern</button>
          <button class="secondary" onclick="this.closest('.ms-edit-overlay').remove()">Abbrechen</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', html);
  document.getElementById('ms-edit-textarea').focus();
}

function speichereEigeneFormulierung(id) {
  const text = document.getElementById('ms-edit-textarea').value.trim();
  if (text) {
    meineSozialismusDefinition.eigeneTexte[id] = text;
  } else {
    delete meineSozialismusDefinition.eigeneTexte[id];
  }
  speichereDefinitionLokal();
  document.querySelector('.ms-edit-overlay').remove();
  renderHaus('definition');
}

// Position aus dem Wesen hinzufÃ¼gen
function zeigePositionAuswahl() {
  const achsenMeta = window.achsenMeta;
  const hausStruktur = window.hausStruktur;
  
  // Sammle alle verfÃ¼gbaren Positionen
  let optionen = '';
  hausStruktur.forEach(etage => {
    optionen += `<div class="ms-auswahl-etage"><h5>${etage.icon} ${etage.name}</h5>`;
    etage.zimmer.forEach(zimmer => {
      const meta = achsenMeta[zimmer.achse];
      optionen += `<div class="ms-auswahl-zimmer">
        <span class="ms-auswahl-achse">${zimmer.achse}</span>
        <span class="ms-auswahl-name">${zimmer.name}</span>
        <div class="ms-auswahl-positionen">
          ${[1,2,3,4,5].map(pos => {
            const knotenId = `${zimmer.achse}-${pos}`;
            const knoten = knotenData[knotenId];
            const schonVorhanden = [...meineSozialismusDefinition.kern, ...meineSozialismusDefinition.wichtig, ...meineSozialismusDefinition.relevant]
              .some(i => i.id === knotenId);
            return `<button class="ms-auswahl-pos ${schonVorhanden ? 'vorhanden' : ''}" 
                    onclick="${schonVorhanden ? '' : `fuegePositionHinzu('${zimmer.achse}', ${pos})`}"
                    ${schonVorhanden ? 'disabled' : ''}>
              ${pos}
            </button>`;
          }).join('')}
        </div>
      </div>`;
    });
    optionen += '</div>';
  });
  
  const html = `
    <div class="ms-auswahl-overlay" onclick="this.remove()">
      <div class="ms-auswahl-popup" onclick="event.stopPropagation()">
        <button class="ms-auswahl-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
        <h4>Position hinzufÃ¼gen</h4>
        <p>WÃ¤hle eine Position aus dem Wesen:</p>
        <div class="ms-auswahl-liste">
          ${optionen}
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', html);
}

function fuegePositionHinzu(achse, pos) {
  const knotenId = `${achse}-${pos}`;
  const knoten = knotenData[knotenId];
  const meta = window.achsenMeta[achse];
  const zimmer = window.hausStruktur
    .flatMap(e => e.zimmer)
    .find(z => z.achse === achse);
  
  const item = {
    id: knotenId,
    achse: achse,
    position: pos,
    label: knoten?.name || meta?.pole[pos-1] || `Position ${pos}`,
    zimmer: zimmer?.name || achse,
    quelle: 'manuell'
  };
  
  // StandardmÃ¤ÃŸig zu "relevant" hinzufÃ¼gen
  meineSozialismusDefinition.relevant.push(item);
  
  speichereDefinitionLokal();
  document.querySelector('.ms-auswahl-overlay').remove();
  renderHaus('definition');
}

// Eigenen Punkt hinzufÃ¼gen
function zeigeEigenenPunktDialog() {
  const html = `
    <div class="ms-edit-overlay" onclick="this.remove()">
      <div class="ms-edit-popup" onclick="event.stopPropagation()">
        <h4>âœï¸ Eigenen Punkt hinzufÃ¼gen</h4>
        <p>FÃ¼ge einen Aspekt hinzu, der nicht im Wesen vorkommt:</p>
        <input type="text" id="ms-custom-label" placeholder="Kurzer Titel (z.B. 'Radikale Demokratie')">
        <textarea id="ms-custom-text" placeholder="Beschreibung (optional)"></textarea>
        <div class="ms-edit-buttons">
          <button onclick="fuegeEigenenPunktHinzu()">HinzufÃ¼gen</button>
          <button class="secondary" onclick="this.closest('.ms-edit-overlay').remove()">Abbrechen</button>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', html);
  document.getElementById('ms-custom-label').focus();
}

function fuegeEigenenPunktHinzu() {
  const label = document.getElementById('ms-custom-label').value.trim();
  const text = document.getElementById('ms-custom-text').value.trim();
  
  if (!label) {
    alert('Bitte gib einen Titel ein.');
    return;
  }
  
  const id = 'custom-' + Date.now();
  
  const item = {
    id: id,
    achse: 'âœï¸',
    position: 0,
    label: label,
    zimmer: 'Eigener Punkt',
    quelle: 'custom'
  };
  
  meineSozialismusDefinition.relevant.push(item);
  if (text) {
    meineSozialismusDefinition.eigeneTexte[id] = text;
  }
  
  speichereDefinitionLokal();
  document.querySelector('.ms-edit-overlay').remove();
  renderHaus('definition');
}

// Freitext-Editor
function toggleFreitextEditor() {
  const editor = document.getElementById('ms-freitext-editor');
  const vorschau = document.getElementById('ms-vorschau-text');
  
  if (editor.style.display === 'none') {
    editor.style.display = 'block';
    vorschau.style.display = 'none';
    document.getElementById('ms-freitext-textarea').value = meineSozialismusDefinition.freitext || '';
    document.getElementById('ms-freitext-textarea').focus();
  } else {
    editor.style.display = 'none';
    vorschau.style.display = 'block';
  }
}

function speichereFreitext() {
  meineSozialismusDefinition.freitext = document.getElementById('ms-freitext-textarea').value;
  speichereDefinitionLokal();
  toggleFreitextEditor();
  document.getElementById('ms-vorschau-text').innerHTML = generiereDefinitionsText();
}

// Speichern, Teilen, Kopieren
function speichereDefinitionLokal() {
  localStorage.setItem('meinSozialismus', JSON.stringify(meineSozialismusDefinition));
  // Update Vorschau wenn vorhanden
  const vorschau = document.getElementById('ms-vorschau-text');
  if (vorschau) {
    vorschau.innerHTML = generiereDefinitionsText();
  }
}

function speichereDefinition() {
  speichereDefinitionLokal();
  
  // Kurze BestÃ¤tigung
  const btn = event.target;
  const originalText = btn.innerHTML;
  btn.innerHTML = 'âœ“ Gespeichert!';
  btn.disabled = true;
  setTimeout(() => {
    btn.innerHTML = originalText;
    btn.disabled = false;
  }, 1500);
}

function kopiereDefinition() {
  const text = document.getElementById('ms-vorschau-text').innerText;
  navigator.clipboard.writeText(text).then(() => {
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = 'âœ“ Kopiert!';
    setTimeout(() => btn.innerHTML = originalText, 1500);
  });
}

function teileDefinition() {
  // URL mit Definition generieren
  const encoded = btoa(encodeURIComponent(JSON.stringify(meineSozialismusDefinition)));
  const url = `${window.location.origin}${window.location.pathname}?ansicht=wg&tab=definition&def=${encoded}`;
  
  navigator.clipboard.writeText(url).then(() => {
    alert('Link kopiert! Du kannst ihn jetzt teilen.');
  });
}

function resetDefinition() {
  if (confirm('MÃ¶chtest du deine Definition wirklich zurÃ¼cksetzen?')) {
    meineSozialismusDefinition = {
      kern: [],
      wichtig: [],
      relevant: [],
      eigeneTexte: {},
      freitext: ''
    };
    localStorage.removeItem('meinSozialismus');
    
    // Neu initialisieren aus Profil
    const profil = generatorProfil || konfigAuswahl || {};
    if (Object.keys(profil).length > 0) {
      initDefinitionAusProfil(profil);
    }
    
    renderHaus('definition');
  }
}

// Legacy-Funktionen
function switchWGTyp(typ) { renderHaus(typ); }
function regenerateChaosWG() { renderHaus('wg'); }
function renderWGHaus(modus) { renderHaus(modus || 'funktional'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TALKSHOW ANZEIGEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function zeigeTalkshow() {
  const gaeste = window.aktuelleGaeste;
  const userArchetyp = window.userArchetyp;
  const archetypen = window.archetypen;
  const spannungsFelder = window.spannungsFelder;
  
  if (!gaeste || gaeste.length < 4) return;
  
  // Hole GÃ¤ste-Daten
  const gaesteDaten = gaeste.map(id => ({
    id,
    ...archetypen[id]
  }));
  
  // Berechne Spannungen
  const achsen = ['A1', 'A2', 'A3', 'B1', 'B2', 'B3', 'C1', 'C2', 'C3', 'D1', 'D2', 'D3', 'E1', 'E2', 'E3'];
  const spannungen = [];
  
  achsen.forEach(achse => {
    const werte = gaesteDaten.map(g => g.ideal?.[achse] || 3);
    const min = Math.min(...werte);
    const max = Math.max(...werte);
    const diff = max - min;
    
    if (diff >= 2) {
      const minGast = gaesteDaten.find(g => (g.ideal?.[achse] || 3) === min);
      const maxGast = gaesteDaten.find(g => (g.ideal?.[achse] || 3) === max);
      
      spannungen.push({
        achse,
        diff,
        minGast,
        maxGast,
        feld: spannungsFelder[achse]
      });
    }
  });
  
  spannungen.sort((a, b) => b.diff - a.diff);
  const topThemen = spannungen.slice(0, 3);
  
  // Finde Gemeinsamkeiten
  const gemeinsamkeiten = findeGemeinsamkeiten(gaesteDaten, achsen);
  
  // User-Info
  const userInfo = userArchetyp ? archetypen[userArchetyp] : null;
  
  // Popup generieren
  const html = `
    <div class="talkshow-overlay" onclick="this.remove()">
      <div class="talkshow-popup" onclick="event.stopPropagation()">
        <button class="talkshow-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
        
        <div class="talkshow-popup-header">
          <span class="talkshow-popup-logo">ğŸ“º</span>
          <div>
            <h3>Talkshow-Generator</h3>
            <p>Vier Perspektiven auf die groÃŸen Fragen</p>
          </div>
        </div>
        
        <div class="talkshow-popup-gaeste">
          ${gaesteDaten.map(g => `
            <div class="popup-gast" style="--accent: ${g.farbe}">
              <span>${g.icon}</span>
              <span>${g.name.split(' ')[0]}</span>
            </div>
          `).join('')}
        </div>
        
        <!-- THEMEN / DEBATTEN -->
        ${topThemen.length > 0 ? topThemen.map((t, i) => `
          <div class="talkshow-thema">
            <div class="thema-header">
              <span class="thema-nummer">Thema ${i + 1}</span>
              <span class="thema-name">${t.feld?.name || t.achse}</span>
            </div>
            
            <div class="thema-frage">
              ğŸ™ï¸ "${t.feld?.fragen[Math.floor(Math.random() * t.feld.fragen.length)] || 'Wie seht ihr das?'}"
            </div>
            
            <div class="thema-statements">
              ${gaesteDaten.map(g => {
                const statement = generiereStatement(g, t.achse, t);
                return `
                  <div class="statement" style="--accent: ${g.farbe}">
                    <span class="statement-icon">${g.icon}</span>
                    <div class="statement-text">
                      <span class="statement-name">${g.name.split(' ')[0]}:</span>
                      "${statement}"
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `).join('') : `
          <div class="talkshow-harmonie">
            <p>ğŸ•Šï¸ Diese Runde ist Ã¼berraschend einig!</p>
          </div>
        `}
        
        <!-- ABSCHLUSSRUNDE -->
        <div class="talkshow-abschluss">
          <div class="abschluss-header">
            <span>ğŸ¤</span>
            <h4>Abschlussrunde</h4>
          </div>
          
          ${gemeinsamkeiten.length > 0 ? `
            <div class="abschluss-gemeinsamkeiten">
              <p class="gem-intro">Was diese Runde verbindet:</p>
              ${gemeinsamkeiten.map(g => `<span class="gem-tag">âœ“ ${g}</span>`).join('')}
            </div>
          ` : ''}
          
          <div class="abschluss-frage">
            ğŸ’¬ "WofÃ¼r wÃ¼rdet ihr trotz aller Differenzen gemeinsam auf die StraÃŸe gehen?"
          </div>
          
          <div class="abschluss-note">
            ğŸ’š Linke Einheit heiÃŸt nicht UniformitÃ¤t â€“ sondern solidarisch streiten.
          </div>
        </div>
        
        <!-- USER EINSCHALTEN -->
        ${userInfo ? `
          <div class="talkshow-einschalten">
            <div class="einschalten-header">
              <span>${userInfo.icon}</span>
              <div>
                <strong>Du als ${userInfo.name}</strong>
                <p>Was wÃ¼rdest du zu dieser Debatte sagen?</p>
              </div>
            </div>
            <a href="mailto:info@das-linke-wesen.de?subject=Talkshow: Meine Perspektive&body=Ich bin ${encodeURIComponent(userInfo.name)} und mÃ¶chte folgendes einwerfen:%0A%0A" class="einschalten-mail-btn">
              âœ‰ï¸ Schreib uns deine Meinung!
            </a>
          </div>
        ` : ''}
        
        <div class="talkshow-popup-footer">
          <span>ğŸ”œ Bald: Live-Debatten mit echten Menschen</span>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', html);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATEMENT GENERIEREN (ein Satz pro Archetyp + Achse)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function generiereStatement(gast, achse, spannung) {
  const wert = gast.ideal?.[achse] || 3;
  
  // Basis-Statements je nach Achse und Position
  const statements = {
    A1: {
      low: "Wir mÃ¼ssen die Menschen dort abholen, wo sie sind â€“ mit konkreten Verbesserungen.",
      mid: "Reform und Revolution sind keine GegensÃ¤tze, sondern Etappen desselben Weges.",
      high: "Solange wir im System spielen, reproduzieren wir es â€“ wir brauchen den Bruch."
    },
    A2: {
      low: "Die Arbeiterklasse bleibt das zentrale revolutionÃ¤re Subjekt.",
      mid: "Wir mÃ¼ssen verschiedene KÃ¤mpfe verbinden, ohne sie zu hierarchisieren.",
      high: "Alle UnterdrÃ¼ckten und das Leben selbst â€“ das ist unser Subjekt."
    },
    A3: {
      low: "Den Staat erobern und fÃ¼r unsere Zwecke nutzen â€“ das ist der Weg.",
      mid: "Der Staat ist ein umkÃ¤mpftes Terrain, nicht Freund und nicht Feind.",
      high: "Jede Staatsmacht reproduziert Herrschaft â€“ wir mÃ¼ssen sie auflÃ¶sen."
    },
    B1: {
      low: "MÃ¤rkte kÃ¶nnen sozial reguliert werden â€“ Sozialismus braucht keine Zentralplanung.",
      mid: "Demokratische Planung und Markt mÃ¼ssen klug kombiniert werden.",
      high: "Nur demokratische Planung Ã¼berwindet die Anarchie des Marktes."
    },
    B2: {
      low: "Ã–ffentliches Eigentum unter staatlicher Kontrolle ist die Basis.",
      mid: "Verschiedene Eigentumsformen haben verschiedene StÃ¤rken.",
      high: "Commons und Gemeineigentum von unten â€“ nicht Staatseigentum."
    },
    B3: {
      low: "Gute Arbeit fÃ¼r alle muss unser Ziel sein.",
      mid: "ArbeitszeitverkÃ¼rzung bei vollem Lohnausgleich â€“ jetzt!",
      high: "Die Befreiung von der Lohnarbeit ist das eigentliche Ziel."
    },
    C1: {
      low: "Der Klassenkampf muss PrioritÃ¤t haben â€“ alles andere folgt.",
      mid: "Klasse und Geschlecht sind verwoben und mÃ¼ssen zusammen bekÃ¤mpft werden.",
      high: "Ohne Sturz des Patriarchats kein Sozialismus â€“ Feminismus ist zentral."
    },
    C2: {
      low: "Erst mÃ¼ssen wir die ProduktivkrÃ¤fte entwickeln, dann kÃ¶nnen wir Ã¶kologisch werden.",
      mid: "Soziale und Ã¶kologische Frage gehÃ¶ren zusammen.",
      high: "Die Natur hat eigene Rechte â€“ Sozialismus muss Ã¶kozentrisch sein."
    },
    C3: {
      low: "Wir mÃ¼ssen erst im eigenen Land stark werden.",
      mid: "Internationale SolidaritÃ¤t braucht lokale Verankerung.",
      high: "Sozialismus ist global oder gar nicht â€“ No Borders, No Nations."
    },
    D1: {
      low: "Utopien sind gefÃ¤hrlich â€“ wir wissen nur, was wir nicht wollen.",
      mid: "Der Weg ist das Ziel, aber wir brauchen eine Richtung.",
      high: "Konkrete Utopien zeigen, dass eine andere Welt mÃ¶glich ist."
    },
    D2: {
      low: "Schrittweise Transformation ist realistischer als Revolutionsromantik.",
      mid: "Wir brauchen BrÃ¼che und KontinuitÃ¤t zugleich.",
      high: "Nur ein radikaler Bruch kann das System Ã¼berwinden."
    },
    D3: {
      low: "Religion ist Opium â€“ Sozialismus ist sÃ¤kular.",
      mid: "SpiritualitÃ¤t kann persÃ¶nlich wertvoll sein, aber Politik ist weltlich.",
      high: "Befreiung hat auch eine spirituelle Dimension."
    },
    E1: {
      low: "Klare Klassenlinie â€“ keine VerwÃ¤sserung durch liberale BÃ¼ndnisse.",
      mid: "Breite BÃ¼ndnisse, aber mit klarem sozialistischen Kern.",
      high: "Alle progressiven KrÃ¤fte zusammen â€“ Massenlinie!"
    },
    E2: {
      low: "Zentrale Koordination ist fÃ¼r wirksamen Kampf unerlÃ¤sslich.",
      mid: "Mehrebenen-Politik: lokal handeln, global denken.",
      high: "Von unten, dezentral, basisdemokratisch â€“ das ist unsere StÃ¤rke."
    },
    E3: {
      low: "Ohne revolutionÃ¤re Theorie keine revolutionÃ¤re Praxis.",
      mid: "Theorie und Praxis mÃ¼ssen sich gegenseitig befruchten.",
      high: "Wir lernen im Kampf, nicht im Seminar â€“ Praxis zuerst."
    },
    E4: {
      low: "Strikt legale Mittel â€“ alles andere schadet der Bewegung.",
      mid: "Ziviler Ungehorsam hat seinen Platz.",
      high: "Die Frage der Mittel ist eine taktische, keine moralische."
    }
  };
  
  const achsenStatements = statements[achse];
  if (!achsenStatements) return "Das mÃ¼ssen wir gemeinsam diskutieren.";
  
  if (wert <= 2) return achsenStatements.low;
  if (wert >= 4) return achsenStatements.high;
  return achsenStatements.mid;
}

// Legacy-Funktion fÃ¼r KompatibilitÃ¤t
function zeigeWGDebatte(index) { zeigeTalkshow(); }

// Finde Gemeinsamkeiten zwischen den 4 Archetypen
function findeGemeinsamkeiten(bewohnerDaten, achsen) {
  const dominated = [];
  const achsenMeta = window.achsenMeta;
  
  achsen.forEach(achse => {
    const werte = bewohnerDaten.map(b => b.ideal?.[achse] || 3);
    const min = Math.min(...werte);
    const max = Math.max(...werte);
    const durchschnitt = werte.reduce((a, b) => a + b, 0) / werte.length;
    
    // Wenn alle Ã¤hnlich (Differenz <= 1), ist das eine Gemeinsamkeit
    if (max - min <= 1) {
      const meta = achsenMeta[achse];
      if (meta) {
        const posIndex = Math.round(durchschnitt) - 1;
        const position = meta.pole[posIndex] || '';
        
        // Generiere Beschreibung basierend auf Achse und Position
        const beschreibung = generiereGemeinsamkeitsBeschreibung(achse, durchschnitt);
        if (beschreibung) {
          dominated.push(beschreibung);
        }
      }
    }
  });
  
  return dominated.slice(0, 3); // Max 3 Gemeinsamkeiten
}

function generiereGemeinsamkeitsBeschreibung(achse, wert) {
  const beschreibungen = {
    A1: wert >= 4 ? "Ihr seid euch einig: Es braucht grundlegende VerÃ¤nderung" : 
        wert <= 2 ? "Ihr bevorzugt alle schrittweise Reformen" : null,
    A2: wert >= 4 ? "Ihr seht ein breites gesellschaftliches Subjekt" :
        wert <= 2 ? "Ihr fokussiert auf die Arbeiterklasse" : null,
    A3: wert >= 4 ? "Ihr seid staatskritisch" :
        wert <= 2 ? "Ihr seht den Staat als wichtiges Werkzeug" : null,
    B2: wert >= 4 ? "Ihr favorisiert Gemeineigentum und Commons" :
        wert <= 2 ? "Ihr setzt auf Ã¶ffentliches Eigentum" : null,
    B3: wert >= 4 ? "Ihr wollt Arbeit radikal reduzieren oder abschaffen" :
        wert <= 2 ? "Ihr betont den Wert guter Arbeit" : null,
    C1: wert >= 4 ? "Feminismus ist fÃ¼r euch zentral" :
        wert <= 2 ? "Ihr priorisiert den Klassenkampf" : null,
    C2: wert >= 4 ? "Ã–kologie hat fÃ¼r euch hÃ¶chste PrioritÃ¤t" :
        wert <= 2 ? "Ihr seht Produktion als notwendig" : null,
    C3: wert >= 4 ? "Ihr denkt global und internationalistisch" :
        wert <= 2 ? "Ihr fokussiert auf nationale Strategien" : null,
    D1: wert >= 4 ? "Ihr glaubt an konkrete Utopien" :
        wert <= 2 ? "Ihr seid skeptisch gegenÃ¼ber Utopien" : null,
    E1: wert >= 4 ? "Ihr setzt auf breite BÃ¼ndnisse" :
        wert <= 2 ? "Ihr bevorzugt klare Klassenlinien" : null,
    E2: wert >= 4 ? "Ihr favorisiert dezentrale Organisation" :
        wert <= 2 ? "Ihr seht Zentralismus als notwendig" : null,
    E3: wert >= 4 ? "Ihr betont Praxis und Erfahrung" :
        wert <= 2 ? "Ihr betont Theorie und AufklÃ¤rung" : null
  };
  
  return beschreibungen[achse] || null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã–KOSYSTEM: Positionen als Arten
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initOekosystem() {
  const container = document.getElementById('oekosystem-container');
  
  // Klassifiziere Positionen nach "Ã¶kologischer Nische"
  const verbindungsCount = {};
  Object.keys(knotenData).forEach(id => verbindungsCount[id] = 0);
  verbindungenData.forEach(v => {
    verbindungsCount[v.von]++;
    verbindungsCount[v.zu]++;
  });
  
  // Kategorisiere
  const dominant = []; // Viele Verbindungen (>6)
  const pioneer = [];  // In Debatten verwickelt
  const symbionten = []; // Mittlere Verbindungen, keine Debatten
  const nischen = []; // Wenige Verbindungen
  const endangered = []; // Sehr wenige Verbindungen (<3)
  
  const debattenIds = new Set();
  verbindungenData.filter(v => v.typ === 'debatte').forEach(v => {
    debattenIds.add(v.von);
    debattenIds.add(v.zu);
  });
  
  Object.values(knotenData).forEach(k => {
    const count = verbindungsCount[k.id];
    const inDebatte = debattenIds.has(k.id);
    
    if (count >= 7) {
      dominant.push({ ...k, count, typ: 'dominant' });
    } else if (inDebatte) {
      pioneer.push({ ...k, count, typ: 'pioneer' });
    } else if (count >= 4) {
      symbionten.push({ ...k, count, typ: 'symbiont' });
    } else if (count <= 2) {
      endangered.push({ ...k, count, typ: 'endangered' });
    } else {
      nischen.push({ ...k, count, typ: 'nische' });
    }
  });
  
  let html = '<h2 style="color: #4CAF50; margin-bottom: 0.5rem;">ğŸŒ¿ Das Ã–kosystem des linken Denkens</h2>';
  html += '<p style="color: #888; margin-bottom: 2rem;">Positionen als Arten. Wer dominiert das Ã–kosystem? Wer kÃ¤mpft um Ressourcen? Wer lebt in Symbiose? Wer ist vom Aussterben bedroht?</p>';
  
  const zonen = [
    { titel: 'ğŸŒ³ Dominante Arten', beschreibung: 'Die groÃŸen BÃ¤ume des Waldes â€” stark vernetzt, prÃ¤gen das Ã–kosystem', arten: dominant, klasse: 'dominant' },
    { titel: 'ğŸ”¥ Pionierpflanzen', beschreibung: 'Wachsen in umkÃ¤mpftem Terrain â€” in aktiven Debatten verwickelt', arten: pioneer, klasse: 'pioneer' },
    { titel: 'ğŸ¤ Symbionten', beschreibung: 'Leben in Kooperation â€” gut vernetzt, ohne Konflikte', arten: symbionten, klasse: 'symbiont' },
    { titel: 'ğŸŒ± Nischenarten', beschreibung: 'Spezialisiert, aber stabil â€” moderate Vernetzung', arten: nischen, klasse: 'nische' },
    { titel: 'ğŸ¦¤ GefÃ¤hrdete Arten', beschreibung: 'Wenig Verbindungen â€” drohen in Vergessenheit zu geraten', arten: endangered, klasse: 'endangered' }
  ];
  
  zonen.forEach(zone => {
    if (zone.arten.length === 0) return;
    html += `<div class="oeko-zone">
      <h3>${zone.titel} <span style="font-weight: normal; color: #666;">(${zone.arten.length})</span></h3>
      <p style="color: #666; margin-bottom: 1rem; font-size: 0.85rem;">${zone.beschreibung}</p>
      <div class="oeko-arten">`;
    
    zone.arten.sort((a, b) => b.count - a.count).forEach(art => {
      html += `<span class="oeko-art ${zone.klasse}" onclick="showKnoten('${art.id}')">${art.name} <span style="color: #666; font-size: 0.7rem;">(${art.count})</span></span>`;
    });
    
    html += '</div></div>';
  });
  
  // Nahrungsketten / Beziehungen
  html += `<div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #333;">
    <h3 style="color: #4CAF50;">ğŸ”— Ã–kologische Beziehungen</h3>
    <p style="color: #666; margin: 1rem 0;">Einige bemerkenswerte Symbiosen und Konkurrenzen:</p>
    <div style="display: grid; gap: 1rem;">`;
  
  // StÃ¤rkste AffinitÃ¤ten
  const starkeAffinitaeten = verbindungenData
    .filter(v => v.typ === 'affinitaet' && v.staerke >= 0.85)
    .slice(0, 5);
  
  starkeAffinitaeten.forEach(v => {
    const a = knotenData[v.von];
    const b = knotenData[v.zu];
    if (a && b) {
      html += `<div style="background: #252525; padding: 0.75rem; border-radius: 4px; border-left: 3px solid #4CAF50;">
        <strong style="color: #4CAF50;">Symbiose:</strong> ${a.name} â†” ${b.name}
        <div style="color: #888; font-size: 0.8rem; margin-top: 0.25rem;">${v.beschreibung}</div>
      </div>`;
    }
  });
  
  html += '</div></div>';
  
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LABOR: Chemische Reaktionen zwischen Ideen
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initChemie() {
  const container = document.getElementById('chemie-container');
  
  // Elemente definieren basierend auf Eigenschaften
  const elemente = Object.values(knotenData).map(k => {
    // Verbindungscount
    let count = 0;
    let debattenCount = 0;
    verbindungenData.forEach(v => {
      if (v.von === k.id || v.zu === k.id) {
        count++;
        if (v.typ === 'debatte') debattenCount++;
      }
    });
    
    // Klassifizierung
    let typ = 'stabil';
    if (debattenCount >= 2) typ = 'alkali'; // Hochreaktiv
    else if (count <= 2) typ = 'edelgas'; // Reagiert kaum
    else if (count >= 6) typ = 'katalysator'; // Verbindet viele
    
    // Symbol aus ersten Buchstaben
    const words = k.name.split(/[\s-]+/);
    let symbol = words[0].substring(0, 2);
    if (words.length > 1) {
      symbol = words[0][0] + words[1][0];
    }
    symbol = symbol.toUpperCase();
    
    return { ...k, symbol, typ, count, debattenCount };
  });
  
  let html = '<h2 style="color: #FF9800; margin-bottom: 0.5rem;">âš—ï¸ Das Labor der Ideen</h2>';
  html += '<p style="color: #888; margin-bottom: 2rem;">Positionen als chemische Elemente. Manche reagieren heftig miteinander, manche sind stabil, manche katalysieren Verbindungen.</p>';
  
  // Legende
  html += `<div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
    <span style="color: #f44336;">â— Alkali (hochreaktiv, in Debatten)</span>
    <span style="color: #FF9800;">â— Katalysator (verbindet viele)</span>
    <span style="color: #4CAF50;">â— Stabil (ausgeglichen)</span>
    <span style="color: #9C27B0;">â— Edelgas (reagiert kaum)</span>
  </div>`;
  
  // Periodensystem
  html += '<div class="periodensystem">';
  
  elemente.sort((a, b) => {
    const order = { alkali: 0, katalysator: 1, stabil: 2, edelgas: 3 };
    return order[a.typ] - order[b.typ];
  }).forEach(el => {
    html += `<div class="element ${el.typ}" onclick="showKnoten('${el.id}')" title="${el.name}">
      <div class="symbol">${el.symbol}</div>
      <div class="name">${el.name.length > 12 ? el.name.substring(0, 10) + 'â€¦' : el.name}</div>
    </div>`;
  });
  
  html += '</div>';
  
  // Reaktionsgleichungen
  html += '<div class="reaktionsgleichung">';
  html += '<h3>ğŸ“œ Historische Reaktionen</h3>';
  
  const reaktionen = [
    { formel: 'Anarchismus + Leninismus â†’ Explosion (1872)', ergebnis: 'Spaltung der Ersten Internationale, Bakunin ausgeschlossen' },
    { formel: 'Klassensubjekt + Multitude â†’ Spannung', ergebnis: 'Hardt/Negri vs. orthodoxer Marxismus' },
    { formel: 'Reform + Revolution â†’ Doppelstrategie', ergebnis: 'Rosa Luxemburg synthesiert beide' },
    { formel: 'Feminismus + Klassenprimat â†’ Debatte', ergebnis: 'Haupt- vs. Nebenwiderspruch' },
    { formel: 'Anarchismus + Ã–kologie â†’ SozialÃ¶kologie', ergebnis: 'Murray Bookchin, Kommunalismus' }
  ];
  
  reaktionen.forEach(r => {
    html += `<div class="reaktion">
      <div class="formel">${r.formel}</div>
      <div class="ergebnis">â†’ ${r.ergebnis}</div>
    </div>`;
  });
  
  html += '</div>';
  
  // Interaktiver Hinweis
  html += `<div style="margin-top: 2rem; padding: 1rem; background: #252525; border-radius: 8px; color: #888;">
    <strong style="color: #FF9800;">ğŸ’¡ Tipp:</strong> Gehe zum 3D-Netzwerk und ziehe zwei Elemente aufeinander, um ihre Reaktion zu analysieren.
  </div>`;
  
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EPOCHEN: Das Haus in verschiedenen Zeiten
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initEpochen() {
  const container = document.getElementById('zeit-container');
  
  const epochen = [
    {
      id: '1848',
      name: '1848 â€” Die Geburt',
      beschreibung: 'Das Jahr der Revolutionen. Marx und Engels verÃ¶ffentlichen das Kommunistische Manifest. Die Arbeiterbewegung betritt die WeltbÃ¼hne.',
      geboren: ['A2-2', 'A3-2', 'C3-3', 'A1-5'],
      aktiv: [],
      geist: 'Die Welt ist jung. Alles scheint mÃ¶glich. Die Fabriken rauchen, die Barrikaden brennen, die Zukunft gehÃ¶rt den Massen.'
    },
    {
      id: '1917',
      name: '1917 â€” Der Durchbruch',
      beschreibung: 'Die Russische Revolution. Zum ersten Mal ergreift die Arbeiterklasse die Macht. Hoffnung und Schrecken zugleich.',
      geboren: ['B1-5', 'B2-1', 'E2-1', 'E3-1', 'E3-2'],
      aktiv: ['A3-2', 'A2-2', 'A1-5', 'C3-4'],
      geist: 'Der Staat ist erobert. Aber was nun? BÃ¼rgerkrieg, Intervention, Mangel. Die Debatten werden hÃ¤rter, die Spaltungen tiefer.'
    },
    {
      id: '1968',
      name: '1968 â€” Die Erweiterung',
      beschreibung: 'Paris, Prag, Berkeley, Mexiko. Neue Subjekte, neue Fragen. Feminismus, Ã–kologie, Antirassismus betreten die BÃ¼hne.',
      geboren: ['C1-3', 'C1-5', 'A3-4', 'A2-4', 'C2-4'],
      aktiv: ['A3-5', 'E1-4', 'D1-3'],
      geist: 'Die alte Linke ist zu eng. Wer ist das revolutionÃ¤re Subjekt? Studenten, Frauen, Kolonisierte? Die Phantasie ergreift die Macht.'
    },
    {
      id: '1989',
      name: '1989 â€” Der Zusammenbruch',
      beschreibung: 'Die Mauer fÃ¤llt. Der Realsozialismus endet. Triumphgeheul der Sieger, Orientierungslosigkeit der Linken.',
      geboren: ['D1-4', 'D2-2', 'B2-4'],
      aktiv: ['B1-1', 'A3-3', 'D3-3'],
      tot: ['B1-5', 'B2-1', 'E2-1'],
      geist: 'Was bleibt? Die groÃŸen ErzÃ¤hlungen sind diskreditiert. Zeit fÃ¼r Mikropolitik, Nischen, reale Utopien im Kleinen.'
    },
    {
      id: 'heute',
      name: 'Heute â€” Die Suche',
      beschreibung: 'Klimakrise, Digitalisierung, neue Autoritarismen. Die alten Fragen kehren zurÃ¼ck, aber anders.',
      geboren: ['B3-5', 'C2-5', 'E1-5'],
      aktiv: ['C1-3', 'C2-4', 'A2-4', 'D1-4', 'B3-4'],
      geist: 'Das Haus ist voll, aber chaotisch. Viele Bewohner, wenig Einigkeit. Aber auch: Mehr MÃ¶glichkeiten als je zuvor. Die Suche geht weiter.'
    }
  ];
  
  let html = '<h2 style="color: #E53935; margin-bottom: 0.5rem;">ğŸŒ€ Epochen des linken Denkens</h2>';
  html += '<p style="color: #888; margin-bottom: 2rem;">Dasselbe Haus in verschiedenen historischen Momenten. Wer war schon da? Wer wurde gerade geboren? Wer ist verschwunden?</p>';
  
  html += '<div class="epochen-nav">';
  epochen.forEach((ep, i) => {
    html += `<button class="epoche-btn ${i === 0 ? 'active' : ''}" onclick="showEpoche('${ep.id}')">${ep.name.split(' â€” ')[0]}</button>`;
  });
  html += '</div>';
  
  html += '<div id="epochen-inhalt" class="epochen-inhalt"></div>';
  
  container.innerHTML = html;
  
  // Initial erste Epoche zeigen
  window.epochenData = epochen;
  showEpoche('1848');
}

function showEpoche(id) {
  const ep = window.epochenData.find(e => e.id === id);
  if (!ep) return;
  
  // Buttons aktualisieren
  document.querySelectorAll('.epoche-btn').forEach(btn => {
    btn.classList.toggle('active', btn.textContent === id || btn.textContent === ep.name.split(' â€” ')[0]);
  });
  
  let html = `<h3>${ep.name}</h3>`;
  html += `<p>${ep.beschreibung}</p>`;
  html += `<div style="background: #1a1a1a; padding: 1rem; border-radius: 4px; margin: 1rem 0; font-style: italic; color: #888; border-left: 3px solid #E53935;">"${ep.geist}"</div>`;
  
  if (ep.geboren && ep.geboren.length > 0) {
    html += '<p style="color: #4CAF50; margin-top: 1.5rem;"><strong>ğŸŒ± In dieser Zeit geboren:</strong></p>';
    html += '<div class="epochen-knoten">';
    ep.geboren.forEach(id => {
      const k = knotenData[id];
      if (k) html += `<span class="geboren" onclick="showKnoten('${id}')">${k.name}</span>`;
    });
    html += '</div>';
  }
  
  if (ep.aktiv && ep.aktiv.length > 0) {
    html += '<p style="color: #FF9800; margin-top: 1rem;"><strong>ğŸ”¥ Besonders aktiv:</strong></p>';
    html += '<div class="epochen-knoten">';
    ep.aktiv.forEach(id => {
      const k = knotenData[id];
      if (k) html += `<span class="aktiv" onclick="showKnoten('${id}')">${k.name}</span>`;
    });
    html += '</div>';
  }
  
  if (ep.tot && ep.tot.length > 0) {
    html += '<p style="color: #666; margin-top: 1rem;"><strong>ğŸ’€ Diskreditiert / verschwunden:</strong></p>';
    html += '<div class="epochen-knoten">';
    ep.tot.forEach(id => {
      const k = knotenData[id];
      if (k) html += `<span class="tot" onclick="showKnoten('${id}')">${k.name}</span>`;
    });
    html += '</div>';
  }
  
  document.getElementById('epochen-inhalt').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STAMMBAUM: Genealogie der Ideen
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initStammbaum() {
  const container = document.getElementById('stammbaum-container');
  
  // Ideen-Genealogie definieren
  const generationen = [
    {
      zeit: "VorlÃ¤ufer (vor 1848)",
      denker: [
        { name: "Rousseau", jahre: "1712-1778", einfluss: ["A3-1", "D1-3"], id: null },
        { name: "Babeuf", jahre: "1760-1797", einfluss: ["A1-5", "B2-1"], id: null },
        { name: "Owen/Fourier", jahre: "~1800", einfluss: ["D1-5", "B2-4"], id: null }
      ]
    },
    {
      zeit: "GrÃ¼ndergeneration (1848-1890)",
      denker: [
        { name: "Marx", jahre: "1818-1883", einfluss: ["A2-2", "A3-2", "D3-1"], id: "A2-2" },
        { name: "Bakunin", jahre: "1814-1876", einfluss: ["A3-5", "B2-5"], id: "A3-5" },
        { name: "Proudhon", jahre: "1809-1865", einfluss: ["B2-4", "A3-5"], id: null }
      ]
    },
    {
      zeit: "Zweite Generation (1890-1920)",
      denker: [
        { name: "Lenin", jahre: "1870-1924", einfluss: ["A3-2", "E3-1"], id: "A3-2" },
        { name: "Luxemburg", jahre: "1871-1919", einfluss: ["A1-3", "A1-4"], id: "A1-3" },
        { name: "Bernstein", jahre: "1850-1932", einfluss: ["A1-1", "D2-1"], id: "A1-1" },
        { name: "Kropotkin", jahre: "1842-1921", einfluss: ["A3-5", "B2-5"], id: "A3-5" }
      ]
    },
    {
      zeit: "Dritte Generation (1920-1968)",
      denker: [
        { name: "Gramsci", jahre: "1891-1937", einfluss: ["A3-3", "E3-3"], id: "A3-3" },
        { name: "Adorno", jahre: "1903-1969", einfluss: ["D1-2", "D3-1"], id: "D1-2" },
        { name: "Beauvoir", jahre: "1908-1986", einfluss: ["C1-3", "C1-5"], id: "C1-5" },
        { name: "Fanon", jahre: "1925-1961", einfluss: ["C3-3", "A1-5"], id: null }
      ]
    },
    {
      zeit: "Vierte Generation (1968-2000)",
      denker: [
        { name: "Bookchin", jahre: "1921-2006", einfluss: ["C2-5", "E2-4"], id: "C2-5" },
        { name: "Federici", jahre: "*1942", einfluss: ["C1-4", "C1-5"], id: "C1-4" },
        { name: "E.O. Wright", jahre: "1947-2019", einfluss: ["D1-4", "D2-2"], id: "D1-4" },
        { name: "Poulantzas", jahre: "1936-1979", einfluss: ["A3-3"], id: "A3-3" }
      ]
    },
    {
      zeit: "FÃ¼nfte Generation (2000-heute)",
      denker: [
        { name: "Hardt/Negri", jahre: "*1960/*1933", einfluss: ["A2-4", "A3-4"], id: "A2-4" },
        { name: "Graeber", jahre: "1961-2020", einfluss: ["A3-5", "B3-5"], id: "B3-5" },
        { name: "Fraser", jahre: "*1947", einfluss: ["C1-3", "C1-4"], id: "C1-3" },
        { name: "Srnicek/Williams", jahre: "*1982/*1988", einfluss: ["B3-5", "D1-5"], id: "B3-5" }
      ]
    }
  ];
  
  let html = `
    <div class="stammbaum-header">
      <h2>ğŸŒ³ Genealogie der Ideen</h2>
      <p>Wer beeinflusste wen? Die Ahnenreihen des linken Denkens.</p>
    </div>
    <div class="stammbaum-timeline">
  `;
  
  generationen.forEach((gen, i) => {
    html += `<div class="stammbaum-epoche">`;
    html += `<div class="stammbaum-zeit">${gen.zeit}</div>`;
    html += '<div class="stammbaum-generation">';
    
    gen.denker.forEach(d => {
      const clickHandler = d.id ? `onclick="showKnoten('${d.id}')"` : '';
      const clickableClass = d.id ? 'clickable' : '';
      const einflussTags = d.einfluss.slice(0, 2).map(e => `<span class="einfluss-tag">${e}</span>`).join('');
      
      html += `<div class="stammbaum-knoten ${clickableClass}" ${clickHandler}>
        <div class="name">${d.name}</div>
        <div class="zeit">${d.jahre}</div>
        <div class="einfluss-tags">${einflussTags}</div>
      </div>`;
    });
    
    html += '</div></div>';
  });
  
  html += '</div>';
  
  html += `<div class="stammbaum-footer">
    <strong>Lesehinweis:</strong> Klickbare Namen (mit grÃ¼nem Rand) fÃ¼hren zu Positionen im Netzwerk. Nicht alle Denker*innen sind als eigene Position erfasst â€” manche sind Ã¼ber ihre Ideen prÃ¤sent.
  </div>`;
  
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DIALOGE: ImaginÃ¤re GesprÃ¤che
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initDialoge() {
  const container = document.getElementById('dialoge-container');
  
  const dialoge = [
    {
      titel: "Reform oder Revolution?",
      sprecher1: { name: "Rosa Luxemburg", position: "A1-3" },
      sprecher2: { name: "Eduard Bernstein", position: "A1-1" },
      zeilen: [
        { autor: 1, text: "Die Sozialreform ist nicht dem Endziel entgegengesetzt, aber sie ist kein Mittel zur Erreichung des Endziels. Sie ist das Endziel selbst!" },
        { autor: 2, text: "Aber der Kapitalismus bricht nicht zusammen, Rosa. Wir mÃ¼ssen ihn Schritt fÃ¼r Schritt transformieren." },
        { autor: 1, text: "Und wenn die Herrschenden diese Schritte nicht zulassen? Wenn sie die Spielregeln Ã¤ndern, sobald wir zu gewinnen drohen?" },
        { autor: 2, text: "Dann haben wir die demokratischen Institutionen gestÃ¤rkt, die uns schÃ¼tzen." },
        { autor: 1, text: "Die Institutionen der Bourgeoisie werden nie gegen die Bourgeoisie schÃ¼tzen. Die Doppelstrategie â€” Reform UND Vorbereitung auf den Bruch â€” das ist der Weg." }
      ]
    },
    {
      titel: "Staat zerschlagen oder besetzen?",
      sprecher1: { name: "Bakunin", position: "A3-5" },
      sprecher2: { name: "Lenin", position: "A3-2" },
      zeilen: [
        { autor: 2, text: "Der bÃ¼rgerliche Staat muss zerschlagen werden, ja. Aber nur um durch einen proletarischen Staat ersetzt zu werden." },
        { autor: 1, text: "Ein Staat ist ein Staat! Er wird dieselben Herrschaftsstrukturen reproduzieren, egal wer ihn fÃ¼hrt." },
        { autor: 2, text: "Der Staat stirbt ab, Michail. Er ist nur ein Werkzeug fÃ¼r die Ãœbergangsperiode." },
        { autor: 1, text: "Ha! Wann ist je ein Staat freiwillig abgestorben? Die neuen Herren werden neue GrÃ¼nde finden, ihre Macht zu behalten." },
        { autor: 2, text: "Ohne Staat kÃ¶nnen wir uns nicht gegen die Konterrevolution verteidigen." },
        { autor: 1, text: "Die grÃ¶ÃŸte Konterrevolution kommt von innen â€” von denen, die im Namen der Revolution herrschen." }
      ]
    },
    {
      titel: "Klasse oder Multitude?",
      sprecher1: { name: "Traditioneller Marxist", position: "A2-2" },
      sprecher2: { name: "Hardt/Negri", position: "A2-4" },
      zeilen: [
        { autor: 1, text: "Die Arbeiterklasse ist das revolutionÃ¤re Subjekt. Punkt. Alles andere ist kleinbÃ¼rgerliche Ablenkung." },
        { autor: 2, text: "Aber wer ist heute noch 'die Arbeiterklasse'? PrekÃ¤re, Migrant*innen, Care-Arbeiter*innen, Studierende â€” sie alle produzieren Wert." },
        { autor: 1, text: "Und genau deshalb verschwimmt alles in eurem Begriff 'Multitude'. Wer fÃ¼hrt? Wer organisiert?" },
        { autor: 2, text: "Niemand fÃ¼hrt. Das ist der Punkt. Schwarmorganisation, Netzwerke, emergente Strategien." },
        { autor: 1, text: "Und deshalb scheitern eure Bewegungen. Occupy, Arabischer FrÃ¼hling â€” viel Energie, keine dauerhafte Struktur." },
        { autor: 2, text: "Vielleicht ist 'Scheitern' das falsche Wort. Vielleicht transformieren sie die Welt auf Weisen, die eure Kategorien nicht erfassen." }
      ]
    }
  ];
  
  let html = '<h2 style="color: #2196F3; margin-bottom: 0.5rem;">ğŸ—£ï¸ ImaginÃ¤re Dialoge</h2>';
  html += '<p style="color: #888; margin-bottom: 2rem;">GesprÃ¤che, die so nie stattfanden â€” aber hÃ¤tten stattfinden kÃ¶nnen.</p>';
  
  dialoge.forEach(d => {
    html += '<div class="dialog-box">';
    html += `<div class="dialog-header">
      <h3 style="color: #fff; margin: 0;">${d.titel}</h3>
      <div>
        <span class="dialog-sprecher links" onclick="showKnoten('${d.sprecher1.position}')">${d.sprecher1.name}</span>
        <span style="color: #666; margin: 0 0.5rem;">vs.</span>
        <span class="dialog-sprecher rechts" onclick="showKnoten('${d.sprecher2.position}')">${d.sprecher2.name}</span>
      </div>
    </div>`;
    
    d.zeilen.forEach(z => {
      const seite = z.autor === 1 ? 'links' : 'rechts';
      const name = z.autor === 1 ? d.sprecher1.name : d.sprecher2.name;
      html += `<div class="dialog-zeile ${seite}">
        <div class="autor">${name}:</div>
        <div class="text">"${z.text}"</div>
      </div>`;
    });
    
    html += '</div>';
  });
  
  html += `<div style="margin-top: 1rem; padding: 1rem; background: #252525; border-radius: 8px; color: #888; max-width: 600px; margin-left: auto; margin-right: auto;">
    <strong style="color: #2196F3;">ğŸ“ Hinweis:</strong> Diese Dialoge sind fiktiv, aber basieren auf realen Positionen und Argumenten. Sie dienen der Veranschaulichung, nicht der historischen Dokumentation.
  </div>`;
  
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZITATE: Thematisch sortiert
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initZitate() {
  const container = document.getElementById('zitate-container');
  
  // Sammle alle Zitate aus knotenData
  const alleZitate = [];
  Object.values(knotenData).forEach(k => {
    if (k.zitate && k.zitate.length > 0) {
      k.zitate.forEach(z => {
        alleZitate.push({
          text: z.text,
          autor: z.autor,
          quelle: z.quelle,
          jahr: z.jahr,
          position: k.id,
          positionName: k.name
        });
      });
    }
  });
  
  // Thematische Kategorien
  const themen = {
    "Revolution & Strategie": ["revolution", "reform", "kampf", "macht", "staat", "bewegung"],
    "Klasse & Subjekt": ["klasse", "arbeiter", "proletariat", "volk", "masse"],
    "Ã–konomie & Eigentum": ["eigentum", "kapital", "produktion", "arbeit", "markt"],
    "Utopie & Vision": ["zukunft", "freiheit", "emanzipation", "befreiung", "mÃ¶glich"],
    "Kritik & Negation": ["kritik", "ideologie", "herrschaft", "unterdrÃ¼ckung"]
  };
  
  let html = '<h2 style="color: #FF9800; margin-bottom: 0.5rem;">ğŸ’¬ Zitate-Sammlung</h2>';
  html += '<p style="color: #888; margin-bottom: 2rem;">Die Stimmen des linken Denkens â€” thematisch sortiert.</p>';
  
  // ZufÃ¤llige Auswahl wenn zu viele
  const shuffled = alleZitate.sort(() => Math.random() - 0.5);
  const ausgewÃ¤hlt = shuffled.slice(0, 20);
  
  ausgewÃ¤hlt.forEach(z => {
    html += `<div class="zitat-card">
      <div class="zitat-text">"${z.text}"</div>
      <div class="zitat-quelle">
        <span class="zitat-autor" onclick="showKnoten('${z.position}')">${z.autor} â†’ ${z.positionName}</span>
        <span>${z.quelle || ''} ${z.jahr ? '(' + z.jahr + ')' : ''}</span>
      </div>
    </div>`;
  });
  
  if (alleZitate.length === 0) {
    html += '<p style="color: #666; text-align: center;">Keine Zitate gefunden.</p>';
  }
  
  html += `<div style="margin-top: 1rem; text-align: center; color: #666;">
    ${alleZitate.length} Zitate aus ${Object.keys(knotenData).length} Positionen
    <br><button onclick="initZitate()" style="margin-top: 0.5rem; background: #333; border: none; color: #aaa; padding: 0.5rem 1rem; cursor: pointer; border-radius: 4px;">ğŸ² Neue Auswahl</button>
  </div>`;
  
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KONFIGURATOR: Baue deine eigene Position
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let konfigAuswahl = {};

// Generator-Profil Variablen (werden von URL-Params oder Generator gesetzt)
let generatorProfil = null;
let generatorArchetyp = null;
let generatorName = null;
let generatorKnoten = null; // z.B. ["C2-4", "B3-4", "A1-4"]

function initKonfigurator() {
  // Verwende die neue Render-Funktion (unterstÃ¼tzt sowohl Generator-Profil als auch manuellen Modus)
  renderKonfiguratorMitProfil();
}

function selectKonfig(achse, pos) {
  konfigAuswahl[achse] = pos;
  
  // Komplett neu rendern mit neuer Auswahl
  renderKonfiguratorMitProfil();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIEBERKURVE: Was ist gerade heiÃŸ?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initFieber() {
  const container = document.getElementById('fieber-container');
  
  // Berechne "Temperatur" basierend auf:
  // - Anzahl Verbindungen
  // - Anzahl Debatten
  // - AktualitÃ¤t (geschÃ¤tzt)
  
  const temperaturen = Object.values(knotenData).map(k => {
    let temp = 0;
    let debatten = 0;
    
    // Verbindungen zÃ¤hlen
    verbindungenData.forEach(v => {
      if (v.von === k.id || v.zu === k.id) {
        temp += v.staerke * 10;
        if (v.typ === 'debatte') debatten++;
      }
    });
    
    // AktualitÃ¤tsbonus fÃ¼r bestimmte Themen
    const heisseThemen = ['Ã–kosozialismus', 'Post-Work', 'Grundeinkommen', 'IntersektionalitÃ¤t', 'Multitude', 'Care-Revolution'];
    if (heisseThemen.some(t => k.name.includes(t))) {
      temp += 15;
    }
    
    // Debatten erhÃ¶hen Temperatur
    temp += debatten * 10;
    
    return { 
      id: k.id, 
      name: k.name, 
      temp: Math.min(100, temp),
      debatten: debatten
    };
  }).sort((a, b) => b.temp - a.temp);
  
  let html = '<h2 style="color: #f44336; margin-bottom: 0.5rem;">ğŸŒ¡ï¸ Fieberkurve des linken Denkens</h2>';
  html += '<p style="color: #888; margin-bottom: 2rem;">Was wird gerade heiÃŸ diskutiert? Basierend auf Vernetzung und aktuellen Debatten.</p>';
  
  // Legende
  html += `<div style="display: flex; gap: 2rem; margin-bottom: 2rem; justify-content: center;">
    <span><span style="display: inline-block; width: 12px; height: 12px; background: linear-gradient(to right, #FF9800, #f44336); border-radius: 2px;"></span> HeiÃŸ (60+)</span>
    <span><span style="display: inline-block; width: 12px; height: 12px; background: linear-gradient(to right, #4CAF50, #FF9800); border-radius: 2px;"></span> Warm (30-60)</span>
    <span><span style="display: inline-block; width: 12px; height: 12px; background: linear-gradient(to right, #2196F3, #4CAF50); border-radius: 2px;"></span> KÃ¼hl (10-30)</span>
    <span><span style="display: inline-block; width: 12px; height: 12px; background: #444; border-radius: 2px;"></span> Kalt (<10)</span>
  </div>`;
  
  html += '<div class="fieber-skala">';
  
  temperaturen.slice(0, 30).forEach(t => {
    let klasse = 'tot';
    if (t.temp >= 60) klasse = 'heiss';
    else if (t.temp >= 30) klasse = 'warm';
    else if (t.temp >= 10) klasse = 'kalt';
    
    html += `<div class="fieber-zeile">
      <span class="fieber-label" onclick="showKnoten('${t.id}')">${t.name}</span>
      <div class="fieber-bar">
        <div class="fieber-fill ${klasse}" style="width: ${t.temp}%;"></div>
      </div>
      <span style="width: 40px; text-align: right; color: #666; font-size: 0.8rem;">${Math.round(t.temp)}Â°</span>
    </div>`;
  });
  
  html += '</div>';
  
  // Statistik
  const heiss = temperaturen.filter(t => t.temp >= 60).length;
  const kalt = temperaturen.filter(t => t.temp < 10).length;
  
  html += `<div style="margin-top: 2rem; padding: 1rem; background: #252525; border-radius: 8px; color: #888; max-width: 600px; margin-left: auto; margin-right: auto;">
    <strong style="color: #f44336;">Diagnose:</strong> ${heiss} heiÃŸe Positionen, ${kalt} kalte. 
    Die heiÃŸesten Debatten finden um Grundfragen von Subjekt, Staat und Transformation statt.
  </div>`;
  
  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSONEN-DATENBANK: VollstÃ¤ndige Biografien
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const personenDB = {
  // Werden geladen aus externer Quelle oder inline
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUCH-FUNKTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function initSuche() {
  // Such-Event-Listener
  const suchfeld = document.getElementById('suche-input');
  if (suchfeld) {
    suchfeld.addEventListener('input', debounce(function(e) {
      const query = e.target.value.trim().toLowerCase();
      if (query.length >= 2) {
        zeigeSuchergebnisse(query);
      } else {
        document.getElementById('suche-ergebnisse').innerHTML = '';
        document.getElementById('suche-ergebnisse').style.display = 'none';
      }
    }, 300));
  }
}

function debounce(func, wait) {
  let timeout;
  return function(...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), wait);
  };
}

function zeigeSuchergebnisse(query) {
  const ergebnisse = {
    positionen: [],
    personen: [],
    zitate: []
  };
  
  // Positionen durchsuchen
  Object.values(knotenData).forEach(k => {
    if (k.name.toLowerCase().includes(query) || 
        k.beschreibung.toLowerCase().includes(query)) {
      ergebnisse.positionen.push({
        id: k.id,
        name: k.name,
        achse: k.achse,
        match: k.name.toLowerCase().includes(query) ? 'name' : 'beschreibung'
      });
    }
  });
  
  // Stammbaum-Personen durchsuchen
  stammbaumData.stroemungen.forEach(s => {
    if (s.name.toLowerCase().includes(query) ||
        (s.kernidee && s.kernidee.toLowerCase().includes(query))) {
      ergebnisse.personen.push({
        id: s.id,
        name: s.name,
        epoche: s.epoche,
        kernidee: s.kernidee
      });
    }
  });
  
  // Zitate durchsuchen
  Object.values(knotenData).forEach(k => {
    if (k.zitate) {
      k.zitate.forEach(z => {
        if (z.text.toLowerCase().includes(query) ||
            z.autor.toLowerCase().includes(query)) {
          ergebnisse.zitate.push({
            text: z.text,
            autor: z.autor,
            quelle: z.quelle,
            knotenId: k.id,
            knotenName: k.name
          });
        }
      });
    }
  });
  
  // Ergebnisse anzeigen
  const container = document.getElementById('suche-ergebnisse');
  
  if (ergebnisse.positionen.length === 0 && 
      ergebnisse.personen.length === 0 && 
      ergebnisse.zitate.length === 0) {
    container.innerHTML = `<div class="suche-leer">Keine Ergebnisse fÃ¼r "${query}"</div>`;
    container.style.display = 'block';
    return;
  }
  
  let html = '';
  
  if (ergebnisse.positionen.length > 0) {
    html += `<div class="suche-kategorie">
      <div class="suche-kategorie-titel">ğŸ“ Positionen (${ergebnisse.positionen.length})</div>
      ${ergebnisse.positionen.slice(0, 5).map(p => `
        <div class="suche-item" onclick="showKnoten('${p.id}'); closeSuche();">
          <span class="suche-item-name">${p.name}</span>
          <span class="suche-item-meta">${p.achse}</span>
        </div>
      `).join('')}
    </div>`;
  }
  
  if (ergebnisse.personen.length > 0) {
    html += `<div class="suche-kategorie">
      <div class="suche-kategorie-titel">ğŸ‘¤ Denker*innen (${ergebnisse.personen.length})</div>
      ${ergebnisse.personen.slice(0, 5).map(p => `
        <div class="suche-item" onclick="showStammbaumPerson('${p.id}'); closeSuche();">
          <span class="suche-item-name">${p.name}</span>
          <span class="suche-item-meta">${p.kernidee ? p.kernidee.substring(0, 50) + '...' : ''}</span>
        </div>
      `).join('')}
    </div>`;
  }
  
  if (ergebnisse.zitate.length > 0) {
    html += `<div class="suche-kategorie">
      <div class="suche-kategorie-titel">ğŸ’¬ Zitate (${ergebnisse.zitate.length})</div>
      ${ergebnisse.zitate.slice(0, 3).map(z => `
        <div class="suche-item" onclick="showKnoten('${z.knotenId}'); closeSuche();">
          <span class="suche-item-zitat">"${z.text.substring(0, 80)}..."</span>
          <span class="suche-item-meta">â€” ${z.autor}</span>
        </div>
      `).join('')}
    </div>`;
  }
  
  container.innerHTML = html;
  container.style.display = 'block';
}

function closeSuche() {
  document.getElementById('suche-ergebnisse').style.display = 'none';
  document.getElementById('suche-input').value = '';
}


function initStammbaum() {
  const container = document.getElementById('stammbaum-container');
  
  // SVG-Dimensionen
  const width = 1600;
  const marginLeft = 180;
  const marginTop = 60;
  const epocheHeight = 100;
  const personRadius = 14;
  
  // Personen pro Epoche gruppieren
  const personenProEpoche = {};
  stammbaumData.epochen.forEach(e => personenProEpoche[e.id] = []);
  stammbaumData.stroemungen.forEach(s => {
    if (personenProEpoche[s.epoche]) {
      personenProEpoche[s.epoche].push(s);
    }
  });
  
  // HÃ¶he berechnen
  const height = marginTop + stammbaumData.epochen.length * epocheHeight + 100;
  
  // Epoche Y-Position
  const getY = (epocheId) => {
    const epoche = stammbaumData.epochen.find(e => e.id === epocheId);
    return marginTop + (epoche ? epoche.y * epocheHeight : 0) + epocheHeight / 2;
  };
  
  // Person X-Position automatisch berechnen
  const getX = (personId) => {
    const person = stammbaumData.stroemungen.find(s => s.id === personId);
    if (!person) return width / 2;
    
    const personen = personenProEpoche[person.epoche];
    const index = personen.findIndex(p => p.id === personId);
    const count = personen.length;
    
    // VerfÃ¼gbare Breite
    const availableWidth = width - marginLeft - 100;
    const spacing = availableWidth / (count + 1);
    
    return marginLeft + spacing * (index + 1);
  };
  
  const getPos = (id) => {
    const s = stammbaumData.stroemungen.find(st => st.id === id);
    if (!s) return { x: width/2, y: height/2 };
    return { x: getX(s.id), y: getY(s.epoche) };
  };
  
  // SVG erstellen
  let svg = `<svg class="stammbaum-svg" viewBox="0 0 ${width} ${height}" xmlns="http://www.w3.org/2000/svg">`;
  
  // Hintergrund-Epochen
  stammbaumData.epochen.forEach(epoche => {
    const y = marginTop + epoche.y * epocheHeight;
    svg += `
      <g class="stammbaum-epoche">
        <rect x="10" y="${y}" width="${width - 20}" height="${epocheHeight - 8}" 
              fill="${epoche.farbe}" opacity="0.1" rx="4"/>
        <text x="25" y="${y + 20}" class="stammbaum-epoche-label">${epoche.name}</text>
        <text x="25" y="${y + 35}" class="stammbaum-zeit-label">${epoche.zeit}</text>
      </g>
    `;
  });
  
  // Verbindungslinien - dÃ¼nner
  stammbaumData.verbindungen.forEach(v => {
    const von = getPos(v.von);
    const zu = getPos(v.zu);
    const klasse = v.typ === 'konflikt' ? 'konflikt' : 'einfluss';
    
    // Sanfte Kurve
    const midY = (von.y + zu.y) / 2;
    const ctrlX = (von.x + zu.x) / 2;
    svg += `<path class="stammbaum-linie ${klasse}" 
                  d="M ${von.x} ${von.y} C ${von.x} ${midY}, ${zu.x} ${midY}, ${zu.x} ${zu.y}"/>`;
  });
  
  // Personen/StrÃ¶mungen
  stammbaumData.stroemungen.forEach((s) => {
    const pos = getPos(s.id);
    const r = s.wichtig ? personRadius + 3 : personRadius;
    const epoche = stammbaumData.epochen.find(e => e.id === s.epoche);
    const farbe = epoche ? epoche.farbe : '#888';
    
    // Kurzer Name (max 12 Zeichen)
    const kurzName = s.name.length > 12 ? s.name.substring(0, 11) + 'â€¦' : s.name;
    
    svg += `
      <g class="stammbaum-person" onclick="showStammbaumPerson('${s.id}')" transform="translate(${pos.x}, ${pos.y})">
        <circle r="${r}" fill="${farbe}" opacity="0.9"/>
        ${s.wichtig ? `<circle r="${r + 3}" fill="none" stroke="${farbe}" stroke-width="2" opacity="0.5"/>` : ''}
        <text y="${r + 12}" class="stammbaum-label">${kurzName}</text>
      </g>
    `;
  });
  
  svg += '</svg>';
  
  // Legende
  const legende = `
    <div class="stammbaum-legende">
      <div class="stammbaum-legende-item">
        <div class="stammbaum-legende-linie" style="background: #4CAF50;"></div>
        <span>Einfluss</span>
      </div>
      <div class="stammbaum-legende-item">
        <div class="stammbaum-legende-linie" style="background: #f44336; border-style: dotted;"></div>
        <span>Konflikt</span>
      </div>
      <div class="stammbaum-legende-item">
        <span style="display:inline-block;width:14px;height:14px;border-radius:50%;border:2px solid #888;margin-right:0.5rem;"></span>
        <span>Zentrale Figur</span>
      </div>
    </div>
  `;
  
  container.innerHTML = `
    <div class="stammbaum-wrapper">
      ${svg}
    </div>
    ${legende}
  `;
}

function showEpoche(epocheId) {
  const epoche = stammbaumData.epochen.find(e => e.id === epocheId);
  if (!epoche) return;
  
  const personen = stammbaumData.stroemungen.filter(s => s.epoche === epocheId);
  
  document.getElementById('detail-content').innerHTML = `
    <span class="achse-tag" style="background: ${epoche.farbe}; color: #000;">${epoche.zeit}</span>
    <h2>${epoche.name}</h2>
    <p class="beschreibung">${epoche.beschreibung}</p>
    <h3>ğŸ‘¤ Denker*innen dieser Epoche</h3>
    <div class="verbindungen">
      ${personen.map(p => `<span class="verbindung" onclick="showStammbaumPerson('${p.id}')">${p.name}</span>`).join('')}
    </div>
  `;
  document.getElementById('detail-panel').classList.add('open');
}

function showStammbaumPerson(personId) {
  const person = stammbaumData.stroemungen.find(s => s.id === personId);
  if (!person) return;
  
  const epoche = stammbaumData.epochen.find(e => e.id === person.epoche);
  
  // Finde EinflÃ¼sse
  const beeinflusst_von = stammbaumData.verbindungen
    .filter(v => v.zu === personId && v.typ === 'einfluss')
    .map(v => stammbaumData.stroemungen.find(s => s.id === v.von))
    .filter(Boolean);
    
  const beeinflusst = stammbaumData.verbindungen
    .filter(v => v.von === personId && v.typ === 'einfluss')
    .map(v => stammbaumData.stroemungen.find(s => s.id === v.zu))
    .filter(Boolean);
    
  const konflikte = stammbaumData.verbindungen
    .filter(v => (v.von === personId || v.zu === personId) && v.typ === 'konflikt')
    .map(v => {
      const otherId = v.von === personId ? v.zu : v.von;
      return stammbaumData.stroemungen.find(s => s.id === otherId);
    })
    .filter(Boolean);
  
  document.getElementById('detail-content').innerHTML = `
    <span class="achse-tag" style="background: ${epoche?.farbe || '#888'}; color: #000;">${epoche?.name || ''}</span>
    <h2>${person.name}</h2>
    ${person.leben ? `<p style="color: var(--text-secondary); margin-bottom: 1rem;">ğŸ“… ${person.leben}</p>` : ''}
    <p class="beschreibung">${person.kernidee}</p>
    
    ${person.werke?.length ? `
      <h3>ğŸ“š Hauptwerke</h3>
      <div class="bewohner">
        ${person.werke.map(w => `<span style="background:#2a2a2a;padding:0.3rem 0.6rem;border-radius:3px;font-size:0.85rem;">${w}</span>`).join('')}
      </div>
    ` : ''}
    
    ${beeinflusst_von.length ? `
      <h3>ğŸ“¥ Beeinflusst von</h3>
      <div class="verbindungen">
        ${beeinflusst_von.map(p => `<span class="verbindung" onclick="showStammbaumPerson('${p.id}')">${p.name}</span>`).join('')}
      </div>
    ` : ''}
    
    ${beeinflusst.length ? `
      <h3>ğŸ“¤ Hat beeinflusst</h3>
      <div class="verbindungen">
        ${beeinflusst.map(p => `<span class="verbindung" onclick="showStammbaumPerson('${p.id}')">${p.name}</span>`).join('')}
      </div>
    ` : ''}
    
    ${konflikte.length ? `
      <h3>âš”ï¸ Konflikte mit</h3>
      <div class="verbindungen">
        ${konflikte.map(p => `<span class="verbindung debatte" onclick="showStammbaumPerson('${p.id}')">${p.name}</span>`).join('')}
      </div>
    ` : ''}
    
    <div style="margin-top: 2rem;">
      <button onclick="searchPerson('${person.name}')" style="background: var(--accent); border: none; color: #000; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
        ğŸ” In Positionen suchen
      </button>
    </div>
  `;
  document.getElementById('detail-panel').classList.add('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSONEN: Alle Bewohner*innen des Hauses
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let personenData = [];

// Personen-Daten aus externer JSON laden
async function loadPersonenData() {
  try {
    const response = await fetch('../data/personen.json');
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    const data = await response.json();
    personenData = data.personen;
    // Stats aktualisieren
    document.getElementById('stats').textContent = `${Object.keys(knotenData).length} Positionen Â· ${verbindungenData.length} Verbindungen Â· ${personenData.length} Personen`;
  } catch (e) {
    console.error('Fehler beim Laden der Personen:', e);
    document.getElementById('stats').textContent = `${Object.keys(knotenData).length} Positionen Â· ${verbindungenData.length} Verbindungen Â· Personen: Ladefehler`;
  }
}

let personenFilter = 'alle';

function initPersonen() {
  const container = document.getElementById('personen-container');
  
  // Loading-Indikator wenn noch keine Daten
  if (personenData.length === 0) {
    container.innerHTML = `
      <div style="text-align: center; padding: 3rem; color: #888;">
        <div style="font-size: 2rem; margin-bottom: 1rem;">â³</div>
        <div>Lade Personen-Daten...</div>
        <div style="font-size: 0.8rem; margin-top: 0.5rem; color: #666;">
          Falls dies nicht funktioniert, prÃ¼fe ob personen.json im data/-Ordner liegt.
        </div>
      </div>
    `;
    return;
  }
  
  const kategorien = {
    'alle': 'Alle',
    'klassiker': 'ğŸ›ï¸ Klassiker',
    'revolutionaer': 'âœŠ RevolutionÃ¤r',
    'frankfurt': 'ğŸ“š Frankfurt',
    'feminismus': 'â™€ï¸ Feminismus',
    'oekologie': 'ğŸŒ¿ Ã–kologie',
    'autonomie': 'ğŸ´ Autonomie',
    'operaismus': 'âš™ï¸ Operaismus',
    'analytisch': 'ğŸ§® Analytisch',
    'zeitgenoessisch': 'ğŸ”® ZeitgenÃ¶ssisch',
    'postkolonial': 'ğŸŒ Postkolonial',
    'deutsch': 'ğŸ‡©ğŸ‡ª Deutschsprachig'
  };
  
  let html = '<h2 style="color: #9C27B0; margin-bottom: 0.5rem; text-align: center;">ğŸ‘¤ Die Bewohner*innen des Hauses</h2>';
  html += '<p style="color: #888; margin-bottom: 1.5rem; text-align: center;">Wer denkt, streitet und arbeitet hier?</p>';
  
  // Filter
  html += '<div class="personen-filter">';
  Object.entries(kategorien).forEach(([key, label]) => {
    const active = personenFilter === key ? 'active' : '';
    html += `<button class="${active}" onclick="filterPersonen('${key}')">${label}</button>`;
  });
  html += '</div>';
  
  // Grid
  html += '<div class="personen-grid">';
  
  const gefiltert = personenFilter === 'alle' 
    ? personenData 
    : personenData.filter(p => p.kategorie === personenFilter);
  
  gefiltert.forEach(p => {
    const initialen = p.name.split(' ').map(n => n[0]).join('').substring(0, 2);
    const lebenStr = p.leben || (p.gestorben ? `${p.geboren}-${p.gestorben}` : `*${p.geboren}`);
    const lebt = p.leben ? p.leben.startsWith('*') : (p.gestorben === null);
    
    html += `<div class="person-card" onclick="showPerson('${p.id}')">
      <div class="header">
        <div class="avatar">${initialen}</div>
        <div class="info">
          <div class="name">${p.name} ${lebt ? 'ğŸŸ¢' : ''}</div>
          <div class="leben">${lebenStr}</div>
        </div>
      </div>
      <div class="bio">${p.bio || p.kurzbio || ''}</div>
      <div class="positionen">
        ${(p.positionen || p.hauptzimmer || []).slice(0, 3).map(pos => {
          const k = knotenData[pos];
          return k ? `<span class="pos-tag" onclick="event.stopPropagation(); showKnoten('${pos}')">${k.name}</span>` : '';
        }).join('')}
      </div>
    </div>`;
  });
  
  html += '</div>';
  
  html += `<div style="margin-top: 2rem; text-align: center; color: #666;">
    ${personenData.length} Denker*innen Â· ${personenData.filter(p => p.leben ? p.leben.startsWith('*') : p.gestorben === null).length} leben noch
  </div>`;
  
  container.innerHTML = html;
}

function filterPersonen(kat) {
  personenFilter = kat;
  initPersonen();
}

function showPerson(id) {
  const p = personenData.find(x => x.id === id);
  if (!p) return;
  
  // Hilfsfunktion: ID zu lesbarem Namen
  const idToName = (bid) => {
    const b = personenData.find(x => x.id === bid);
    if (b) {
      return `<span style="cursor: pointer; text-decoration: underline; color: #aaa;" onclick="showPerson('${bid}')">${b.name}</span>`;
    } else {
      // ID zu lesbarem Namen konvertieren (z.B. "von_parijs" â†’ "Von Parijs")
      const readable = bid.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
      return `<span style="color: #666;" title="Nicht in Datenbank">${readable}</span>`;
    }
  };
  
  // Overlay
  const overlay = document.createElement('div');
  overlay.className = 'person-overlay';
  overlay.onclick = () => { overlay.remove(); detail.remove(); };
  document.body.appendChild(overlay);
  
  // Detail
  const detail = document.createElement('div');
  detail.className = 'person-detail';
  
  // Leben-String erstellen (unterstÃ¼tzt beide Formate)
  const lebenStr = p.leben || (p.gestorben ? `${p.geboren}-${p.gestorben}` : `*${p.geboren}`);
  const lebt = p.leben ? p.leben.startsWith('*') : (p.gestorben === null);
  
  // Zitate HTML
  const zitateHtml = p.zitate && p.zitate.length > 0 ? `
    <h3 style="color: #FF9800; font-size: 0.9rem; margin-bottom: 0.5rem;">ğŸ’¬ Zitate:</h3>
    <div style="margin-bottom: 1.5rem;">
      ${p.zitate.slice(0, 2).map(z => `
        <blockquote style="border-left: 2px solid #FF9800; padding-left: 1rem; margin: 0.5rem 0; color: #ccc; font-style: italic;">
          â€${z.text}"
          <footer style="color: #666; font-size: 0.8rem; font-style: normal; margin-top: 0.3rem;">â€” ${z.quelle}${z.jahr ? ` (${z.jahr})` : ''}</footer>
        </blockquote>
      `).join('')}
    </div>
  ` : '';
  
  // Werke HTML
  const werkeHtml = p.hauptwerke && p.hauptwerke.length > 0 ? `
    <h3 style="color: #2196F3; font-size: 0.9rem; margin-bottom: 0.5rem;">ğŸ“š Hauptwerke:</h3>
    <div style="margin-bottom: 1.5rem; color: #aaa; font-size: 0.85rem;">
      ${p.hauptwerke.slice(0, 4).map(w => `<div>â€¢ ${w.titel} (${w.jahr})</div>`).join('')}
    </div>
  ` : '';
  
  // Beeinflusst von HTML
  const beeinflusstVonHtml = p.beeinflusst_von && p.beeinflusst_von.length > 0 ? `
    <h3 style="color: #9C27B0; font-size: 0.9rem; margin-bottom: 0.5rem;">â† Beeinflusst von:</h3>
    <div style="color: #888; margin-bottom: 1rem; font-size: 0.85rem;">
      ${p.beeinflusst_von.map(idToName).join(', ')}
    </div>
  ` : '';
  
  // Beeinflusste HTML
  const beeinflussteHtml = p.beeinflusst && p.beeinflusst.length > 0 ? `
    <h3 style="color: #4CAF50; font-size: 0.9rem; margin-bottom: 0.5rem;">â†’ Beeinflusste:</h3>
    <div style="color: #888; margin-bottom: 1rem; font-size: 0.85rem;">
      ${p.beeinflusst.map(idToName).join(', ')}
    </div>
  ` : '';
  
  // Debattierte mit HTML
  const debattenHtml = p.debattiert_mit && p.debattiert_mit.length > 0 ? `
    <h3 style="color: #f44336; font-size: 0.9rem; margin-bottom: 0.5rem;">âš”ï¸ Debattierte mit:</h3>
    <div style="color: #888; margin-bottom: 1rem; font-size: 0.85rem;">
      ${p.debattiert_mit.map(idToName).join(', ')}
    </div>
  ` : '';
  
  // Tags HTML
  const tagsHtml = p.tags && p.tags.length > 0 ? `
    <div style="display: flex; flex-wrap: wrap; gap: 0.3rem; margin-top: 1rem;">
      ${p.tags.map(t => `<span style="background: #333; color: #888; padding: 0.2rem 0.5rem; border-radius: 3px; font-size: 0.7rem;">#${t}</span>`).join('')}
    </div>
  ` : '';
  
  detail.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
      <div>
        <h2 style="color: #fff; margin: 0;">${p.name}</h2>
        <div style="color: #666;">${lebenStr} ${lebt ? 'ğŸŸ¢' : ''} ${p.herkunft ? `Â· ${p.herkunft}` : ''}</div>
      </div>
      <button onclick="this.closest('.person-detail').remove(); document.querySelector('.person-overlay').remove();" style="background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer;">Ã—</button>
    </div>
    
    <p style="color: #aaa; line-height: 1.6; margin-bottom: 1.5rem;">${p.bio}</p>
    
    ${zitateHtml}
    
    <h3 style="color: #E53935; font-size: 0.9rem; margin-bottom: 0.5rem;">ğŸ  Wohnt in:</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
      ${(p.positionen || p.hauptzimmer || []).map(pos => {
        const k = knotenData[pos];
        return k ? `<span style="background: rgba(229,57,53,0.2); color: #E53935; padding: 0.3rem 0.6rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;" onclick="showKnoten('${pos}'); this.closest('.person-detail').remove(); document.querySelector('.person-overlay').remove();">${k.name}</span>` : '';
      }).join('')}
    </div>
    
    ${p.besucht && p.besucht.length > 0 ? `
      <div style="color: #666; font-size: 0.8rem; margin-bottom: 1.5rem;">
        Besucht auch: ${p.besucht.map(pos => {
          const k = knotenData[pos];
          return k ? `<span style="cursor: pointer; text-decoration: underline;" onclick="showKnoten('${pos}'); this.closest('.person-detail').remove(); document.querySelector('.person-overlay').remove();">${k.name}</span>` : '';
        }).join(', ')}
      </div>
    ` : ''}
    
    ${werkeHtml}
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div>${beeinflusstVonHtml}</div>
      <div>${beeinflussteHtml}</div>
    </div>
    
    ${debattenHtml}
    
    ${tagsHtml}
    
    <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #333; color: #666; font-size: 0.8rem;">
      Klicke auf Positionen oder Namen um mehr zu erfahren.
    </div>
  `;
  
  document.body.appendChild(detail);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAS ANIMIERTE WESEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let wesenScene, wesenCamera, wesenRenderer, wesen;
let wesenTime = 0;
let wesenMouseX = 0, wesenMouseY = 0;

const achsenFarbenWesen = [
  new THREE.Color(0xE53935), // A - Rot
  new THREE.Color(0x4CAF50), // B - GrÃ¼n
  new THREE.Color(0x2196F3), // C - Blau
  new THREE.Color(0x9C27B0), // D - Lila
  new THREE.Color(0xFF9800)  // E - Orange
];

function initWesen() {
  const container = document.getElementById('wesen-container');
  const canvas = document.getElementById('wesen-canvas');
  if (!canvas) return;
  
  const width = container.clientWidth || window.innerWidth;
  const height = container.clientHeight || window.innerHeight - 70;
  
  wesenScene = new THREE.Scene();
  wesenScene.background = new THREE.Color(0x0a0a0a);
  
  wesenCamera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
  wesenCamera.position.z = 5;
  
  wesenRenderer = new THREE.WebGLRenderer({ canvas, antialias: true });
  wesenRenderer.setSize(width, height);
  wesenRenderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  
  // Das Wesen als deformierbare Kugel
  const geometry = new THREE.IcosahedronGeometry(1.5, 4);
  geometry.userData.originalPositions = geometry.attributes.position.array.slice();
  
  const material = new THREE.MeshBasicMaterial({
    color: 0xE53935,
    wireframe: true,
    transparent: true,
    opacity: 0.6
  });
  
  wesen = new THREE.Mesh(geometry, material);
  wesenScene.add(wesen);
  
  // Innere Kugel
  const kernGeometry = new THREE.IcosahedronGeometry(0.8, 2);
  const kernMaterial = new THREE.MeshBasicMaterial({
    color: 0xffffff,
    wireframe: true,
    transparent: true,
    opacity: 0.15
  });
  const kern = new THREE.Mesh(kernGeometry, kernMaterial);
  wesen.add(kern);
  
  // Partikel
  const particleCount = 300;
  const particleGeometry = new THREE.BufferGeometry();
  const positions = new Float32Array(particleCount * 3);
  const colors = new Float32Array(particleCount * 3);
  
  for (let i = 0; i < particleCount; i++) {
    const theta = Math.random() * Math.PI * 2;
    const phi = Math.acos(Math.random() * 2 - 1);
    const r = 2 + Math.random() * 2;
    
    positions[i * 3] = r * Math.sin(phi) * Math.cos(theta);
    positions[i * 3 + 1] = r * Math.sin(phi) * Math.sin(theta);
    positions[i * 3 + 2] = r * Math.cos(phi);
    
    const color = achsenFarbenWesen[Math.floor(Math.random() * 5)];
    colors[i * 3] = color.r;
    colors[i * 3 + 1] = color.g;
    colors[i * 3 + 2] = color.b;
  }
  
  particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  particleGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
  
  const particleMaterial = new THREE.PointsMaterial({
    size: 0.03,
    vertexColors: true,
    transparent: true,
    opacity: 0.6
  });
  
  const particles = new THREE.Points(particleGeometry, particleMaterial);
  wesenScene.add(particles);
  
  // Mouse tracking
  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    wesenMouseX = ((e.clientX - rect.left) / rect.width) * 2 - 1;
    wesenMouseY = -((e.clientY - rect.top) / rect.height) * 2 + 1;
  });
  
  // Animation
  function animateWesenLoop() {
    const container = document.getElementById('wesen-container');
    if (!container || container.classList.contains('hidden')) {
      return; // Stop wenn nicht sichtbar
    }
    
    requestAnimationFrame(animateWesenLoop);
    
    wesenTime += 0.01;
    
    // Organische Deformation
    const pos = wesen.geometry.attributes.position.array;
    const orig = wesen.geometry.userData.originalPositions;
    
    for (let i = 0; i < pos.length; i += 3) {
      const ox = orig[i], oy = orig[i + 1], oz = orig[i + 2];
      
      const noise = Math.sin(ox * 2 + wesenTime) * Math.cos(oy * 2 + wesenTime * 0.7) * Math.sin(oz * 2 + wesenTime * 0.5);
      const breathe = 1 + Math.sin(wesenTime * 0.5) * 0.05;
      const pulse = 1 + Math.sin(wesenTime * 2) * 0.02;
      
      const scale = breathe * pulse * (1 + noise * 0.15);
      
      pos[i] = ox * scale;
      pos[i + 1] = oy * scale;
      pos[i + 2] = oz * scale;
    }
    
    wesen.geometry.attributes.position.needsUpdate = true;
    
    // Rotation Richtung Maus
    wesen.rotation.y += (wesenMouseX * 0.3 - wesen.rotation.y) * 0.02;
    wesen.rotation.x += (wesenMouseY * 0.2 - wesen.rotation.x) * 0.02;
    wesen.rotation.z += 0.001;
    
    // Farbwechsel
    const colorIndex = Math.floor((wesenTime * 0.1) % 5);
    const nextColorIndex = (colorIndex + 1) % 5;
    const t = (wesenTime * 0.1) % 1;
    
    const currentColor = achsenFarbenWesen[colorIndex].clone();
    currentColor.lerp(achsenFarbenWesen[nextColorIndex], t);
    wesen.material.color = currentColor;
    
    wesenRenderer.render(wesenScene, wesenCamera);
  }
  
  // Global zugÃ¤nglich machen
  window.animateWesenLoop = animateWesenLoop;
  
  animateWesenLoop();
  
  // Resize
  window.addEventListener('resize', () => {
    const w = container.clientWidth;
    const h = container.clientHeight;
    if (w && h) {
      wesenCamera.aspect = w / h;
      wesenCamera.updateProjectionMatrix();
      wesenRenderer.setSize(w, h);
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION: Ansichten, Filter, Werkzeuge
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Container fÃ¼r Ansichten
const ansichtContainer = ['wesen', 'netzwerk', 'karte', 'liste', 'wg', 'oekosystem', 'zeitleiste', 'stammbaum', 'chemie'];

// Container fÃ¼r Werkzeuge (eigene Ansichten)
const werkzeugContainer = ['konfigurator', 'zufall', 'fragen'];

// Alle Container
const alleContainer = [...ansichtContainer, ...werkzeugContainer, 'zeit', 'stammbaum', 'dialoge', 'zitate', 'bibliothek', 'praxis', 'fieber', 'personen', 'kosmos', 'debatten'];

// Aktueller Zustand (Variablen sind oben im Script definiert)

// Ansicht wechseln
function setAnsicht(ansicht) {
  aktiveAnsicht = ansicht;
  
  // Linsen in Palette aktualisieren
  document.querySelectorAll('.linse.ansicht').forEach(l => {
    l.classList.toggle('active', l.dataset.id === ansicht);
  });
  
  // Werkzeug-Linsen deaktivieren
  document.querySelectorAll('.linse.werkzeug').forEach(l => {
    l.classList.remove('active');
  });
  
  // Gruppen automatisch Ã¶ffnen wenn Kind aktiv
  const laborAnsichten = ['stammbaum', 'oekosystem', 'netzwerk', 'chemie'];
  const archivAnsichten = ['liste', 'zeitleiste', 'karte'];
  
  const gruppeLabor = document.getElementById('gruppe-labor');
  const gruppeArchiv = document.getElementById('gruppe-archiv');
  
  if (gruppeLabor) {
    gruppeLabor.classList.toggle('open', laborAnsichten.includes(ansicht));
  }
  if (gruppeArchiv) {
    gruppeArchiv.classList.toggle('open', archivAnsichten.includes(ansicht));
  }
  
  // Container wechseln - NUR display setzen, keine Klassen
  alleContainer.forEach(c => {
    const el = document.getElementById(`${c}-container`);
    if (el) {
      if (c === ansicht) {
        el.style.display = 'block';
        el.classList.remove('hidden');
      } else {
        el.style.display = 'none';
      }
    }
  });
  
  // WICHTIG: Bei Haus-Ansicht immer renderHaus aufrufen (mit aktuellem Profil!)
  if (ansicht === 'wg') {
    renderHaus('erkunden');
  }
  
  // Filter anwenden
  applyFilters();
  closePanel();
  closeReaktor();
  updateActiveLinsenDisplay();
  
  // Kombinierbare Filter hervorheben
  highlightCombinable('ansicht', ansicht);
}

// Filter toggle
function toggleFilter(filter) {
    
  if (aktiveFilter.has(filter)) {
    aktiveFilter.delete(filter);
  } else {
    aktiveFilter.add(filter);
  }
  
  // Linsen in Palette aktualisieren
  document.querySelectorAll('.linse.filter').forEach(l => {
    l.classList.toggle('active', aktiveFilter.has(l.dataset.id));
  });
  
  // Epoche-Slider zeigen/verstecken
  const epocheSlider = document.getElementById('epoche-slider-vertical');
  if (epocheSlider) {
    epocheSlider.classList.toggle('visible', aktiveFilter.has('epoche'));
  }
  
  // Filter-Legenden im Netzwerk zeigen/verstecken
  const legendeFieber = document.getElementById('legende-fieber');
  const legendeKonflikte = document.getElementById('legende-konflikte');
  if (legendeFieber) {
    legendeFieber.classList.toggle('visible', aktiveFilter.has('fieber'));
  }
  if (legendeKonflikte) {
    legendeKonflikte.classList.toggle('visible', aktiveFilter.has('debatten'));
  }
  
  // Globale Filter-Info-Box aktualisieren
  updateGlobalFilterInfo();
  
  // Filter anwenden
  applyFilters();
  updateActiveLinsenDisplay();
}

// Globale Filter-Info aktualisieren
function updateGlobalFilterInfo() {
  const container = document.getElementById('filter-info-global');
  if (!container) return;
  
  const hasFieber = aktiveFilter.has('fieber');
  const hasKonflikte = aktiveFilter.has('debatten');
  const hasEpoche = aktiveFilter.has('epoche');
  const hasPersonen = aktiveFilter.has('personen');
  
  document.getElementById('filter-info-fieber').style.display = hasFieber ? 'block' : 'none';
  document.getElementById('filter-info-konflikte').style.display = hasKonflikte ? 'block' : 'none';
  document.getElementById('filter-info-epoche').style.display = hasEpoche ? 'block' : 'none';
  document.getElementById('filter-info-personen').style.display = hasPersonen ? 'block' : 'none';
  
  // Container nur zeigen wenn mindestens ein Filter aktiv
  container.classList.toggle('visible', hasFieber || hasKonflikte || hasEpoche || hasPersonen);
}

// Filter-Bar aktualisieren
function updateFilterBar() {
  const filterBar = document.getElementById('filter-bar');
  const filterChips = document.getElementById('filter-chips');
  const epocheControl = document.getElementById('epoche-control');
  
  if (aktiveFilter.size > 0) {
    filterBar.classList.add('visible');
    
    const filterNames = {
      'personen': 'ğŸ‘¤ Personen',
      'fieber': 'ğŸŒ¡ï¸ Fieber',
      'debatten': 'âš”ï¸ Konflikte',
      'epoche': 'ğŸŒ€ Epoche'
    };
    
    filterChips.innerHTML = Array.from(aktiveFilter).map(f => `
      <span class="filter-chip">
        ${filterNames[f] || f}
        <span class="remove" onclick="toggleFilter('${f}')">Ã—</span>
      </span>
    `).join('');
    
    // Epoche-Slider zeigen wenn aktiv
    epocheControl.classList.toggle('visible', aktiveFilter.has('epoche'));
  } else {
    filterBar.classList.remove('visible');
  }
}

// Epoche aktualisieren
function updateEpoche(wert) {
  epocheWert = parseInt(wert);
  document.getElementById('epoche-wert').textContent = epocheWert === 2025 ? 'bis heute' : `bis ${epocheWert}`;
  applyFilters();
}

// Filter auf aktuelle Ansicht anwenden
function applyFilters() {
  
  // Netzwerk
  if (aktiveAnsicht === 'netzwerk' && typeof applyFiltersToNetzwerk === 'function') {
    applyFiltersToNetzwerk(aktiveFilter, epocheWert);
  }
  
  // Liste
  if (aktiveAnsicht === 'liste' && typeof applyFiltersToListe === 'function') {
    applyFiltersToListe(aktiveFilter, epocheWert);
  }
  
  // Karte
  if (aktiveAnsicht === 'karte' && typeof applyFiltersToKarte === 'function') {
    applyFiltersToKarte(aktiveFilter, epocheWert);
  }
}

// Werkzeug Ã¶ffnen
function openWerkzeug(werkzeug) {
    
  // Linsen in Palette aktualisieren
  document.querySelectorAll('.linse.ansicht').forEach(l => l.classList.remove('active'));
  document.querySelectorAll('.linse.werkzeug').forEach(l => {
    l.classList.toggle('active', l.dataset.id === werkzeug);
  });
  
  // Container wechseln
  alleContainer.forEach(c => {
    const el = document.getElementById(`${c}-container`);
    if (el) {
      const isActive = c === werkzeug;
      el.classList.toggle('hidden', !isActive);
      if (isActive) {
        el.style.display = (c === 'netzwerk' || c === 'wesen') ? 'block' : 'flex';
      } else {
        el.style.display = 'none';
      }
    }
  });
  
  // Spezielle Aktionen
  if (werkzeug === 'wesen' && window.animateWesenLoop) {
    window.animateWesenLoop();
  }
  
  closePanel();
  updateActiveLinsenDisplay();
}

// SchlieÃŸt alle Werkzeug-Container und zeigt das Netzwerk
function closeAllWerkzeuge() {
  setAnsicht('netzwerk');
}

// Event-Listener registrieren

// Ansicht-Buttons
document.querySelectorAll('.ansicht-btn').forEach(btn => {
  btn.addEventListener('click', () => setAnsicht(btn.dataset.ansicht));
});

// Filter-Buttons
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => toggleFilter(btn.dataset.filter));
});

// Werkzeug-Buttons
document.querySelectorAll('.werkzeug-btn').forEach(btn => {
  btn.addEventListener('click', () => openWerkzeug(btn.dataset.werkzeug));
});

// Init alle Ansichten
try {
    initWesen();
  } catch(e) {
  console.error('Fehler in initWesen:', e);
}

// HINWEIS: Alle init-Funktionen werden im fetch-Callback aufgerufen (siehe oben)
// nachdem knotenData geladen wurde

// Stats aktualisieren (wird spÃ¤ter durch loadPersonenData aktualisiert)
document.getElementById('stats').textContent = `${Object.keys(knotenData).length} Positionen Â· ${verbindungenData.length} Verbindungen Â· Personen laden...`;

// Initiale Ansicht: Das Wesen
openWerkzeug('wesen');

// Netzwerk nach Layout-Reflow erneut initialisieren
setTimeout(() => {
  const container = document.getElementById('netzwerk-container');
  const canvas = document.getElementById('netzwerk3d');
  if (container && canvas && renderer) {
    const width = container.clientWidth || window.innerWidth - 100;
    const height = container.clientHeight || window.innerHeight - 100;
    renderer.setSize(width, height);
    camera.aspect = width / height;
    camera.updateProjectionMatrix();
  }
}, 100);


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LINSEN-INTERAKTION (Spielerisches Interface)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let floatingLinse = null; // Welche Linse schwebt gerade?
let cursorX = 0, cursorY = 0;

// Palette ein-/ausklappen
function togglePalette() {
  const palette = document.getElementById('linsen-palette');
  palette.classList.toggle('expanded');
  document.body.classList.toggle('palette-expanded');
}

// Linse-Gruppe auf-/zuklappen
function toggleGruppe(gruppe) {
  const gruppeEl = document.getElementById(`gruppe-${gruppe}`);
  if (gruppeEl) {
    gruppeEl.classList.toggle('open');
  }
}

// Kombinierbare Linsen hervorheben
function highlightCombinable(typ, id) {
  // Erst alle combinable entfernen
  document.querySelectorAll('.linse.combinable').forEach(l => l.classList.remove('combinable'));
  
  if (typ === 'ansicht') {
    // Bei Ansicht: Alle Filter sind kombinierbar
    document.querySelectorAll('.linse.filter').forEach(l => {
      if (!l.classList.contains('active')) {
        l.classList.add('combinable');
      }
    });
  } else if (typ === 'filter') {
    // Bei Filter: Andere Filter sind kombinierbar
    document.querySelectorAll('.linse.filter').forEach(l => {
      if (l.dataset.id !== id && !l.classList.contains('active')) {
        l.classList.add('combinable');
      }
    });
  }
}

// Kombinierbare Hervorhebung entfernen
function clearCombinable() {
  document.querySelectorAll('.linse.combinable').forEach(l => l.classList.remove('combinable'));
}

// Linse aufnehmen
function pickupLinse(element) {
  const typ = element.dataset.typ;
  const id = element.dataset.id;
  const icon = element.textContent.trim().split('\n')[0];
  
  // Wenn bereits eine Linse schwebt, diese zuerst anwenden
  if (floatingLinse) {
    applyFloatingLinse();
    return;
  }
  
  // Werkzeuge sofort ausfÃ¼hren (kein Schweben)
  if (typ === 'werkzeug') {
    executeWerkzeug(id);
    return;
  }
  
  // Linse aufnehmen
  floatingLinse = { typ, id, icon, element };
  
  // Schwebende Linse zeigen
  const floating = document.getElementById('floating-linse');
  const floatingIcon = document.getElementById('floating-icon');
  floatingIcon.textContent = icon;
  floating.className = `floating-linse visible ${typ}`;
  
  // Hinweis zeigen
  document.getElementById('linse-hint').classList.add('visible');
  
  // Element hervorheben
  element.style.opacity = '0.5';
  
  }

// Linse anwenden (Klick auf Viewport)
function applyFloatingLinse() {
  if (!floatingLinse) return;
  
  const { typ, id, element } = floatingLinse;
  
  // Glow-Effekt
  const glow = document.getElementById('viewport-glow');
  glow.style.boxShadow = typ === 'filter' 
    ? 'inset 0 0 100px 50px rgba(255, 152, 0, 0.3)'
    : 'inset 0 0 100px 50px rgba(229, 57, 53, 0.3)';
  glow.classList.add('active');
  setTimeout(() => glow.classList.remove('active'), 600);
  
  // Anwenden
  if (typ === 'ansicht') {
    setAnsicht(id);
    
    // Alle Ansicht-Linsen deaktivieren, diese aktivieren
    document.querySelectorAll('.linse.ansicht').forEach(l => l.classList.remove('active'));
    element.classList.add('active');
    
    // Kombinierbare Filter hervorheben
    highlightCombinable('ansicht', id);
  } else if (typ === 'filter') {
    toggleFilter(id);
    element.classList.toggle('active', aktiveFilter.has(id));
    
    // Epoche-Slider zeigen/verstecken
    if (id === 'epoche') {
      document.getElementById('epoche-slider-vertical').classList.toggle('visible', aktiveFilter.has('epoche'));
    }
    
    // Kombinierbare Filter hervorheben
    if (aktiveFilter.size > 0) {
      highlightCombinable('filter', id);
    } else {
      clearCombinable();
    }
  }
  
  // Schwebende Linse verstecken
  document.getElementById('floating-linse').classList.remove('visible');
  document.getElementById('linse-hint').classList.remove('visible');
  element.style.opacity = '';
  
  // Aktive Linsen aktualisieren
  updateActiveLinsenDisplay();
  
  floatingLinse = null;
  console.log('Linse angewendet:', typ, id);
}

// Linse ablegen (ESC oder Rechtsklick)
function dropLinse() {
  if (!floatingLinse) return;
  
  floatingLinse.element.style.opacity = '';
  floatingLinse = null;
  
  document.getElementById('floating-linse').classList.remove('visible');
  document.getElementById('linse-hint').classList.remove('visible');
  
  console.log('Linse abgelegt');
}

// Werkzeug ausfÃ¼hren
function executeWerkzeug(id) {
  console.log('Werkzeug ausfÃ¼hren:', id);
  
  const glow = document.getElementById('viewport-glow');
  glow.style.boxShadow = 'inset 0 0 100px 50px rgba(156, 39, 176, 0.3)';
  glow.classList.add('active');
  setTimeout(() => glow.classList.remove('active'), 600);
  
  switch(id) {
    case 'zufall':
      zeigeZufall();
      break;
    case 'konfigurator':
      openWerkzeug('konfigurator');
      break;
    case 'fragen':
      openWerkzeug('fragen');
      break;
  }
}

// Aktive Linsen-Anzeige aktualisieren
function updateActiveLinsenDisplay() {
  const container = document.getElementById('active-linsen');
  let html = '';
  
  // Aktive Ansicht
  const ansichtNames = {
    'wesen': 'ğŸ”´ Das Wesen',
    'netzwerk': 'ğŸ•¸ï¸ Netzwerk',
    'karte': 'ğŸ—ºï¸ Karte',
    'liste': 'ğŸ“‹ Liste',
    'wg': 'ğŸ  Haus',
    'oekosystem': 'ğŸŒ¿ Ã–kosystem',
    'zeitleiste': 'â³ Zeit',
    'stammbaum': 'ğŸŒ³ Stammbaum',
    'chemie': 'ğŸ§ª Chemie'
  };
  
  if (aktiveAnsicht && ansichtNames[aktiveAnsicht]) {
    html += `<div class="active-chip ansicht">${ansichtNames[aktiveAnsicht]}</div>`;
  }
  
  // Aktive Filter
  if (aktiveFilter.size > 0) {
    html += '<span class="separator">+</span>';
    
    const filterNames = {
      'personen': 'ğŸ‘¤ Personen',
      'fieber': 'ğŸŒ¡ï¸ Fieber',
      'debatten': 'âš”ï¸ Konflikte',
      'epoche': 'ğŸŒ€ ' + epocheWert
    };
    
    aktiveFilter.forEach(f => {
      html += `<div class="active-chip filter">
        ${filterNames[f] || f}
        <span class="remove" onclick="removeFilter('${f}')">Ã—</span>
      </div>`;
    });
  }
  
  container.innerHTML = html;
}

// Filter entfernen
function removeFilter(id) {
  aktiveFilter.delete(id);
  document.querySelector(`.linse.filter[data-id="${id}"]`)?.classList.remove('active');
  
  if (id === 'epoche') {
    document.getElementById('epoche-slider-vertical').classList.remove('visible');
  }
  
  applyFilters();
  updateActiveLinsenDisplay();
  
  // Hervorhebung aktualisieren
  if (aktiveFilter.size > 0) {
    highlightCombinable('filter', Array.from(aktiveFilter)[0]);
  } else {
    highlightCombinable('ansicht', aktiveAnsicht);
  }
}

// Epoche-Slider (vertikal)
function updateEpocheV(value) {
  epocheWert = parseInt(value);
  document.getElementById('epoche-value-v').textContent = value;
  applyFilters();
  updateActiveLinsenDisplay();
}

// Maus-Tracking fÃ¼r schwebende Linse
document.addEventListener('mousemove', (e) => {
  cursorX = e.clientX;
  cursorY = e.clientY;
  
  if (floatingLinse) {
    const floating = document.getElementById('floating-linse');
    floating.style.left = cursorX + 'px';
    floating.style.top = cursorY + 'px';
  }
});

// Klick auf Viewport = Linse anwenden
document.addEventListener('click', (e) => {
  if (!floatingLinse) return;
  
  // Nicht anwenden wenn auf Palette geklickt
  if (e.target.closest('.linsen-palette')) return;
  if (e.target.closest('.theme-modal')) return;
  if (e.target.closest('.detail-panel')) return;
  
  applyFloatingLinse();
});

// ESC = Linse ablegen
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    dropLinse();
    closePanel();
  }
});

// Rechtsklick = Linse ablegen
document.addEventListener('contextmenu', (e) => {
  if (floatingLinse) {
    e.preventDefault();
    dropLinse();
  }
});

// Initiale Anzeige
updateActiveLinsenDisplay();
highlightCombinable('ansicht', 'netzwerk');

// Netzwerk-Container wird durch setAnsicht/openWerkzeug gesteuert
// (nicht mehr manuell sichtbar machen)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THEME-SYSTEM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let currentTheme = localStorage.getItem('wesen-theme') || 'default';

function setTheme(theme) {
  // Entferne alle Theme-Klassen
  document.body.classList.remove('theme-myzel', 'theme-barrikade', 'theme-terminal', 'theme-kosmos', 'theme-ruine');
  
  // FÃ¼ge neue Theme-Klasse hinzu (auÃŸer default)
  if (theme !== 'default') {
    document.body.classList.add(`theme-${theme}`);
  }
  
  // Speichern
  currentTheme = theme;
  localStorage.setItem('wesen-theme', theme);
  
  // UI aktualisieren
  document.querySelectorAll('.theme-option').forEach(opt => {
    opt.classList.toggle('active', opt.dataset.theme === theme);
  });
  
  // Netzwerk-Hintergrund aktualisieren falls vorhanden
  if (scene) {
    const colors = {
      'default': 0x1a1a1a,
      'myzel': 0x0a1208,
      'barrikade': 0x1a0a0a,
      'terminal': 0x0a0a0a,
      'kosmos': 0x050510,
      'ruine': 0x1a1815
    };
    scene.background = new THREE.Color(colors[theme] || 0x1a1a1a);
  }
  
  console.log('Theme gewechselt zu:', theme);
}

function openThemeModal() {
  document.getElementById('theme-modal').classList.add('open');
}

function closeThemeModal() {
  document.getElementById('theme-modal').classList.remove('open');
}

// Theme beim Laden anwenden
setTheme(currentTheme);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARE / SOCIAL MEDIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getShareUrl() {
  const url = new URL(window.location.href);
  
  // Aktuelle Ansicht in URL
  url.searchParams.set('ansicht', aktiveAnsicht);
  
  // Aktive Filter
  if (aktiveFilter.size > 0) {
    url.searchParams.set('filter', Array.from(aktiveFilter).join(','));
  }
  
  // Epoche
  if (aktiveFilter.has('epoche')) {
    url.searchParams.set('epoche', epocheWert);
  }
  
  // Theme
  if (currentTheme !== 'default') {
    url.searchParams.set('theme', currentTheme);
  }
  
  return url.toString();
}

function getShareText() {
  const texte = {
    'netzwerk': 'ğŸ•¸ï¸ Entdecke das Netzwerk linker Ideen',
    'karte': 'ğŸ—ºï¸ Die Landkarte des linken Denkens',
    'liste': 'ğŸ“‹ Alle Positionen im Ãœberblick',
    'wg': 'ğŸ  Willkommen in der WG linker Ideen',
    'oekosystem': 'ğŸŒ¿ Das Ã–kosystem politischer Positionen',
    'zeitleiste': 'â³ Die Geschichte linker Ideen',
    'wesen': 'ğŸ«€ Das lebende Wesen des linken Denkens'
  };
  return texte[aktiveAnsicht] || 'Das Wesen des linken Denkens - interaktive Kartografie';
}

function openShareModal() {
  document.getElementById('share-url').value = getShareUrl();
  document.getElementById('share-modal').classList.add('open');
}

function closeShareModal() {
  document.getElementById('share-modal').classList.remove('open');
}

function copyShareUrl() {
  const input = document.getElementById('share-url');
  input.select();
  document.execCommand('copy');
  
  const feedback = document.getElementById('copy-feedback');
  feedback.style.display = 'block';
  setTimeout(() => feedback.style.display = 'none', 2000);
}

function shareToTwitter() {
  const url = encodeURIComponent(getShareUrl());
  const text = encodeURIComponent(getShareText());
  window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank', 'width=600,height=400');
}

function shareToMastodon() {
  const text = encodeURIComponent(`${getShareText()}\n\n${getShareUrl()}`);
  window.open(`https://mastodon.social/share?text=${text}`, '_blank', 'width=600,height=400');
}

function shareToTelegram() {
  const url = encodeURIComponent(getShareUrl());
  const text = encodeURIComponent(getShareText());
  window.open(`https://t.me/share/url?url=${url}&text=${text}`, '_blank', 'width=600,height=400');
}

function shareToWhatsApp() {
  const text = encodeURIComponent(`${getShareText()}\n${getShareUrl()}`);
  window.open(`https://wa.me/?text=${text}`, '_blank', 'width=600,height=400');
}

function shareToEmail() {
  const subject = encodeURIComponent('Das Wesen des linken Denkens');
  const body = encodeURIComponent(`${getShareText()}\n\n${getShareUrl()}`);
  window.location.href = `mailto:?subject=${subject}&body=${body}`;
}

function createShareImage() {
  // Canvas-Screenshot erstellen
  const mainContainer = document.querySelector('main');
  
  // Einfache Implementierung: Alert mit Hinweis
  alert('Screenshot-Funktion: Nutze die Browser-Funktion (Strg+Shift+S in Firefox) oder ein Screenshot-Tool deiner Wahl.');
  
  // TODO: Implementierung mit html2canvas Bibliothek fÃ¼r bessere Screenshots
}

// URL-Parameter beim Laden auswerten
function parseUrlParams() {
  const params = new URLSearchParams(window.location.search);
  
  // Ansicht
  const ansicht = params.get('ansicht');
  if (ansicht && ['netzwerk', 'karte', 'liste', 'wg', 'oekosystem', 'zeitleiste'].includes(ansicht)) {
    setAnsicht(ansicht);
  }
  
  // Filter
  const filterParam = params.get('filter');
  if (filterParam) {
    filterParam.split(',').forEach(f => {
      if (['personen', 'fieber', 'debatten', 'epoche'].includes(f)) {
        toggleFilter(f);
      }
    });
  }
  
  // Epoche
  const epocheParam = params.get('epoche');
  if (epocheParam) {
    epocheWert = parseInt(epocheParam);
    document.getElementById('epoche-range').value = epocheWert;
    updateEpoche(epocheWert);
  }
  
  // Theme
  const themeParam = params.get('theme');
  if (themeParam) {
    setTheme(themeParam);
  }
  
  // Position
  const posParam = params.get('pos');
  if (posParam && knotenData[posParam]) {
    setTimeout(() => showKnoten(posParam), 500);
  }
  
  // === GENERATOR-VERBINDUNG ===
  
  // Archetyp (z.B. "oekosozialismus")
  const archetypParam = params.get('archetyp');
  
  // Knoten (z.B. "C2-4,B3-4,A1-4") - IMMER speichern wenn vorhanden
  const knotenParam = params.get('knoten');
  if (knotenParam) {
    generatorKnoten = knotenParam.split(',');
    console.log('Generator-Knoten:', generatorKnoten);
  }
  
  // Volles Profil vom Generator (z.B. "A1:3,A2:4,B1:2,...")
  const profilParam = params.get('profil');
  if (profilParam) {
    const profil = parseGeneratorProfil(profilParam);
    console.log('Generator-Profil:', profil);
    
    // Profil setzen fÃ¼r Markierungen im Haus
    generatorProfil = profil;
    generatorArchetyp = archetypParam;
    
    // Startseite bleibt "Das Wesen" - User kann selbst ins Haus wechseln
    // Knoten im Netzwerk hervorheben wenn vorhanden
    if (knotenParam) {
      setTimeout(() => {
        highlightGeneratorKnoten(generatorKnoten);
      }, 1200);
    }
  } else if (archetypParam && window.archetypen && window.archetypen[archetypParam]) {
    // NUR Archetyp ohne Profil â†’ Profil aus Archetyp-ideal Ã¼bernehmen
    const archetyp = window.archetypen[archetypParam];
    const profil = archetyp.ideal || {};
    
    console.log('Archetyp erkannt:', archetypParam);
    console.log('Ãœbernommenes Profil:', profil);
    
    // Profil setzen fÃ¼r Markierungen im Haus
    generatorProfil = profil;
    generatorArchetyp = archetypParam;
    
    // Startseite bleibt "Das Wesen" - User kann selbst ins Haus wechseln
  } else if (knotenParam) {
    // Nur Knoten ohne Profil - Knoten hervorheben
    setTimeout(() => {
      highlightGeneratorKnoten(generatorKnoten);
    }, 1200);
  }
  
  // Zimmer (poetische Beschreibung)
  const zimmerParam = params.get('zimmer');
  if (zimmerParam) {
    console.log('Generator-Zimmer:', zimmerParam);
  }
  
  // Konfigurator neu rendern wenn Profil vom Generator kam
  if (generatorProfil && Object.keys(generatorProfil).length > 0) {
    renderKonfiguratorMitProfil();
  }
}

// Willkommens-Banner fÃ¼r Generator-Besucher
function showWelcomeBanner(zimmer, knoten, archetyp) {
  const banner = document.createElement('div');
  banner.id = 'welcome-banner';
  banner.innerHTML = `
    <div style="
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: 2px solid #C62828;
      border-radius: 12px;
      padding: 1.25rem 2rem;
      z-index: 10000;
      max-width: 500px;
      box-shadow: 0 8px 32px rgba(198,40,40,0.3);
      animation: fadeInDown 0.5s ease;
    ">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <span style="font-size: 2rem;">ğŸ </span>
        <div style="flex: 1;">
          <div style="color: #fff; font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">
            Willkommen in deinem Zimmer!
          </div>
          <div style="color: #AAA; font-size: 0.9rem;">
            ${zimmer}
          </div>
          <div style="color: #888; font-size: 0.8rem; margin-top: 0.5rem;">
            Deine Positionen: ${knoten.join(' Â· ')}
          </div>
        </div>
        <button onclick="document.getElementById('welcome-banner').remove()" style="
          background: transparent;
          border: 1px solid #666;
          color: #AAA;
          padding: 0.25rem 0.75rem;
          border-radius: 4px;
          cursor: pointer;
        ">Ã—</button>
      </div>
    </div>
  `;
  document.body.appendChild(banner);
  
  // Auto-hide nach 8 Sekunden
  setTimeout(() => {
    const b = document.getElementById('welcome-banner');
    if (b) b.style.opacity = '0';
    setTimeout(() => {
      const b2 = document.getElementById('welcome-banner');
      if (b2) b2.remove();
    }, 500);
  }, 8000);
}

// Highlighte Knoten aus dem Generator
function highlightGeneratorKnoten(knotenIds) {
  // Im 2D-Modus: Rahmen hinzufÃ¼gen
  knotenIds.forEach(id => {
    const el = document.querySelector(`[data-knoten-id="${id}"]`);
    if (el) {
      el.style.boxShadow = '0 0 20px rgba(198,40,40,0.8)';
      el.style.border = '2px solid #C62828';
    }
  });
  
  // Ã–ffne das erste Knoten-Detail nach kurzer VerzÃ¶gerung
  // NUR auf Desktop - auf Mobile stÃ¶rt das Fullscreen-Panel
  if (knotenIds.length > 0 && knotenData[knotenIds[0]] && window.innerWidth > 768) {
    setTimeout(() => showKnoten(knotenIds[0]), 2000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GENERATOR-PROFIL VERARBEITUNG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Parse "A1:3,A2:4,B1:2,..." zu {A1: 3, A2: 4, B1: 2, ...}
function parseGeneratorProfil(profilString) {
  const profil = {};
  profilString.split(',').forEach(pair => {
    const [achse, wert] = pair.split(':');
    if (achse && wert) {
      profil[achse.trim()] = parseInt(wert.trim());
    }
  });
  return profil;
}

// Zeigt das Generator-Profil im Konfigurator
function showGeneratorProfil(profil, archetyp, name) {
  generatorProfil = profil;
  generatorArchetyp = archetyp;
  generatorName = name;
  
  // Setze die Auswahl im Konfigurator
  Object.entries(profil).forEach(([achse, wert]) => {
    konfigAuswahl[achse] = wert;
  });
  
  // Konfigurator mit Generator-Modus neu rendern
  renderKonfiguratorMitProfil();
}

// Berechnet Ã„hnlichkeit zwischen Profil und einem Knoten
function berechneProfilMatch(profil, knotenId) {
  const knoten = knotenData[knotenId];
  if (!knoten) return 0;
  
  // Extrahiere Achse und Position aus Knoten-ID (z.B. "A1-3" â†’ A1, 3)
  const match = knotenId.match(/^([A-F]\d)-(\d)$/);
  if (!match) return 0;
  
  const achse = match[1];
  const position = parseInt(match[2]);
  
  // Hat das Profil einen Wert fÃ¼r diese Achse?
  if (profil[achse] !== undefined) {
    const diff = Math.abs(profil[achse] - position);
    return Math.max(0, 100 - diff * 25); // 0 diff = 100%, 1 diff = 75%, etc.
  }
  
  return 0;
}

// Finde alle Knoten sortiert nach Ãœbereinstimmung mit dem Profil
function findeNachbarn(profil, limit = 10) {
  const ergebnisse = [];
  
  Object.keys(knotenData).forEach(id => {
    // FÃ¼r jeden Knoten: Berechne GesamtÃ¼bereinstimmung
    const match = id.match(/^([A-F]\d)-(\d)$/);
    if (!match) return;
    
    const achse = match[1];
    const position = parseInt(match[2]);
    
    if (profil[achse] !== undefined) {
      const diff = Math.abs(profil[achse] - position);
      const score = 100 - diff * 25;
      
      if (score > 0) {
        ergebnisse.push({
          id,
          knoten: knotenData[id],
          achse,
          position,
          profilWert: profil[achse],
          score,
          exakt: diff === 0
        });
      }
    }
  });
  
  // Sortiere nach Score (hÃ¶chste zuerst)
  ergebnisse.sort((a, b) => b.score - a.score);
  
  return ergebnisse.slice(0, limit);
}

// Rendert den Konfigurator mit dem Generator-Profil
function renderKonfiguratorMitProfil() {
  const container = document.getElementById('konfigurator-container');
  if (!container) return;
  
  const profil = generatorProfil || {};
  const archetyp = generatorArchetyp;
  const name = generatorName;
  
  // Achsen-Definition
  const achsen = [
    { id: 'A1', name: 'Reform â†” Revolution', pole: ['Reform', 'Strukturref.', 'Doppel', 'Hegemonie', 'Alternativ'] },
    { id: 'A2', name: 'Rev. Subjekt', pole: ['Industrie', 'Lohnabh.', 'Multitude', 'Intersekt.', 'Leben'] },
    { id: 'A3', name: 'Staat', pole: ['Erobern', 'Umbauen', 'Terrain', 'Ignorieren', 'Abschaffen'] },
    { id: 'A4', name: 'Organisation', pole: ['Zentral', 'Partei', 'Bewegung', 'Netzwerk', 'Basis'] },
    { id: 'B1', name: 'Markt â†” Plan', pole: ['Markt', 'Reguliert', 'Mischung', 'Dem.Plan', 'Vollplan'] },
    { id: 'B2', name: 'Eigentum', pole: ['Staat', 'Ã–ffentl.', 'Gemischt', 'Genoss.', 'Commons'] },
    { id: 'B3', name: 'Arbeit', pole: ['Vollbesch.', 'Gute Arb.', 'Reduktion', 'BGE', 'Post-Work'] },
    { id: 'C1', name: 'Feminismus', pole: ['Klasse', 'Sozial.', 'Dual', 'Intersekt.', 'Radikal'] },
    { id: 'C2', name: 'Natur', pole: ['Produktiv.', 'GrÃ¼n', 'Nachhaltig', 'Ã–kosoz.', 'Rechte'] },
    { id: 'C3', name: 'International', pole: ['National', 'Solidar.', 'Kooper.', 'Global', 'No Border'] },
    { id: 'D1', name: 'Utopie', pole: ['Anti', 'Negativ', 'Prozess', 'Real', 'Konkret'] },
    { id: 'D2', name: 'Transformation', pole: ['Graduell', 'Interstit.', 'Symbiot.', 'Rupturell', 'Revolution'] },
    { id: 'D3', name: 'SpiritualitÃ¤t', pole: ['SÃ¤kular', 'Offen', 'Ã–kumen.', 'Spirit.', 'Mystisch'] },
    { id: 'E1', name: 'BÃ¼ndnisse', pole: ['Klasse', 'Kern', 'Breit', 'Bewegung', 'Alle'] },
    { id: 'E2', name: 'Ebenen', pole: ['Zentral', 'FÃ¶deral', 'Multi', 'Kommun.', 'Basis'] },
    { id: 'E3', name: 'Bildung', pole: ['AufklÃ¤r.', 'Theorie', 'Praxis', 'Erfahrung', 'PrÃ¤fig.'] },
    { id: 'E4', name: 'Mittel', pole: ['Legal', 'Zivil', 'Aktionen', 'Militant', 'Alles'] }
  ];
  
  const hatProfil = Object.keys(profil).length > 0;
  const aktuelleAuswahl = hatProfil ? profil : konfigAuswahl;
  const anzahlGewÃ¤hlt = Object.keys(aktuelleAuswahl).length;
  
  let html = '';
  
  // Header
  if (hatProfil) {
    html += `
      <div class="konfig-generator-header">
        <div class="konfig-generator-icon">ğŸ¯</div>
        <div>
          <h2>Dein Profil im Wesen</h2>
          ${archetyp ? `<p class="archetyp-name">${archetyp}</p>` : ''}
          <p class="konfig-subtitle">Vom Sozialismus-Generator</p>
        </div>
      </div>
    `;
  } else {
    html += `
      <div class="konfig-header">
        <h2>ğŸ›ï¸ Wo stehe ich?</h2>
        <p>WÃ¤hle auf jeder Achse deine Position</p>
        <span class="konfig-hint">ğŸ’¡ <a href="../?start=2" style="color: #C62828;">Sozialismus-Generator</a> fÃ¼r ausfÃ¼hrliche Analyse</span>
      </div>
    `;
  }
  
  // Haupt-Layout: Zwei Spalten
  html += `<div class="konfig-main">`;
  
  // Linke Spalte: Achsen-Grid
  html += `<div class="konfig-achsen">`;
  html += `<div class="konfig-achsen-header">${hatProfil ? 'Dein Profil auf 17 Achsen' : 'WÃ¤hle deine Positionen'}</div>`;
  
  achsen.forEach(achse => {
    const wert = aktuelleAuswahl[achse.id];
    const hatWert = wert !== undefined;
    
    html += `<div class="konfig-achse ${hatWert ? 'has-value' : ''}">`;
    html += `<div class="konfig-achse-header">`;
    html += `<span class="konfig-achse-id">${achse.id}</span>`;
    html += `<span class="konfig-achse-name">${achse.name}</span>`;
    html += `</div>`;
    
    html += `<div class="konfig-slider">`;
    achse.pole.forEach((pol, i) => {
      const pos = i + 1;
      const selected = wert === pos ? 'selected' : '';
      const clickable = !hatProfil ? `onclick="selectKonfig('${achse.id}', ${pos})"` : '';
      html += `<div class="konfig-option ${selected}" ${clickable} title="${pol}">${pos}</div>`;
    });
    html += `</div>`;
    
    html += `</div>`;
  });
  
  html += `</div>`; // Ende Achsen
  
  // Rechte Spalte: Sidebar mit Nachbarn
  html += `<div class="konfig-sidebar">`;
  
  if (anzahlGewÃ¤hlt >= 3) {
    const nachbarn = findeNachbarn(aktuelleAuswahl, 10);
    const exakte = nachbarn.filter(n => n.exakt);
    const nahe = nachbarn.filter(n => !n.exakt);
    
    html += `<div class="konfig-nachbarn">`;
    html += `<h3>ğŸ  Deine Positionen</h3>`;
    
    if (exakte.length > 0) {
      html += `<div class="nachbarn-gruppe">`;
      html += `<div class="nachbarn-label">Genau deine Position</div>`;
      html += `<div class="nachbarn-liste">`;
      exakte.forEach(n => {
        html += `<div class="nachbar-card exakt" onclick="showKnoten('${n.id}'); closeAllWerkzeuge();">
          <span class="nachbar-name">${n.knoten.name}</span>
          <span class="nachbar-id">${n.id}</span>
        </div>`;
      });
      html += `</div></div>`;
    }
    
    if (nahe.length > 0) {
      html += `<div class="nachbarn-gruppe">`;
      html += `<div class="nachbarn-label">In deiner NÃ¤he</div>`;
      html += `<div class="nachbarn-liste">`;
      nahe.slice(0, 6).forEach(n => {
        html += `<div class="nachbar-card nahe" onclick="showKnoten('${n.id}'); closeAllWerkzeuge();">
          <span class="nachbar-name">${n.knoten.name}</span>
          <span class="nachbar-match">${n.score}%</span>
        </div>`;
      });
      html += `</div></div>`;
    }
    
    // Actions
    html += `<div class="konfig-actions">`;
    html += `<button class="konfig-btn primary" onclick="zeigeProfilImHaus();">ğŸ  Empfohlene Zimmer</button>`;
    if (hatProfil) {
      html += `<button class="konfig-btn" onclick="generatorProfil=null; konfigAuswahl={}; renderKonfiguratorMitProfil();">ğŸ”„ Manuell</button>`;
    } else {
      html += `<button class="konfig-btn" onclick="konfigAuswahl={}; renderKonfiguratorMitProfil();">ğŸ”„ Reset</button>`;
    }
    html += `</div>`;
    
    html += `</div>`; // Ende Nachbarn
  } else {
    // Noch nicht genug gewÃ¤hlt
    html += `<div class="konfig-nachbarn">`;
    html += `<div class="konfig-hint-box">`;
    html += `<span class="count">${anzahlGewÃ¤hlt}/3</span>`;
    html += `WÃ¤hle mindestens 3 Achsen um deine Nachbarn zu sehen`;
    html += `</div>`;
    html += `</div>`;
  }
  
  html += `</div>`; // Ende Sidebar
  html += `</div>`; // Ende Main
  
  container.innerHTML = html;
}

// Zeigt das Profil in der WG/Haus-Ansicht
function zeigeProfilImHaus() {
  // Zur WG-Ansicht wechseln und Funktional-Modus rendern (Default)
  setAnsicht('wg');
  
  // Kurz warten, dann rendern mit Profil
  setTimeout(() => {
    renderHaus('erkunden');
  }, 100);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ZIMMER-FINDER: Personalisierte Fragen nach Archetyp
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Fragen-Texte pro Achse (generisch, fÃ¼r alle Archetypen)
const zimmerFinderAchsenFragen = {
  A1: {
    titel: 'Reform oder Revolution?',
    frage: 'Wie erreichst du gesellschaftliche VerÃ¤nderung?',
    optionen: [
      { wert: 1, text: 'Schrittweise Reformen im bestehenden System' },
      { wert: 2, text: 'Strukturreformen, die das System verbessern' },
      { wert: 3, text: 'Doppelstrategie: Reformen nutzen, Systemwechsel vorbereiten' },
      { wert: 4, text: 'Gegen-Hegemonie aufbauen, dann transformieren' },
      { wert: 5, text: 'RevolutionÃ¤rer Bruch â€“ das System muss fallen' }
    ]
  },
  A2: {
    titel: 'Wer macht die Revolution?',
    frage: 'Wer ist das Subjekt der VerÃ¤nderung?',
    optionen: [
      { wert: 1, text: 'Die industrielle Arbeiterklasse' },
      { wert: 2, text: 'Alle LohnabhÃ¤ngigen gemeinsam' },
      { wert: 3, text: 'Die Multitude â€“ alle Ausgebeuteten' },
      { wert: 4, text: 'Intersektionale Allianzen verschiedener KÃ¤mpfe' },
      { wert: 5, text: 'Alles Leben â€“ Menschen, Tiere, Natur' }
    ]
  },
  A3: {
    titel: 'Was tun mit dem Staat?',
    frage: 'Wie stehst du zum Staat als Mittel der VerÃ¤nderung?',
    optionen: [
      { wert: 1, text: 'Den Staat erobern und fÃ¼r uns nutzen' },
      { wert: 2, text: 'Den Staat demokratisch umbauen' },
      { wert: 3, text: 'Der Staat ist umkÃ¤mpftes Terrain' },
      { wert: 4, text: 'Parallelstrukturen aufbauen, Staat ignorieren' },
      { wert: 5, text: 'Den Staat abschaffen â€“ er ist Teil des Problems' }
    ]
  },
  A4: {
    titel: 'Wie organisieren wir uns?',
    frage: 'Welche Organisationsform bevorzugst du?',
    optionen: [
      { wert: 1, text: 'Zentralistische Kaderpartei' },
      { wert: 2, text: 'Demokratische Massenpartei' },
      { wert: 3, text: 'Bewegungspartei mit offenem Charakter' },
      { wert: 4, text: 'Lose Netzwerke und BÃ¼ndnisse' },
      { wert: 5, text: 'Basisdemokratische RÃ¤testrukturen' }
    ]
  },
  B1: {
    titel: 'Markt oder Plan?',
    frage: 'Wie soll die Wirtschaft koordiniert werden?',
    optionen: [
      { wert: 1, text: 'Regulierte Marktwirtschaft' },
      { wert: 2, text: 'Starke staatliche Steuerung mit Markt' },
      { wert: 3, text: 'Mischsystem mit verschiedenen Sektoren' },
      { wert: 4, text: 'Demokratische Planung von unten' },
      { wert: 5, text: 'VollstÃ¤ndige gesellschaftliche Planung' }
    ]
  },
  B2: {
    titel: 'Wem gehÃ¶rt was?',
    frage: 'Wie soll Eigentum organisiert sein?',
    optionen: [
      { wert: 1, text: 'Staatseigentum an SchlÃ¼sselindustrien' },
      { wert: 2, text: 'Ã–ffentliches Eigentum mit demokratischer Kontrolle' },
      { wert: 3, text: 'Mischung verschiedener Eigentumsformen' },
      { wert: 4, text: 'Genossenschaften und Kollektive' },
      { wert: 5, text: 'Commons â€“ Gemeineigentum ohne Staat' }
    ]
  },
  B3: {
    titel: 'Arbeit â€“ wie viel davon?',
    frage: 'Wie stehst du zur Lohnarbeit?',
    optionen: [
      { wert: 1, text: 'VollbeschÃ¤ftigung fÃ¼r alle' },
      { wert: 2, text: 'Gute Arbeit mit fairen Bedingungen' },
      { wert: 3, text: 'ArbeitszeitverkÃ¼rzung und Umverteilung' },
      { wert: 4, text: 'Grundeinkommen und freiwillige Arbeit' },
      { wert: 5, text: 'Post-Work: Befreiung von der Lohnarbeit' }
    ]
  },
  C1: {
    titel: 'Klasse und Geschlecht',
    frage: 'Wie verbindest du Feminismus und Klassenkampf?',
    optionen: [
      { wert: 1, text: 'Klassenkampf zuerst â€“ Feminismus kommt danach' },
      { wert: 2, text: 'Sozialistischer Feminismus im Klassenkampf' },
      { wert: 3, text: 'Beide KÃ¤mpfe gleichwertig verbinden' },
      { wert: 4, text: 'Intersektionale Analyse aller UnterdrÃ¼ckung' },
      { wert: 5, text: 'Radikaler Feminismus als Basis aller Befreiung' }
    ]
  },
  C2: {
    titel: 'Mensch und Natur',
    frage: 'Wie radikal ist dein Ã–kologismus?',
    optionen: [
      { wert: 1, text: 'ProduktivkrÃ¤fte entwickeln, Natur nutzen' },
      { wert: 2, text: 'GrÃ¼nes Wachstum ist mÃ¶glich' },
      { wert: 3, text: 'Nachhaltigkeit durch Regulierung' },
      { wert: 4, text: 'Ã–kosozialismus: System Change fÃ¼rs Klima' },
      { wert: 5, text: 'Eigenrechte der Natur â€“ radikaler Ã–kosozialismus' }
    ]
  },
  C3: {
    titel: 'Lokal oder Global?',
    frage: 'Auf welcher Ebene kÃ¤mpfst du?',
    optionen: [
      { wert: 1, text: 'National â€“ hier kÃ¶nnen wir etwas Ã¤ndern' },
      { wert: 2, text: 'Internationale SolidaritÃ¤t mit nationalem Fokus' },
      { wert: 3, text: 'Transnationale Kooperation und Vernetzung' },
      { wert: 4, text: 'Globale Bewegungen und Strukturen' },
      { wert: 5, text: 'No Borders â€“ Internationalismus radikal gedacht' }
    ]
  },
  D1: {
    titel: 'Brauchen wir Utopien?',
    frage: 'Wie konkret soll das Ziel sein?',
    optionen: [
      { wert: 1, text: 'Anti-Utopismus: Kritik genÃ¼gt, keine Blaupausen' },
      { wert: 2, text: 'Negative Utopie: Wissen was wir NICHT wollen' },
      { wert: 3, text: 'Der Weg ist das Ziel â€“ prozesshaft denken' },
      { wert: 4, text: 'Real-Utopien: Machbare Alternativen entwickeln' },
      { wert: 5, text: 'Konkrete Utopie: Detaillierte Zukunftsbilder' }
    ]
  },
  D2: {
    titel: 'Wie transformieren?',
    frage: 'Wie radikal muss der Wandel sein?',
    optionen: [
      { wert: 1, text: 'Graduell â€“ Schritt fÃ¼r Schritt' },
      { wert: 2, text: 'Interstitiell â€“ Alternativen in den Nischen' },
      { wert: 3, text: 'Symbiotisch â€“ mit dem System arbeiten' },
      { wert: 4, text: 'Rupturell â€“ BrÃ¼che provozieren' },
      { wert: 5, text: 'RevolutionÃ¤r â€“ fundamentaler Systembruch' }
    ]
  },
  D3: {
    titel: 'SpiritualitÃ¤t und Politik',
    frage: 'Welche Rolle spielt SpiritualitÃ¤t?',
    optionen: [
      { wert: 1, text: 'Strikt sÃ¤kular â€“ Religion ist Privatsache' },
      { wert: 2, text: 'Offen fÃ¼r religiÃ¶se Genoss*innen' },
      { wert: 3, text: 'Verschiedene Weltanschauungen respektieren' },
      { wert: 4, text: 'Spirituelle Dimensionen in der Politik' },
      { wert: 5, text: 'Innere und Ã¤uÃŸere Transformation verbinden' }
    ]
  },
  E1: {
    titel: 'Mit wem verbÃ¼nden?',
    frage: 'Wie breit sollen BÃ¼ndnisse sein?',
    optionen: [
      { wert: 1, text: 'Klassenlinie halten â€“ keine VerwÃ¤sserung' },
      { wert: 2, text: 'Stabiler sozialistischer Kern' },
      { wert: 3, text: 'Breite BÃ¼ndnisse mit klaren Prinzipien' },
      { wert: 4, text: 'BewegungsÃ¼bergreifende Allianzen' },
      { wert: 5, text: 'Alle gegen das System â€“ breiteste Front' }
    ]
  },
  E2: {
    titel: 'Auf welcher Ebene?',
    frage: 'Wo setzt politisches Handeln an?',
    optionen: [
      { wert: 1, text: 'Zentral â€“ nationale/staatliche Ebene' },
      { wert: 2, text: 'FÃ¶deral â€“ LÃ¤nder und Regionen' },
      { wert: 3, text: 'Mehrebenen â€“ je nach Thema' },
      { wert: 4, text: 'Kommunal â€“ die Stadt als Ausgangspunkt' },
      { wert: 5, text: 'Basisdemokratisch â€“ von unten aufbauen' }
    ]
  },
  E3: {
    titel: 'Wie lernen wir?',
    frage: 'Theorie oder Praxis â€“ was kommt zuerst?',
    optionen: [
      { wert: 1, text: 'AufklÃ¤rung â€“ Wissen verbreiten' },
      { wert: 2, text: 'Theoriearbeit als Grundlage' },
      { wert: 3, text: 'Praxis-Theorie-Praxis-Zyklus' },
      { wert: 4, text: 'Lernen im Kampf â€“ Erfahrung zÃ¤hlt' },
      { wert: 5, text: 'PrÃ¤figuration â€“ die Zukunft jetzt leben' }
    ]
  },
  E4: {
    titel: 'Welche Mittel?',
    frage: 'Wie weit gehst du im Widerstand?',
    optionen: [
      { wert: 1, text: 'Strikt legal â€“ alle Rechtswege nutzen' },
      { wert: 2, text: 'Ziviler Ungehorsam wenn nÃ¶tig' },
      { wert: 3, text: 'Direkte Aktionen situativ einsetzen' },
      { wert: 4, text: 'Militante Aktionen als Option' },
      { wert: 5, text: 'Alle Mittel â€“ die Situation entscheidet' }
    ]
  }
};

// Zimmer-Finder State
let zimmerFinderState = {
  archetyp: null,
  archetypData: null,
  fragenAchsen: [],
  aktuelleFrageIndex: 0,
  antworten: {}
};

// Finde die 4 extremsten Achsen eines Archetyps
function findeExtremeAchsen(ideal, anzahl = 4) {
  const achsenDistanzen = Object.entries(ideal).map(([achse, wert]) => ({
    achse,
    wert,
    distanz: Math.abs(wert - 3) // Distanz zur Mitte
  }));
  
  // Sortiere nach Extremheit (hÃ¶chste Distanz zuerst)
  achsenDistanzen.sort((a, b) => b.distanz - a.distanz);
  
  // Nimm die extremsten
  return achsenDistanzen.slice(0, anzahl).map(a => a.achse);
}

// Startet den Zimmer-Finder
function starteZimmerFinder(archetypId) {
  const archetypen = window.archetypen;
  if (!archetypen || !archetypen[archetypId]) {
    console.error('Archetyp nicht gefunden:', archetypId);
    return;
  }
  
  const archetypData = archetypen[archetypId];
  const ideal = archetypData.ideal || {};
  
  // Finde die 4 extremsten Achsen
  const fragenAchsen = findeExtremeAchsen(ideal, 4);
  
  console.log('Zimmer-Finder gestartet fÃ¼r:', archetypId);
  console.log('Fragen zu Achsen:', fragenAchsen);
  
  // State initialisieren
  zimmerFinderState = {
    archetyp: archetypId,
    archetypData,
    fragenAchsen,
    aktuelleFrageIndex: 0,
    antworten: { ...ideal } // Starte mit ideal-Werten als Default
  };
  
  // UI anzeigen
  zeigeZimmerFinderPopup();
}

// Zeigt das Zimmer-Finder Popup
function zeigeZimmerFinderPopup() {
  // Entferne altes Popup falls vorhanden
  const altes = document.getElementById('zimmer-finder-popup');
  if (altes) altes.remove();
  
  const popup = document.createElement('div');
  popup.id = 'zimmer-finder-popup';
  popup.innerHTML = renderZimmerFinderInhalt();
  document.body.appendChild(popup);
}

// Rendert den aktuellen Inhalt des Zimmer-Finders
function renderZimmerFinderInhalt() {
  const { archetyp, archetypData, fragenAchsen, aktuelleFrageIndex, antworten } = zimmerFinderState;
  const istLetzteFrage = aktuelleFrageIndex >= fragenAchsen.length;
  
  let html = `
    <div class="zimmer-finder-overlay">
      <div class="zimmer-finder-modal">
  `;
  
  if (istLetzteFrage) {
    // Ergebnis anzeigen
    html += renderZimmerFinderErgebnis();
  } else {
    // Frage anzeigen
    const achse = fragenAchsen[aktuelleFrageIndex];
    const frageData = zimmerFinderAchsenFragen[achse];
    const aktuellerWert = antworten[achse] || 3;
    
    html += `
      <div class="zimmer-finder-header">
        <div class="zimmer-finder-archetyp">
          <span class="archetyp-icon">${archetypData.icon}</span>
          <span class="archetyp-name">${archetypData.name}</span>
        </div>
        <div class="zimmer-finder-progress">
          Frage ${aktuelleFrageIndex + 1} von ${fragenAchsen.length}
        </div>
      </div>
      
      <div class="zimmer-finder-frage">
        <h2>${frageData.titel}</h2>
        <p class="frage-text">${frageData.frage}</p>
        
        <div class="zimmer-finder-optionen">
          ${frageData.optionen.map(opt => `
            <label class="zf-option ${opt.wert === aktuellerWert ? 'selected' : ''}" onclick="waehleZimmerFinderOption('${achse}', ${opt.wert})">
              <span class="zf-radio ${opt.wert === aktuellerWert ? 'checked' : ''}"></span>
              <span class="zf-option-text">${opt.text}</span>
              <span class="zf-option-wert">${opt.wert}</span>
            </label>
          `).join('')}
        </div>
      </div>
      
      <div class="zimmer-finder-actions">
        ${aktuelleFrageIndex > 0 ? `
          <button class="zf-btn secondary" onclick="zimmerFinderZurueck()">â† ZurÃ¼ck</button>
        ` : `
          <button class="zf-btn secondary" onclick="zimmerFinderUeberspringen()">Ãœberspringen</button>
        `}
        <button class="zf-btn primary" onclick="zimmerFinderWeiter()">
          ${aktuelleFrageIndex === fragenAchsen.length - 1 ? 'Ergebnis anzeigen' : 'Weiter â†’'}
        </button>
      </div>
    `;
  }
  
  html += `
      </div>
    </div>
  `;
  
  return html;
}

// Rendert das Ergebnis des Zimmer-Finders
function renderZimmerFinderErgebnis() {
  const { archetyp, archetypData, antworten } = zimmerFinderState;
  
  // Berechne "Dein Platz" basierend auf den Antworten
  const platz = berechneDeinenPlatz(antworten);
  const hauptzimmer = platz?.hauptzimmer;
  const achsenMeta = window.achsenMeta;
  
  let html = `
    <div class="zimmer-finder-header ergebnis">
      <div class="zimmer-finder-archetyp">
        <span class="archetyp-icon">${archetypData.icon}</span>
        <span class="archetyp-name">${archetypData.name}</span>
      </div>
      <div class="zimmer-finder-titel">Dein Platz im Haus</div>
    </div>
    
    <div class="zimmer-finder-ergebnis">
  `;
  
  if (hauptzimmer) {
    const meta = achsenMeta[hauptzimmer.achse];
    const posName = meta?.pole[hauptzimmer.profilWert - 1] || hauptzimmer.profilWert;
    
    html += `
      <div class="zf-hauptzimmer">
        <div class="zf-badge">ğŸ”¥ Hier wirst du gebraucht</div>
        <div class="zf-zimmer-header">
          <span class="zf-etage-icon">${hauptzimmer.etageIcon}</span>
          <div>
            <h3>${hauptzimmer.zimmer.name}</h3>
            <span class="zf-achse">${hauptzimmer.achse} â€” ${hauptzimmer.zimmer.beschreibung}</span>
          </div>
        </div>
        <div class="zf-position">
          <span class="zf-pos-label">Deine Position:</span>
          <span class="zf-pos-wert">${hauptzimmer.profilWert}</span>
          <span class="zf-pos-name">${posName}</span>
        </div>
        <div class="zf-aufgabe">
          <span class="zf-aufgabe-icon">âœŠ</span>
          <p>${hauptzimmer.aufgabe}</p>
        </div>
      </div>
    `;
  }
  
  // Weitere Zimmer
  if (platz?.weitereZimmer?.length > 0) {
    html += `<div class="zf-weitere-titel">ğŸ’¡ Weitere RÃ¤ume fÃ¼r dich:</div>`;
    html += `<div class="zf-weitere-liste">`;
    
    platz.weitereZimmer.slice(0, 3).forEach(z => {
      const meta = achsenMeta[z.achse];
      const posName = meta?.pole[z.profilWert - 1] || z.profilWert;
      
      html += `
        <div class="zf-weiteres-zimmer">
          <span class="zf-weiteres-icon">${z.etageIcon}</span>
          <div>
            <span class="zf-weiteres-name">${z.zimmer.name}</span>
            <span class="zf-weiteres-pos">Position ${z.profilWert}: ${posName}</span>
          </div>
        </div>
      `;
    });
    
    html += `</div>`;
  }
  
  // Ã„hnliche Archetypen
  const aehnliche = findeAehnlicheArchetypen(archetyp, 3);
  if (aehnliche.length > 0) {
    html += `
      <div class="zf-wg-empfehlung">
        <div class="zf-wg-label">ğŸ¤ Du passt gut zu:</div>
        <div class="zf-wg-liste">
          ${aehnliche.map(a => `
            <span class="zf-wg-item" style="--accent: ${a.farbe}">${a.icon} ${a.name}</span>
          `).join('')}
        </div>
      </div>
    `;
  }
  
  html += `
    </div>
    
    <div class="zimmer-finder-actions ergebnis">
      <button class="zf-btn primary gross" onclick="zimmerFinderAbschliessen()">
        ğŸ  Haus erkunden
      </button>
    </div>
  `;
  
  return html;
}

// Option wÃ¤hlen
function waehleZimmerFinderOption(achse, wert) {
  zimmerFinderState.antworten[achse] = wert;
  
  // UI aktualisieren
  const popup = document.getElementById('zimmer-finder-popup');
  if (popup) {
    popup.innerHTML = renderZimmerFinderInhalt();
  }
}

// Weiter zur nÃ¤chsten Frage
function zimmerFinderWeiter() {
  zimmerFinderState.aktuelleFrageIndex++;
  
  const popup = document.getElementById('zimmer-finder-popup');
  if (popup) {
    popup.innerHTML = renderZimmerFinderInhalt();
  }
}

// ZurÃ¼ck zur vorherigen Frage
function zimmerFinderZurueck() {
  if (zimmerFinderState.aktuelleFrageIndex > 0) {
    zimmerFinderState.aktuelleFrageIndex--;
    
    const popup = document.getElementById('zimmer-finder-popup');
    if (popup) {
      popup.innerHTML = renderZimmerFinderInhalt();
    }
  }
}

// Ãœberspringen (alle Archetyp-Defaults Ã¼bernehmen)
function zimmerFinderUeberspringen() {
  // Direkt zum Ergebnis
  zimmerFinderState.aktuelleFrageIndex = zimmerFinderState.fragenAchsen.length;
  
  const popup = document.getElementById('zimmer-finder-popup');
  if (popup) {
    popup.innerHTML = renderZimmerFinderInhalt();
  }
}

// AbschlieÃŸen und ins Haus wechseln
function zimmerFinderAbschliessen() {
  const { archetyp, antworten } = zimmerFinderState;
  
  // Profil setzen
  generatorProfil = antworten;
  generatorArchetyp = archetyp;
  
  // Popup entfernen
  const popup = document.getElementById('zimmer-finder-popup');
  if (popup) popup.remove();
  
  // Ins Haus wechseln
  setAnsicht('wg');
  renderHaus('erkunden');
}

// Berechnet das Hauptzimmer und weitere passende Zimmer basierend auf Profil
function berechneDeinenPlatz(profil) {
  if (!profil || Object.keys(profil).length === 0) return null;
  
  const hausStruktur = window.hausStruktur;
  const achsenMeta = window.achsenMeta;
  
  // Sammle alle Zimmer mit Bewertung
  const bewerteteZimmer = [];
  
  hausStruktur.forEach(etage => {
    etage.zimmer.forEach(zimmer => {
      const achse = zimmer.achse;
      const profilWert = profil[achse];
      
      if (profilWert !== undefined) {
        // Extremheit: Wie weit von der Mitte (3) entfernt?
        const distanzZurMitte = Math.abs(profilWert - 3);
        
        bewerteteZimmer.push({
          achse,
          zimmer,
          etage: etage.name,
          etageIcon: etage.icon,
          profilWert,
          extremheit: distanzZurMitte,
          richtung: profilWert > 3 ? 'progressiv' : profilWert < 3 ? 'traditionell' : 'vermittelnd',
          aufgabe: generiereAufgabe(achse, profilWert)
        });
      }
    });
  });
  
  // Finde maximale Extremheit
  const maxExtremheit = Math.max(...bewerteteZimmer.map(z => z.extremheit));
  
  // Sammle alle Zimmer mit maximaler Extremheit
  const extremsteZimmer = bewerteteZimmer.filter(z => z.extremheit === maxExtremheit);
  
  // WÃ¤hle zufÃ¤llig eines der extremsten Zimmer
  const hauptzimmer = extremsteZimmer[Math.floor(Math.random() * extremsteZimmer.length)];
  
  // Sortiere restliche nach Extremheit fÃ¼r "weitere Zimmer"
  const weitereZimmer = bewerteteZimmer
    .filter(z => z.achse !== hauptzimmer?.achse)
    .sort((a, b) => b.extremheit - a.extremheit);
  
  return {
    hauptzimmer: hauptzimmer || null,
    weitereZimmer: weitereZimmer.slice(0, 3), // Top 3 weitere
    alleZimmer: bewerteteZimmer
  };
}

// Generiert eine persÃ¶nliche Aufgabe basierend auf Achse und Position
function generiereAufgabe(achse, wert) {
  const aufgaben = {
    A1: {
      1: "Du verteidigst realistische Reformen gegen utopische TrÃ¤umereien und zeigst, dass kleine Schritte zum Ziel fÃ¼hren.",
      2: "Du bringst pragmatische Perspektiven in revolutionÃ¤re Debatten und baust BrÃ¼cken zwischen Positionen.",
      3: "Du vermittelst zwischen Reform und Revolution und hÃ¤ltst beide Optionen offen.",
      4: "Du treibst radikale Transformation voran und zeigst, dass Systemwechsel nÃ¶tig ist.",
      5: "Du erinnerst alle daran: Ohne Bruch keine Befreiung. Du hÃ¤ltst die revolutionÃ¤re Perspektive wach."
    },
    A2: {
      1: "Du betonst die zentrale Rolle der Arbeiterklasse und organisierst in Betrieben.",
      2: "Du erweiterst den Blick auf alle LohnabhÃ¤ngigen und verbindest verschiedene Sektoren.",
      3: "Du verbindest verschiedene Subjekte und suchst nach Gemeinsamkeiten.",
      4: "Du bringst intersektionale Perspektiven ein und zeigst UnterdrÃ¼ckungszusammenhÃ¤nge auf.",
      5: "Du erweiterst das revolutionÃ¤re Subjekt auf alles Leben und denkst radikal inklusiv."
    },
    A3: {
      1: "Du analysierst den Staat als Werkzeug und entwickelst Strategien zu seiner Eroberung.",
      2: "Du arbeitest an konkreten Staatsreformen und demokratischen UmbaumaÃŸnahmen.",
      3: "Du siehst den Staat als umkÃ¤mpftes Terrain und navigierst klug zwischen den Positionen.",
      4: "Du baust autonome Strukturen jenseits des Staates auf und lebst Alternativen vor.",
      5: "Du erinnerst an die herrschaftliche Natur des Staates und arbeitest an seiner Ãœberwindung."
    },
    A4: {
      1: "Du organisierst effiziente zentrale Strukturen fÃ¼r koordiniertes Handeln.",
      2: "Du baust Parteistrukturen auf, die Massenwirkung entfalten kÃ¶nnen.",
      3: "Du verbindest verschiedene Organisationsformen und lernst von allen.",
      4: "Du vernetzt dezentrale Initiativen und stÃ¤rkst horizontale Strukturen.",
      5: "Du praktizierst und lehrst basisdemokratische Entscheidungsfindung."
    },
    B1: {
      1: "Du zeigst, wie sozial regulierte MÃ¤rkte funktionieren kÃ¶nnen.",
      2: "Du entwickelst hybride Wirtschaftsmodelle mit starker Regulierung.",
      3: "Du experimentierst mit verschiedenen Koordinationsmechanismen.",
      4: "Du arbeitest an demokratischer Wirtschaftsplanung und Partizipation.",
      5: "Du entwickelst Visionen umfassender demokratischer Planung."
    },
    B2: {
      1: "Du stÃ¤rkst Ã¶ffentliches Eigentum und staatliche Daseinsvorsorge.",
      2: "Du entwickelst Modelle gesellschaftlichen Eigentums mit demokratischer Kontrolle.",
      3: "Du erforschst verschiedene Eigentumsformen und ihre StÃ¤rken.",
      4: "Du baust genossenschaftliche Strukturen auf und vernetzt sie.",
      5: "Du praktizierst und verbreitest Commons-basierte Wirtschaft."
    },
    B3: {
      1: "Du kÃ¤mpfst fÃ¼r gute Arbeit fÃ¼r alle und gegen Arbeitslosigkeit.",
      2: "Du setzt dich fÃ¼r bessere Arbeitsbedingungen und Mitbestimmung ein.",
      3: "Du verbindest ArbeitskÃ¤mpfe mit ArbeitszeitverkÃ¼rzung.",
      4: "Du entwickelst Konzepte fÃ¼r ein bedingungsloses Grundeinkommen.",
      5: "Du denkst radikal Ã¼ber Arbeit hinaus und praktizierst Post-Work-Politik."
    },
    C1: {
      1: "Du betonst den Primat des Klassenkampfs und organisierst auf dieser Basis.",
      2: "Du verbindest Klassenpolitik mit anderen KÃ¤mpfen ohne Hierarchisierung.",
      3: "Du suchst nach Verbindungen zwischen verschiedenen UnterdrÃ¼ckungsformen.",
      4: "Du bringst intersektionale Analyse in alle politischen Diskussionen.",
      5: "Du machst feministischen Kampf zum Zentrum revolutionÃ¤rer Politik."
    },
    C2: {
      1: "Du betonst die Notwendigkeit von Produktion und materieller Entwicklung.",
      2: "Du verbindest soziale mit Ã¶kologischen Forderungen pragmatisch.",
      3: "Du suchst nach sozial-Ã¶kologischen Win-Win-LÃ¶sungen.",
      4: "Du machst Klimagerechtigkeit zum Kern sozialistischer Politik.",
      5: "Du vertrittst Eigenrechte der Natur und radikalen Ã–kosozialismus."
    },
    C3: {
      1: "Du stÃ¤rkst nationale HandlungsfÃ¤higkeit als Basis fÃ¼r VerÃ¤nderung.",
      2: "Du praktizierst internationale SolidaritÃ¤t mit lokaler Verankerung.",
      3: "Du baust internationale Kooperationen auf praktischer Ebene.",
      4: "Du arbeitest an globalen sozialistischen Netzwerken.",
      5: "Du praktizierst und predigst Internationalismus ohne Kompromisse."
    },
    D1: {
      1: "Du warnst vor den Gefahren utopischer EntwÃ¼rfe und betonst Negation.",
      2: "Du formulierst, was wir nicht wollen, ohne vorschnell LÃ¶sungen zu geben.",
      3: "Du hÃ¤ltst Prozess und Ziel in produktiver Spannung.",
      4: "Du entwickelst realistische Utopien, die inspirieren und orientieren.",
      5: "Du malst konkrete Bilder der befreiten Gesellschaft."
    },
    D2: {
      1: "Du entwickelst Strategien gradueller Transformation mit Geduld.",
      2: "Du baust alternative Strukturen in den Nischen des Systems.",
      3: "Du kombinierst verschiedene Transformationsstrategien klug.",
      4: "Du arbeitest auf gesellschaftliche Bruchpunkte hin.",
      5: "Du hÃ¤ltst die revolutionÃ¤re Perspektive eines fundamentalen Bruchs wach."
    },
    D3: {
      1: "Du betonst den sÃ¤kularen Charakter linker Politik.",
      2: "Du bist offen fÃ¼r religiÃ¶se Genoss*innen ohne Religion zu fÃ¶rdern.",
      3: "Du verbindest verschiedene Weltanschauungen respektvoll.",
      4: "Du bringst spirituelle Dimensionen in politische Arbeit ein.",
      5: "Du verbindest innere und Ã¤uÃŸere Transformation radikal."
    },
    E1: {
      1: "Du hÃ¤ltst die klare Klassenlinie und warnst vor VerwÃ¤sserung.",
      2: "Du baust einen stabilen sozialistischen Kern mit klarer Linie.",
      3: "Du suchst nach BÃ¼ndnissen mit klaren Prinzipien.",
      4: "Du vernetzt verschiedene Bewegungen und findest Gemeinsamkeiten.",
      5: "Du baust die breitestmÃ¶gliche Front gegen Kapital und Reaktion."
    },
    E2: {
      1: "Du koordinierst zentral fÃ¼r maximale Schlagkraft.",
      2: "Du baust fÃ¶derale Strukturen mit klarer Arbeitsteilung.",
      3: "Du denkst und handelst auf mehreren Ebenen gleichzeitig.",
      4: "Du stÃ¤rkst kommunale Selbstverwaltung und lokale Macht.",
      5: "Du praktizierst und lehrst Basisdemokratie von unten."
    },
    E3: {
      1: "Du organisierst AufklÃ¤rung und politische Bildungsarbeit.",
      2: "Du verbindest theoretische Arbeit mit Praxisreflexion.",
      3: "Du lernst aus Theorie und Praxis gleichermaÃŸen.",
      4: "Du betonst Erfahrungswissen und gemeinsames Lernen im Kampf.",
      5: "Du lebst schon jetzt vor, wie die befreite Gesellschaft aussieht."
    },
    E4: {
      1: "Du organisierst strikt legalen Widerstand und nutzt alle Rechtswege.",
      2: "Du praktizierst zivilen Ungehorsam als legitimes Mittel.",
      3: "Du wÃ¤hlst Mittel situativ und begrÃ¼ndest sie kontextabhÃ¤ngig.",
      4: "Du organisierst militante Aktionen wenn nÃ¶tig.",
      5: "Du hÃ¤ltst alle Optionen offen und entscheidest taktisch."
    }
  };
  
  return aufgaben[achse]?.[wert] || "Du bringst deine einzigartige Perspektive ein.";
}

// Rendert die "Dein Platz"-Ansicht - 3 gleichwertige Zimmer
function renderDeinPlatz(profil, archetyp) {
  const platz = berechneDeinenPlatz(profil);
  if (!platz || !platz.alleZimmer || platz.alleZimmer.length === 0) return '';
  
  const achsenMeta = window.achsenMeta;
  
  // Top 3 Zimmer nach Extremheit (alle gleichwertig)
  const topZimmer = platz.alleZimmer
    .sort((a, b) => b.extremheit - a.extremheit)
    .slice(0, 3);
  
  let html = `
    <div class="dein-platz">
      <div class="dein-platz-header">
        <span class="dein-platz-icon">ğŸ”¥</span>
        <div>
          <h2>Hier wirst du gebraucht</h2>
          <p>Basierend auf deinem Profil: Diese drei Bereiche passen besonders zu dir</p>
        </div>
      </div>
      
      <div class="drei-zimmer-grid">
  `;
  
  topZimmer.forEach((z, index) => {
    const meta = achsenMeta[z.achse];
    const posName = meta?.pole[z.profilWert - 1] || `Position ${z.profilWert}`;
    const knotenId = `${z.achse}-${z.profilWert}`;
    const knoten = knotenData[knotenId];
    
    html += `
      <div class="empfohlenes-zimmer" onclick="zeigeEmpfohlenesZimmer('${z.achse}', ${z.profilWert})">
        <div class="empf-zimmer-header">
          <span class="empf-zimmer-icon">${z.etageIcon}</span>
          <span class="empf-zimmer-achse">${z.achse}</span>
        </div>
        <h3 class="empf-zimmer-name">${z.zimmer.name}</h3>
        <p class="empf-zimmer-frage">${z.zimmer.beschreibung}</p>
        <div class="empf-zimmer-position">
          <span class="empf-pos-nummer">${z.profilWert}</span>
          <span class="empf-pos-name">${knoten?.name || posName}</span>
        </div>
        <div class="empf-zimmer-teaser">
          <span class="teaser-icon">âœŠ</span>
          <span class="teaser-text">${z.aufgabe.slice(0, 80)}...</span>
        </div>
        <div class="empf-zimmer-action">
          <span>Klick fÃ¼r konkrete Aufgaben â†’</span>
        </div>
      </div>
    `;
  });
  
  html += `
      </div>
    </div>
  `;
  
  return html;
}

// Zeigt Popup fÃ¼r empfohlenes Zimmer mit konkreten Aufgaben
function zeigeEmpfohlenesZimmer(achse, position) {
  const zimmer = window.hausStruktur
    .flatMap(e => e.zimmer)
    .find(z => z.achse === achse);
  
  if (!zimmer) return;
  
  const meta = window.achsenMeta[achse];
  const knotenId = `${achse}-${position}`;
  const knoten = knotenData[knotenId];
  const posName = knoten?.name || meta?.pole[position - 1] || `Position ${position}`;
  
  // Generiere 3 konkrete Aufgaben
  const aufgaben = generiereKonkreteAufgaben(achse, position);
  
  const html = `
    <div class="zimmer-detail-overlay" onclick="this.remove()">
      <div class="zimmer-detail-popup empfohlenes-popup" onclick="event.stopPropagation()">
        <button class="zimmer-detail-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
        
        <div class="empf-popup-header">
          <span class="empf-popup-achse">${achse}</span>
          <h3>${zimmer.name}</h3>
        </div>
        
        <p class="empf-popup-frage">${zimmer.beschreibung}</p>
        
        <div class="empf-popup-position">
          <div class="position-marker">
            <span class="position-nummer">${position}</span>
          </div>
          <div class="position-info">
            <span class="position-name">${posName}</span>
            ${knoten?.beschreibung ? `<p class="position-beschreibung">${knoten.beschreibung}</p>` : ''}
          </div>
        </div>
        
        ${knoten?.zitate?.[0] ? `
          <div class="empf-popup-zitat">
            <span class="zitat-zeichen">â€</span>
            <blockquote>${knoten.zitate[0].text}</blockquote>
            <cite>â€” ${knoten.zitate[0].autor}</cite>
          </div>
        ` : ''}
        
        <div class="empf-popup-aufgaben">
          <h4>âœŠ So kannst du dich konkret einbringen:</h4>
          <div class="aufgaben-liste">
            ${aufgaben.map((aufgabe, i) => `
              <div class="aufgabe-item">
                <span class="aufgabe-nummer">${i + 1}</span>
                <div class="aufgabe-content">
                  <strong>${aufgabe.titel}</strong>
                  <p>${aufgabe.beschreibung}</p>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <button class="empf-popup-mehr" onclick="this.closest('.zimmer-detail-overlay').remove(); showKnoten('${knotenId}');">
          ğŸ“– Mehr Ã¼ber diese Position erfahren
        </button>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', html);
}

// Generiert 3 konkrete Aufgaben fÃ¼r eine Position
function generiereKonkreteAufgaben(achse, position) {
  // Aufgaben-Datenbank (spÃ¤ter durch generierte Texte ersetzen)
  const aufgabenDB = {
    A1: {
      1: [
        { titel: "Lokalpolitik stÃ¤rken", beschreibung: "Engagiere dich in kommunalen Gremien und zeige, dass konkrete Verbesserungen mÃ¶glich sind." },
        { titel: "Reformerfolge dokumentieren", beschreibung: "Sammle Beispiele erfolgreicher Reformen und teile sie in deinen Netzwerken." },
        { titel: "Dialog organisieren", beschreibung: "Organisiere GesprÃ¤chsrunden zwischen verschiedenen linken StrÃ¶mungen Ã¼ber gangbare Wege." }
      ],
      2: [
        { titel: "Strukturreformen entwickeln", beschreibung: "Arbeite an ReformvorschlÃ¤gen, die das System an seine Grenzen bringen." },
        { titel: "Druckmittel koordinieren", beschreibung: "Verbinde parlamentarische Arbeit mit auÃŸerparlamentarischem Druck." },
        { titel: "Reale Utopien aufbauen", beschreibung: "UnterstÃ¼tze Projekte wie das MietshÃ¤user Syndikat oder Genossenschaften." }
      ],
      3: [
        { titel: "Strategiedebatten fÃ¼hren", beschreibung: "Moderiere Diskussionen Ã¼ber Reform und Revolution ohne Dogmatismus." },
        { titel: "Situationsanalysen erstellen", beschreibung: "Analysiere, wann welche Taktik angemessen ist." },
        { titel: "FlexibilitÃ¤t lehren", beschreibung: "Zeige, dass verschiedene Wege je nach Situation richtig sein kÃ¶nnen." }
      ],
      4: [
        { titel: "Krisenbewusstsein schÃ¤rfen", beschreibung: "Analysiere gesellschaftliche Bruchlinien und potenzielle Kipppunkte." },
        { titel: "RevolutionÃ¤re Geschichte vermitteln", beschreibung: "Organisiere Lesekreise zu historischen Revolutionen und ihren Lehren." },
        { titel: "Gegenmacht aufbauen", beschreibung: "StÃ¤rke Strukturen, die im Ernstfall handlungsfÃ¤hig sind." }
      ],
      5: [
        { titel: "Radikale Perspektive wachhalten", beschreibung: "Erinnere in reformistischen Kontexten an die Notwendigkeit grundlegender VerÃ¤nderung." },
        { titel: "Historische Momente analysieren", beschreibung: "Studiere revolutionÃ¤re Situationen und ihre Bedingungen." },
        { titel: "Militanz reflektieren", beschreibung: "Diskutiere die Frage politischer Gewalt offen und differenziert." }
      ]
    },
    // Weitere Achsen...
    B1: {
      1: [
        { titel: "Soziale Marktwirtschaft verteidigen", beschreibung: "Argumentiere fÃ¼r regulierte MÃ¤rkte mit starkem Sozialstaat." },
        { titel: "Genossenschaftsmodelle fÃ¶rdern", beschreibung: "UnterstÃ¼tze marktwirtschaftliche Alternativen wie Genossenschaften." },
        { titel: "Konsument*innen organisieren", beschreibung: "Baue Verbraucher*innennetzwerke fÃ¼r ethischen Konsum auf." }
      ],
      3: [
        { titel: "Hybridmodelle entwickeln", beschreibung: "Experimentiere mit Kombinationen aus Plan und Markt." },
        { titel: "Partizipative Planung testen", beschreibung: "Initiiere lokale Experimente mit demokratischer Wirtschaftsplanung." },
        { titel: "Wirtschaftsdemokratie stÃ¤rken", beschreibung: "KÃ¤mpfe fÃ¼r mehr Mitbestimmung in Betrieben und Branchen." }
      ],
      5: [
        { titel: "Planwirtschaft erforschen", beschreibung: "Studiere historische und theoretische Modelle demokratischer Planung." },
        { titel: "Digitale Planungstools entwickeln", beschreibung: "Arbeite an technischen LÃ¶sungen fÃ¼r dezentrale Koordination." },
        { titel: "Bedarfserhebung organisieren", beschreibung: "Entwickle Methoden, um gesellschaftliche BedÃ¼rfnisse demokratisch zu erfassen." }
      ]
    },
    C2: {
      1: [
        { titel: "ProduktivkrÃ¤fte entwickeln", beschreibung: "Argumentiere fÃ¼r technischen Fortschritt als Basis fÃ¼r Befreiung." },
        { titel: "ArbeitsplÃ¤tze sichern", beschreibung: "Verbinde Ã¶kologische Forderungen mit BeschÃ¤ftigungsperspektiven." },
        { titel: "Modernisierung vorantreiben", beschreibung: "Setze dich fÃ¼r Ã¶kologische Industriepolitik ein." }
      ],
      3: [
        { titel: "Win-Win-LÃ¶sungen finden", beschreibung: "Entwickle Konzepte, die Soziales und Ã–kologisches verbinden." },
        { titel: "Just Transition organisieren", beschreibung: "KÃ¤mpfe fÃ¼r gerechte ÃœbergÃ¤nge in betroffenen Branchen." },
        { titel: "Klimabewegung verbinden", beschreibung: "Baue BrÃ¼cken zwischen Gewerkschaften und Umweltbewegung." }
      ],
      5: [
        { titel: "Eigenrechte der Natur vertreten", beschreibung: "Setze dich fÃ¼r rechtliche Anerkennung von Ã–kosystemen ein." },
        { titel: "Degrowth praktizieren", beschreibung: "Lebe und verbreite Konzepte des guten Lebens jenseits von Wachstum." },
        { titel: "Ã–kosozialismus entwickeln", beschreibung: "Arbeite an einer Synthese von Sozialismus und Ã–kologie." }
      ]
    }
  };
  
  // Fallback-Aufgaben
  const fallback = [
    { titel: "Netzwerke aufbauen", beschreibung: "Verbinde dich mit anderen, die Ã¤hnlich denken, und tauscht euch aus." },
    { titel: "Wissen teilen", beschreibung: "Organisiere Lesekreise oder Workshops zu deinen Themen." },
    { titel: "Praxis wagen", beschreibung: "Setze kleine Projekte um, die deine Ãœberzeugungen sichtbar machen." }
  ];
  
  return aufgabenDB[achse]?.[position] || fallback;
}

// Findet Ã¤hnliche Archetypen basierend auf ideal-Werten
function findeAehnlicheArchetypen(eigenerArchetyp, anzahl = 3) {
  const archetypen = window.archetypen;
  if (!archetypen || !eigenerArchetyp) return [];
  
  const eigener = archetypen[eigenerArchetyp];
  if (!eigener || !eigener.ideal) return [];
  
  const distanzen = [];
  
  Object.entries(archetypen).forEach(([id, arch]) => {
    if (id === eigenerArchetyp || !arch.ideal) return;
    
    // Berechne Distanz
    let distanz = 0;
    Object.keys(eigener.ideal).forEach(achse => {
      const diff = Math.abs((eigener.ideal[achse] || 3) - (arch.ideal[achse] || 3));
      distanz += diff;
    });
    
    distanzen.push({ id, ...arch, distanz });
  });
  
  distanzen.sort((a, b) => a.distanz - b.distanz);
  
  return distanzen.slice(0, anzahl);
}

// Scrollt zum Zimmer in der funktionalen Ansicht
function scrollToZimmer(achse) {
  document.querySelector('.dein-platz').style.display = 'none';
  
  setTimeout(() => {
    const zimmerEl = document.querySelector(`[data-achse="${achse}"]`);
    if (zimmerEl) {
      zimmerEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      zimmerEl.classList.add('highlight-pulse');
      setTimeout(() => zimmerEl.classList.remove('highlight-pulse'), 2000);
    }
  }, 100);
}

// Legacy-Funktion fÃ¼r KompatibilitÃ¤t
function highlightMeineWG(knoten, profil) {
  // Wird jetzt direkt in renderHaus gemacht
}

// parseUrlParams wird im fetch-Callback aufgerufen (siehe oben)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REAKTOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openReaktor(idA, idB) {
  const a = knotenData[idA];
  const b = knotenData[idB];
  if (!a || !b) return;
  
  document.getElementById('reaktor-a').textContent = a.name;
  document.getElementById('reaktor-b').textContent = b.name;
  
  // Analyse
  const analyse = analysiereVerbindung(idA, idB);
  
  let html = '';
  
  // Sektion 1: Direkte Verbindung
  html += '<div class="reaktor-section">';
  html += '<h3>Direkte Verbindung</h3>';
  
  if (analyse.direkteVerbindung) {
    const v = analyse.direkteVerbindung;
    const typ = v.typ === 'debatte' ? 'debatte' : 'direkt';
    html += `<div class="reaktor-verbindung ${typ}">`;
    html += `<div style="font-size: 1.1rem; color: #fff; margin-bottom: 0.5rem;">`;
    html += v.typ === 'debatte' ? 'âš”ï¸ Debatte' : 'ğŸ¤ AffinitÃ¤t';
    html += `</div>`;
    html += `<div style="font-size: 0.9rem; color: #aaa;">${v.beschreibung || ''}</div>`;
    html += `<div style="margin-top: 0.5rem;">`;
    html += `<span style="color: ${v.staerke > 0.7 ? '#4CAF50' : v.staerke > 0.4 ? '#FF9800' : '#f44336'};">`;
    html += `StÃ¤rke: ${Math.round(v.staerke * 100)}%</span>`;
    html += `</div>`;
    html += `</div>`;
  } else {
    html += `<div class="reaktor-verbindung keine">`;
    html += `<div style="color: #888;">Keine direkte Verbindung dokumentiert</div>`;
    html += `<div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem;">`;
    html += `Achsen-Distanz: ${analyse.achsenDistanz !== null ? analyse.achsenDistanz + ' Schritte' : 'verschiedene Achsen'}`;
    html += `</div>`;
    html += `</div>`;
  }
  html += '</div>';
  
  // Sektion 2: Gemeinsame Nachbarn
  html += '<div class="reaktor-section">';
  html += '<h3>Gemeinsame Nachbarn</h3>';
  
  if (analyse.gemeinsameNachbarn.length > 0) {
    html += '<div class="reaktor-nachbarn">';
    analyse.gemeinsameNachbarn.forEach(n => {
      html += `<span class="reaktor-nachbar" onclick="openReaktor('${idA}', '${n.id}')">${n.name}</span>`;
    });
    html += '</div>';
    html += `<div style="font-size: 0.75rem; color: #666; margin-top: 0.5rem;">`;
    html += `Diese Positionen sind mit beiden verbunden`;
    html += `</div>`;
  } else {
    html += `<div style="color: #666; font-size: 0.9rem;">Keine gemeinsamen Nachbarn</div>`;
  }
  
  // KÃ¼rzester Pfad
  if (analyse.pfad && analyse.pfad.length > 2) {
    html += `<div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #333;">`;
    html += `<div style="font-size: 0.75rem; color: #888; margin-bottom: 0.5rem;">KÃ¼rzester Pfad (${analyse.pfad.length - 1} Schritte):</div>`;
    html += `<div style="font-size: 0.85rem; color: #aaa;">`;
    html += analyse.pfad.map(id => knotenData[id]?.name || id).join(' â†’ ');
    html += `</div></div>`;
  }
  html += '</div>';
  
  // Sektion 3: Synthese-Versuch
  html += '<div class="reaktor-section">';
  html += '<h3>Synthese / Spannung</h3>';
  
  const synthese = generiereSynthese(a, b, analyse);
  html += `<div class="reaktor-synthese">${synthese.text}</div>`;
  
  if (synthese.frage) {
    html += `<div class="reaktor-frage">${synthese.frage}</div>`;
  }
  
  // Gemeinsame Bewohner
  if (analyse.gemeinsamePersonen.length > 0) {
    html += `<div style="margin-top: 1rem; font-size: 0.85rem;">`;
    html += `<span style="color: #888;">Personen in beiden:</span> `;
    html += `<span style="color: #ccc;">${analyse.gemeinsamePersonen.join(', ')}</span>`;
    html += `</div>`;
  }
  
  html += '</div>';
  
  document.getElementById('reaktor-body').innerHTML = html;
  document.getElementById('reaktor-panel').classList.add('open');
  closePanel(); // Detail-Panel schlieÃŸen
}

function closeReaktor() {
  document.getElementById('reaktor-panel').classList.remove('open');
}

function analysiereVerbindung(idA, idB) {
  const a = knotenData[idA];
  const b = knotenData[idB];
  
  // Direkte Verbindung?
  const direkteVerbindung = verbindungenData.find(v => 
    (v.von === idA && v.zu === idB) || (v.von === idB && v.zu === idA)
  );
  
  // Nachbarn von A und B
  const nachbarnA = new Set();
  const nachbarnB = new Set();
  
  verbindungenData.forEach(v => {
    if (v.von === idA) nachbarnA.add(v.zu);
    if (v.zu === idA) nachbarnA.add(v.von);
    if (v.von === idB) nachbarnB.add(v.zu);
    if (v.zu === idB) nachbarnB.add(v.von);
  });
  
  // Gemeinsame Nachbarn
  const gemeinsameNachbarn = [...nachbarnA].filter(id => nachbarnB.has(id))
    .map(id => ({ id, name: knotenData[id]?.name }))
    .filter(n => n.name);
  
  // Achsen-Distanz (wenn gleiche Achse)
  let achsenDistanz = null;
  if (a.achse === b.achse) {
    achsenDistanz = Math.abs(a.position - b.position);
  }
  
  // Gemeinsame Personen
  const personenA = new Set([
    ...(a.bewohner?.klassiker || []),
    ...(a.bewohner?.zeitgenossen || [])
  ].map(p => p.replace(/\s*\([^)]*\)/, '')));
  
  const personenB = new Set([
    ...(b.bewohner?.klassiker || []),
    ...(b.bewohner?.zeitgenossen || [])
  ].map(p => p.replace(/\s*\([^)]*\)/, '')));
  
  const gemeinsamePersonen = [...personenA].filter(p => personenB.has(p));
  
  // KÃ¼rzester Pfad (BFS)
  const pfad = findeKÃ¼rzestenPfad(idA, idB);
  
  return {
    direkteVerbindung,
    gemeinsameNachbarn,
    achsenDistanz,
    gemeinsamePersonen,
    pfad
  };
}

function findeKÃ¼rzestenPfad(startId, zielId) {
  const queue = [[startId]];
  const visited = new Set([startId]);
  
  while (queue.length > 0) {
    const pfad = queue.shift();
    const current = pfad[pfad.length - 1];
    
    if (current === zielId) return pfad;
    
    // Nachbarn finden
    const nachbarn = [];
    verbindungenData.forEach(v => {
      if (v.von === current && !visited.has(v.zu)) nachbarn.push(v.zu);
      if (v.zu === current && !visited.has(v.von)) nachbarn.push(v.von);
    });
    
    nachbarn.forEach(n => {
      visited.add(n);
      queue.push([...pfad, n]);
    });
    
    // Abbruch bei zu langen Pfaden
    if (pfad.length > 10) return null;
  }
  
  return null;
}

function generiereSynthese(a, b, analyse) {
  // Verschiedene Synthese-Typen basierend auf der Beziehung
  
  // Gleiche Achse = Spektrum
  if (a.achse === b.achse) {
    const distanz = Math.abs(a.position - b.position);
    if (distanz <= 1) {
      return {
        text: `${a.name} und ${b.name} sind Nachbarn auf der ${a.achse}-Achse. Sie teilen Grundannahmen, unterscheiden sich aber in der IntensitÃ¤t oder Konsequenz.`,
        frage: `Was genau ist der Unterschied? Ist es eine Frage des Grades oder des Prinzips?`
      };
    } else if (distanz >= 3) {
      return {
        text: `${a.name} und ${b.name} markieren gegensÃ¤tzliche Pole derselben Frage. Die Spannung zwischen ihnen definiert das gesamte Spektrum der ${a.achse}-Debatte.`,
        frage: `Gibt es eine Position in der Mitte, die beide versÃ¶hnt â€“ oder ist die Spannung unauflÃ¶sbar?`
      };
    }
  }
  
  // Debatte
  if (analyse.direkteVerbindung?.typ === 'debatte') {
    return {
      text: `Hier treffen historische Gegner aufeinander. Die Debatte zwischen ${a.name} und ${b.name} hat die Linke geprÃ¤gt und gespalten.`,
      frage: `Wer hatte recht? Oder ist die Frage falsch gestellt?`
    };
  }
  
  // Hohe AffinitÃ¤t
  if (analyse.direkteVerbindung?.staerke > 0.8) {
    return {
      text: `${a.name} und ${b.name} gehÃ¶ren zusammen wie zwei Seiten einer Medaille. Wer das eine denkt, denkt meist auch das andere.`,
      frage: `Muss das so sein? Kann man das eine ohne das andere haben?`
    };
  }
  
  // Gemeinsame Nachbarn
  if (analyse.gemeinsameNachbarn.length > 0) {
    const brÃ¼cken = analyse.gemeinsameNachbarn.slice(0, 3).map(n => n.name).join(', ');
    return {
      text: `${a.name} und ${b.name} haben keine direkte Verbindung, aber gemeinsame Nachbarn: ${brÃ¼cken}. Diese kÃ¶nnten als BrÃ¼cke dienen.`,
      frage: `Was wÃ¼rde passieren, wenn jemand versucht, ${a.name} und ${b.name} direkt zu verbinden?`
    };
  }
  
  // Verschiedene Achsen, keine Verbindung
  return {
    text: `${a.name} (${a.achse}) und ${b.name} (${b.achse}) bewegen sich auf verschiedenen Achsen des Denkens. Ihre Begegnung wÃ¤re ein Experiment.`,
    frage: `Was wÃ¼rde ${a.bewohner?.klassiker?.[0]?.replace(/\s*\([^)]*\)/, '') || 'ein Vertreter von ' + a.name} zu ${b.name} sagen?`
  };
}
  </script>
</body>
</html>
